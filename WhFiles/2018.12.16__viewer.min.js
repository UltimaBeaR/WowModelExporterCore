(function($){if(!$.fn.on){$.fn.on=function(events,selector,data,handler){var self=this;var args=arguments.length;if(args>3){return self.delegate(selector,events,data,handler)}else if(args>2){if(typeof selector==="string"){return self.delegate(selector,events,data)}else{return self.bind(events,selector,data)}}else{return self.bind(events,selector)}}}if(!$.fn.off){$.fn.off=function(events,selector,handler){var self=this;var args=arguments.length;if(typeof selector==="string"){if(args>2){return self.undelegate(selector,events,handler)}else if(args>1){return self.undelegate(selector,events)}else{return self.undelegate()}}else{if(args>1){handler=selector;return self.unbind(events,handler)}else if(args>0){return self.unbind(events)}else{return self.unbind()}}}}})(this.jQuery);(function(_global){"use strict";var shim={};if(typeof exports==="undefined"){if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){shim.exports={};define(function(){return shim.exports})}else{shim.exports=typeof window!=="undefined"?window:_global}}else{shim.exports=exports}(function(exports){if(!GLMAT_EPSILON){var GLMAT_EPSILON=1e-6}if(!GLMAT_ARRAY_TYPE){var GLMAT_ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array}if(!GLMAT_RANDOM){var GLMAT_RANDOM=Math.random}var glMatrix={};glMatrix.setMatrixArrayType=function(type){GLMAT_ARRAY_TYPE=type};if(typeof exports!=="undefined"){exports.glMatrix=glMatrix}var degree=Math.PI/180;glMatrix.toRadian=function(a){return a*degree};var vec2={};vec2.create=function(){var out=new GLMAT_ARRAY_TYPE(2);out[0]=0;out[1]=0;return out};vec2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out};vec2.fromValues=function(x,y){var out=new GLMAT_ARRAY_TYPE(2);out[0]=x;out[1]=y;return out};vec2.copy=function(out,a){out[0]=a[0];out[1]=a[1];return out};vec2.set=function(out,x,y){out[0]=x;out[1]=y;return out};vec2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out};vec2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out};vec2.sub=vec2.subtract;vec2.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out};vec2.mul=vec2.multiply;vec2.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out};vec2.div=vec2.divide;vec2.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out};vec2.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out};vec2.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out};vec2.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out};vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};vec2.dist=vec2.distance;vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};vec2.len=vec2.length;vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];return out};vec2.normalize=function(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out};vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};vec2.cross=function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out};vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out};vec2.random=function(out,scale){scale=scale||1;var r=GLMAT_RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out};vec2.transformMat2=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out};vec2.transformMat2d=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out};vec2.transformMat3=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out};vec2.transformMat4=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out};vec2.forEach=function(){var vec=vec2.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=2}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}}();vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};if(typeof exports!=="undefined"){exports.vec2=vec2}var vec3={};vec3.create=function(){var out=new GLMAT_ARRAY_TYPE(3);out[0]=0;out[1]=0;out[2]=0;return out};vec3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.fromValues=function(x,y,z){var out=new GLMAT_ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out};vec3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.set=function(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out};vec3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out};vec3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out};vec3.sub=vec3.subtract;vec3.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out};vec3.mul=vec3.multiply;vec3.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out};vec3.div=vec3.divide;vec3.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out};vec3.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out};vec3.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out};vec3.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out};vec3.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.dist=vec3.distance;vec3.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z};vec3.sqrDist=vec3.squaredDistance;vec3.length=function(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.len=vec3.length;vec3.squaredLength=function(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z};vec3.sqrLen=vec3.squaredLength;vec3.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out};vec3.normalize=function(out,a){var x=a[0],y=a[1],z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.cross=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out};vec3.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out};vec3.random=function(out,scale){scale=scale||1;var r=GLMAT_RANDOM()*2*Math.PI;var z=GLMAT_RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=Math.sin(r)*zScale;out[2]=z*scale;return out};vec3.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12];out[1]=m[1]*x+m[5]*y+m[9]*z+m[13];out[2]=m[2]*x+m[6]*y+m[10]*z+m[14];return out};vec3.transformMat3=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out};vec3.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec3.rotateX=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c);r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateY=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c);r[1]=p[1];r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.rotateZ=function(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c);r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out};vec3.forEach=function(){var vec=vec3.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=3}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}}();vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};if(typeof exports!=="undefined"){exports.vec3=vec3}var vec4={};vec4.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out};vec4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.fromValues=function(x,y,z,w){var out=new GLMAT_ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.set=function(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};vec4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};vec4.sub=vec4.subtract;vec4.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out};vec4.mul=vec4.multiply;vec4.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out};vec4.div=vec4.divide;vec4.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out};vec4.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out};vec4.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};vec4.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out};vec4.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.dist=vec4.distance;vec4.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w};vec4.sqrDist=vec4.squaredDistance;vec4.length=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.len=vec4.length;vec4.squaredLength=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w};vec4.sqrLen=vec4.squaredLength;vec4.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out};vec4.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len;out[3]=a[3]*len}return out};vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};vec4.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out};vec4.random=function(out,scale){scale=scale||1;out[0]=GLMAT_RANDOM();out[1]=GLMAT_RANDOM();out[2]=GLMAT_RANDOM();out[3]=GLMAT_RANDOM();vec4.normalize(out,out);vec4.scale(out,out,scale);return out};vec4.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out};vec4.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec4.forEach=function(){var vec=vec4.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=4}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}}();vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof exports!=="undefined"){exports.vec4=vec4}var mat2={};mat2.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.transpose=function(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out};mat2.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;if(!det){return null}det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out};mat2.adjoint=function(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out};mat2.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};mat2.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out};mat2.mul=mat2.multiply;mat2.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out};mat2.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out};mat2.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};mat2.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};mat2.LDU=function(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U]};if(typeof exports!=="undefined"){exports.mat2=mat2}var mat2d={};mat2d.create=function(){var out=new GLMAT_ARRAY_TYPE(6);out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.clone=function(a){var out=new GLMAT_ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.invert=function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out};mat2d.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};mat2d.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out};mat2d.mul=mat2d.multiply;mat2d.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out};mat2d.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out};mat2d.translate=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out};mat2d.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};mat2d.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};if(typeof exports!=="undefined"){exports.mat2d=mat2d}var mat3={};mat3.create=function(){var out=new GLMAT_ARRAY_TYPE(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat4=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out};mat3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out};mat3.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out};mat3.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out};mat3.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out};mat3.mul=mat3.multiply;mat3.translate=function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out};mat3.rotate=function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out};mat3.scale=function(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromMat2d=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out};mat3.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out};mat3.normalFromMat4=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out};mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};mat3.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};if(typeof exports!=="undefined"){exports.mat3=mat3}var mat4={};mat4.create=function(){var out=new GLMAT_ARRAY_TYPE(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out};mat4.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out};mat4.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return out};mat4.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out};mat4.mul=mat4.multiply;mat4.translate=function(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out};mat4.scale=function(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.rotate=function(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<GLMAT_EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out};mat4.rotateX=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out};mat4.rotateY=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out};mat4.rotateZ=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out};mat4.fromRotationTranslation=function(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.frustum=function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out};mat4.perspective=function(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return out};mat4.ortho=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out};mat4.lookAt=function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<GLMAT_EPSILON&&Math.abs(eyey-centery)<GLMAT_EPSILON&&Math.abs(eyez-centerz)<GLMAT_EPSILON){return mat4.identity(out)}z0=eyex-centerx;z1=eyey-centery
;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out};mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};mat4.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};if(typeof exports!=="undefined"){exports.mat4=mat4}var quat={};quat.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.rotationTo=function(){var tmpvec3=vec3.create();var xUnitVec3=vec3.fromValues(1,0,0);var yUnitVec3=vec3.fromValues(0,1,0);return function(out,a,b){var dot=vec3.dot(a,b);if(dot<-.999999){vec3.cross(tmpvec3,xUnitVec3,a);if(vec3.length(tmpvec3)<1e-6)vec3.cross(tmpvec3,yUnitVec3,a);vec3.normalize(tmpvec3,tmpvec3);quat.setAxisAngle(out,tmpvec3,Math.PI);return out}else if(dot>.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{vec3.cross(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return quat.normalize(out,out)}}}();quat.setAxes=function(){var matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return quat.normalize(out,quat.fromMat3(out,matr))}}();quat.clone=vec4.clone;quat.fromValues=vec4.fromValues;quat.copy=vec4.copy;quat.set=vec4.set;quat.identity=function(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.setAxisAngle=function(out,axis,rad){rad=rad*.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out};quat.add=vec4.add;quat.multiply=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out};quat.mul=quat.multiply;quat.scale=vec4.scale;quat.rotateX=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out};quat.rotateY=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out};quat.rotateZ=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out};quat.calculateW=function(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=-Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out};quat.dot=vec4.dot;quat.lerp=vec4.lerp;quat.slerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>1e-6){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out};quat.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out};quat.conjugate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out};quat.length=vec4.length;quat.len=quat.length;quat.squaredLength=vec4.squaredLength;quat.sqrLen=quat.squaredLength;quat.normalize=vec4.normalize;quat.fromMat3=function(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=.5*fRoot;fRoot=.5/fRoot;out[0]=(m[7]-m[5])*fRoot;out[1]=(m[2]-m[6])*fRoot;out[2]=(m[3]-m[1])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=.5*fRoot;fRoot=.5/fRoot;out[3]=(m[k*3+j]-m[j*3+k])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out};quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof exports!=="undefined"){exports.quat=quat}})(shim.exports)})(this);!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.pako=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";var zlib_inflate=_dereq_("./zlib/inflate.js");var utils=_dereq_("./utils/common");var strings=_dereq_("./utils/strings");var c=_dereq_("./zlib/constants");var msg=_dereq_("./zlib/messages");var zstream=_dereq_("./zlib/zstream");var gzheader=_dereq_("./zlib/gzheader");var Inflate=function(options){this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>=0&&opt.windowBits<16){opt.windowBits=-opt.windowBits;if(opt.windowBits===0){opt.windowBits=-15}}if(opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits)){opt.windowBits+=32}if(opt.windowBits>15&&opt.windowBits<48){if((opt.windowBits&15)===0){opt.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new zstream;this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK){throw new Error(msg[status])}this.header=new gzheader;zlib_inflate.inflateGetHeader(this.strm,this.header)};Inflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var status,_mode;var next_out_utf8,tail,utf8str;if(this.ended){return false}_mode=mode===~~mode?mode:mode===true?c.Z_FINISH:c.Z_NO_FLUSH;if(typeof data==="string"){strm.input=strings.binstring2buf(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH);if(status!==c.Z_STREAM_END&&status!==c.Z_OK){this.onEnd(status);this.ended=true;return false}if(strm.next_out){if(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&_mode===c.Z_FINISH){if(this.options.to==="string"){next_out_utf8=strings.utf8border(strm.output,strm.next_out);tail=strm.next_out-next_out_utf8;utf8str=strings.buf2string(strm.output,next_out_utf8);strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail){utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0)}this.onData(utf8str)}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out))}}}}while(strm.avail_in>0&&status!==c.Z_STREAM_END);if(status===c.Z_STREAM_END){_mode=c.Z_FINISH}if(_mode===c.Z_FINISH){status=zlib_inflate.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===c.Z_OK}return true};Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate.prototype.onEnd=function(status){if(status===c.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function inflate(input,options){var inflator=new Inflate(options);inflator.push(input,true);if(inflator.err){throw inflator.msg}return inflator.result}function inflateRaw(input,options){options=options||{};options.raw=true;return inflate(input,options)}exports.Inflate=Inflate;exports.inflate=inflate;exports.inflateRaw=inflateRaw;exports.ungzip=inflate},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,"./zlib/messages":11,"./zlib/zstream":12}],2:[function(_dereq_,module,exports){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(source.hasOwnProperty(p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],3:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("./common");var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=false}var _utf8len=new utils.Buf8(256);for(var i=0;i<256;i++){_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1}_utf8len[254]=_utf8len[254]=1;exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}buf=new utils.Buf8(buf_len);for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}if(c<128){buf[i++]=c}else if(c<2048){buf[i++]=192|c>>>6;buf[i++]=128|c&63}else if(c<65536){buf[i++]=224|c>>>12;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}else{buf[i++]=240|c>>>18;buf[i++]=128|c>>>12&63;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}}return buf};function buf2binstring(buf,len){if(len<65537){if(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK){return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len))}}var result="";for(var i=0;i<len;i++){result+=String.fromCharCode(buf[i])}return result}exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)};exports.binstring2buf=function(str){var buf=new utils.Buf8(str.length);for(var i=0,len=buf.length;i<len;i++){buf[i]=str.charCodeAt(i)}return buf};exports.buf2string=function(buf,max){var i,out,c,c_len;var len=max||buf.length;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];if(c<128){utf16buf[out++]=c;continue}c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i+=c_len-1;continue}c&=c_len===2?31:c_len===3?15:7;while(c_len>1&&i<len){c=c<<6|buf[i++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536){utf16buf[out++]=c}else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|c&1023}}return buf2binstring(utf16buf,out)};exports.utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length}pos=max-1;while(pos>=0&&(buf[pos]&192)===128){pos--}if(pos<0){return max}if(pos===0){return max}return pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":2}],4:[function(_dereq_,module,exports){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],5:[function(_dereq_,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(_dereq_,module,exports){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc=crc^-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1}module.exports=crc32},{}],7:[function(_dereq_,module,exports){"use strict";function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}module.exports=GZheader},{}],8:[function(_dereq_,module,exports){"use strict";var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}}from=0;from_source=window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],9:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common");var adler32=_dereq_("./adler32");var crc32=_dereq_("./crc32");var inflate_fast=_dereq_("./inffast");var inflate_table=_dereq_("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function ZSWAP32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0}function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}utils.arraySet(state.head.extra,input,next,copy,len)}if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=ZSWAP32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits
;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)}_out=left;if((state.flags?hold:ZSWAP32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}state.head=head;head.done=false;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(_dereq_,module,exports){"use strict";var utils=_dereq_("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}var i=0;for(;;){i++;here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},{"../utils/common":2}],11:[function(_dereq_,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(_dereq_,module,exports){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=ZStream},{}]},{},[1])(1)});var swfobject=function(){var D="undefined",r="object",T="Shockwave Flash",Z="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",S="SWFObjectExprInst",x="onreadystatechange",Q=window,h=document,t=navigator,V=false,X=[],o=[],P=[],K=[],I,p,E,B,L=false,a=false,m,G,j=true,l=false,O=function(){var ad=typeof h.getElementById!=D&&typeof h.getElementsByTagName!=D&&typeof h.createElement!=D,ak=t.userAgent.toLowerCase(),ab=t.platform.toLowerCase(),ah=ab?/win/.test(ab):/win/.test(ak),af=ab?/mac/.test(ab):/mac/.test(ak),ai=/webkit/.test(ak)?parseFloat(ak.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,aa=t.appName==="Microsoft Internet Explorer",aj=[0,0,0],ae=null;if(typeof t.plugins!=D&&typeof t.plugins[T]==r){ae=t.plugins[T].description;if(ae&&(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&t.mimeTypes[q].enabledPlugin)){V=true;aa=false;ae=ae.replace(/^.*\s+(\S+\s+\S+$)/,"$1");aj[0]=n(ae.replace(/^(.*)\..*$/,"$1"));aj[1]=n(ae.replace(/^.*\.(.*)\s.*$/,"$1"));aj[2]=/[a-zA-Z]/.test(ae)?n(ae.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0}}else{if(typeof Q.ActiveXObject!=D){try{var ag=new ActiveXObject(Z);if(ag){ae=ag.GetVariable("$version");if(ae){aa=true;ae=ae.split(" ")[1].split(",");aj=[n(ae[0]),n(ae[1]),n(ae[2])]}}}catch(ac){}}}return{w3:ad,pv:aj,wk:ai,ie:aa,win:ah,mac:af}}(),i=function(){if(!O.w3){return}if(typeof h.readyState!=D&&(h.readyState==="complete"||h.readyState==="interactive")||typeof h.readyState==D&&(h.getElementsByTagName("body")[0]||h.body)){f()}if(!L){if(typeof h.addEventListener!=D){h.addEventListener("DOMContentLoaded",f,false)}if(O.ie){h.attachEvent(x,function aa(){if(h.readyState=="complete"){h.detachEvent(x,aa);f()}});if(Q==top){(function ac(){if(L){return}try{h.documentElement.doScroll("left")}catch(ad){setTimeout(ac,0);return}f()})()}}if(O.wk){(function ab(){if(L){return}if(!/loaded|complete/.test(h.readyState)){setTimeout(ab,0);return}f()})()}}}();function f(){if(L||!document.getElementsByTagName("body")[0]){return}try{var ac,ad=C("span");ad.style.display="none";ac=h.getElementsByTagName("body")[0].appendChild(ad);ac.parentNode.removeChild(ac);ac=null;ad=null}catch(ae){return}L=true;var aa=X.length;for(var ab=0;ab<aa;ab++){X[ab]()}}function M(aa){if(L){aa()}else{X[X.length]=aa}}function s(ab){if(typeof Q.addEventListener!=D){Q.addEventListener("load",ab,false)}else{if(typeof h.addEventListener!=D){h.addEventListener("load",ab,false)}else{if(typeof Q.attachEvent!=D){g(Q,"onload",ab)}else{if(typeof Q.onload=="function"){var aa=Q.onload;Q.onload=function(){aa();ab()}}else{Q.onload=ab}}}}}function Y(){var aa=h.getElementsByTagName("body")[0];var ae=C(r);ae.setAttribute("style","visibility: hidden;");ae.setAttribute("type",q);var ad=aa.appendChild(ae);if(ad){var ac=0;(function ab(){if(typeof ad.GetVariable!=D){try{var ag=ad.GetVariable("$version");if(ag){ag=ag.split(" ")[1].split(",");O.pv=[n(ag[0]),n(ag[1]),n(ag[2])]}}catch(af){O.pv=[8,0,0]}}else{if(ac<10){ac++;setTimeout(ab,10);return}}aa.removeChild(ae);ad=null;H()})()}else{H()}}function H(){var aj=o.length;if(aj>0){for(var ai=0;ai<aj;ai++){var ab=o[ai].id;var ae=o[ai].callbackFn;var ad={success:false,id:ab};if(O.pv[0]>0){var ah=c(ab);if(ah){if(F(o[ai].swfVersion)&&!(O.wk&&O.wk<312)){w(ab,true);if(ae){ad.success=true;ad.ref=z(ab);ad.id=ab;ae(ad)}}else{if(o[ai].expressInstall&&A()){var al={};al.data=o[ai].expressInstall;al.width=ah.getAttribute("width")||"0";al.height=ah.getAttribute("height")||"0";if(ah.getAttribute("class")){al.styleclass=ah.getAttribute("class")}if(ah.getAttribute("align")){al.align=ah.getAttribute("align")}var ak={};var aa=ah.getElementsByTagName("param");var af=aa.length;for(var ag=0;ag<af;ag++){if(aa[ag].getAttribute("name").toLowerCase()!="movie"){ak[aa[ag].getAttribute("name")]=aa[ag].getAttribute("value")}}R(al,ak,ab,ae)}else{b(ah);if(ae){ae(ad)}}}}}else{w(ab,true);if(ae){var ac=z(ab);if(ac&&typeof ac.SetVariable!=D){ad.success=true;ad.ref=ac;ad.id=ac.id}ae(ad)}}}}}X[0]=function(){if(V){Y()}else{H()}};function z(ac){var aa=null,ab=c(ac);if(ab&&ab.nodeName.toUpperCase()==="OBJECT"){if(typeof ab.SetVariable!==D){aa=ab}else{aa=ab.getElementsByTagName(r)[0]||ab}}return aa}function A(){return!a&&F("6.0.65")&&(O.win||O.mac)&&!(O.wk&&O.wk<312)}function R(ad,ae,aa,ac){var ah=c(aa);aa=W(aa);a=true;E=ac||null;B={success:false,id:aa};if(ah){if(ah.nodeName.toUpperCase()=="OBJECT"){I=J(ah);p=null}else{I=ah;p=aa}ad.id=S;if(typeof ad.width==D||!/%$/.test(ad.width)&&n(ad.width)<310){ad.width="310"}if(typeof ad.height==D||!/%$/.test(ad.height)&&n(ad.height)<137){ad.height="137"}var ag=O.ie?"ActiveX":"PlugIn",af="MMredirectURL="+encodeURIComponent(Q.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+ag+"&MMdoctitle="+encodeURIComponent(h.title.slice(0,47)+" - Flash Player Installation");if(typeof ae.flashvars!=D){ae.flashvars+="&"+af}else{ae.flashvars=af}if(O.ie&&ah.readyState!=4){var ab=C("div");aa+="SWFObjectNew";ab.setAttribute("id",aa);ah.parentNode.insertBefore(ab,ah);ah.style.display="none";y(ah)}u(ad,ae,aa)}}function b(ab){if(O.ie&&ab.readyState!=4){ab.style.display="none";var aa=C("div");ab.parentNode.insertBefore(aa,ab);aa.parentNode.replaceChild(J(ab),aa);y(ab)}else{ab.parentNode.replaceChild(J(ab),ab)}}function J(af){var ae=C("div");if(O.win&&O.ie){ae.innerHTML=af.innerHTML}else{var ab=af.getElementsByTagName(r)[0];if(ab){var ag=ab.childNodes;if(ag){var aa=ag.length;for(var ad=0;ad<aa;ad++){if(!(ag[ad].nodeType==1&&ag[ad].nodeName=="PARAM")&&!(ag[ad].nodeType==8)){ae.appendChild(ag[ad].cloneNode(true))}}}}}return ae}function k(aa,ab){var ac=C("div");ac.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+aa+"'>"+ab+"</object>";return ac.firstChild}function u(ai,ag,ab){var aa,ad=c(ab);ab=W(ab);if(O.wk&&O.wk<312){return aa}if(ad){var ac=O.ie?C("div"):C(r),af,ah,ae;if(typeof ai.id==D){ai.id=ab}for(ae in ag){if(ag.hasOwnProperty(ae)&&ae.toLowerCase()!=="movie"){e(ac,ae,ag[ae])}}if(O.ie){ac=k(ai.data,ac.innerHTML)}for(af in ai){if(ai.hasOwnProperty(af)){ah=af.toLowerCase();if(ah==="styleclass"){ac.setAttribute("class",ai[af])}else{if(ah!=="classid"&&ah!=="data"){ac.setAttribute(af,ai[af])}}}}if(O.ie){P[P.length]=ai.id}else{ac.setAttribute("type",q);ac.setAttribute("data",ai.data)}ad.parentNode.replaceChild(ac,ad);aa=ac}return aa}function e(ac,aa,ab){var ad=C("param");ad.setAttribute("name",aa);ad.setAttribute("value",ab);ac.appendChild(ad)}function y(ac){var ab=c(ac);if(ab&&ab.nodeName.toUpperCase()=="OBJECT"){if(O.ie){ab.style.display="none";(function aa(){if(ab.readyState==4){for(var ad in ab){if(typeof ab[ad]=="function"){ab[ad]=null}}ab.parentNode.removeChild(ab)}else{setTimeout(aa,10)}})()}else{ab.parentNode.removeChild(ab)}}}function U(aa){return aa&&aa.nodeType&&aa.nodeType===1}function W(aa){return U(aa)?aa.id:aa}function c(ac){if(U(ac)){return ac}var aa=null;try{aa=h.getElementById(ac)}catch(ab){}return aa}function C(aa){return h.createElement(aa)}function n(aa){return parseInt(aa,10)}function g(ac,aa,ab){ac.attachEvent(aa,ab);K[K.length]=[ac,aa,ab]}function F(ac){ac+="";var ab=O.pv,aa=ac.split(".");aa[0]=n(aa[0]);aa[1]=n(aa[1])||0;aa[2]=n(aa[2])||0;return ab[0]>aa[0]||ab[0]==aa[0]&&ab[1]>aa[1]||ab[0]==aa[0]&&ab[1]==aa[1]&&ab[2]>=aa[2]?true:false}function v(af,ab,ag,ae){var ad=h.getElementsByTagName("head")[0];if(!ad){return}var aa=typeof ag=="string"?ag:"screen";if(ae){m=null;G=null}if(!m||G!=aa){var ac=C("style");ac.setAttribute("type","text/css");ac.setAttribute("media",aa);m=ad.appendChild(ac);if(O.ie&&typeof h.styleSheets!=D&&h.styleSheets.length>0){m=h.styleSheets[h.styleSheets.length-1]}G=aa}if(m){if(typeof m.addRule!=D){m.addRule(af,ab)}else{if(typeof h.createTextNode!=D){m.appendChild(h.createTextNode(af+" {"+ab+"}"))}}}}function w(ad,aa){if(!j){return}var ab=aa?"visible":"hidden",ac=c(ad);if(L&&ac){ac.style.visibility=ab}else{if(typeof ad==="string"){v("#"+ad,"visibility:"+ab)}}}function N(ab){var ac=/[\\\"<>\.;]/;var aa=ac.exec(ab)!=null;return aa&&typeof encodeURIComponent!=D?encodeURIComponent(ab):ab}var d=function(){if(O.ie){window.attachEvent("onunload",function(){var af=K.length;for(var ae=0;ae<af;ae++){K[ae][0].detachEvent(K[ae][1],K[ae][2])}var ac=P.length;for(var ad=0;ad<ac;ad++){y(P[ad])}for(var ab in O){O[ab]=null}O=null;for(var aa in swfobject){swfobject[aa]=null}swfobject=null})}}();return{registerObject:function(ae,aa,ad,ac){if(O.w3&&ae&&aa){var ab={};ab.id=ae;ab.swfVersion=aa;ab.expressInstall=ad;ab.callbackFn=ac;o[o.length]=ab;w(ae,false)}else{if(ac){ac({success:false,id:ae})}}},getObjectById:function(aa){if(O.w3){return z(aa)}},embedSWF:function(af,al,ai,ak,ab,ae,ad,ah,aj,ag){var ac=W(al),aa={success:false,id:ac};if(O.w3&&!(O.wk&&O.wk<312)&&af&&al&&ai&&ak&&ab){w(ac,false);M(function(){ai+="";ak+="";var an={};if(aj&&typeof aj===r){for(var aq in aj){an[aq]=aj[aq]}}an.data=af;an.width=ai;an.height=ak;var ar={};if(ah&&typeof ah===r){for(var ao in ah){ar[ao]=ah[ao]}}if(ad&&typeof ad===r){for(var am in ad){if(ad.hasOwnProperty(am)){var ap=l?encodeURIComponent(am):am,at=l?encodeURIComponent(ad[am]):ad[am];if(typeof ar.flashvars!=D){ar.flashvars+="&"+ap+"="+at}else{ar.flashvars=ap+"="+at}}}}if(F(ab)){var au=u(an,ar,al);if(an.id==ac){w(ac,true)}aa.success=true;aa.ref=au;aa.id=au.id}else{if(ae&&A()){an.data=ae;R(an,ar,al,ag);return}else{w(ac,true)}}if(ag){ag(aa)}})}else{if(ag){ag(aa)}}},switchOffAutoHideShow:function(){j=false},enableUriEncoding:function(aa){l=typeof aa===D?true:aa},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(ac,ab,aa){if(O.w3){return u(ac,ab,aa)}else{return undefined}},showExpressInstall:function(ac,ad,aa,ab){if(O.w3&&A()){R(ac,ad,aa,ab)}},removeSWF:function(aa){if(O.w3){y(aa)}},createCSS:function(ad,ac,ab,aa){if(O.w3){v(ad,ac,ab,aa)}},addDomLoadEvent:M,addLoadEvent:s,getQueryParamValue:function(ad){var ac=h.location.search||h.location.hash;if(ac){if(/\?/.test(ac)){ac=ac.split("?")[1]}if(ad==null){return N(ac)}var ab=ac.split("&");for(var aa=0;aa<ab.length;aa++){if(ab[aa].substring(0,ab[aa].indexOf("="))==ad){return N(ab[aa].substring(ab[aa].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(a){var aa=c(S);if(aa&&I){aa.parentNode.replaceChild(I,aa);if(p){w(p,true);if(O.ie){I.style.display="block"}}if(E){E(B)}}a=false}},version:"2.3"}}();(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["twgl"]=factory();else root["twgl"]=factory()})(typeof self!=="undefined"?self:this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=9)}([function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.copyExistingProperties=copyExistingProperties;exports.copyNamedProperties=copyNamedProperties;exports.isBuffer=isBuffer;exports.isRenderbuffer=isRenderbuffer;exports.isShader=isShader;exports.isTexture=isTexture;exports.isSampler=isSampler;exports.warn=exports.error=void 0;var _globalObject=_interopRequireDefault(__webpack_require__(2));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function copyNamedProperties(names,src,dst){names.forEach(function(name){var value=src[name];if(value!==undefined){dst[name]=value}})}function copyExistingProperties(src,dst){Object.keys(dst).forEach(function(key){if(dst.hasOwnProperty(key)&&src.hasOwnProperty(key)){dst[key]=src[key]}})}var error=_globalObject.default.console&&_globalObject.default.console.error&&typeof _globalObject.default.console.error==="function"?_globalObject.default.console.error.bind(_globalObject.default.console):function(){};exports.error=error;var warn=_globalObject.default.console&&_globalObject.default.console.warn&&typeof _globalObject.default.console.warn==="function"?_globalObject.default.console.warn.bind(_globalObject.default.console):function(){};exports.warn=warn;var repBuffer;function isBuffer(gl,t){if(!repBuffer){repBuffer=gl.createBuffer()}return t instanceof repBuffer.constructor}var repRenderbuffer;function isRenderbuffer(gl,t){if(!repRenderbuffer){repRenderbuffer=gl.createRenderbuffer()}return t instanceof repRenderbuffer.constructor}var repShader;function isShader(gl,t){if(!repShader){repShader=gl.createShader(gl.VERTEX_SHADER)}return t instanceof repShader.constructor}var repTexture;function isTexture(gl,t){if(!repTexture){repTexture=gl.createTexture()}return t instanceof repTexture.constructor}var repSampler;function isSampler(gl,t){if(!repSampler){if(gl.createSampler){repSampler=gl.createSampler()}else{return false}}return t instanceof repSampler.constructor}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.getGLTypeForTypedArray=getGLTypeForTypedArray;exports.getGLTypeForTypedArrayType=getGLTypeForTypedArrayType;exports.getTypedArrayTypeForGLType=getTypedArrayTypeForGLType;exports.isArrayBuffer=void 0;var _globalObject=_interopRequireDefault(__webpack_require__(2));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var gl=undefined;var BYTE=5120;var UNSIGNED_BYTE=5121;var SHORT=5122;var UNSIGNED_SHORT=5123;var INT=5124;var UNSIGNED_INT=5125;var FLOAT=5126;var UNSIGNED_SHORT_4_4_4_4=32819;var UNSIGNED_SHORT_5_5_5_1=32820;var UNSIGNED_SHORT_5_6_5=33635;var HALF_FLOAT=5131;var UNSIGNED_INT_2_10_10_10_REV=33640;var UNSIGNED_INT_10F_11F_11F_REV=35899;var UNSIGNED_INT_5_9_9_9_REV=35902;var FLOAT_32_UNSIGNED_INT_24_8_REV=36269;var UNSIGNED_INT_24_8=34042;var glTypeToTypedArray={};{var tt=glTypeToTypedArray;tt[BYTE]=Int8Array;tt[UNSIGNED_BYTE]=Uint8Array;tt[SHORT]=Int16Array;tt[UNSIGNED_SHORT]=Uint16Array;tt[INT]=Int32Array;tt[UNSIGNED_INT]=Uint32Array;tt[FLOAT]=Float32Array;tt[UNSIGNED_SHORT_4_4_4_4]=Uint16Array;tt[UNSIGNED_SHORT_5_5_5_1]=Uint16Array;tt[UNSIGNED_SHORT_5_6_5]=Uint16Array;tt[HALF_FLOAT]=Uint16Array;tt[UNSIGNED_INT_2_10_10_10_REV]=Uint32Array;tt[UNSIGNED_INT_10F_11F_11F_REV]=Uint32Array;tt[UNSIGNED_INT_5_9_9_9_REV]=Uint32Array;tt[FLOAT_32_UNSIGNED_INT_24_8_REV]=Uint32Array;tt[UNSIGNED_INT_24_8]=Uint32Array}function getGLTypeForTypedArray(typedArray){if(typedArray instanceof Int8Array){return BYTE}if(typedArray instanceof Uint8Array){return UNSIGNED_BYTE}if(typedArray instanceof Uint8ClampedArray){return UNSIGNED_BYTE}if(typedArray instanceof Int16Array){return SHORT}if(typedArray instanceof Uint16Array){return UNSIGNED_SHORT}if(typedArray instanceof Int32Array){return INT}if(typedArray instanceof Uint32Array){return UNSIGNED_INT}if(typedArray instanceof Float32Array){return FLOAT}throw"unsupported typed array type"}function getGLTypeForTypedArrayType(typedArrayType){if(typedArrayType===Int8Array){return BYTE}if(typedArrayType===Uint8Array){return UNSIGNED_BYTE}if(typedArrayType===Uint8ClampedArray){return UNSIGNED_BYTE}if(typedArrayType===Int16Array){return SHORT}if(typedArrayType===Uint16Array){return UNSIGNED_SHORT}if(typedArrayType===Int32Array){return INT}if(typedArrayType===Uint32Array){return UNSIGNED_INT}if(typedArrayType===Float32Array){return FLOAT}throw"unsupported typed array type"}function getTypedArrayTypeForGLType(type){var CTOR=glTypeToTypedArray[type];if(!CTOR){throw"unknown gl type"}return CTOR}var isArrayBuffer=_globalObject.default.SharedArrayBuffer?function isArrayBufferOrSharedArrayBuffer(a){return a&&a.buffer&&(a.buffer instanceof ArrayBuffer||a.buffer instanceof _globalObject.default.SharedArrayBuffer)}:function isArrayBuffer(a){return a&&a.buffer&&a.buffer instanceof ArrayBuffer};exports.isArrayBuffer=isArrayBuffer},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.default=void 0;var global=typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};exports.default=global},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.add=add;exports.copy=copy;exports.create=create;exports.cross=cross;exports.distance=distance;exports.distanceSq=distanceSq;exports.divide=divide;exports.divScalar=divScalar;exports.dot=dot;exports.lerp=lerp;exports.length=length;exports.lengthSq=lengthSq;exports.mulScalar=mulScalar;exports.multiply=multiply;exports.negate=negate;exports.normalize=normalize;exports.setDefaultType=setDefaultType;exports.subtract=subtract;var VecType=Float32Array;function setDefaultType(ctor){var oldType=VecType;VecType=ctor;return oldType}function create(x,y,z){var dst=new VecType(3);if(x){dst[0]=x}if(y){dst[1]=y}if(z){dst[2]=z}return dst}function add(a,b,dst){dst=dst||new VecType(3);dst[0]=a[0]+b[0];dst[1]=a[1]+b[1];dst[2]=a[2]+b[2];return dst}function subtract(a,b,dst){dst=dst||new VecType(3);dst[0]=a[0]-b[0];dst[1]=a[1]-b[1];dst[2]=a[2]-b[2];return dst}function lerp(a,b,t,dst){dst=dst||new VecType(3);dst[0]=(1-t)*a[0]+t*b[0];dst[1]=(1-t)*a[1]+t*b[1];dst[2]=(1-t)*a[2]+t*b[2];return dst}function mulScalar(v,k,dst){dst=dst||new VecType(3);dst[0]=v[0]*k;dst[1]=v[1]*k;dst[2]=v[2]*k;return dst}function divScalar(v,k,dst){dst=dst||new VecType(3);dst[0]=v[0]/k;dst[1]=v[1]/k;dst[2]=v[2]/k;return dst}function cross(a,b,dst){dst=dst||new VecType(3);var t1=a[2]*b[0]-a[0]*b[2];var t2=a[0]*b[1]-a[1]*b[0];dst[0]=a[1]*b[2]-a[2]*b[1];dst[1]=t1;dst[2]=t2;return dst}function dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function length(v){return Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])}function lengthSq(v){return v[0]*v[0]+v[1]*v[1]+v[2]*v[2]}function distance(a,b){var dx=a[0]-b[0];var dy=a[1]-b[1];var dz=a[2]-b[2];return Math.sqrt(dx*dx+dy*dy+dz*dz)}function distanceSq(a,b){var dx=a[0]-b[0];var dy=a[1]-b[1];var dz=a[2]-b[2];return dx*dx+dy*dy+dz*dz}function normalize(a,dst){dst=dst||new VecType(3);var lenSq=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];var len=Math.sqrt(lenSq);if(len>1e-5){dst[0]=a[0]/len;dst[1]=a[1]/len;dst[2]=a[2]/len}else{dst[0]=0;dst[1]=0;dst[2]=0}return dst}function negate(v,dst){dst=dst||new VecType(3);dst[0]=-v[0];dst[1]=-v[1];dst[2]=-v[2];return dst}function copy(v,dst){dst=dst||new VecType(3);dst[0]=v[0];dst[1]=v[1];dst[2]=v[2];return dst}function multiply(a,b,dst){dst=dst||new VecType(3);dst[0]=a[0]*b[0];dst[1]=a[1]*b[1];dst[2]=a[2]*b[2];return dst}function divide(a,b,dst){dst=dst||new VecType(3);dst[0]=a[0]/b[0];dst[1]=a[1]/b[1];dst[2]=a[2]/b[2];return dst}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.isWebGL1=isWebGL1;exports.isWebGL2=isWebGL2;exports.glEnumToString=void 0;function isWebGL2(gl){return!!gl.texStorage2D}function isWebGL1(gl){return!gl.texStorage2D}var glEnumToString=function(){var haveEnumsForType={};var enums={};function addEnums(gl){var type=gl.constructor.name;if(!haveEnumsForType[type]){for(var key in gl){if(typeof gl[key]==="number"){var existing=enums[gl[key]];enums[gl[key]]=existing?"".concat(existing," | ").concat(key):key}}haveEnumsForType[type]=true}}return function glEnumToString(gl,value){addEnums(gl);return enums[value]||"0x"+value.toString(16)}}();exports.glEnumToString=glEnumToString},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.createAttributeSetters=createAttributeSetters;exports.createProgram=createProgram;exports.createProgramFromScripts=createProgramFromScripts;exports.createProgramFromSources=createProgramFromSources;exports.createProgramInfo=createProgramInfo;exports.createProgramInfoFromProgram=createProgramInfoFromProgram;exports.createUniformSetters=createUniformSetters;exports.createUniformBlockSpecFromProgram=createUniformBlockSpecFromProgram;exports.createUniformBlockInfoFromProgram=createUniformBlockInfoFromProgram;exports.createUniformBlockInfo=createUniformBlockInfo;exports.createTransformFeedback=createTransformFeedback;exports.createTransformFeedbackInfo=createTransformFeedbackInfo;exports.bindTransformFeedbackInfo=bindTransformFeedbackInfo;exports.setAttributes=setAttributes;exports.setBuffersAndAttributes=setBuffersAndAttributes;exports.setUniforms=setUniforms;exports.setUniformBlock=setUniformBlock;exports.setBlockUniforms=setBlockUniforms;exports.bindUniformBlock=bindUniformBlock;var utils=_interopRequireWildcard(__webpack_require__(4));var helper=_interopRequireWildcard(__webpack_require__(0));var _globalObject=_interopRequireDefault(__webpack_require__(2));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}var error=helper.error;var warn=helper.warn;var getElementById=_globalObject.default&&_globalObject.default.document&&_globalObject.default.document.getElementById?_globalObject.default.document.getElementById.bind(_globalObject.default.document):function(){return null};var FLOAT=5126;var FLOAT_VEC2=35664;var FLOAT_VEC3=35665;var FLOAT_VEC4=35666;var INT=5124;var INT_VEC2=35667;var INT_VEC3=35668;var INT_VEC4=35669;var BOOL=35670;var BOOL_VEC2=35671;var BOOL_VEC3=35672;var BOOL_VEC4=35673;var FLOAT_MAT2=35674;var FLOAT_MAT3=35675;var FLOAT_MAT4=35676;var SAMPLER_2D=35678;var SAMPLER_CUBE=35680;var SAMPLER_3D=35679;var SAMPLER_2D_SHADOW=35682;var FLOAT_MAT2x3=35685;var FLOAT_MAT2x4=35686;var FLOAT_MAT3x2=35687;var FLOAT_MAT3x4=35688;var FLOAT_MAT4x2=35689;var FLOAT_MAT4x3=35690;var SAMPLER_2D_ARRAY=36289;var SAMPLER_2D_ARRAY_SHADOW=36292;var SAMPLER_CUBE_SHADOW=36293;var UNSIGNED_INT=5125;var UNSIGNED_INT_VEC2=36294;var UNSIGNED_INT_VEC3=36295;var UNSIGNED_INT_VEC4=36296;var INT_SAMPLER_2D=36298;var INT_SAMPLER_3D=36299;var INT_SAMPLER_CUBE=36300;var INT_SAMPLER_2D_ARRAY=36303;var UNSIGNED_INT_SAMPLER_2D=36306;var UNSIGNED_INT_SAMPLER_3D=36307;var UNSIGNED_INT_SAMPLER_CUBE=36308;var UNSIGNED_INT_SAMPLER_2D_ARRAY=36311;var TEXTURE_2D=3553;var TEXTURE_CUBE_MAP=34067;var TEXTURE_3D=32879;var TEXTURE_2D_ARRAY=35866;var typeMap={};function getBindPointForSamplerType(gl,type){return typeMap[type].bindPoint}function floatSetter(gl,location){return function(v){gl.uniform1f(location,v)}}function floatArraySetter(gl,location){return function(v){gl.uniform1fv(location,v)}}function floatVec2Setter(gl,location){return function(v){gl.uniform2fv(location,v)}}function floatVec3Setter(gl,location){return function(v){gl.uniform3fv(location,v)}}function floatVec4Setter(gl,location){return function(v){gl.uniform4fv(location,v)}}function intSetter(gl,location){return function(v){gl.uniform1i(location,v)}}function intArraySetter(gl,location){return function(v){gl.uniform1iv(location,v)}}function intVec2Setter(gl,location){return function(v){gl.uniform2iv(location,v)}}function intVec3Setter(gl,location){return function(v){gl.uniform3iv(location,v)}}function intVec4Setter(gl,location){return function(v){gl.uniform4iv(location,v)}}function uintSetter(gl,location){return function(v){gl.uniform1ui(location,v)}}function uintArraySetter(gl,location){return function(v){gl.uniform1uiv(location,v)}}function uintVec2Setter(gl,location){return function(v){gl.uniform2uiv(location,v)}}function uintVec3Setter(gl,location){return function(v){gl.uniform3uiv(location,v)}}function uintVec4Setter(gl,location){return function(v){gl.uniform4uiv(location,v)}}function floatMat2Setter(gl,location){return function(v){gl.uniformMatrix2fv(location,false,v)}}function floatMat3Setter(gl,location){return function(v){gl.uniformMatrix3fv(location,false,v)}}
function floatMat4Setter(gl,location){return function(v){gl.uniformMatrix4fv(location,false,v)}}function floatMat23Setter(gl,location){return function(v){gl.uniformMatrix2x3fv(location,false,v)}}function floatMat32Setter(gl,location){return function(v){gl.uniformMatrix3x2fv(location,false,v)}}function floatMat24Setter(gl,location){return function(v){gl.uniformMatrix2x4fv(location,false,v)}}function floatMat42Setter(gl,location){return function(v){gl.uniformMatrix4x2fv(location,false,v)}}function floatMat34Setter(gl,location){return function(v){gl.uniformMatrix3x4fv(location,false,v)}}function floatMat43Setter(gl,location){return function(v){gl.uniformMatrix4x3fv(location,false,v)}}function samplerSetter(gl,type,unit,location){var bindPoint=getBindPointForSamplerType(gl,type);return utils.isWebGL2(gl)?function(textureOrPair){var texture;var sampler;if(helper.isTexture(gl,textureOrPair)){texture=textureOrPair;sampler=null}else{texture=textureOrPair.texture;sampler=textureOrPair.sampler}gl.uniform1i(location,unit);gl.activeTexture(gl.TEXTURE0+unit);gl.bindTexture(bindPoint,texture);gl.bindSampler(unit,sampler)}:function(texture){gl.uniform1i(location,unit);gl.activeTexture(gl.TEXTURE0+unit);gl.bindTexture(bindPoint,texture)}}function samplerArraySetter(gl,type,unit,location,size){var bindPoint=getBindPointForSamplerType(gl,type);var units=new Int32Array(size);for(var ii=0;ii<size;++ii){units[ii]=unit+ii}return utils.isWebGL2(gl)?function(textures){gl.uniform1iv(location,units);textures.forEach(function(textureOrPair,index){gl.activeTexture(gl.TEXTURE0+units[index]);var texture;var sampler;if(helper.isTexture(gl,textureOrPair)){texture=textureOrPair;sampler=null}else{texture=textureOrPair.texture;sampler=textureOrPair.sampler}gl.bindSampler(unit,sampler);gl.bindTexture(bindPoint,texture)})}:function(textures){gl.uniform1iv(location,units);textures.forEach(function(texture,index){gl.activeTexture(gl.TEXTURE0+units[index]);gl.bindTexture(bindPoint,texture)})}}typeMap[FLOAT]={Type:Float32Array,size:4,setter:floatSetter,arraySetter:floatArraySetter};typeMap[FLOAT_VEC2]={Type:Float32Array,size:8,setter:floatVec2Setter};typeMap[FLOAT_VEC3]={Type:Float32Array,size:12,setter:floatVec3Setter};typeMap[FLOAT_VEC4]={Type:Float32Array,size:16,setter:floatVec4Setter};typeMap[INT]={Type:Int32Array,size:4,setter:intSetter,arraySetter:intArraySetter};typeMap[INT_VEC2]={Type:Int32Array,size:8,setter:intVec2Setter};typeMap[INT_VEC3]={Type:Int32Array,size:12,setter:intVec3Setter};typeMap[INT_VEC4]={Type:Int32Array,size:16,setter:intVec4Setter};typeMap[UNSIGNED_INT]={Type:Uint32Array,size:4,setter:uintSetter,arraySetter:uintArraySetter};typeMap[UNSIGNED_INT_VEC2]={Type:Uint32Array,size:8,setter:uintVec2Setter};typeMap[UNSIGNED_INT_VEC3]={Type:Uint32Array,size:12,setter:uintVec3Setter};typeMap[UNSIGNED_INT_VEC4]={Type:Uint32Array,size:16,setter:uintVec4Setter};typeMap[BOOL]={Type:Uint32Array,size:4,setter:intSetter,arraySetter:intArraySetter};typeMap[BOOL_VEC2]={Type:Uint32Array,size:8,setter:intVec2Setter};typeMap[BOOL_VEC3]={Type:Uint32Array,size:12,setter:intVec3Setter};typeMap[BOOL_VEC4]={Type:Uint32Array,size:16,setter:intVec4Setter};typeMap[FLOAT_MAT2]={Type:Float32Array,size:16,setter:floatMat2Setter};typeMap[FLOAT_MAT3]={Type:Float32Array,size:36,setter:floatMat3Setter};typeMap[FLOAT_MAT4]={Type:Float32Array,size:64,setter:floatMat4Setter};typeMap[FLOAT_MAT2x3]={Type:Float32Array,size:24,setter:floatMat23Setter};typeMap[FLOAT_MAT2x4]={Type:Float32Array,size:32,setter:floatMat24Setter};typeMap[FLOAT_MAT3x2]={Type:Float32Array,size:24,setter:floatMat32Setter};typeMap[FLOAT_MAT3x4]={Type:Float32Array,size:48,setter:floatMat34Setter};typeMap[FLOAT_MAT4x2]={Type:Float32Array,size:32,setter:floatMat42Setter};typeMap[FLOAT_MAT4x3]={Type:Float32Array,size:48,setter:floatMat43Setter};typeMap[SAMPLER_2D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D};typeMap[SAMPLER_CUBE]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[SAMPLER_3D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_3D};typeMap[SAMPLER_2D_SHADOW]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D};typeMap[SAMPLER_2D_ARRAY]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};typeMap[SAMPLER_2D_ARRAY_SHADOW]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};typeMap[SAMPLER_CUBE_SHADOW]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[INT_SAMPLER_2D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D};typeMap[INT_SAMPLER_3D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_3D};typeMap[INT_SAMPLER_CUBE]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[INT_SAMPLER_2D_ARRAY]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};typeMap[UNSIGNED_INT_SAMPLER_2D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D};typeMap[UNSIGNED_INT_SAMPLER_3D]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_3D};typeMap[UNSIGNED_INT_SAMPLER_CUBE]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_CUBE_MAP};typeMap[UNSIGNED_INT_SAMPLER_2D_ARRAY]={Type:null,size:0,setter:samplerSetter,arraySetter:samplerArraySetter,bindPoint:TEXTURE_2D_ARRAY};function floatAttribSetter(gl,index){return function(b){gl.bindBuffer(gl.ARRAY_BUFFER,b.buffer);gl.enableVertexAttribArray(index);gl.vertexAttribPointer(index,b.numComponents||b.size,b.type||gl.FLOAT,b.normalize||false,b.stride||0,b.offset||0);if(b.divisor!==undefined){gl.vertexAttribDivisor(index,b.divisor)}}}function intAttribSetter(gl,index){return function(b){gl.bindBuffer(gl.ARRAY_BUFFER,b.buffer);gl.enableVertexAttribArray(index);gl.vertexAttribIPointer(index,b.numComponents||b.size,b.type||gl.INT,b.stride||0,b.offset||0);if(b.divisor!==undefined){gl.vertexAttribDivisor(index,b.divisor)}}}function matAttribSetter(gl,index,typeInfo){var defaultSize=typeInfo.size;var count=typeInfo.count;return function(b){gl.bindBuffer(gl.ARRAY_BUFFER,b.buffer);var numComponents=b.size||b.numComponents||defaultSize;var size=numComponents/count;var type=b.type||gl.FLOAT;var typeInfo=typeMap[type];var stride=typeInfo.size*numComponents;var normalize=b.normalize||false;var offset=b.offset||0;var rowOffset=stride/count;for(var i=0;i<count;++i){gl.enableVertexAttribArray(index+i);gl.vertexAttribPointer(index+i,size,type,normalize,stride,offset+rowOffset*i);if(b.divisor!==undefined){gl.vertexAttribDivisor(index+i,b.divisor)}}}}var attrTypeMap={};attrTypeMap[FLOAT]={size:4,setter:floatAttribSetter};attrTypeMap[FLOAT_VEC2]={size:8,setter:floatAttribSetter};attrTypeMap[FLOAT_VEC3]={size:12,setter:floatAttribSetter};attrTypeMap[FLOAT_VEC4]={size:16,setter:floatAttribSetter};attrTypeMap[INT]={size:4,setter:intAttribSetter};attrTypeMap[INT_VEC2]={size:8,setter:intAttribSetter};attrTypeMap[INT_VEC3]={size:12,setter:intAttribSetter};attrTypeMap[INT_VEC4]={size:16,setter:intAttribSetter};attrTypeMap[UNSIGNED_INT]={size:4,setter:intAttribSetter};attrTypeMap[UNSIGNED_INT_VEC2]={size:8,setter:intAttribSetter};attrTypeMap[UNSIGNED_INT_VEC3]={size:12,setter:intAttribSetter};attrTypeMap[UNSIGNED_INT_VEC4]={size:16,setter:intAttribSetter};attrTypeMap[BOOL]={size:4,setter:intAttribSetter};attrTypeMap[BOOL_VEC2]={size:8,setter:intAttribSetter};attrTypeMap[BOOL_VEC3]={size:12,setter:intAttribSetter};attrTypeMap[BOOL_VEC4]={size:16,setter:intAttribSetter};attrTypeMap[FLOAT_MAT2]={size:4,setter:matAttribSetter,count:2};attrTypeMap[FLOAT_MAT3]={size:9,setter:matAttribSetter,count:3};attrTypeMap[FLOAT_MAT4]={size:16,setter:matAttribSetter,count:4};var gl=undefined;function addLineNumbers(src,lineOffset){lineOffset=lineOffset||0;++lineOffset;return src.split("\n").map(function(line,ndx){return ndx+lineOffset+": "+line}).join("\n")}var spaceRE=/^[ \t]*\n/;function loadShader(gl,shaderSource,shaderType,opt_errorCallback){var errFn=opt_errorCallback||error;var shader=gl.createShader(shaderType);var lineOffset=0;if(spaceRE.test(shaderSource)){lineOffset=1;shaderSource=shaderSource.replace(spaceRE,"")}gl.shaderSource(shader,shaderSource);gl.compileShader(shader);var compiled=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(!compiled){var lastError=gl.getShaderInfoLog(shader);errFn(addLineNumbers(shaderSource,lineOffset)+"\n*** Error compiling shader: "+lastError);gl.deleteShader(shader);return null}return shader}function getProgramOptions(opt_attribs,opt_locations,opt_errorCallback){var transformFeedbackVaryings;if(typeof opt_locations==="function"){opt_errorCallback=opt_locations;opt_locations=undefined}if(typeof opt_attribs==="function"){opt_errorCallback=opt_attribs;opt_attribs=undefined}else if(opt_attribs&&!Array.isArray(opt_attribs)){if(opt_attribs.errorCallback){return opt_attribs}var opt=opt_attribs;opt_errorCallback=opt.errorCallback;opt_attribs=opt.attribLocations;transformFeedbackVaryings=opt.transformFeedbackVaryings}var options={errorCallback:opt_errorCallback||error,transformFeedbackVaryings:transformFeedbackVaryings};if(opt_attribs){var attribLocations={};if(Array.isArray(opt_attribs)){opt_attribs.forEach(function(attrib,ndx){attribLocations[attrib]=opt_locations?opt_locations[ndx]:ndx})}else{attribLocations=opt_attribs}options.attribLocations=attribLocations}return options}var defaultShaderType=["VERTEX_SHADER","FRAGMENT_SHADER"];function getShaderTypeFromScriptType(scriptType){if(scriptType.indexOf("frag")>=0){return gl.FRAGMENT_SHADER}else if(scriptType.indexOf("vert")>=0){return gl.VERTEX_SHADER}return undefined}function deleteShaders(gl,shaders){shaders.forEach(function(shader){gl.deleteShader(shader)})}function createProgram(gl,shaders,opt_attribs,opt_locations,opt_errorCallback){var progOptions=getProgramOptions(opt_attribs,opt_locations,opt_errorCallback);var realShaders=[];var newShaders=[];for(var ndx=0;ndx<shaders.length;++ndx){var shader=shaders[ndx];if(typeof shader==="string"){var elem=getElementById(shader);var src=elem?elem.text:shader;var type=gl[defaultShaderType[ndx]];if(elem&&elem.type){type=getShaderTypeFromScriptType(elem.type)||type}shader=loadShader(gl,src,type,progOptions.errorCallback);newShaders.push(shader)}if(helper.isShader(gl,shader)){realShaders.push(shader)}}if(realShaders.length!==shaders.length){progOptions.errorCallback("not enough shaders for program");deleteShaders(gl,newShaders);return null}var program=gl.createProgram();realShaders.forEach(function(shader){gl.attachShader(program,shader)});if(progOptions.attribLocations){Object.keys(progOptions.attribLocations).forEach(function(attrib){gl.bindAttribLocation(program,progOptions.attribLocations[attrib],attrib)})}var varyings=progOptions.transformFeedbackVaryings;if(varyings){if(varyings.attribs){varyings=varyings.attribs}if(!Array.isArray(varyings)){varyings=Object.keys(varyings)}gl.transformFeedbackVaryings(program,varyings,progOptions.transformFeedbackMode||gl.SEPARATE_ATTRIBS)}gl.linkProgram(program);var linked=gl.getProgramParameter(program,gl.LINK_STATUS);if(!linked){var lastError=gl.getProgramInfoLog(program);progOptions.errorCallback("Error in program linking:"+lastError);gl.deleteProgram(program);deleteShaders(gl,newShaders);return null}return program}function createShaderFromScript(gl,scriptId,opt_shaderType,opt_errorCallback){var shaderSource="";var shaderScript=getElementById(scriptId);if(!shaderScript){throw"*** Error: unknown script element"+scriptId}shaderSource=shaderScript.text;var shaderType=opt_shaderType||getShaderTypeFromScriptType(shaderScript.type);if(!shaderType){throw"*** Error: unknown shader type"}return loadShader(gl,shaderSource,shaderType,opt_errorCallback)}function createProgramFromScripts(gl,shaderScriptIds,opt_attribs,opt_locations,opt_errorCallback){var progOptions=getProgramOptions(opt_attribs,opt_locations,opt_errorCallback);var shaders=[];for(var ii=0;ii<shaderScriptIds.length;++ii){var shader=createShaderFromScript(gl,shaderScriptIds[ii],gl[defaultShaderType[ii]],progOptions.errorCallback);if(!shader){return null}shaders.push(shader)}return createProgram(gl,shaders,progOptions)}function createProgramFromSources(gl,shaderSources,opt_attribs,opt_locations,opt_errorCallback){var progOptions=getProgramOptions(opt_attribs,opt_locations,opt_errorCallback);var shaders=[];for(var ii=0;ii<shaderSources.length;++ii){var shader=loadShader(gl,shaderSources[ii],gl[defaultShaderType[ii]],progOptions.errorCallback);if(!shader){return null}shaders.push(shader)}return createProgram(gl,shaders,progOptions)}function isBuiltIn(info){var name=info.name;return name.startsWith("gl_")||name.startsWith("webgl_")}function createUniformSetters(gl,program){var textureUnit=0;function createUniformSetter(program,uniformInfo){var location=gl.getUniformLocation(program,uniformInfo.name);var isArray=uniformInfo.size>1&&uniformInfo.name.substr(-3)==="[0]";var type=uniformInfo.type;var typeInfo=typeMap[type];if(!typeInfo){throw"unknown type: 0x"+type.toString(16)}var setter;if(typeInfo.bindPoint){var unit=textureUnit;textureUnit+=uniformInfo.size;if(isArray){setter=typeInfo.arraySetter(gl,type,unit,location,uniformInfo.size)}else{setter=typeInfo.setter(gl,type,unit,location,uniformInfo.size)}}else{if(typeInfo.arraySetter&&isArray){setter=typeInfo.arraySetter(gl,location)}else{setter=typeInfo.setter(gl,location)}}setter.location=location;return setter}var uniformSetters={};var numUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var ii=0;ii<numUniforms;++ii){var uniformInfo=gl.getActiveUniform(program,ii);if(isBuiltIn(uniformInfo)){continue}var name=uniformInfo.name;if(name.substr(-3)==="[0]"){name=name.substr(0,name.length-3)}var setter=createUniformSetter(program,uniformInfo);uniformSetters[name]=setter}return uniformSetters}function createTransformFeedbackInfo(gl,program){var info={};var numVaryings=gl.getProgramParameter(program,gl.TRANSFORM_FEEDBACK_VARYINGS);for(var ii=0;ii<numVaryings;++ii){var varying=gl.getTransformFeedbackVarying(program,ii);info[varying.name]={index:ii,type:varying.type,size:varying.size}}return info}function bindTransformFeedbackInfo(gl,transformFeedbackInfo,bufferInfo){if(transformFeedbackInfo.transformFeedbackInfo){transformFeedbackInfo=transformFeedbackInfo.transformFeedbackInfo}if(bufferInfo.attribs){bufferInfo=bufferInfo.attribs}for(var name in bufferInfo){var varying=transformFeedbackInfo[name];if(varying){var buf=bufferInfo[name];if(buf.offset){gl.bindBufferRange(gl.TRANSFORM_FEEDBACK_BUFFER,varying.index,buf.buffer,buf.offset,buf.size)}else{gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER,varying.index,buf.buffer)}}}}function unbindTransformFeedbackInfo(gl,transformFeedbackInfo,bufferInfo){if(transformFeedbackInfo.transformFeedbackInfo){transformFeedbackInfo=transformFeedbackInfo.transformFeedbackInfo}if(bufferInfo.attribs){bufferInfo=bufferInfo.attribs}for(var name in bufferInfo){var varying=transformFeedbackInfo[name];if(varying){gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER,varying.index,null)}}}function createTransformFeedback(gl,programInfo,bufferInfo){var tf=gl.createTransformFeedback();gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,tf);gl.useProgram(programInfo.program);bindTransformFeedbackInfo(gl,programInfo,bufferInfo);gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,null);unbindTransformFeedbackInfo(gl,programInfo,bufferInfo);return tf}function createUniformBlockSpecFromProgram(gl,program){var numUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);var uniformData=[];var uniformIndices=[];for(var ii=0;ii<numUniforms;++ii){uniformIndices.push(ii);uniformData.push({});var uniformInfo=gl.getActiveUniform(program,ii);if(isBuiltIn(uniformInfo)){break}uniformData[ii].name=uniformInfo.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(pair){var pname=pair[0];var key=pair[1];gl.getActiveUniforms(program,uniformIndices,gl[pname]).forEach(function(value,ndx){uniformData[ndx][key]=value})});var blockSpecs={};var numUniformBlocks=gl.getProgramParameter(program,gl.ACTIVE_UNIFORM_BLOCKS);for(var _ii=0;_ii<numUniformBlocks;++_ii){var name=gl.getActiveUniformBlockName(program,_ii);var blockSpec={index:_ii,usedByVertexShader:gl.getActiveUniformBlockParameter(program,_ii,gl.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:gl.getActiveUniformBlockParameter(program,_ii,gl.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:gl.getActiveUniformBlockParameter(program,_ii,gl.UNIFORM_BLOCK_DATA_SIZE),uniformIndices:gl.getActiveUniformBlockParameter(program,_ii,gl.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};blockSpec.used=blockSpec.usedByVertexSahder||blockSpec.usedByFragmentShader;blockSpecs[name]=blockSpec}return{blockSpecs:blockSpecs,uniformData:uniformData}}var arraySuffixRE=/\[\d+\]\.$/;function createUniformBlockInfoFromProgram(gl,program,uniformBlockSpec,blockName){var blockSpecs=uniformBlockSpec.blockSpecs;var uniformData=uniformBlockSpec.uniformData;var blockSpec=blockSpecs[blockName];if(!blockSpec){warn("no uniform block object named:",blockName);return{name:blockName,uniforms:{}}}var array=new ArrayBuffer(blockSpec.size);var buffer=gl.createBuffer();var uniformBufferIndex=blockSpec.index;gl.bindBuffer(gl.UNIFORM_BUFFER,buffer);gl.uniformBlockBinding(program,blockSpec.index,uniformBufferIndex);var prefix=blockName+".";if(arraySuffixRE.test(prefix)){prefix=prefix.replace(arraySuffixRE,".")}var uniforms={};blockSpec.uniformIndices.forEach(function(uniformNdx){var data=uniformData[uniformNdx];var typeInfo=typeMap[data.type];var Type=typeInfo.Type;var length=data.size*typeInfo.size;var name=data.name;if(name.substr(0,prefix.length)===prefix){name=name.substr(prefix.length)}uniforms[name]=new Type(array,data.offset,length/Type.BYTES_PER_ELEMENT)});return{name:blockName,array:array,asFloat:new Float32Array(array),buffer:buffer,uniforms:uniforms}}function createUniformBlockInfo(gl,programInfo,blockName){return createUniformBlockInfoFromProgram(gl,programInfo.program,programInfo.uniformBlockSpec,blockName)}function bindUniformBlock(gl,programInfo,uniformBlockInfo){var uniformBlockSpec=programInfo.uniformBlockSpec||programInfo;var blockSpec=uniformBlockSpec.blockSpecs[uniformBlockInfo.name];if(blockSpec){var bufferBindIndex=blockSpec.index;gl.bindBufferRange(gl.UNIFORM_BUFFER,bufferBindIndex,uniformBlockInfo.buffer,uniformBlockInfo.offset||0,uniformBlockInfo.array.byteLength);return true}return false}function setUniformBlock(gl,programInfo,uniformBlockInfo){if(bindUniformBlock(gl,programInfo,uniformBlockInfo)){gl.bufferData(gl.UNIFORM_BUFFER,uniformBlockInfo.array,gl.DYNAMIC_DRAW)}}function setBlockUniforms(uniformBlockInfo,values){var uniforms=uniformBlockInfo.uniforms;for(var name in values){var array=uniforms[name];if(array){var value=values[name];if(value.length){array.set(value)}else{array[0]=value}}}}function setUniforms(setters,values){var actualSetters=setters.uniformSetters||setters;var numArgs=arguments.length;for(var andx=1;andx<numArgs;++andx){var vals=arguments[andx];if(Array.isArray(vals)){var numValues=vals.length;for(var ii=0;ii<numValues;++ii){setUniforms(actualSetters,vals[ii])}}else{for(var name in vals){var setter=actualSetters[name];if(setter){setter(vals[name])}}}}}function createAttributeSetters(gl,program){var attribSetters={};var numAttribs=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var ii=0;ii<numAttribs;++ii){var attribInfo=gl.getActiveAttrib(program,ii);if(isBuiltIn(attribInfo)){continue}var index=gl.getAttribLocation(program,attribInfo.name);var typeInfo=attrTypeMap[attribInfo.type];var setter=typeInfo.setter(gl,index,typeInfo);setter.location=index;attribSetters[attribInfo.name]=setter}return attribSetters}function setAttributes(setters,buffers){for(var name in buffers){var setter=setters[name];if(setter){setter(buffers[name])}}}function setBuffersAndAttributes(gl,programInfo,buffers){if(buffers.vertexArrayObject){gl.bindVertexArray(buffers.vertexArrayObject)}else{setAttributes(programInfo.attribSetters||programInfo,buffers.attribs);if(buffers.indices){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,buffers.indices)}}}function createProgramInfoFromProgram(gl,program){var uniformSetters=createUniformSetters(gl,program);var attribSetters=createAttributeSetters(gl,program);var programInfo={program:program,uniformSetters:uniformSetters,attribSetters:attribSetters};if(utils.isWebGL2(gl)){programInfo.uniformBlockSpec=createUniformBlockSpecFromProgram(gl,program);programInfo.transformFeedbackInfo=createTransformFeedbackInfo(gl,program)}return programInfo}function createProgramInfo(gl,shaderSources,opt_attribs,opt_locations,opt_errorCallback){var progOptions=getProgramOptions(opt_attribs,opt_locations,opt_errorCallback);var good=true;shaderSources=shaderSources.map(function(source){if(false){var script=getElementById(source);if(!script){progOptions.errorCallback("no element with id: "+source);good=false}else{source=script.text}}return source});if(!good){return null}var program=createProgramFromSources(gl,shaderSources,progOptions);if(!program){return null}return createProgramInfoFromProgram(gl,program)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.axisRotate=axisRotate;exports.axisRotation=axisRotation;exports.copy=copy;exports.frustum=frustum;exports.getAxis=getAxis;exports.getTranslation=getTranslation;exports.identity=identity;exports.inverse=inverse;exports.lookAt=lookAt;exports.multiply=multiply;exports.negate=negate;exports.ortho=ortho;exports.perspective=perspective;exports.rotateX=rotateX;exports.rotateY=rotateY;exports.rotateZ=rotateZ;exports.rotationX=rotationX;exports.rotationY=rotationY;exports.rotationZ=rotationZ;exports.scale=scale;exports.scaling=scaling;exports.setAxis=setAxis;exports.setDefaultType=setDefaultType;exports.setTranslation=setTranslation;exports.transformDirection=transformDirection;exports.transformNormal=transformNormal;exports.transformPoint=transformPoint;exports.translate=translate;exports.translation=translation;exports.transpose=transpose;var v3=_interopRequireWildcard(__webpack_require__(3));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}var MatType=Float32Array;var tempV3a=v3.create();var tempV3b=v3.create();var tempV3c=v3.create();function setDefaultType(ctor){var oldType=MatType;MatType=ctor;return oldType}function negate(m,dst){dst=dst||new MatType(16);dst[0]=-m[0];dst[1]=-m[1];dst[2]=-m[2];dst[3]=-m[3];dst[4]=-m[4];dst[5]=-m[5];dst[6]=-m[6];dst[7]=-m[7];dst[8]=-m[8];dst[9]=-m[9];dst[10]=-m[10];dst[11]=-m[11];dst[12]=-m[12];dst[13]=-m[13];dst[14]=-m[14];dst[15]=-m[15];return dst}function copy(m,dst){dst=dst||new MatType(16);dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];dst[3]=m[3];dst[4]=m[4];dst[5]=m[5];dst[6]=m[6];dst[7]=m[7];dst[8]=m[8];dst[9]=m[9];dst[10]=m[10];dst[11]=m[11];dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15];return dst}function identity(dst){dst=dst||new MatType(16);dst[0]=1;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=1;dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=1;dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=1;return dst}function transpose(m,dst){dst=dst||new MatType(16);if(dst===m){var t;t=m[1];m[1]=m[4];m[4]=t;t=m[2];m[2]=m[8];m[8]=t;t=m[3];m[3]=m[12];m[12]=t;t=m[6];m[6]=m[9];m[9]=t;t=m[7];m[7]=m[13];m[13]=t;t=m[11];m[11]=m[14];m[14]=t;return dst}var m00=m[0*4+0];var m01=m[0*4+1];var m02=m[0*4+2];var m03=m[0*4+3];var m10=m[1*4+0];var m11=m[1*4+1];var m12=m[1*4+2];var m13=m[1*4+3];var m20=m[2*4+0];var m21=m[2*4+1];var m22=m[2*4+2];var m23=m[2*4+3];var m30=m[3*4+0];var m31=m[3*4+1];var m32=m[3*4+2];var m33=m[3*4+3];dst[0]=m00;dst[1]=m10;dst[2]=m20;dst[3]=m30;dst[4]=m01;dst[5]=m11;dst[6]=m21;dst[7]=m31;dst[8]=m02;dst[9]=m12;dst[10]=m22;dst[11]=m32;dst[12]=m03;dst[13]=m13;dst[14]=m23;dst[15]=m33;return dst}function inverse(m,dst){dst=dst||new MatType(16);var m00=m[0*4+0];var m01=m[0*4+1];var m02=m[0*4+2];var m03=m[0*4+3];var m10=m[1*4+0];var m11=m[1*4+1];var m12=m[1*4+2];var m13=m[1*4+3];var m20=m[2*4+0];var m21=m[2*4+1];var m22=m[2*4+2];var m23=m[2*4+3];var m30=m[3*4+0];var m31=m[3*4+1];var m32=m[3*4+2];var m33=m[3*4+3];var tmp_0=m22*m33;var tmp_1=m32*m23;var tmp_2=m12*m33;var tmp_3=m32*m13;var tmp_4=m12*m23;var tmp_5=m22*m13;var tmp_6=m02*m33;var tmp_7=m32*m03;var tmp_8=m02*m23;var tmp_9=m22*m03;var tmp_10=m02*m13;var tmp_11=m12*m03;var tmp_12=m20*m31;var tmp_13=m30*m21;var tmp_14=m10*m31;var tmp_15=m30*m11;var tmp_16=m10*m21;var tmp_17=m20*m11;var tmp_18=m00*m31;var tmp_19=m30*m01;var tmp_20=m00*m21;var tmp_21=m20*m01;var tmp_22=m00*m11;var tmp_23=m10*m01;var t0=tmp_0*m11+tmp_3*m21+tmp_4*m31-(tmp_1*m11+tmp_2*m21+tmp_5*m31);var t1=tmp_1*m01+tmp_6*m21+tmp_9*m31-(tmp_0*m01+tmp_7*m21+tmp_8*m31);var t2=tmp_2*m01+tmp_7*m11+tmp_10*m31-(tmp_3*m01+tmp_6*m11+tmp_11*m31);var t3=tmp_5*m01+tmp_8*m11+tmp_11*m21-(tmp_4*m01+tmp_9*m11+tmp_10*m21);var d=1/(m00*t0+m10*t1+m20*t2+m30*t3);dst[0]=d*t0;dst[1]=d*t1;dst[2]=d*t2;dst[3]=d*t3;dst[4]=d*(tmp_1*m10+tmp_2*m20+tmp_5*m30-(tmp_0*m10+tmp_3*m20+tmp_4*m30));dst[5]=d*(tmp_0*m00+tmp_7*m20+tmp_8*m30-(tmp_1*m00+tmp_6*m20+tmp_9*m30));dst[6]=d*(tmp_3*m00+tmp_6*m10+tmp_11*m30-(tmp_2*m00+tmp_7*m10+tmp_10*m30));dst[7]=d*(tmp_4*m00+tmp_9*m10+tmp_10*m20-(tmp_5*m00+tmp_8*m10+tmp_11*m20));dst[8]=d*(tmp_12*m13+tmp_15*m23+tmp_16*m33-(tmp_13*m13+tmp_14*m23+tmp_17*m33));dst[9]=d*(tmp_13*m03+tmp_18*m23+tmp_21*m33-(tmp_12*m03+tmp_19*m23+tmp_20*m33));dst[10]=d*(tmp_14*m03+tmp_19*m13+tmp_22*m33-(tmp_15*m03+tmp_18*m13+tmp_23*m33));dst[11]=d*(tmp_17*m03+tmp_20*m13+tmp_23*m23-(tmp_16*m03+tmp_21*m13+tmp_22*m23));dst[12]=d*(tmp_14*m22+tmp_17*m32+tmp_13*m12-(tmp_16*m32+tmp_12*m12+tmp_15*m22));dst[13]=d*(tmp_20*m32+tmp_12*m02+tmp_19*m22-(tmp_18*m22+tmp_21*m32+tmp_13*m02));dst[14]=d*(tmp_18*m12+tmp_23*m32+tmp_15*m02-(tmp_22*m32+tmp_14*m02+tmp_19*m12));dst[15]=d*(tmp_22*m22+tmp_16*m02+tmp_21*m12-(tmp_20*m12+tmp_23*m22+tmp_17*m02));return dst}function multiply(a,b,dst){dst=dst||new MatType(16);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4+0];var a11=a[4+1];var a12=a[4+2];var a13=a[4+3];var a20=a[8+0];var a21=a[8+1];var a22=a[8+2];var a23=a[8+3];var a30=a[12+0];var a31=a[12+1];var a32=a[12+2];var a33=a[12+3];var b00=b[0];var b01=b[1];var b02=b[2];var b03=b[3];var b10=b[4+0];var b11=b[4+1];var b12=b[4+2];var b13=b[4+3];var b20=b[8+0];var b21=b[8+1];var b22=b[8+2];var b23=b[8+3];var b30=b[12+0];var b31=b[12+1];var b32=b[12+2];var b33=b[12+3];dst[0]=a00*b00+a10*b01+a20*b02+a30*b03;dst[1]=a01*b00+a11*b01+a21*b02+a31*b03;dst[2]=a02*b00+a12*b01+a22*b02+a32*b03;dst[3]=a03*b00+a13*b01+a23*b02+a33*b03;dst[4]=a00*b10+a10*b11+a20*b12+a30*b13;dst[5]=a01*b10+a11*b11+a21*b12+a31*b13;dst[6]=a02*b10+a12*b11+a22*b12+a32*b13;dst[7]=a03*b10+a13*b11+a23*b12+a33*b13;dst[8]=a00*b20+a10*b21+a20*b22+a30*b23;dst[9]=a01*b20+a11*b21+a21*b22+a31*b23;dst[10]=a02*b20+a12*b21+a22*b22+a32*b23;dst[11]=a03*b20+a13*b21+a23*b22+a33*b23;dst[12]=a00*b30+a10*b31+a20*b32+a30*b33;dst[13]=a01*b30+a11*b31+a21*b32+a31*b33;dst[14]=a02*b30+a12*b31+a22*b32+a32*b33;dst[15]=a03*b30+a13*b31+a23*b32+a33*b33;return dst}function setTranslation(a,v,dst){dst=dst||identity();if(a!==dst){dst[0]=a[0];dst[1]=a[1];dst[2]=a[2];dst[3]=a[3];dst[4]=a[4];dst[5]=a[5];dst[6]=a[6];dst[7]=a[7];dst[8]=a[8];dst[9]=a[9];dst[10]=a[10];dst[11]=a[11]}dst[12]=v[0];dst[13]=v[1];dst[14]=v[2];dst[15]=1;return dst}function getTranslation(m,dst){dst=dst||v3.create();dst[0]=m[12];dst[1]=m[13];dst[2]=m[14];return dst}function getAxis(m,axis,dst){dst=dst||v3.create();var off=axis*4;dst[0]=m[off+0];dst[1]=m[off+1];dst[2]=m[off+2];return dst}function setAxis(a,v,axis,dst){if(dst!==a){dst=copy(a,dst)}var off=axis*4;dst[off+0]=v[0];dst[off+1]=v[1];dst[off+2]=v[2];return dst}function perspective(fieldOfViewYInRadians,aspect,zNear,zFar,dst){dst=dst||new MatType(16);var f=Math.tan(Math.PI*.5-.5*fieldOfViewYInRadians);var rangeInv=1/(zNear-zFar);dst[0]=f/aspect;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=f;dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=(zNear+zFar)*rangeInv;dst[11]=-1;dst[12]=0;dst[13]=0;dst[14]=zNear*zFar*rangeInv*2;dst[15]=0;return dst}function ortho(left,right,bottom,top,near,far,dst){dst=dst||new MatType(16);dst[0]=2/(right-left);dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=2/(top-bottom);dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=2/(near-far);dst[11]=0;dst[12]=(right+left)/(left-right);dst[13]=(top+bottom)/(bottom-top);dst[14]=(far+near)/(near-far);dst[15]=1;return dst}function frustum(left,right,bottom,top,near,far,dst){dst=dst||new MatType(16);var dx=right-left;var dy=top-bottom;var dz=near-far;dst[0]=2*near/dx;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=2*near/dy;dst[6]=0;dst[7]=0;dst[8]=(left+right)/dx;dst[9]=(top+bottom)/dy;dst[10]=far/dz;dst[11]=-1;dst[12]=0;dst[13]=0;dst[14]=near*far/dz;dst[15]=0;return dst}function lookAt(eye,target,up,dst){dst=dst||new MatType(16);var xAxis=tempV3a;var yAxis=tempV3b;var zAxis=tempV3c;v3.normalize(v3.subtract(eye,target,zAxis),zAxis);v3.normalize(v3.cross(up,zAxis,xAxis),xAxis);v3.normalize(v3.cross(zAxis,xAxis,yAxis),yAxis);dst[0]=xAxis[0];dst[1]=xAxis[1];dst[2]=xAxis[2];dst[3]=0;dst[4]=yAxis[0];dst[5]=yAxis[1];dst[6]=yAxis[2];dst[7]=0;dst[8]=zAxis[0];dst[9]=zAxis[1];dst[10]=zAxis[2];dst[11]=0;dst[12]=eye[0];dst[13]=eye[1];dst[14]=eye[2];dst[15]=1;return dst}function translation(v,dst){dst=dst||new MatType(16);dst[0]=1;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=1;dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=1;dst[11]=0;dst[12]=v[0];dst[13]=v[1];dst[14]=v[2];dst[15]=1;return dst}function translate(m,v,dst){dst=dst||new MatType(16);var v0=v[0];var v1=v[1];var v2=v[2];var m00=m[0];var m01=m[1];var m02=m[2];var m03=m[3];var m10=m[1*4+0];var m11=m[1*4+1];var m12=m[1*4+2];var m13=m[1*4+3];var m20=m[2*4+0];var m21=m[2*4+1];var m22=m[2*4+2];var m23=m[2*4+3];var m30=m[3*4+0];var m31=m[3*4+1];var m32=m[3*4+2];var m33=m[3*4+3];if(m!==dst){dst[0]=m00;dst[1]=m01;dst[2]=m02;dst[3]=m03;dst[4]=m10;dst[5]=m11;dst[6]=m12;dst[7]=m13;dst[8]=m20;dst[9]=m21;dst[10]=m22;dst[11]=m23}dst[12]=m00*v0+m10*v1+m20*v2+m30;dst[13]=m01*v0+m11*v1+m21*v2+m31;dst[14]=m02*v0+m12*v1+m22*v2+m32;dst[15]=m03*v0+m13*v1+m23*v2+m33;return dst}function rotationX(angleInRadians,dst){dst=dst||new MatType(16);var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);dst[0]=1;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=c;dst[6]=s;dst[7]=0;dst[8]=0;dst[9]=-s;dst[10]=c;dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=1;return dst}function rotateX(m,angleInRadians,dst){dst=dst||new MatType(16);var m10=m[4];var m11=m[5];var m12=m[6];var m13=m[7];var m20=m[8];var m21=m[9];var m22=m[10];var m23=m[11];var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);dst[4]=c*m10+s*m20;dst[5]=c*m11+s*m21;dst[6]=c*m12+s*m22;dst[7]=c*m13+s*m23;dst[8]=c*m20-s*m10;dst[9]=c*m21-s*m11;dst[10]=c*m22-s*m12;dst[11]=c*m23-s*m13;if(m!==dst){dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];dst[3]=m[3];dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15]}return dst}function rotationY(angleInRadians,dst){dst=dst||new MatType(16);var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);dst[0]=c;dst[1]=0;dst[2]=-s;dst[3]=0;dst[4]=0;dst[5]=1;dst[6]=0;dst[7]=0;dst[8]=s;dst[9]=0;dst[10]=c;dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=1;return dst}function rotateY(m,angleInRadians,dst){dst=dst||new MatType(16);var m00=m[0*4+0]
;var m01=m[0*4+1];var m02=m[0*4+2];var m03=m[0*4+3];var m20=m[2*4+0];var m21=m[2*4+1];var m22=m[2*4+2];var m23=m[2*4+3];var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);dst[0]=c*m00-s*m20;dst[1]=c*m01-s*m21;dst[2]=c*m02-s*m22;dst[3]=c*m03-s*m23;dst[8]=c*m20+s*m00;dst[9]=c*m21+s*m01;dst[10]=c*m22+s*m02;dst[11]=c*m23+s*m03;if(m!==dst){dst[4]=m[4];dst[5]=m[5];dst[6]=m[6];dst[7]=m[7];dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15]}return dst}function rotationZ(angleInRadians,dst){dst=dst||new MatType(16);var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);dst[0]=c;dst[1]=s;dst[2]=0;dst[3]=0;dst[4]=-s;dst[5]=c;dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=1;dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=1;return dst}function rotateZ(m,angleInRadians,dst){dst=dst||new MatType(16);var m00=m[0*4+0];var m01=m[0*4+1];var m02=m[0*4+2];var m03=m[0*4+3];var m10=m[1*4+0];var m11=m[1*4+1];var m12=m[1*4+2];var m13=m[1*4+3];var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);dst[0]=c*m00+s*m10;dst[1]=c*m01+s*m11;dst[2]=c*m02+s*m12;dst[3]=c*m03+s*m13;dst[4]=c*m10-s*m00;dst[5]=c*m11-s*m01;dst[6]=c*m12-s*m02;dst[7]=c*m13-s*m03;if(m!==dst){dst[8]=m[8];dst[9]=m[9];dst[10]=m[10];dst[11]=m[11];dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15]}return dst}function axisRotation(axis,angleInRadians,dst){dst=dst||new MatType(16);var x=axis[0];var y=axis[1];var z=axis[2];var n=Math.sqrt(x*x+y*y+z*z);x/=n;y/=n;z/=n;var xx=x*x;var yy=y*y;var zz=z*z;var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);var oneMinusCosine=1-c;dst[0]=xx+(1-xx)*c;dst[1]=x*y*oneMinusCosine+z*s;dst[2]=x*z*oneMinusCosine-y*s;dst[3]=0;dst[4]=x*y*oneMinusCosine-z*s;dst[5]=yy+(1-yy)*c;dst[6]=y*z*oneMinusCosine+x*s;dst[7]=0;dst[8]=x*z*oneMinusCosine+y*s;dst[9]=y*z*oneMinusCosine-x*s;dst[10]=zz+(1-zz)*c;dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=1;return dst}function axisRotate(m,axis,angleInRadians,dst){dst=dst||new MatType(16);var x=axis[0];var y=axis[1];var z=axis[2];var n=Math.sqrt(x*x+y*y+z*z);x/=n;y/=n;z/=n;var xx=x*x;var yy=y*y;var zz=z*z;var c=Math.cos(angleInRadians);var s=Math.sin(angleInRadians);var oneMinusCosine=1-c;var r00=xx+(1-xx)*c;var r01=x*y*oneMinusCosine+z*s;var r02=x*z*oneMinusCosine-y*s;var r10=x*y*oneMinusCosine-z*s;var r11=yy+(1-yy)*c;var r12=y*z*oneMinusCosine+x*s;var r20=x*z*oneMinusCosine+y*s;var r21=y*z*oneMinusCosine-x*s;var r22=zz+(1-zz)*c;var m00=m[0];var m01=m[1];var m02=m[2];var m03=m[3];var m10=m[4];var m11=m[5];var m12=m[6];var m13=m[7];var m20=m[8];var m21=m[9];var m22=m[10];var m23=m[11];dst[0]=r00*m00+r01*m10+r02*m20;dst[1]=r00*m01+r01*m11+r02*m21;dst[2]=r00*m02+r01*m12+r02*m22;dst[3]=r00*m03+r01*m13+r02*m23;dst[4]=r10*m00+r11*m10+r12*m20;dst[5]=r10*m01+r11*m11+r12*m21;dst[6]=r10*m02+r11*m12+r12*m22;dst[7]=r10*m03+r11*m13+r12*m23;dst[8]=r20*m00+r21*m10+r22*m20;dst[9]=r20*m01+r21*m11+r22*m21;dst[10]=r20*m02+r21*m12+r22*m22;dst[11]=r20*m03+r21*m13+r22*m23;if(m!==dst){dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15]}return dst}function scaling(v,dst){dst=dst||new MatType(16);dst[0]=v[0];dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=v[1];dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=v[2];dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=1;return dst}function scale(m,v,dst){dst=dst||new MatType(16);var v0=v[0];var v1=v[1];var v2=v[2];dst[0]=v0*m[0*4+0];dst[1]=v0*m[0*4+1];dst[2]=v0*m[0*4+2];dst[3]=v0*m[0*4+3];dst[4]=v1*m[1*4+0];dst[5]=v1*m[1*4+1];dst[6]=v1*m[1*4+2];dst[7]=v1*m[1*4+3];dst[8]=v2*m[2*4+0];dst[9]=v2*m[2*4+1];dst[10]=v2*m[2*4+2];dst[11]=v2*m[2*4+3];if(m!==dst){dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15]}return dst}function transformPoint(m,v,dst){dst=dst||v3.create();var v0=v[0];var v1=v[1];var v2=v[2];var d=v0*m[0*4+3]+v1*m[1*4+3]+v2*m[2*4+3]+m[3*4+3];dst[0]=(v0*m[0*4+0]+v1*m[1*4+0]+v2*m[2*4+0]+m[3*4+0])/d;dst[1]=(v0*m[0*4+1]+v1*m[1*4+1]+v2*m[2*4+1]+m[3*4+1])/d;dst[2]=(v0*m[0*4+2]+v1*m[1*4+2]+v2*m[2*4+2]+m[3*4+2])/d;return dst}function transformDirection(m,v,dst){dst=dst||v3.create();var v0=v[0];var v1=v[1];var v2=v[2];dst[0]=v0*m[0*4+0]+v1*m[1*4+0]+v2*m[2*4+0];dst[1]=v0*m[0*4+1]+v1*m[1*4+1]+v2*m[2*4+1];dst[2]=v0*m[0*4+2]+v1*m[1*4+2]+v2*m[2*4+2];return dst}function transformNormal(m,v,dst){dst=dst||v3.create();var mi=inverse(m);var v0=v[0];var v1=v[1];var v2=v[2];dst[0]=v0*mi[0*4+0]+v1*mi[0*4+1]+v2*mi[0*4+2];dst[1]=v0*mi[1*4+0]+v1*mi[1*4+1]+v2*mi[1*4+2];dst[2]=v0*mi[2*4+0]+v1*mi[2*4+1]+v2*mi[2*4+2];return dst}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.createAttribsFromArrays=createAttribsFromArrays;exports.createBuffersFromArrays=createBuffersFromArrays;exports.createBufferFromArray=createBufferFromArray;exports.createBufferFromTypedArray=createBufferFromTypedArray;exports.createBufferInfoFromArrays=createBufferInfoFromArrays;exports.setAttribInfoBufferFromArray=setAttribInfoBufferFromArray;exports.setAttributePrefix=setAttributePrefix;exports.setAttributeDefaults_=setDefaults;exports.getNumComponents_=getNumComponents;exports.getArray_=getArray;var typedArrays=_interopRequireWildcard(__webpack_require__(1));var helper=_interopRequireWildcard(__webpack_require__(0));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}var gl=undefined;var defaults={attribPrefix:""};function setAttributePrefix(prefix){defaults.attribPrefix=prefix}function setDefaults(newDefaults){helper.copyExistingProperties(newDefaults,defaults)}function setBufferFromTypedArray(gl,type,buffer,array,drawType){gl.bindBuffer(type,buffer);gl.bufferData(type,array,drawType||gl.STATIC_DRAW)}function createBufferFromTypedArray(gl,typedArray,type,drawType){if(helper.isBuffer(gl,typedArray)){return typedArray}type=type||gl.ARRAY_BUFFER;var buffer=gl.createBuffer();setBufferFromTypedArray(gl,type,buffer,typedArray,drawType);return buffer}function isIndices(name){return name==="indices"}function getNormalizationForTypedArray(typedArray){if(typedArray instanceof Int8Array){return true}if(typedArray instanceof Uint8Array){return true}return false}function getNormalizationForTypedArrayType(typedArrayType){if(typedArrayType===Int8Array){return true}if(typedArrayType===Uint8Array){return true}return false}function getArray(array){return array.length?array:array.data}var texcoordRE=/coord|texture/i;var colorRE=/color|colour/i;function guessNumComponentsFromName(name,length){var numComponents;if(texcoordRE.test(name)){numComponents=2}else if(colorRE.test(name)){numComponents=4}else{numComponents=3}if(length%numComponents>0){throw"Can not guess numComponents for attribute '"+name+"'. Tried "+numComponents+" but "+length+" values is not evenly divisible by "+numComponents+". You should specify it."}return numComponents}function getNumComponents(array,arrayName){return array.numComponents||array.size||guessNumComponentsFromName(arrayName,getArray(array).length)}function makeTypedArray(array,name){if(typedArrays.isArrayBuffer(array)){return array}if(typedArrays.isArrayBuffer(array.data)){return array.data}if(Array.isArray(array)){array={data:array}}var Type=array.type;if(!Type){if(isIndices(name)){Type=Uint16Array}else{Type=Float32Array}}return new Type(array.data)}function createAttribsFromArrays(gl,arrays){var attribs={};Object.keys(arrays).forEach(function(arrayName){if(!isIndices(arrayName)){var array=arrays[arrayName];var attribName=array.attrib||array.name||array.attribName||defaults.attribPrefix+arrayName;var buffer;var type;var normalization;var numComponents;var numValues;if(typeof array==="number"||typeof array.data==="number"){numValues=array.data||array;var arrayType=array.type||Float32Array;var numBytes=numValues*arrayType.BYTES_PER_ELEMENT;type=typedArrays.getGLTypeForTypedArrayType(arrayType);normalization=array.normalize!==undefined?array.normalize:getNormalizationForTypedArrayType(arrayType);numComponents=array.numComponents||array.size||guessNumComponentsFromName(arrayName,numValues);buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,numBytes,array.drawType||gl.STATIC_DRAW)}else{var typedArray=makeTypedArray(array,arrayName);buffer=createBufferFromTypedArray(gl,typedArray,undefined,array.drawType);type=typedArrays.getGLTypeForTypedArray(typedArray);normalization=array.normalize!==undefined?array.normalize:getNormalizationForTypedArray(typedArray);numComponents=getNumComponents(array,arrayName);numValues=typedArray.length}attribs[attribName]={buffer:buffer,numComponents:numComponents,type:type,normalize:normalization,stride:array.stride||0,offset:array.offset||0,divisor:array.divisor===undefined?undefined:array.divisor,drawType:array.drawType}}});gl.bindBuffer(gl.ARRAY_BUFFER,null);return attribs}function setAttribInfoBufferFromArray(gl,attribInfo,array,offset){array=makeTypedArray(array);if(offset!==undefined){gl.bindBuffer(gl.ARRAY_BUFFER,attribInfo.buffer);gl.bufferSubData(gl.ARRAY_BUFFER,offset,array)}else{setBufferFromTypedArray(gl,gl.ARRAY_BUFFER,attribInfo.buffer,array,attribInfo.drawType)}}function getBytesPerValueForGLType(gl,type){if(type===gl.BYTE)return 1;if(type===gl.UNSIGNED_BYTE)return 1;if(type===gl.SHORT)return 2;if(type===gl.UNSIGNED_SHORT)return 2;if(type===gl.INT)return 4;if(type===gl.UNSIGNED_INT)return 4;if(type===gl.FLOAT)return 4;return 0}var positionKeys=["position","positions","a_position"];function getNumElementsFromNonIndexedArrays(arrays){var key;for(var _ii=0;_ii<positionKeys.length;++_ii){key=positionKeys[_ii];if(key in arrays){break}}if(ii===positionKeys.length){key=Object.keys(arrays)[0]}var array=arrays[key];var length=getArray(array).length;var numComponents=getNumComponents(array,key);var numElements=length/numComponents;if(length%numComponents>0){throw"numComponents "+numComponents+" not correct for length "+length}return numElements}function getNumElementsFromAttributes(gl,attribs){var key;var ii;for(ii=0;ii<positionKeys.length;++ii){key=positionKeys[ii];if(key in attribs){break}key=defaults.attribPrefix+key;if(key in attribs){break}}if(ii===positionKeys.length){key=Object.keys(attribs)[0]}var attrib=attribs[key];gl.bindBuffer(gl.ARRAY_BUFFER,attrib.buffer);var numBytes=gl.getBufferParameter(gl.ARRAY_BUFFER,gl.BUFFER_SIZE);gl.bindBuffer(gl.ARRAY_BUFFER,null);var bytesPerValue=getBytesPerValueForGLType(gl,attrib.type);var totalElements=numBytes/bytesPerValue;var numComponents=attrib.numComponents||attrib.size;var numElements=totalElements/numComponents;if(numElements%1!==0){throw"numComponents "+numComponents+" not correct for length "+length}return numElements}function createBufferInfoFromArrays(gl,arrays){var bufferInfo={attribs:createAttribsFromArrays(gl,arrays)};var indices=arrays.indices;if(indices){var newIndices=makeTypedArray(indices,"indices");bufferInfo.indices=createBufferFromTypedArray(gl,newIndices,gl.ELEMENT_ARRAY_BUFFER);bufferInfo.numElements=newIndices.length;bufferInfo.elementType=typedArrays.getGLTypeForTypedArray(newIndices)}else{bufferInfo.numElements=getNumElementsFromAttributes(gl,bufferInfo.attribs)}return bufferInfo}function createBufferFromArray(gl,array,arrayName){var type=arrayName==="indices"?gl.ELEMENT_ARRAY_BUFFER:gl.ARRAY_BUFFER;var typedArray=makeTypedArray(array,arrayName);return createBufferFromTypedArray(gl,typedArray,type)}function createBuffersFromArrays(gl,arrays){var buffers={};Object.keys(arrays).forEach(function(key){buffers[key]=createBufferFromArray(gl,arrays[key],key)});if(arrays.indices){buffers.numElements=arrays.indices.length;buffers.elementType=typedArrays.getGLTypeForTypedArray(makeTypedArray(arrays.indices),"indices")}else{buffers.numElements=getNumElementsFromNonIndexedArrays(arrays)}return buffers}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.setTextureDefaults_=setDefaults;exports.createSampler=createSampler;exports.createSamplers=createSamplers;exports.setSamplerParameters=setSamplerParameters;exports.createTexture=createTexture;exports.setEmptyTexture=setEmptyTexture;exports.setTextureFromArray=setTextureFromArray;exports.loadTextureFromUrl=loadTextureFromUrl;exports.setTextureFromElement=setTextureFromElement;exports.setTextureFilteringForSize=setTextureFilteringForSize;exports.setTextureParameters=setTextureParameters;exports.setDefaultTextureColor=setDefaultTextureColor;exports.createTextures=createTextures;exports.resizeTexture=resizeTexture;exports.getNumComponentsForFormat=getNumComponentsForFormat;exports.getBytesPerElementForInternalFormat=getBytesPerElementForInternalFormat;var utils=_interopRequireWildcard(__webpack_require__(4));var typedArrays=_interopRequireWildcard(__webpack_require__(1));var helper=_interopRequireWildcard(__webpack_require__(0));var _globalObject=_interopRequireDefault(__webpack_require__(2));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}var gl=undefined;var defaults={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:undefined};var isArrayBuffer=typedArrays.isArrayBuffer;var ctx=_globalObject.default.document&&_globalObject.default.document.createElement?_globalObject.default.document.createElement("canvas").getContext("2d"):null;var ALPHA=6406;var RGB=6407;var RGBA=6408;var LUMINANCE=6409;var LUMINANCE_ALPHA=6410;var DEPTH_COMPONENT=6402;var DEPTH_STENCIL=34041;var REPEAT=10497;var MIRRORED_REPEAT=33648;var NEAREST=9728;var NEAREST_MIPMAP_NEAREST=9984;var LINEAR_MIPMAP_NEAREST=9985;var NEAREST_MIPMAP_LINEAR=9986;var LINEAR_MIPMAP_LINEAR=9987;var R8=33321;var R8_SNORM=36756;var R16F=33325;var R32F=33326;var R8UI=33330;var R8I=33329;var RG16UI=33338;var RG16I=33337;var RG32UI=33340;var RG32I=33339;var RG8=33323;var RG8_SNORM=36757;var RG16F=33327;var RG32F=33328;var RG8UI=33336;var RG8I=33335;var R16UI=33332;var R16I=33331;var R32UI=33334;var R32I=33333;var RGB8=32849;var SRGB8=35905;var RGB565=36194;var RGB8_SNORM=36758;var R11F_G11F_B10F=35898;var RGB9_E5=35901;var RGB16F=34843;var RGB32F=34837;var RGB8UI=36221;var RGB8I=36239;var RGB16UI=36215;var RGB16I=36233;var RGB32UI=36209;var RGB32I=36227;var RGBA8=32856;var SRGB8_ALPHA8=35907;var RGBA8_SNORM=36759;var RGB5_A1=32855;var RGBA4=32854;var RGB10_A2=32857;var RGBA16F=34842;var RGBA32F=34836;var RGBA8UI=36220;var RGBA8I=36238;var RGB10_A2UI=36975;var RGBA16UI=36214;var RGBA16I=36232;var RGBA32I=36226;var RGBA32UI=36208;var DEPTH_COMPONENT16=33189;var DEPTH_COMPONENT24=33190;var DEPTH_COMPONENT32F=36012;var DEPTH32F_STENCIL8=36013;var DEPTH24_STENCIL8=35056;var BYTE=5120;var UNSIGNED_BYTE=5121;var SHORT=5122;var UNSIGNED_SHORT=5123;var INT=5124;var UNSIGNED_INT=5125;var FLOAT=5126;var UNSIGNED_SHORT_4_4_4_4=32819;var UNSIGNED_SHORT_5_5_5_1=32820;var UNSIGNED_SHORT_5_6_5=33635;var HALF_FLOAT=5131;var HALF_FLOAT_OES=36193;var UNSIGNED_INT_2_10_10_10_REV=33640;var UNSIGNED_INT_10F_11F_11F_REV=35899;var UNSIGNED_INT_5_9_9_9_REV=35902;var FLOAT_32_UNSIGNED_INT_24_8_REV=36269;var UNSIGNED_INT_24_8=34042;var RG=33319;var RG_INTEGER=33320;var RED=6403;var RED_INTEGER=36244;var RGB_INTEGER=36248;var RGBA_INTEGER=36249;var formatInfo={};{var f=formatInfo;f[ALPHA]={numColorComponents:1};f[LUMINANCE]={numColorComponents:1};f[LUMINANCE_ALPHA]={numColorComponents:2};f[RGB]={numColorComponents:3};f[RGBA]={numColorComponents:4};f[RED]={numColorComponents:1};f[RED_INTEGER]={numColorComponents:1};f[RG]={numColorComponents:2};f[RG_INTEGER]={numColorComponents:2};f[RGB]={numColorComponents:3};f[RGB_INTEGER]={numColorComponents:3};f[RGBA]={numColorComponents:4};f[RGBA_INTEGER]={numColorComponents:4};f[DEPTH_COMPONENT]={numColorComponents:1};f[DEPTH_STENCIL]={numColorComponents:2}}var textureInternalFormatInfo={};{var t=textureInternalFormatInfo;t[ALPHA]={textureFormat:ALPHA,colorRenderable:true,textureFilterable:true,bytesPerElement:[1,2,2,4],type:[UNSIGNED_BYTE,HALF_FLOAT,HALF_FLOAT_OES,FLOAT]};t[LUMINANCE]={textureFormat:LUMINANCE,colorRenderable:true,textureFilterable:true,bytesPerElement:[1,2,2,4],type:[UNSIGNED_BYTE,HALF_FLOAT,HALF_FLOAT_OES,FLOAT]};t[LUMINANCE_ALPHA]={textureFormat:LUMINANCE_ALPHA,colorRenderable:true,textureFilterable:true,bytesPerElement:[2,4,4,8],type:[UNSIGNED_BYTE,HALF_FLOAT,HALF_FLOAT_OES,FLOAT]};t[RGB]={textureFormat:RGB,colorRenderable:true,textureFilterable:true,bytesPerElement:[3,6,6,12,2],type:[UNSIGNED_BYTE,HALF_FLOAT,HALF_FLOAT_OES,FLOAT,UNSIGNED_SHORT_5_6_5]};t[RGBA]={textureFormat:RGBA,colorRenderable:true,textureFilterable:true,bytesPerElement:[4,8,8,16,2,2],type:[UNSIGNED_BYTE,HALF_FLOAT,HALF_FLOAT_OES,FLOAT,UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1]};t[R8]={textureFormat:RED,colorRenderable:true,textureFilterable:true,bytesPerElement:1,type:UNSIGNED_BYTE};t[R8_SNORM]={textureFormat:RED,colorRenderable:false,textureFilterable:true,bytesPerElement:1,type:BYTE};t[R16F]={textureFormat:RED,colorRenderable:false,textureFilterable:true,bytesPerElement:[4,2],type:[FLOAT,HALF_FLOAT]};t[R32F]={textureFormat:RED,colorRenderable:false,textureFilterable:false,bytesPerElement:4,type:FLOAT};t[R8UI]={textureFormat:RED_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:1,type:UNSIGNED_BYTE};t[R8I]={textureFormat:RED_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:1,type:BYTE};t[R16UI]={textureFormat:RED_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:2,type:UNSIGNED_SHORT};t[R16I]={textureFormat:RED_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:2,type:SHORT};t[R32UI]={textureFormat:RED_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:UNSIGNED_INT};t[R32I]={textureFormat:RED_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:INT};t[RG8]={textureFormat:RG,colorRenderable:true,textureFilterable:true,bytesPerElement:2,type:UNSIGNED_BYTE};t[RG8_SNORM]={textureFormat:RG,colorRenderable:false,textureFilterable:true,bytesPerElement:2,type:BYTE};t[RG16F]={textureFormat:RG,colorRenderable:false,textureFilterable:true,bytesPerElement:[8,4],type:[FLOAT,HALF_FLOAT]};t[RG32F]={textureFormat:RG,colorRenderable:false,textureFilterable:false,bytesPerElement:8,type:FLOAT};t[RG8UI]={textureFormat:RG_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:2,type:UNSIGNED_BYTE};t[RG8I]={textureFormat:RG_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:2,type:BYTE};t[RG16UI]={textureFormat:RG_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:UNSIGNED_SHORT};t[RG16I]={textureFormat:RG_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:SHORT};t[RG32UI]={textureFormat:RG_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:8,type:UNSIGNED_INT};t[RG32I]={textureFormat:RG_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:8,type:INT};t[RGB8]={textureFormat:RGB,colorRenderable:true,textureFilterable:true,bytesPerElement:3,type:UNSIGNED_BYTE};t[SRGB8]={textureFormat:RGB,colorRenderable:false,textureFilterable:true,bytesPerElement:3,type:UNSIGNED_BYTE};t[RGB565]={textureFormat:RGB,colorRenderable:true,textureFilterable:true,bytesPerElement:[3,2],type:[UNSIGNED_BYTE,UNSIGNED_SHORT_5_6_5]};t[RGB8_SNORM]={textureFormat:RGB,colorRenderable:false,textureFilterable:true,bytesPerElement:3,type:BYTE};t[R11F_G11F_B10F]={textureFormat:RGB,colorRenderable:false,textureFilterable:true,bytesPerElement:[12,6,4],type:[FLOAT,HALF_FLOAT,UNSIGNED_INT_10F_11F_11F_REV]};t[RGB9_E5]={textureFormat:RGB,colorRenderable:false,textureFilterable:true,bytesPerElement:[12,6,4],type:[FLOAT,HALF_FLOAT,UNSIGNED_INT_5_9_9_9_REV]};t[RGB16F]={textureFormat:RGB,colorRenderable:false,textureFilterable:true,bytesPerElement:[12,6],type:[FLOAT,HALF_FLOAT]};t[RGB32F]={textureFormat:RGB,colorRenderable:false,textureFilterable:false,bytesPerElement:12,type:FLOAT};t[RGB8UI]={textureFormat:RGB_INTEGER,colorRenderable:false,textureFilterable:false,bytesPerElement:3,type:UNSIGNED_BYTE};t[RGB8I]={textureFormat:RGB_INTEGER,colorRenderable:false,textureFilterable:false,bytesPerElement:3,type:BYTE};t[RGB16UI]={textureFormat:RGB_INTEGER,colorRenderable:false,textureFilterable:false,bytesPerElement:6,type:UNSIGNED_SHORT};t[RGB16I]={textureFormat:RGB_INTEGER,colorRenderable:false,textureFilterable:false,bytesPerElement:6,type:SHORT};t[RGB32UI]={textureFormat:RGB_INTEGER,colorRenderable:false,textureFilterable:false,bytesPerElement:12,type:UNSIGNED_INT};t[RGB32I]={textureFormat:RGB_INTEGER,colorRenderable:false,textureFilterable:false,bytesPerElement:12,type:INT};t[RGBA8]={textureFormat:RGBA,colorRenderable:true,textureFilterable:true,bytesPerElement:4,type:UNSIGNED_BYTE};t[SRGB8_ALPHA8]={textureFormat:RGBA,colorRenderable:true,textureFilterable:true,bytesPerElement:4,type:UNSIGNED_BYTE};t[RGBA8_SNORM]={textureFormat:RGBA,colorRenderable:false,textureFilterable:true,bytesPerElement:4,type:BYTE};t[RGB5_A1]={textureFormat:RGBA,colorRenderable:true,textureFilterable:true,bytesPerElement:[4,2,4],type:[UNSIGNED_BYTE,UNSIGNED_SHORT_5_5_5_1,UNSIGNED_INT_2_10_10_10_REV]};t[RGBA4]={textureFormat:RGBA,colorRenderable:true,textureFilterable:true,bytesPerElement:[4,2],type:[UNSIGNED_BYTE,UNSIGNED_SHORT_4_4_4_4]};t[RGB10_A2]={textureFormat:RGBA,colorRenderable:true,textureFilterable:true,bytesPerElement:4,type:UNSIGNED_INT_2_10_10_10_REV};t[RGBA16F]={textureFormat:RGBA,colorRenderable:false,textureFilterable:true,bytesPerElement:[16,8],type:[FLOAT,HALF_FLOAT]};t[RGBA32F]={textureFormat:RGBA,colorRenderable:false,textureFilterable:false,bytesPerElement:16,type:FLOAT};t[RGBA8UI]={textureFormat:RGBA_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:UNSIGNED_BYTE};t[RGBA8I]={textureFormat:RGBA_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:BYTE};t[RGB10_A2UI]={textureFormat:RGBA_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:UNSIGNED_INT_2_10_10_10_REV};t[RGBA16UI]={textureFormat:RGBA_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:8,type:UNSIGNED_SHORT};t[RGBA16I]={textureFormat:RGBA_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:8,type:SHORT};t[RGBA32I]={textureFormat:RGBA_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:16,type:INT};t[RGBA32UI]={textureFormat:RGBA_INTEGER,colorRenderable:true,textureFilterable:false,bytesPerElement:16,type:UNSIGNED_INT};t[DEPTH_COMPONENT16]={textureFormat:DEPTH_COMPONENT,colorRenderable:true,textureFilterable:false,bytesPerElement:[2,4],type:[UNSIGNED_SHORT,UNSIGNED_INT]};t[DEPTH_COMPONENT24]={textureFormat:DEPTH_COMPONENT,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:UNSIGNED_INT};t[DEPTH_COMPONENT32F]={textureFormat:DEPTH_COMPONENT,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:FLOAT};t[DEPTH24_STENCIL8]={textureFormat:DEPTH_STENCIL,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:UNSIGNED_INT_24_8};t[DEPTH32F_STENCIL8]={textureFormat:DEPTH_STENCIL,colorRenderable:true,textureFilterable:false,bytesPerElement:4,type:FLOAT_32_UNSIGNED_INT_24_8_REV};Object.keys(t).forEach(function(internalFormat){var info=t[internalFormat];info.bytesPerElementMap={};if(Array.isArray(info.bytesPerElement)){info.bytesPerElement.forEach(function(bytesPerElement,ndx){var type=info.type[ndx];info.bytesPerElementMap[type]=bytesPerElement})}else{var type=info.type;info.bytesPerElementMap[type]=info.bytesPerElement}})}function getBytesPerElementForInternalFormat(internalFormat,type){var info=textureInternalFormatInfo[internalFormat];if(!info){throw"unknown internal format"}var bytesPerElement=info.bytesPerElementMap[type];if(bytesPerElement===undefined){throw"unknown internal format"}return bytesPerElement}function getFormatAndTypeForInternalFormat(internalFormat){var info=textureInternalFormatInfo[internalFormat];if(!info){throw"unknown internal format"}return{format:info.textureFormat,type:Array.isArray(info.type)?info.type[0]:info.type}}function isPowerOf2(value){return(value&value-1)===0}function canGenerateMipmap(gl,width,height,internalFormat){if(!utils.isWebGL2(gl)){return isPowerOf2(width)&&isPowerOf2(height)}var info=textureInternalFormatInfo[internalFormat];if(!info){throw"unknown internal format"}return info.colorRenderable&&info.textureFilterable}function canFilter(internalFormat){var info=textureInternalFormatInfo[internalFormat];if(!info){throw"unknown internal format"}return info.textureFilterable}function getNumComponentsForFormat(format){var info=formatInfo[format];if(!info){throw"unknown format: "+format}return info.numColorComponents}function getTextureTypeForArrayType(gl,src,defaultType){if(isArrayBuffer(src)){return typedArrays.getGLTypeForTypedArray(src)}return defaultType||gl.UNSIGNED_BYTE}function guessDimensions(gl,target,width,height,numElements){if(numElements%1!==0){throw"can't guess dimensions"}if(!width&&!height){var size=Math.sqrt(numElements/(target===gl.TEXTURE_CUBE_MAP?6:1));if(size%1===0){width=size;height=size}else{width=numElements;height=1}}else if(!height){height=numElements/width;if(height%1){throw"can't guess dimensions"}}else if(!width){width=numElements/height;if(width%1){throw"can't guess dimensions"}}return{width:width,height:height}}function setDefaultTextureColor(color){defaults.textureColor=new Uint8Array([color[0]*255,color[1]*255,color[2]*255,color[3]*255])}function setDefaults(newDefaults){helper.copyExistingProperties(newDefaults,defaults);if(newDefaults.textureColor){setDefaultTextureColor(newDefaults.textureColor)}}var lastPackState={};function savePackState(gl,options){if(options.colorspaceConversion!==undefined){lastPackState.colorspaceConversion=gl.getParameter(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL);gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,options.colorspaceConversion)}if(options.premultiplyAlpha!==undefined){lastPackState.premultiplyAlpha=gl.getParameter(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,options.premultiplyAlpha)}if(options.flipY!==undefined){lastPackState.flipY=gl.getParameter(gl.UNPACK_FLIP_Y_WEBGL);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,options.flipY)}}function restorePackState(gl,options){if(options.colorspaceConversion!==undefined){gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,lastPackState.colorspaceConversion)}if(options.premultiplyAlpha!==undefined){gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,lastPackState.premultiplyAlpha)}if(options.flipY!==undefined){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,lastPackState.flipY)}}function saveSkipState(gl){lastPackState.unpackAlignment=gl.getParameter(gl.UNPACK_ALIGNMENT);if(utils.isWebGL2(gl)){lastPackState.unpackRowLength=gl.getParameter(gl.UNPACK_ROW_LENGTH);lastPackState.unpackImageHeight=gl.getParameter(gl.UNPACK_IMAGE_HEIGHT);lastPackState.unpackSkipPixels=gl.getParameter(gl.UNPACK_SKIP_PIXELS);lastPackState.unpackSkipRows=gl.getParameter(gl.UNPACK_SKIP_ROWS);lastPackState.unpackSkipImages=gl.getParameter(gl.UNPACK_SKIP_IMAGES)}}function restoreSkipState(gl){gl.pixelStorei(gl.UNPACK_ALIGNMENT,lastPackState.unpackAlignment);if(utils.isWebGL2(gl)){gl.pixelStorei(gl.UNPACK_ROW_LENGTH,lastPackState.unpackRowLength);gl.pixelStorei(gl.UNPACK_IMAGE_HEIGHT,lastPackState.unpackImageHeight);gl.pixelStorei(gl.UNPACK_SKIP_PIXELS,lastPackState.unpackSkipPixels);gl.pixelStorei(gl.UNPACK_SKIP_ROWS,lastPackState.unpackSkipRows);gl.pixelStorei(gl.UNPACK_SKIP_IMAGES,lastPackState.unpackSkipImages)}}function setTextureSamplerParameters(gl,target,parameteriFn,options){if(options.minMag){parameteriFn.call(gl,target,gl.TEXTURE_MIN_FILTER,options.minMag);parameteriFn.call(gl,target,gl.TEXTURE_MAG_FILTER,options.minMag)}if(options.min){parameteriFn.call(gl,target,gl.TEXTURE_MIN_FILTER,options.min)}if(options.mag){parameteriFn.call(gl,target,gl.TEXTURE_MAG_FILTER,options.mag)}if(options.wrap){parameteriFn.call(gl,target,gl.TEXTURE_WRAP_S,options.wrap);parameteriFn.call(gl,target,gl.TEXTURE_WRAP_T,options.wrap);if(target===gl.TEXTURE_3D||helper.isSampler(gl,target)){parameteriFn.call(gl,target,gl.TEXTURE_WRAP_R,options.wrap)}}if(options.wrapR){parameteriFn.call(gl,target,gl.TEXTURE_WRAP_R,options.wrapR)}if(options.wrapS){parameteriFn.call(gl,target,gl.TEXTURE_WRAP_S,options.wrapS)}if(options.wrapT){parameteriFn.call(gl,target,gl.TEXTURE_WRAP_T,options.wrapT)}if(options.minLod){parameteriFn.call(gl,target,gl.TEXTURE_MIN_LOD,options.minLod)}if(options.maxLod){parameteriFn.call(gl,target,gl.TEXTURE_MAX_LOD,options.maxLod)}if(options.baseLevel){parameteriFn.call(gl,target,gl.TEXTURE_BASE_LEVEL,options.baseLevel)}if(options.maxLevel){parameteriFn.call(gl,target,gl.TEXTURE_MAX_LEVEL,options.maxLevel)}}function setTextureParameters(gl,tex,options){var target=options.target||gl.TEXTURE_2D;gl.bindTexture(target,tex);setTextureSamplerParameters(gl,target,gl.texParameteri,options)}function setSamplerParameters(gl,sampler,options){setTextureSamplerParameters(gl,sampler,gl.samplerParameteri,options)}function createSampler(gl,options){var sampler=gl.createSampler();setSamplerParameters(gl,sampler,options);return sampler}function createSamplers(gl,samplerOptions){var samplers={};Object.keys(samplerOptions).forEach(function(name){samplers[name]=createSampler(gl,samplerOptions[name])});return samplers}function make1Pixel(color){color=color||defaults.textureColor;if(isArrayBuffer(color)){return color}return new Uint8Array([color[0]*255,color[1]*255,color[2]*255,color[3]*255])}function setTextureFilteringForSize(gl,tex,options,width,height,internalFormat,type){options=options||defaults.textureOptions;internalFormat=internalFormat||gl.RGBA;type=type||gl.UNSIGNED_BYTE;var target=options.target||gl.TEXTURE_2D;width=width||options.width;height=height||options.height;gl.bindTexture(target,tex);if(canGenerateMipmap(gl,width,height,internalFormat,type)){gl.generateMipmap(target)}else{var filtering=canFilter(internalFormat,type)?gl.LINEAR:gl.NEAREST;gl.texParameteri(target,gl.TEXTURE_MIN_FILTER,filtering);gl.texParameteri(target,gl.TEXTURE_MAG_FILTER,filtering);gl.texParameteri(target,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(target,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}}function shouldAutomaticallySetTextureFilteringForSize(options){return options.auto===true||options.auto===undefined&&options.level===undefined}function getCubeFaceOrder(gl,options){options=options||{};return options.cubeFaceOrder||[gl.TEXTURE_CUBE_MAP_POSITIVE_X,gl.TEXTURE_CUBE_MAP_NEGATIVE_X,gl.TEXTURE_CUBE_MAP_POSITIVE_Y,gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,gl.TEXTURE_CUBE_MAP_POSITIVE_Z,gl.TEXTURE_CUBE_MAP_NEGATIVE_Z]}function getCubeFacesWithNdx(gl,options){var faces=getCubeFaceOrder(gl,options);var facesWithNdx=faces.map(function(face,ndx){return{face:face,ndx:ndx}});facesWithNdx.sort(function(a,b){return a.face-b.face});return facesWithNdx}function setTextureFromElement(gl,tex,element,options){options=options||defaults.textureOptions;var target=options.target||gl.TEXTURE_2D;var level=options.level||0;var width=element.width;var height=element.height;var internalFormat=options.internalFormat||options.format||gl.RGBA;var formatType=getFormatAndTypeForInternalFormat(internalFormat);var format=options.format||formatType.format;var type=options.type||formatType.type;savePackState(gl,options);gl.bindTexture(target,tex);if(target===gl.TEXTURE_CUBE_MAP){
var imgWidth=element.width;var imgHeight=element.height;var size;var slices;if(imgWidth/6===imgHeight){size=imgHeight;slices=[0,0,1,0,2,0,3,0,4,0,5,0]}else if(imgHeight/6===imgWidth){size=imgWidth;slices=[0,0,0,1,0,2,0,3,0,4,0,5]}else if(imgWidth/3===imgHeight/2){size=imgWidth/3;slices=[0,0,1,0,2,0,0,1,1,1,2,1]}else if(imgWidth/2===imgHeight/3){size=imgWidth/2;slices=[0,0,1,0,0,1,1,1,0,2,1,2]}else{throw"can't figure out cube map from element: "+(element.src?element.src:element.nodeName)}if(ctx){ctx.canvas.width=size;ctx.canvas.height=size;width=size;height=size;getCubeFacesWithNdx(gl,options).forEach(function(f){var xOffset=slices[f.ndx*2+0]*size;var yOffset=slices[f.ndx*2+1]*size;ctx.drawImage(element,xOffset,yOffset,size,size,0,0,size,size);gl.texImage2D(f.face,level,internalFormat,format,type,ctx.canvas)});ctx.canvas.width=1;ctx.canvas.height=1}else if(_globalObject.default.createImageBitmap){width=size;height=size;getCubeFacesWithNdx(gl,options).forEach(function(f){var xOffset=slices[f.ndx*2+0]*size;var yOffset=slices[f.ndx*2+1]*size;gl.texImage2D(f.face,level,internalFormat,size,size,0,format,type,null);_globalObject.default.createImageBitmap(element,xOffset,yOffset,size,size,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(imageBitmap){savePackState(gl,options);gl.bindTexture(target,tex);gl.texImage2D(f.face,level,internalFormat,format,type,imageBitmap);restorePackState(gl,options);if(shouldAutomaticallySetTextureFilteringForSize(options)){setTextureFilteringForSize(gl,tex,options,width,height,internalFormat,type)}})})}}else if(target===gl.TEXTURE_3D||target===gl.TEXTURE_2D_ARRAY){var smallest=Math.min(element.width,element.height);var largest=Math.max(element.width,element.height);var depth=largest/smallest;if(depth%1!==0){throw"can not compute 3D dimensions of element"}var xMult=element.width===largest?1:0;var yMult=element.height===largest?1:0;saveSkipState(gl);gl.pixelStorei(gl.UNPACK_ALIGNMENT,1);gl.pixelStorei(gl.UNPACK_ROW_LENGTH,element.width);gl.pixelStorei(gl.UNPACK_IMAGE_HEIGHT,0);gl.pixelStorei(gl.UNPACK_SKIP_IMAGES,0);gl.texImage3D(target,level,internalFormat,smallest,smallest,smallest,0,format,type,null);for(var d=0;d<depth;++d){var srcX=d*smallest*xMult;var srcY=d*smallest*yMult;gl.pixelStorei(gl.UNPACK_SKIP_PIXELS,srcX);gl.pixelStorei(gl.UNPACK_SKIP_ROWS,srcY);gl.texSubImage3D(target,level,0,0,d,smallest,smallest,1,format,type,element)}restoreSkipState(gl)}else{gl.texImage2D(target,level,internalFormat,format,type,element)}restorePackState(gl,options);if(shouldAutomaticallySetTextureFilteringForSize(options)){setTextureFilteringForSize(gl,tex,options,width,height,internalFormat,type)}setTextureParameters(gl,tex,options)}function noop(){}function loadImage(url,crossOrigin,callback){callback=callback||noop;var img;if(_globalObject.default.Image){img=new _globalObject.default.Image;crossOrigin=crossOrigin!==undefined?crossOrigin:defaults.crossOrigin;if(crossOrigin!==undefined){img.crossOrigin=crossOrigin}var clearEventHandlers=function clearEventHandlers(){img.removeEventListener("error",onError);img.removeEventListener("load",onLoad);img=null};var onError=function onError(){var msg="couldn't load image: "+url;helper.error(msg);callback(msg,img);clearEventHandlers()};var onLoad=function onLoad(){callback(null,img);clearEventHandlers()};img.addEventListener("error",onError);img.addEventListener("load",onLoad);img.src=url;return img}else if(_globalObject.default.ImageBitmap){var err;var bm;var cb=function cb(){callback(err,bm)};var options={};if(crossOrigin){options.mode="cors"}fetch(url,options).then(function(response){if(!response.ok){throw response}return response.blob()}).then(function(blob){return _globalObject.default.createImageBitmap(blob,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(bitmap){bm=bitmap;setTimeout(cb)}).catch(function(e){err=e;setTimeout(cb)});img=null}return img}function isTexImageSource(obj){return _globalObject.default.ImageBitmap&&obj instanceof _globalObject.default.ImageBitmap||_globalObject.default.ImageData&&obj instanceof _globalObject.default.ImageData||_globalObject.default.HTMLElement&&obj instanceof _globalObject.default.HTMLElement}function loadAndUseImage(obj,crossOrigin,callback){if(isTexImageSource(obj)){setTimeout(function(){callback(null,obj)});return obj}return loadImage(obj,crossOrigin,callback)}function setTextureTo1PixelColor(gl,tex,options){options=options||defaults.textureOptions;var target=options.target||gl.TEXTURE_2D;gl.bindTexture(target,tex);if(options.color===false){return}var color=make1Pixel(options.color);if(target===gl.TEXTURE_CUBE_MAP){for(var ii=0;ii<6;++ii){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+ii,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,color)}}else if(target===gl.TEXTURE_3D||target===gl.TEXTURE_2D_ARRAY){gl.texImage3D(target,0,gl.RGBA,1,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,color)}else{gl.texImage2D(target,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,color)}}function loadTextureFromUrl(gl,tex,options,callback){callback=callback||noop;options=options||defaults.textureOptions;setTextureTo1PixelColor(gl,tex,options);options=Object.assign({},options);var img=loadAndUseImage(options.src,options.crossOrigin,function(err,img){if(err){callback(err,tex,img)}else{setTextureFromElement(gl,tex,img,options);callback(null,tex,img)}});return img}function loadCubemapFromUrls(gl,tex,options,callback){callback=callback||noop;var urls=options.src;if(urls.length!==6){throw"there must be 6 urls for a cubemap"}var level=options.level||0;var internalFormat=options.internalFormat||options.format||gl.RGBA;var formatType=getFormatAndTypeForInternalFormat(internalFormat);var format=options.format||formatType.format;var type=options.type||gl.UNSIGNED_BYTE;var target=options.target||gl.TEXTURE_2D;if(target!==gl.TEXTURE_CUBE_MAP){throw"target must be TEXTURE_CUBE_MAP"}setTextureTo1PixelColor(gl,tex,options);options=Object.assign({},options);var numToLoad=6;var errors=[];var faces=getCubeFaceOrder(gl,options);var imgs;function uploadImg(faceTarget){return function(err,img){--numToLoad;if(err){errors.push(err)}else{if(img.width!==img.height){errors.push("cubemap face img is not a square: "+img.src)}else{savePackState(gl,options);gl.bindTexture(target,tex);if(numToLoad===5){getCubeFaceOrder(gl).forEach(function(otherTarget){gl.texImage2D(otherTarget,level,internalFormat,format,type,img)})}else{gl.texImage2D(faceTarget,level,internalFormat,format,type,img)}restorePackState(gl,options);if(shouldAutomaticallySetTextureFilteringForSize(options)){gl.generateMipmap(target)}}}if(numToLoad===0){callback(errors.length?errors:undefined,tex,imgs)}}}imgs=urls.map(function(url,ndx){return loadAndUseImage(url,options.crossOrigin,uploadImg(faces[ndx]))})}function loadSlicesFromUrls(gl,tex,options,callback){callback=callback||noop;var urls=options.src;var internalFormat=options.internalFormat||options.format||gl.RGBA;var formatType=getFormatAndTypeForInternalFormat(internalFormat);var format=options.format||formatType.format;var type=options.type||gl.UNSIGNED_BYTE;var target=options.target||gl.TEXTURE_2D_ARRAY;if(target!==gl.TEXTURE_3D&&target!==gl.TEXTURE_2D_ARRAY){throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY"}setTextureTo1PixelColor(gl,tex,options);options=Object.assign({},options);var numToLoad=urls.length;var errors=[];var imgs;var level=options.level||0;var width=options.width;var height=options.height;var depth=urls.length;var firstImage=true;function uploadImg(slice){return function(err,img){--numToLoad;if(err){errors.push(err)}else{savePackState(gl,options);gl.bindTexture(target,tex);if(firstImage){firstImage=false;width=options.width||img.width;height=options.height||img.height;gl.texImage3D(target,level,internalFormat,width,height,depth,0,format,type,null);for(var s=0;s<depth;++s){gl.texSubImage3D(target,level,0,0,s,width,height,1,format,type,img)}}else{var src=img;if(img.width!==width||img.height!==height){src=ctx.canvas;ctx.canvas.width=width;ctx.canvas.height=height;ctx.drawImage(img,0,0,width,height)}gl.texSubImage3D(target,level,0,0,slice,width,height,1,format,type,src);if(src===ctx.canvas){ctx.canvas.width=0;ctx.canvas.height=0}}restorePackState(gl,options);if(shouldAutomaticallySetTextureFilteringForSize(options)){gl.generateMipmap(target)}}if(numToLoad===0){callback(errors.length?errors:undefined,tex,imgs)}}}imgs=urls.map(function(url,ndx){return loadAndUseImage(url,options.crossOrigin,uploadImg(ndx))})}function setTextureFromArray(gl,tex,src,options){options=options||defaults.textureOptions;var target=options.target||gl.TEXTURE_2D;gl.bindTexture(target,tex);var width=options.width;var height=options.height;var depth=options.depth;var level=options.level||0;var internalFormat=options.internalFormat||options.format||gl.RGBA;var formatType=getFormatAndTypeForInternalFormat(internalFormat);var format=options.format||formatType.format;var type=options.type||getTextureTypeForArrayType(gl,src,formatType.type);if(!isArrayBuffer(src)){var Type=typedArrays.getTypedArrayTypeForGLType(type);src=new Type(src)}else if(src instanceof Uint8ClampedArray){src=new Uint8Array(src.buffer)}var bytesPerElement=getBytesPerElementForInternalFormat(internalFormat,type);var numElements=src.byteLength/bytesPerElement;if(numElements%1){throw"length wrong size for format: "+utils.glEnumToString(gl,format)}var dimensions;if(target===gl.TEXTURE_3D){if(!width&&!height&&!depth){var size=Math.cbrt(numElements);if(size%1!==0){throw"can't guess cube size of array of numElements: "+numElements}width=size;height=size;depth=size}else if(width&&(!height||!depth)){dimensions=guessDimensions(gl,target,height,depth,numElements/width);height=dimensions.width;depth=dimensions.height}else if(height&&(!width||!depth)){dimensions=guessDimensions(gl,target,width,depth,numElements/height);width=dimensions.width;depth=dimensions.height}else{dimensions=guessDimensions(gl,target,width,height,numElements/depth);width=dimensions.width;height=dimensions.height}}else{dimensions=guessDimensions(gl,target,width,height,numElements);width=dimensions.width;height=dimensions.height}saveSkipState(gl);gl.pixelStorei(gl.UNPACK_ALIGNMENT,options.unpackAlignment||1);savePackState(gl,options);if(target===gl.TEXTURE_CUBE_MAP){var elementsPerElement=bytesPerElement/src.BYTES_PER_ELEMENT;var faceSize=numElements/6*elementsPerElement;getCubeFacesWithNdx(gl,options).forEach(function(f){var offset=faceSize*f.ndx;var data=src.subarray(offset,offset+faceSize);gl.texImage2D(f.face,level,internalFormat,width,height,0,format,type,data)})}else if(target===gl.TEXTURE_3D){gl.texImage3D(target,level,internalFormat,width,height,depth,0,format,type,src)}else{gl.texImage2D(target,level,internalFormat,width,height,0,format,type,src)}restorePackState(gl,options);restoreSkipState(gl);return{width:width,height:height,depth:depth,type:type}}function setEmptyTexture(gl,tex,options){var target=options.target||gl.TEXTURE_2D;gl.bindTexture(target,tex);var level=options.level||0;var internalFormat=options.internalFormat||options.format||gl.RGBA;var formatType=getFormatAndTypeForInternalFormat(internalFormat);var format=options.format||formatType.format;var type=options.type||formatType.type;savePackState(gl,options);if(target===gl.TEXTURE_CUBE_MAP){for(var ii=0;ii<6;++ii){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+ii,level,internalFormat,options.width,options.height,0,format,type,null)}}else if(target===gl.TEXTURE_3D){gl.texImage3D(target,level,internalFormat,options.width,options.height,options.depth,0,format,type,null)}else{gl.texImage2D(target,level,internalFormat,options.width,options.height,0,format,type,null)}restorePackState(gl,options)}function createTexture(gl,options,callback){callback=callback||noop;options=options||defaults.textureOptions;var tex=gl.createTexture();var target=options.target||gl.TEXTURE_2D;var width=options.width||1;var height=options.height||1;var internalFormat=options.internalFormat||gl.RGBA;var formatType=getFormatAndTypeForInternalFormat(internalFormat);var type=options.type||formatType.type;gl.bindTexture(target,tex);if(target===gl.TEXTURE_CUBE_MAP){gl.texParameteri(target,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(target,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}var src=options.src;if(src){if(typeof src==="function"){src=src(gl,options)}if(typeof src==="string"){loadTextureFromUrl(gl,tex,options,callback)}else if(isArrayBuffer(src)||Array.isArray(src)&&(typeof src[0]==="number"||Array.isArray(src[0])||isArrayBuffer(src[0]))){var dimensions=setTextureFromArray(gl,tex,src,options);width=dimensions.width;height=dimensions.height;type=dimensions.type}else if(Array.isArray(src)&&(typeof src[0]==="string"||isTexImageSource(src[0]))){if(target===gl.TEXTURE_CUBE_MAP){loadCubemapFromUrls(gl,tex,options,callback)}else{loadSlicesFromUrls(gl,tex,options,callback)}}else if(isTexImageSource(src)){setTextureFromElement(gl,tex,src,options);width=src.width;height=src.height}else{throw"unsupported src type"}}else{setEmptyTexture(gl,tex,options)}if(shouldAutomaticallySetTextureFilteringForSize(options)){setTextureFilteringForSize(gl,tex,options,width,height,internalFormat,type)}setTextureParameters(gl,tex,options);return tex}function resizeTexture(gl,tex,options,width,height){width=width||options.width;height=height||options.height;var target=options.target||gl.TEXTURE_2D;gl.bindTexture(target,tex);var level=options.level||0;var internalFormat=options.internalFormat||options.format||gl.RGBA;var formatType=getFormatAndTypeForInternalFormat(internalFormat);var format=options.format||formatType.format;var type;var src=options.src;if(!src){type=options.type||formatType.type}else if(isArrayBuffer(src)||Array.isArray(src)&&typeof src[0]==="number"){type=options.type||getTextureTypeForArrayType(gl,src,formatType.type)}else{type=options.type||formatType.type}if(target===gl.TEXTURE_CUBE_MAP){for(var ii=0;ii<6;++ii){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+ii,level,internalFormat,width,height,0,format,type,null)}}else{gl.texImage2D(target,level,internalFormat,width,height,0,format,type,null)}}function isAsyncSrc(src){return typeof src==="string"||Array.isArray(src)&&typeof src[0]==="string"}function createTextures(gl,textureOptions,callback){callback=callback||noop;var numDownloading=0;var errors=[];var textures={};var images={};function callCallbackIfReady(){if(numDownloading===0){setTimeout(function(){callback(errors.length?errors:undefined,textures,images)},0)}}Object.keys(textureOptions).forEach(function(name){var options=textureOptions[name];var onLoadFn;if(isAsyncSrc(options.src)){onLoadFn=function onLoadFn(err,tex,img){images[name]=img;--numDownloading;if(err){errors.push(err)}callCallbackIfReady()};++numDownloading}textures[name]=createTexture(gl,options,onLoadFn)});callCallbackIfReady();return textures}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _exportNames={m4:true,v3:true,primitives:true};exports.primitives=exports.v3=exports.m4=void 0;var m4=_interopRequireWildcard(__webpack_require__(6));exports.m4=m4;var v3=_interopRequireWildcard(__webpack_require__(3));exports.v3=v3;var primitives=_interopRequireWildcard(__webpack_require__(10));exports.primitives=primitives;var _twgl=__webpack_require__(11);Object.keys(_twgl).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=_twgl[key]});function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.create3DFVertices=create3DFVertices;exports.createAugmentedTypedArray=createAugmentedTypedArray;exports.createCubeVertices=createCubeVertices;exports.createPlaneVertices=createPlaneVertices;exports.createSphereVertices=createSphereVertices;exports.createTruncatedConeVertices=createTruncatedConeVertices;exports.createXYQuadVertices=createXYQuadVertices;exports.createCresentVertices=createCresentVertices;exports.createCylinderVertices=createCylinderVertices;exports.createTorusVertices=createTorusVertices;exports.createDiscVertices=createDiscVertices;exports.deindexVertices=deindexVertices;exports.flattenNormals=flattenNormals;exports.makeRandomVertexColors=makeRandomVertexColors;exports.reorientDirections=reorientDirections;exports.reorientNormals=reorientNormals;exports.reorientPositions=reorientPositions;exports.reorientVertices=reorientVertices;exports.concatVertices=concatVertices;exports.duplicateVertices=duplicateVertices;exports.createDiscBuffers=exports.createDiscBufferInfo=exports.createTorusBuffers=exports.createTorusBufferInfo=exports.createCylinderBuffers=exports.createCylinderBufferInfo=exports.createCresentBuffers=exports.createCresentBufferInfo=exports.createXYQuadBuffers=exports.createXYQuadBufferInfo=exports.createTruncatedConeBuffers=exports.createTruncatedConeBufferInfo=exports.createSphereBuffers=exports.createSphereBufferInfo=exports.createPlaneBuffers=exports.createPlaneBufferInfo=exports.createCubeBuffers=exports.createCubeBufferInfo=exports.create3DFBuffers=exports.create3DFBufferInfo=void 0;var attributes=_interopRequireWildcard(__webpack_require__(7));var helper=_interopRequireWildcard(__webpack_require__(0));var typedArrays=_interopRequireWildcard(__webpack_require__(1));var m4=_interopRequireWildcard(__webpack_require__(6));var v3=_interopRequireWildcard(__webpack_require__(3));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}var getArray=attributes.getArray_;var getNumComponents=attributes.getNumComponents_;function augmentTypedArray(typedArray,numComponents){var cursor=0;typedArray.push=function(){for(var ii=0;ii<arguments.length;++ii){var value=arguments[ii];if(value instanceof Array||typedArrays.isArrayBuffer(value)){for(var jj=0;jj<value.length;++jj){typedArray[cursor++]=value[jj]}}else{typedArray[cursor++]=value}}};typedArray.reset=function(opt_index){cursor=opt_index||0};typedArray.numComponents=numComponents;Object.defineProperty(typedArray,"numElements",{get:function get(){return this.length/this.numComponents|0}});return typedArray}function createAugmentedTypedArray(numComponents,numElements,opt_type){var Type=opt_type||Float32Array;return augmentTypedArray(new Type(numComponents*numElements),numComponents)}function allButIndices(name){return name!=="indices"}function deindexVertices(vertices){var indices=vertices.indices;var newVertices={};var numElements=indices.length;function expandToUnindexed(channel){var srcBuffer=vertices[channel];var numComponents=srcBuffer.numComponents;var dstBuffer=createAugmentedTypedArray(numComponents,numElements,srcBuffer.constructor);for(var ii=0;ii<numElements;++ii){var ndx=indices[ii];var offset=ndx*numComponents;for(var jj=0;jj<numComponents;++jj){dstBuffer.push(srcBuffer[offset+jj])}}newVertices[channel]=dstBuffer}Object.keys(vertices).filter(allButIndices).forEach(expandToUnindexed);return newVertices}function flattenNormals(vertices){if(vertices.indices){throw"can't flatten normals of indexed vertices. deindex them first"}var normals=vertices.normal;var numNormals=normals.length;for(var ii=0;ii<numNormals;ii+=9){var nax=normals[ii+0];var nay=normals[ii+1];var naz=normals[ii+2];var nbx=normals[ii+3];var nby=normals[ii+4];var nbz=normals[ii+5];var ncx=normals[ii+6];var ncy=normals[ii+7];var ncz=normals[ii+8];var nx=nax+nbx+ncx;var ny=nay+nby+ncy;var nz=naz+nbz+ncz;var length=Math.sqrt(nx*nx+ny*ny+nz*nz);nx/=length;ny/=length;nz/=length;normals[ii+0]=nx;normals[ii+1]=ny;normals[ii+2]=nz;normals[ii+3]=nx;normals[ii+4]=ny;normals[ii+5]=nz;normals[ii+6]=nx;normals[ii+7]=ny;normals[ii+8]=nz}return vertices}function applyFuncToV3Array(array,matrix,fn){var len=array.length;var tmp=new Float32Array(3);for(var ii=0;ii<len;ii+=3){fn(matrix,[array[ii],array[ii+1],array[ii+2]],tmp);array[ii]=tmp[0];array[ii+1]=tmp[1];array[ii+2]=tmp[2]}}function transformNormal(mi,v,dst){dst=dst||v3.create();var v0=v[0];var v1=v[1];var v2=v[2];dst[0]=v0*mi[0*4+0]+v1*mi[0*4+1]+v2*mi[0*4+2];dst[1]=v0*mi[1*4+0]+v1*mi[1*4+1]+v2*mi[1*4+2];dst[2]=v0*mi[2*4+0]+v1*mi[2*4+1]+v2*mi[2*4+2];return dst}function reorientDirections(array,matrix){applyFuncToV3Array(array,matrix,m4.transformDirection);return array}function reorientNormals(array,matrix){applyFuncToV3Array(array,m4.inverse(matrix),transformNormal);return array}function reorientPositions(array,matrix){applyFuncToV3Array(array,matrix,m4.transformPoint);return array}function reorientVertices(arrays,matrix){Object.keys(arrays).forEach(function(name){var array=arrays[name];if(name.indexOf("pos")>=0){reorientPositions(array,matrix)}else if(name.indexOf("tan")>=0||name.indexOf("binorm")>=0){reorientDirections(array,matrix)}else if(name.indexOf("norm")>=0){reorientNormals(array,matrix)}});return arrays}function createXYQuadVertices(size,xOffset,yOffset){size=size||2;xOffset=xOffset||0;yOffset=yOffset||0;size*=.5;return{position:{numComponents:2,data:[xOffset+-1*size,yOffset+-1*size,xOffset+1*size,yOffset+-1*size,xOffset+-1*size,yOffset+1*size,xOffset+1*size,yOffset+1*size]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function createPlaneVertices(width,depth,subdivisionsWidth,subdivisionsDepth,matrix){width=width||1;depth=depth||1;subdivisionsWidth=subdivisionsWidth||1;subdivisionsDepth=subdivisionsDepth||1;matrix=matrix||m4.identity();var numVertices=(subdivisionsWidth+1)*(subdivisionsDepth+1);var positions=createAugmentedTypedArray(3,numVertices);var normals=createAugmentedTypedArray(3,numVertices);var texcoords=createAugmentedTypedArray(2,numVertices);for(var z=0;z<=subdivisionsDepth;z++){for(var x=0;x<=subdivisionsWidth;x++){var u=x/subdivisionsWidth;var v=z/subdivisionsDepth;positions.push(width*u-width*.5,0,depth*v-depth*.5);normals.push(0,1,0);texcoords.push(u,v)}}var numVertsAcross=subdivisionsWidth+1;var indices=createAugmentedTypedArray(3,subdivisionsWidth*subdivisionsDepth*2,Uint16Array);for(var _z=0;_z<subdivisionsDepth;_z++){for(var _x=0;_x<subdivisionsWidth;_x++){indices.push((_z+0)*numVertsAcross+_x,(_z+1)*numVertsAcross+_x,(_z+0)*numVertsAcross+_x+1);indices.push((_z+1)*numVertsAcross+_x,(_z+1)*numVertsAcross+_x+1,(_z+0)*numVertsAcross+_x+1)}}var arrays=reorientVertices({position:positions,normal:normals,texcoord:texcoords,indices:indices},matrix);return arrays}function createSphereVertices(radius,subdivisionsAxis,subdivisionsHeight,opt_startLatitudeInRadians,opt_endLatitudeInRadians,opt_startLongitudeInRadians,opt_endLongitudeInRadians){if(subdivisionsAxis<=0||subdivisionsHeight<=0){throw Error("subdivisionAxis and subdivisionHeight must be > 0")}opt_startLatitudeInRadians=opt_startLatitudeInRadians||0;opt_endLatitudeInRadians=opt_endLatitudeInRadians||Math.PI;opt_startLongitudeInRadians=opt_startLongitudeInRadians||0;opt_endLongitudeInRadians=opt_endLongitudeInRadians||Math.PI*2;var latRange=opt_endLatitudeInRadians-opt_startLatitudeInRadians;var longRange=opt_endLongitudeInRadians-opt_startLongitudeInRadians;var numVertices=(subdivisionsAxis+1)*(subdivisionsHeight+1);var positions=createAugmentedTypedArray(3,numVertices);var normals=createAugmentedTypedArray(3,numVertices);var texcoords=createAugmentedTypedArray(2,numVertices);for(var y=0;y<=subdivisionsHeight;y++){for(var x=0;x<=subdivisionsAxis;x++){var u=x/subdivisionsAxis;var v=y/subdivisionsHeight;var theta=longRange*u;var phi=latRange*v;var sinTheta=Math.sin(theta);var cosTheta=Math.cos(theta);var sinPhi=Math.sin(phi);var cosPhi=Math.cos(phi);var ux=cosTheta*sinPhi;var uy=cosPhi;var uz=sinTheta*sinPhi;positions.push(radius*ux,radius*uy,radius*uz);normals.push(ux,uy,uz);texcoords.push(1-u,v)}}var numVertsAround=subdivisionsAxis+1;var indices=createAugmentedTypedArray(3,subdivisionsAxis*subdivisionsHeight*2,Uint16Array);for(var _x2=0;_x2<subdivisionsAxis;_x2++){for(var _y=0;_y<subdivisionsHeight;_y++){indices.push((_y+0)*numVertsAround+_x2,(_y+0)*numVertsAround+_x2+1,(_y+1)*numVertsAround+_x2);indices.push((_y+1)*numVertsAround+_x2,(_y+0)*numVertsAround+_x2+1,(_y+1)*numVertsAround+_x2+1)}}return{position:positions,normal:normals,texcoord:texcoords,indices:indices}}var CUBE_FACE_INDICES=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function createCubeVertices(size){size=size||1;var k=size/2;var cornerVertices=[[-k,-k,-k],[+k,-k,-k],[-k,+k,-k],[+k,+k,-k],[-k,-k,+k],[+k,-k,+k],[-k,+k,+k],[+k,+k,+k]];var faceNormals=[[+1,+0,+0],[-1,+0,+0],[+0,+1,+0],[+0,-1,+0],[+0,+0,+1],[+0,+0,-1]];var uvCoords=[[1,0],[0,0],[0,1],[1,1]];var numVertices=6*4;var positions=createAugmentedTypedArray(3,numVertices);var normals=createAugmentedTypedArray(3,numVertices);var texcoords=createAugmentedTypedArray(2,numVertices);var indices=createAugmentedTypedArray(3,6*2,Uint16Array);for(var f=0;f<6;++f){var faceIndices=CUBE_FACE_INDICES[f];for(var v=0;v<4;++v){var position=cornerVertices[faceIndices[v]];var normal=faceNormals[f];var uv=uvCoords[v];positions.push(position);normals.push(normal);texcoords.push(uv)}var offset=4*f;indices.push(offset+0,offset+1,offset+2);indices.push(offset+0,offset+2,offset+3)}return{position:positions,normal:normals,texcoord:texcoords,indices:indices}}function createTruncatedConeVertices(bottomRadius,topRadius,height,radialSubdivisions,verticalSubdivisions,opt_topCap,opt_bottomCap){if(radialSubdivisions<3){throw Error("radialSubdivisions must be 3 or greater")}if(verticalSubdivisions<1){throw Error("verticalSubdivisions must be 1 or greater")}var topCap=opt_topCap===undefined?true:opt_topCap;var bottomCap=opt_bottomCap===undefined?true:opt_bottomCap;var extra=(topCap?2:0)+(bottomCap?2:0);var numVertices=(radialSubdivisions+1)*(verticalSubdivisions+1+extra);var positions=createAugmentedTypedArray(3,numVertices);var normals=createAugmentedTypedArray(3,numVertices);var texcoords=createAugmentedTypedArray(2,numVertices);var indices=createAugmentedTypedArray(3,radialSubdivisions*(verticalSubdivisions+extra)*2,Uint16Array);var vertsAroundEdge=radialSubdivisions+1;var slant=Math.atan2(bottomRadius-topRadius,height);var cosSlant=Math.cos(slant);var sinSlant=Math.sin(slant);var start=topCap?-2:0;var end=verticalSubdivisions+(bottomCap?2:0);for(var yy=start;yy<=end;++yy){var v=yy/verticalSubdivisions;var y=height*v;var ringRadius=void 0;if(yy<0){y=0;v=1;ringRadius=bottomRadius}else if(yy>verticalSubdivisions){y=height;v=1;ringRadius=topRadius}else{ringRadius=bottomRadius+(topRadius-bottomRadius)*(yy/verticalSubdivisions)}if(yy===-2||yy===verticalSubdivisions+2){ringRadius=0;v=0}y-=height/2;for(var ii=0;ii<vertsAroundEdge;++ii){var sin=Math.sin(ii*Math.PI*2/radialSubdivisions);var cos=Math.cos(ii*Math.PI*2/radialSubdivisions);positions.push(sin*ringRadius,y,cos*ringRadius);normals.push(yy<0||yy>verticalSubdivisions?0:sin*cosSlant,yy<0?-1:yy>verticalSubdivisions?1:sinSlant,yy<0||yy>verticalSubdivisions?0:cos*cosSlant);texcoords.push(ii/radialSubdivisions,1-v)}}for(var _yy=0;_yy<verticalSubdivisions+extra;++_yy){for(var _ii=0;_ii<radialSubdivisions;++_ii){indices.push(vertsAroundEdge*(_yy+0)+0+_ii,vertsAroundEdge*(_yy+0)+1+_ii,vertsAroundEdge*(_yy+1)+1+_ii);indices.push(vertsAroundEdge*(_yy+0)+0+_ii,vertsAroundEdge*(_yy+1)+1+_ii,vertsAroundEdge*(_yy+1)+0+_ii)}}return{position:positions,normal:normals,texcoord:texcoords,indices:indices}}function expandRLEData(rleData,padding){padding=padding||[];var data=[];for(var ii=0;ii<rleData.length;ii+=4){var runLength=rleData[ii];var element=rleData.slice(ii+1,ii+4);element.push.apply(element,padding);for(var jj=0;jj<runLength;++jj){data.push.apply(data,element)}}return data}function create3DFVertices(){var positions=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0];var texcoords=[.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0];var normals=expandRLEData([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]);var colors=expandRLEData([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]);var numVerts=positions.length/3;var arrays={position:createAugmentedTypedArray(3,numVerts),texcoord:createAugmentedTypedArray(2,numVerts),normal:createAugmentedTypedArray(3,numVerts),color:createAugmentedTypedArray(4,numVerts,Uint8Array),indices:createAugmentedTypedArray(3,numVerts/3,Uint16Array)};arrays.position.push(positions);arrays.texcoord.push(texcoords);arrays.normal.push(normals);arrays.color.push(colors);for(var ii=0;ii<numVerts;++ii){arrays.indices.push(ii)}return arrays}function createCresentVertices(verticalRadius,outerRadius,innerRadius,thickness,subdivisionsDown,startOffset,endOffset){if(subdivisionsDown<=0){throw Error("subdivisionDown must be > 0")}startOffset=startOffset||0;endOffset=endOffset||1;var subdivisionsThick=2;var offsetRange=endOffset-startOffset;var numVertices=(subdivisionsDown+1)*2*(2+subdivisionsThick);var positions=createAugmentedTypedArray(3,numVertices);var normals=createAugmentedTypedArray(3,numVertices);var texcoords=createAugmentedTypedArray(2,numVertices);function lerp(a,b,s){return a+(b-a)*s}function createArc(arcRadius,x,normalMult,normalAdd,uMult,uAdd){for(var z=0;z<=subdivisionsDown;z++){var uBack=x/(subdivisionsThick-1);var v=z/subdivisionsDown;var xBack=(uBack-.5)*2;var angle=(startOffset+v*offsetRange)*Math.PI;var s=Math.sin(angle);var c=Math.cos(angle);var radius=lerp(verticalRadius,arcRadius,s);var px=xBack*thickness;var py=c*verticalRadius;var pz=s*radius;positions.push(px,py,pz);var n=v3.add(v3.multiply([0,s,c],normalMult),normalAdd);normals.push(n);texcoords.push(uBack*uMult+uAdd,v)}}for(var x=0;x<subdivisionsThick;x++){var uBack=(x/(subdivisionsThick-1)-.5)*2;createArc(outerRadius,x,[1,1,1],[0,0,0],1,0);createArc(outerRadius,x,[0,0,0],[uBack,0,0],0,0);createArc(innerRadius,x,[1,1,1],[0,0,0],1,0);createArc(innerRadius,x,[0,0,0],[uBack,0,0],0,1)}var indices=createAugmentedTypedArray(3,subdivisionsDown*2*(2+subdivisionsThick),Uint16Array);function createSurface(leftArcOffset,rightArcOffset){for(var z=0;z<subdivisionsDown;++z){indices.push(leftArcOffset+z+0,leftArcOffset+z+1,rightArcOffset+z+0)
;indices.push(leftArcOffset+z+1,rightArcOffset+z+1,rightArcOffset+z+0)}}var numVerticesDown=subdivisionsDown+1;createSurface(numVerticesDown*0,numVerticesDown*4);createSurface(numVerticesDown*5,numVerticesDown*7);createSurface(numVerticesDown*6,numVerticesDown*2);createSurface(numVerticesDown*3,numVerticesDown*1);return{position:positions,normal:normals,texcoord:texcoords,indices:indices}}function createCylinderVertices(radius,height,radialSubdivisions,verticalSubdivisions,topCap,bottomCap){return createTruncatedConeVertices(radius,radius,height,radialSubdivisions,verticalSubdivisions,topCap,bottomCap)}function createTorusVertices(radius,thickness,radialSubdivisions,bodySubdivisions,startAngle,endAngle){if(radialSubdivisions<3){throw Error("radialSubdivisions must be 3 or greater")}if(bodySubdivisions<3){throw Error("verticalSubdivisions must be 3 or greater")}startAngle=startAngle||0;endAngle=endAngle||Math.PI*2;var range=endAngle-startAngle;var radialParts=radialSubdivisions+1;var bodyParts=bodySubdivisions+1;var numVertices=radialParts*bodyParts;var positions=createAugmentedTypedArray(3,numVertices);var normals=createAugmentedTypedArray(3,numVertices);var texcoords=createAugmentedTypedArray(2,numVertices);var indices=createAugmentedTypedArray(3,radialSubdivisions*bodySubdivisions*2,Uint16Array);for(var slice=0;slice<bodyParts;++slice){var v=slice/bodySubdivisions;var sliceAngle=v*Math.PI*2;var sliceSin=Math.sin(sliceAngle);var ringRadius=radius+sliceSin*thickness;var ny=Math.cos(sliceAngle);var y=ny*thickness;for(var ring=0;ring<radialParts;++ring){var u=ring/radialSubdivisions;var ringAngle=startAngle+u*range;var xSin=Math.sin(ringAngle);var zCos=Math.cos(ringAngle);var x=xSin*ringRadius;var z=zCos*ringRadius;var nx=xSin*sliceSin;var nz=zCos*sliceSin;positions.push(x,y,z);normals.push(nx,ny,nz);texcoords.push(u,1-v)}}for(var _slice=0;_slice<bodySubdivisions;++_slice){for(var _ring=0;_ring<radialSubdivisions;++_ring){var nextRingIndex=1+_ring;var nextSliceIndex=1+_slice;indices.push(radialParts*_slice+_ring,radialParts*nextSliceIndex+_ring,radialParts*_slice+nextRingIndex);indices.push(radialParts*nextSliceIndex+_ring,radialParts*nextSliceIndex+nextRingIndex,radialParts*_slice+nextRingIndex)}}return{position:positions,normal:normals,texcoord:texcoords,indices:indices}}function createDiscVertices(radius,divisions,stacks,innerRadius,stackPower){if(divisions<3){throw Error("divisions must be at least 3")}stacks=stacks?stacks:1;stackPower=stackPower?stackPower:1;innerRadius=innerRadius?innerRadius:0;var numVertices=(divisions+1)*(stacks+1);var positions=createAugmentedTypedArray(3,numVertices);var normals=createAugmentedTypedArray(3,numVertices);var texcoords=createAugmentedTypedArray(2,numVertices);var indices=createAugmentedTypedArray(3,stacks*divisions*2,Uint16Array);var firstIndex=0;var radiusSpan=radius-innerRadius;var pointsPerStack=divisions+1;for(var stack=0;stack<=stacks;++stack){var stackRadius=innerRadius+radiusSpan*Math.pow(stack/stacks,stackPower);for(var i=0;i<=divisions;++i){var theta=2*Math.PI*i/divisions;var x=stackRadius*Math.cos(theta);var z=stackRadius*Math.sin(theta);positions.push(x,0,z);normals.push(0,1,0);texcoords.push(1-i/divisions,stack/stacks);if(stack>0&&i!==divisions){var a=firstIndex+(i+1);var b=firstIndex+i;var c=firstIndex+i-pointsPerStack;var d=firstIndex+(i+1)-pointsPerStack;indices.push(a,b,c);indices.push(a,c,d)}}firstIndex+=divisions+1}return{position:positions,normal:normals,texcoord:texcoords,indices:indices}}function randInt(range){return Math.random()*range|0}function makeRandomVertexColors(vertices,options){options=options||{};var numElements=vertices.position.numElements;var vcolors=createAugmentedTypedArray(4,numElements,Uint8Array);var rand=options.rand||function(ndx,channel){return channel<3?randInt(256):255};vertices.color=vcolors;if(vertices.indices){for(var ii=0;ii<numElements;++ii){vcolors.push(rand(ii,0),rand(ii,1),rand(ii,2),rand(ii,3))}}else{var numVertsPerColor=options.vertsPerColor||3;var numSets=numElements/numVertsPerColor;for(var _ii2=0;_ii2<numSets;++_ii2){var color=[rand(_ii2,0),rand(_ii2,1),rand(_ii2,2),rand(_ii2,3)];for(var jj=0;jj<numVertsPerColor;++jj){vcolors.push(color)}}}return vertices}function createBufferFunc(fn){return function(gl){var arrays=fn.apply(this,Array.prototype.slice.call(arguments,1));return attributes.createBuffersFromArrays(gl,arrays)}}function createBufferInfoFunc(fn){return function(gl){var arrays=fn.apply(null,Array.prototype.slice.call(arguments,1));return attributes.createBufferInfoFromArrays(gl,arrays)}}var arraySpecPropertyNames=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function copyElements(src,dst,dstNdx,offset){offset=offset||0;var length=src.length;for(var ii=0;ii<length;++ii){dst[dstNdx+ii]=src[ii]+offset}}function createArrayOfSameType(srcArray,length){var arraySrc=getArray(srcArray);var newArray=new arraySrc.constructor(length);var newArraySpec=newArray;if(arraySrc.numComponents&&arraySrc.numElements){augmentTypedArray(newArray,arraySrc.numComponents)}if(srcArray.data){newArraySpec={data:newArray};helper.copyNamedProperties(arraySpecPropertyNames,srcArray,newArraySpec)}return newArraySpec}function concatVertices(arrayOfArrays){var names={};var baseName;var _loop=function _loop(ii){var arrays=arrayOfArrays[ii];Object.keys(arrays).forEach(function(name){if(!names[name]){names[name]=[]}if(!baseName&&name!=="indices"){baseName=name}var arrayInfo=arrays[name];var numComponents=getNumComponents(arrayInfo,name);var array=getArray(arrayInfo);var numElements=array.length/numComponents;names[name].push(numElements)})};for(var ii=0;ii<arrayOfArrays.length;++ii){_loop(ii)}function getLengthOfCombinedArrays(name){var length=0;var arraySpec;for(var ii=0;ii<arrayOfArrays.length;++ii){var arrays=arrayOfArrays[ii];var arrayInfo=arrays[name];var array=getArray(arrayInfo);length+=array.length;if(!arraySpec||arrayInfo.data){arraySpec=arrayInfo}}return{length:length,spec:arraySpec}}function copyArraysToNewArray(name,base,newArray){var baseIndex=0;var offset=0;for(var ii=0;ii<arrayOfArrays.length;++ii){var arrays=arrayOfArrays[ii];var arrayInfo=arrays[name];var array=getArray(arrayInfo);if(name==="indices"){copyElements(array,newArray,offset,baseIndex);baseIndex+=base[ii]}else{copyElements(array,newArray,offset)}offset+=array.length}}var base=names[baseName];var newArrays={};Object.keys(names).forEach(function(name){var info=getLengthOfCombinedArrays(name);var newArraySpec=createArrayOfSameType(info.spec,info.length);copyArraysToNewArray(name,base,getArray(newArraySpec));newArrays[name]=newArraySpec});return newArrays}function duplicateVertices(arrays){var newArrays={};Object.keys(arrays).forEach(function(name){var arraySpec=arrays[name];var srcArray=getArray(arraySpec);var newArraySpec=createArrayOfSameType(arraySpec,srcArray.length);copyElements(srcArray,getArray(newArraySpec),0);newArrays[name]=newArraySpec});return newArrays}var create3DFBufferInfo=createBufferInfoFunc(create3DFVertices);exports.create3DFBufferInfo=create3DFBufferInfo;var create3DFBuffers=createBufferFunc(create3DFVertices);exports.create3DFBuffers=create3DFBuffers;var createCubeBufferInfo=createBufferInfoFunc(createCubeVertices);exports.createCubeBufferInfo=createCubeBufferInfo;var createCubeBuffers=createBufferFunc(createCubeVertices);exports.createCubeBuffers=createCubeBuffers;var createPlaneBufferInfo=createBufferInfoFunc(createPlaneVertices);exports.createPlaneBufferInfo=createPlaneBufferInfo;var createPlaneBuffers=createBufferFunc(createPlaneVertices);exports.createPlaneBuffers=createPlaneBuffers;var createSphereBufferInfo=createBufferInfoFunc(createSphereVertices);exports.createSphereBufferInfo=createSphereBufferInfo;var createSphereBuffers=createBufferFunc(createSphereVertices);exports.createSphereBuffers=createSphereBuffers;var createTruncatedConeBufferInfo=createBufferInfoFunc(createTruncatedConeVertices);exports.createTruncatedConeBufferInfo=createTruncatedConeBufferInfo;var createTruncatedConeBuffers=createBufferFunc(createTruncatedConeVertices);exports.createTruncatedConeBuffers=createTruncatedConeBuffers;var createXYQuadBufferInfo=createBufferInfoFunc(createXYQuadVertices);exports.createXYQuadBufferInfo=createXYQuadBufferInfo;var createXYQuadBuffers=createBufferFunc(createXYQuadVertices);exports.createXYQuadBuffers=createXYQuadBuffers;var createCresentBufferInfo=createBufferInfoFunc(createCresentVertices);exports.createCresentBufferInfo=createCresentBufferInfo;var createCresentBuffers=createBufferFunc(createCresentVertices);exports.createCresentBuffers=createCresentBuffers;var createCylinderBufferInfo=createBufferInfoFunc(createCylinderVertices);exports.createCylinderBufferInfo=createCylinderBufferInfo;var createCylinderBuffers=createBufferFunc(createCylinderVertices);exports.createCylinderBuffers=createCylinderBuffers;var createTorusBufferInfo=createBufferInfoFunc(createTorusVertices);exports.createTorusBufferInfo=createTorusBufferInfo;var createTorusBuffers=createBufferFunc(createTorusVertices);exports.createTorusBuffers=createTorusBuffers;var createDiscBufferInfo=createBufferInfoFunc(createDiscVertices);exports.createDiscBufferInfo=createDiscBufferInfo;var createDiscBuffers=createBufferFunc(createDiscVertices);exports.createDiscBuffers=createDiscBuffers},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _exportNames={addExtensionsToContext:true,getContext:true,getWebGLContext:true,resizeCanvasToDisplaySize:true,setDefaults:true};exports.addExtensionsToContext=addExtensionsToContext;exports.getContext=getContext;exports.getWebGLContext=getWebGLContext;exports.resizeCanvasToDisplaySize=resizeCanvasToDisplaySize;exports.setDefaults=setDefaults;var attributes=_interopRequireWildcard(__webpack_require__(7));Object.keys(attributes).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=attributes[key]});var textures=_interopRequireWildcard(__webpack_require__(8));Object.keys(textures).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=textures[key]});var helper=_interopRequireWildcard(__webpack_require__(0));var utils=_interopRequireWildcard(__webpack_require__(4));Object.keys(utils).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=utils[key]});var _draw=__webpack_require__(12);Object.keys(_draw).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=_draw[key]});var _framebuffers=__webpack_require__(13);Object.keys(_framebuffers).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=_framebuffers[key]});var _programs=__webpack_require__(5);Object.keys(_programs).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=_programs[key]});var _typedarrays=__webpack_require__(1);Object.keys(_typedarrays).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=_typedarrays[key]});var _vertexArrays=__webpack_require__(14);Object.keys(_vertexArrays).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;exports[key]=_vertexArrays[key]});function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}var gl=undefined;var defaults={addExtensionsToContext:true};function setDefaults(newDefaults){helper.copyExistingProperties(newDefaults,defaults);attributes.setAttributeDefaults_(newDefaults);textures.setTextureDefaults_(newDefaults)}var prefixRE=/^(.*?)_/;function addExtensionToContext(gl,extensionName){utils.glEnumToString(gl,0);var ext=gl.getExtension(extensionName);if(ext){var enums={};var fnSuffix=prefixRE.exec(extensionName)[1];var enumSuffix="_"+fnSuffix;for(var key in ext){var value=ext[key];var isFunc=typeof value==="function";var suffix=isFunc?fnSuffix:enumSuffix;var name=key;if(key.endsWith(suffix)){name=key.substring(0,key.length-suffix.length)}if(gl[name]!==undefined){if(!isFunc&&gl[name]!==value){helper.warn(name,gl[name],value,key)}}else{if(isFunc){gl[name]=function(origFn){return function(){return origFn.apply(ext,arguments)}}(value)}else{gl[name]=value;enums[name]=value}}}enums.constructor={name:ext.constructor.name};utils.glEnumToString(enums,0)}return ext}var supportedExtensions=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function addExtensionsToContext(gl){for(var ii=0;ii<supportedExtensions.length;++ii){addExtensionToContext(gl,supportedExtensions[ii])}}function create3DContext(canvas,opt_attribs){var names=["webgl","experimental-webgl"];var context=null;for(var ii=0;ii<names.length;++ii){context=canvas.getContext(names[ii],opt_attribs);if(context){if(defaults.addExtensionsToContext){addExtensionsToContext(context)}break}}return context}function getWebGLContext(canvas,opt_attribs){var gl=create3DContext(canvas,opt_attribs);return gl}function createContext(canvas,opt_attribs){var names=["webgl2","webgl","experimental-webgl"];var context=null;for(var ii=0;ii<names.length;++ii){context=canvas.getContext(names[ii],opt_attribs);if(context){if(defaults.addExtensionsToContext){addExtensionsToContext(context)}break}}return context}function getContext(canvas,opt_attribs){var gl=createContext(canvas,opt_attribs);return gl}function resizeCanvasToDisplaySize(canvas,multiplier){multiplier=multiplier||1;multiplier=Math.max(0,multiplier);var width=canvas.clientWidth*multiplier|0;var height=canvas.clientHeight*multiplier|0;if(canvas.width!==width||canvas.height!==height){canvas.width=width;canvas.height=height;return true}return false}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.drawBufferInfo=drawBufferInfo;exports.drawObjectList=drawObjectList;var programs=_interopRequireWildcard(__webpack_require__(5));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}function drawBufferInfo(gl,bufferInfo,type,count,offset,instanceCount){type=type===undefined?gl.TRIANGLES:type;var indices=bufferInfo.indices;var elementType=bufferInfo.elementType;var numElements=count===undefined?bufferInfo.numElements:count;offset=offset===undefined?0:offset;if(elementType||indices){if(instanceCount!==undefined){gl.drawElementsInstanced(type,numElements,elementType===undefined?gl.UNSIGNED_SHORT:bufferInfo.elementType,offset,instanceCount)}else{gl.drawElements(type,numElements,elementType===undefined?gl.UNSIGNED_SHORT:bufferInfo.elementType,offset)}}else{if(instanceCount!==undefined){gl.drawArraysInstanced(type,offset,numElements,instanceCount)}else{gl.drawArrays(type,offset,numElements)}}}function drawObjectList(gl,objectsToDraw){var lastUsedProgramInfo=null;var lastUsedBufferInfo=null;objectsToDraw.forEach(function(object){if(object.active===false){return}var programInfo=object.programInfo;var bufferInfo=object.vertexArrayInfo||object.bufferInfo;var bindBuffers=false;var type=object.type===undefined?gl.TRIANGLES:object.type;if(programInfo!==lastUsedProgramInfo){lastUsedProgramInfo=programInfo;gl.useProgram(programInfo.program);bindBuffers=true}if(bindBuffers||bufferInfo!==lastUsedBufferInfo){if(lastUsedBufferInfo&&lastUsedBufferInfo.vertexArrayObject&&!bufferInfo.vertexArrayObject){gl.bindVertexArray(null)}lastUsedBufferInfo=bufferInfo;programs.setBuffersAndAttributes(gl,programInfo,bufferInfo)}programs.setUniforms(programInfo,object.uniforms);drawBufferInfo(gl,bufferInfo,type,object.count,object.offset,object.instanceCount)});if(lastUsedBufferInfo.vertexArrayObject){gl.bindVertexArray(null)}}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.bindFramebufferInfo=bindFramebufferInfo;exports.createFramebufferInfo=createFramebufferInfo;exports.resizeFramebufferInfo=resizeFramebufferInfo;var textures=_interopRequireWildcard(__webpack_require__(8));var helper=_interopRequireWildcard(__webpack_require__(0));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}var gl=undefined;var UNSIGNED_BYTE=5121;var DEPTH_COMPONENT=6402;var RGBA=6408;var RGBA4=32854;var RGB5_A1=32855;var RGB565=36194;var DEPTH_COMPONENT16=33189;var STENCIL_INDEX=6401;var STENCIL_INDEX8=36168;var DEPTH_STENCIL=34041;var COLOR_ATTACHMENT0=36064;var DEPTH_ATTACHMENT=36096;var STENCIL_ATTACHMENT=36128;var DEPTH_STENCIL_ATTACHMENT=33306;var REPEAT=10497;var CLAMP_TO_EDGE=33071;var MIRRORED_REPEAT=33648;var NEAREST=9728;var LINEAR=9729;var NEAREST_MIPMAP_NEAREST=9984;var LINEAR_MIPMAP_NEAREST=9985;var NEAREST_MIPMAP_LINEAR=9986;var LINEAR_MIPMAP_LINEAR=9987;var defaultAttachments=[{format:RGBA,type:UNSIGNED_BYTE,min:LINEAR,wrap:CLAMP_TO_EDGE},{format:DEPTH_STENCIL}];var attachmentsByFormat={};attachmentsByFormat[DEPTH_STENCIL]=DEPTH_STENCIL_ATTACHMENT;attachmentsByFormat[STENCIL_INDEX]=STENCIL_ATTACHMENT;attachmentsByFormat[STENCIL_INDEX8]=STENCIL_ATTACHMENT;attachmentsByFormat[DEPTH_COMPONENT]=DEPTH_ATTACHMENT;attachmentsByFormat[DEPTH_COMPONENT16]=DEPTH_ATTACHMENT;function getAttachmentPointForFormat(format){return attachmentsByFormat[format]}var renderbufferFormats={};renderbufferFormats[RGBA4]=true;renderbufferFormats[RGB5_A1]=true;renderbufferFormats[RGB565]=true;renderbufferFormats[DEPTH_STENCIL]=true;renderbufferFormats[DEPTH_COMPONENT16]=true;renderbufferFormats[STENCIL_INDEX]=true;renderbufferFormats[STENCIL_INDEX8]=true;function isRenderbufferFormat(format){return renderbufferFormats[format]}function createFramebufferInfo(gl,attachments,width,height){var target=gl.FRAMEBUFFER;var fb=gl.createFramebuffer();gl.bindFramebuffer(target,fb);width=width||gl.drawingBufferWidth;height=height||gl.drawingBufferHeight;attachments=attachments||defaultAttachments;var colorAttachmentCount=0;var framebufferInfo={framebuffer:fb,attachments:[],width:width,height:height};attachments.forEach(function(attachmentOptions){var attachment=attachmentOptions.attachment;var format=attachmentOptions.format;var attachmentPoint=getAttachmentPointForFormat(format);if(!attachmentPoint){attachmentPoint=COLOR_ATTACHMENT0+colorAttachmentCount++}if(!attachment){if(isRenderbufferFormat(format)){attachment=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,attachment);gl.renderbufferStorage(gl.RENDERBUFFER,format,width,height)}else{var textureOptions=Object.assign({},attachmentOptions);textureOptions.width=width;textureOptions.height=height;if(textureOptions.auto===undefined){textureOptions.auto=false;textureOptions.min=textureOptions.min||textureOptions.minMag||gl.LINEAR;textureOptions.mag=textureOptions.mag||textureOptions.minMag||gl.LINEAR;textureOptions.wrapS=textureOptions.wrapS||textureOptions.wrap||gl.CLAMP_TO_EDGE;textureOptions.wrapT=textureOptions.wrapT||textureOptions.wrap||gl.CLAMP_TO_EDGE}attachment=textures.createTexture(gl,textureOptions)}}if(helper.isRenderbuffer(gl,attachment)){gl.framebufferRenderbuffer(target,attachmentPoint,gl.RENDERBUFFER,attachment)}else if(helper.isTexture(gl,attachment)){gl.framebufferTexture2D(target,attachmentPoint,attachmentOptions.texTarget||gl.TEXTURE_2D,attachment,attachmentOptions.level||0)}else{throw"unknown attachment type"}framebufferInfo.attachments.push(attachment)});return framebufferInfo}function resizeFramebufferInfo(gl,framebufferInfo,attachments,width,height){width=width||gl.drawingBufferWidth;height=height||gl.drawingBufferHeight;framebufferInfo.width=width;framebufferInfo.height=height;attachments=attachments||defaultAttachments;attachments.forEach(function(attachmentOptions,ndx){var attachment=framebufferInfo.attachments[ndx];var format=attachmentOptions.format;if(helper.isRenderbuffer(gl,attachment)){gl.bindRenderbuffer(gl.RENDERBUFFER,attachment);gl.renderbufferStorage(gl.RENDERBUFFER,format,width,height)}else if(helper.isTexture(gl,attachment)){textures.resizeTexture(gl,attachment,attachmentOptions,width,height)}else{throw"unknown attachment type"}})}function bindFramebufferInfo(gl,framebufferInfo,target){target=target||gl.FRAMEBUFFER;if(framebufferInfo){gl.bindFramebuffer(target,framebufferInfo.framebuffer);gl.viewport(0,0,framebufferInfo.width,framebufferInfo.height)}else{gl.bindFramebuffer(target,null);gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight)}}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;exports.createVertexArrayInfo=createVertexArrayInfo;exports.createVAOAndSetAttributes=createVAOAndSetAttributes;exports.createVAOFromBufferInfo=createVAOFromBufferInfo;var programs=_interopRequireWildcard(__webpack_require__(5));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}function createVertexArrayInfo(gl,programInfos,bufferInfo){var vao=gl.createVertexArray();gl.bindVertexArray(vao);if(!programInfos.length){programInfos=[programInfos]}programInfos.forEach(function(programInfo){programs.setBuffersAndAttributes(gl,programInfo,bufferInfo)});gl.bindVertexArray(null);return{numElements:bufferInfo.numElements,elementType:bufferInfo.elementType,vertexArrayObject:vao}}function createVAOAndSetAttributes(gl,setters,attribs,indices){var vao=gl.createVertexArray();gl.bindVertexArray(vao);programs.setAttributes(setters,attribs);if(indices){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indices)}gl.bindVertexArray(null);return vao}function createVAOFromBufferInfo(gl,programInfo,bufferInfo){return createVAOAndSetAttributes(gl,programInfo.attribSetters||programInfo,bufferInfo.attribs,bufferInfo.indices)}}])});ZamModelViewer.Programs={};ZamModelViewer.Tools=function(){var tools={};var programs={};var attributeTypes={position:3,normal:3,tangent:3,texcoord:2,texcoord0:2,texcoord1:2,texcoord2:2};tools.AttributeState=function(){this.attribs={};this.enable=function(gl,attribs){this.gl=gl;var newAttrs={};for(i in attribs){var a=attribs[i];if(a.loc===undefined)continue;if(this.attribs[i]===undefined)gl.enableVertexAttribArray(a.loc);gl.vertexAttribPointer(a.loc,a.size,a.type,false,a.stride,a.offset);newAttrs[i]=a.loc;this.attribs[i]=null}for(i in this.attribs){if(this.attribs[i]!==null)this.gl.disableVertexAttribArray(this.attribs[i])}this.attribs=newAttrs};this.disableAll=function(){for(i in this.attribs){this.gl.disableVertexAttribArray(this.attribs[i])}this.attribs={}}};tools.CreateProgramAttributes=function(gl,def){var res={};var o=0;for(var t in def){var i=def[t];var s=attributeTypes[t];res[i]={type:gl.FLOAT,size:s,offset:o*4};o+=s}for(var i in res){res[i].stride=o*4}return res};tools.CleanUpPrograms=function(){programs={}};tools.ReleaseProgram=function(programInfo){};tools._GetProgram=function(name,programDef){return programs[name]};tools.RegisterProgram=function(name,programDef){if(!programs[name]){var shaders=programDef.shaders;programs[name]={shaders:[shaders[0],shaders[1]],attributes:programDef.attributes}}return programs[name]};tools.GetProgram=function(gl,name,config,attributes){var programCache=programs[name];var configBranch="";for(var i in config){configBranch+=i+":"+config[i]+"-"}if(!programCache){var def=name.split(".");var programDef=ZamModelViewer.Programs[def[0]][def[1]];if(programDef)programCache=ZamModelViewer.Tools.RegisterProgram(name,programDef)}if(!programCache)throw"Program not registered: "+def;programCache.programInfo||(programCache.programInfo={});programCache.programInfo[configBranch]=tools.CompileProgram(gl,programCache.shaders,config);attributes=attributes||programCache.attributes&&tools.CreateProgramAttributes(gl,programCache.attributes);var programInfo=programCache.programInfo[configBranch];if(attributes){for(var i in attributes){var a=programInfo.attribSetters[i];if(!a)continue;attributes[i]=attributes[i]||{};attributes[i].loc=a.location}}programInfo.attributes=attributes;return programInfo};tools.CompileProgram=function(gl,shaders,config,attributes){var header="";for(var i in config){var val=config[i];header="#define "+i+" "+(val===null?"":val)+"\n"}var uniforms={};var shs=[header+shaders[0],header+shaders[1]];const programInfo=twgl.createProgramInfo(gl,shs);if(attributes){for(var i in attributes){attributes[i]=attributes[i]||{};attributes[i].loc=a.location}}for(var i in programInfo.uniformSetters){uniforms[i]=programInfo.uniformSetters[i].location}programInfo.uniforms=uniforms;return programInfo};return tools}();ZamModelViewer.Programs["Wow"]||(ZamModelViewer.Programs["Wow"]={});ZamModelViewer.Programs["Wow"]["Generic"]={shaders:["attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord0;\nattribute vec2 aTexCoord1;\nattribute vec3 aColor;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uPanningMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjMatrix;\nuniform mat4 uTextureMatrix1;\nuniform mat4 uTextureMatrix2;\nuniform mat4 uTextureMatrix3;\nuniform mat4 uTextureMatrix4;\nuniform vec3 uCameraPos;\nuniform bool uHasTexture1;\nuniform bool uHasTexture2;\nuniform bool uHasTexture3;\nuniform bool uHasTexture4;\n\n\n#ifndef INPUT_TEXCOORD0\n  #define INPUT_TEXCOORD0 aTexCoord0\n#endif\n#ifndef INPUT_TEXCOORD1\n  #define INPUT_TEXCOORD1 aTexCoord0\n#endif\n#ifndef INPUT_TEXCOORD2\n  #define INPUT_TEXCOORD2 aTexCoord0\n#endif\n#ifndef INPUT_TEXCOORD3\n  #define INPUT_TEXCOORD3 aTexCoord0\n#endif\n\nvoid main(void) {\n  gl_Position = uProjMatrix * uViewMatrix * uModelMatrix * vec4(aPosition, 1);\n\n  vTexCoord1 = (uTextureMatrix1 * vec4(INPUT_TEXCOORD0, 0, 1)).st;\n  vTexCoord2 = (uTextureMatrix2 * vec4(INPUT_TEXCOORD1, 0, 1)).st;\n  vTexCoord3 = (uTextureMatrix3 * vec4(INPUT_TEXCOORD2, 0, 1)).st;\n  vTexCoord4 = (uTextureMatrix4 * vec4(INPUT_TEXCOORD3, 0, 1)).st;\n  vNormal = mat3(uViewMatrix * uModelMatrix) * aNormal;\n}","precision mediump float;\n\nvarying vec3 vNormal;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\n\nuniform bool uHasTexture1;\nuniform bool uHasTexture2;\nuniform bool uHasTexture3;\nuniform bool uHasTexture4;\nuniform bool uHasAlpha;\nuniform int uBlendMode;\nuniform bool uUnlit;\nuniform vec4 uColor;\nuniform vec4 uAmbientColor;\nuniform vec4 uPrimaryColor;\nuniform vec4 uSecondaryColor;\nuniform vec3 uLightDir1;\nuniform vec3 uLightDir2;\nuniform vec3 uLightDir3;\nuniform sampler2D uTexture1;\nuniform sampler2D uTexture2;\nuniform sampler2D uTexture3;\nuniform sampler2D uTexture4;\nuniform sampler2D uAlpha;\n\nvoid main(void) {\n  vec4 color = vec4(1, 1, 1, 1);\n  vec4 tex1 = texture2D(uTexture1, vTexCoord1.st);\n  color.xyz *= tex1.xyz * 2.0;\n\n  if (uHasTexture2) {\n    vec4 tex2 = texture2D(uTexture2, vTexCoord2.st);\n    color.a = tex2.a * 2.0;\n    color.xyz *= tex2.xyz * 2.0;\n  }\n  if (uHasTexture3) {\n    color *= texture2D(uTexture3, vTexCoord3.st);\n  }\n  if (uHasTexture4) {\n    color *= texture2D(uTexture4, vTexCoord4.st);\n  }\n\n  if (uBlendMode == 7) {\n    vec4 color2 = vec4(4, 4, 4, 4);\n    color *= color2;\n  }\n  /*if ((uBlendMode == 1 || uBlendMode == 2 || uBlendMode == 4 || uBlendMode ==\n  7) && uHasAlpha) { color.a = texture2D(uAlpha, vTexCoord.st).a;\n  }*/\n\n  color *= uColor;\n\n  if (uBlendMode == 1) {\n    if (color.a < 0.7) {\n      discard;\n    }\n  }\n\n  if (!uUnlit) {\n    vec4 litColor = uAmbientColor;\n    vec3 normal = normalize(vNormal);\n\n    float dp = max(0.0, dot(normal, uLightDir1));\n    litColor += uPrimaryColor * dp;\n\n    dp = max(0.0, dot(normal, uLightDir2));\n    litColor += uSecondaryColor * dp;\n\n    dp = max(0.0, dot(normal, uLightDir3));\n    litColor += uSecondaryColor * dp;\n\n    litColor = clamp(litColor, vec4(0, 0, 0, 0), vec4(1, 1, 1, 1));\n    /*color *= litColor;*/\n  }\n\n  color = color * 0.5;\n  gl_FragColor = color.xyzw;\n}"],attributes:{position:"aPosition",normal:"aNormal",texcoord0:"aTexCoord0",texcoord1:"aTexCoord1"}};mat4.translation=function(out,vec){mat4.identity(out);out[12]=vec[0];out[13]=vec[1];out[14]=vec[2];return out};mat4.rotationQuat=function(out,q){mat4.identity(out);var xx=q[0]*q[0],yy=q[1]*q[1],zz=q[2]*q[2],xy=q[0]*q[1],zw=q[2]*q[3],zx=q[2]*q[0],yw=q[1]*q[3],yz=q[1]*q[2],xw=q[0]*q[3];out[0]=1-2*(yy+zz);out[1]=2*(xy+zw);out[2]=2*(zx-yw);out[4]=2*(xy-zw);out[5]=1-2*(zz+xx);out[6]=2*(yz+xw);out[8]=2*(zx+yw);out[9]=2*(yz-xw);out[10]=1-2*(yy+xx);return out};mat4.mulSlimDX=function(out,l,r){var left={M11:l[0],M12:l[1],M13:l[2],M14:l[3],M21:l[4],M22:l[5],M23:l[6],M24:l[7],M31:l[8],M32:l[9],M33:l[10],M34:l[11],M41:l[12],M42:l[13],M43:l[14],M44:l[15]};var right={M11:r[0],M12:r[1],M13:r[2],M14:r[3],M21:r[4],M22:r[5],M23:r[6],M24:r[7],M31:r[8],M32:r[9],M33:r[10],M34:r[11],M41:r[12],M42:r[13],M43:r[14],M44:r[15]};out[0]=left.M11*right.M11+left.M12*right.M21+left.M13*right.M31+left.M14*right.M41;out[1]=left.M11*right.M12+left.M12*right.M22+left.M13*right.M32+left.M14*right.M42;out[2]=left.M11*right.M13+left.M12*right.M23+left.M13*right.M33+left.M14*right.M43;out[3]=left.M11*right.M14+left.M12*right.M24+left.M13*right.M34+left.M14*right.M44;out[4]=left.M21*right.M11+left.M22*right.M21+left.M23*right.M31+left.M24*right.M41;out[5]=left.M21*right.M12+left.M22*right.M22+left.M23*right.M32+left.M24*right.M42;out[6]=left.M21*right.M13+left.M22*right.M23+left.M23*right.M33+left.M24*right.M43;out[7]=left.M21*right.M14+left.M22*right.M24+left.M23*right.M34+left.M24*right.M44;out[8]=left.M31*right.M11+left.M32*right.M21+left.M33*right.M31+left.M34*right.M41;out[9]=left.M31*right.M12+left.M32*right.M22+left.M33*right.M32+left.M34*right.M42;out[10]=left.M31*right.M13+left.M32*right.M23+left.M33*right.M33+left.M34*right.M43;out[11]=left.M31*right.M14+left.M32*right.M24+left.M33*right.M34+left.M34*right.M44
;out[12]=left.M41*right.M11+left.M42*right.M21+left.M43*right.M31+left.M44*right.M41;out[13]=left.M41*right.M12+left.M42*right.M22+left.M43*right.M32+left.M44*right.M42;out[14]=left.M41*right.M13+left.M42*right.M23+left.M43*right.M33+left.M44*right.M43;out[15]=left.M41*right.M14+left.M42*right.M24+left.M43*right.M34+left.M44*right.M44;return out};mat4.transformVec3=function(out,v,m){out[0]=v[0]*m[0]+v[1]*m[4]+v[2]*m[8]+m[12];out[1]=v[0]*m[1]+v[1]*m[5]+v[2]*m[9]+m[13];out[2]=v[0]*m[2]+v[1]*m[6]+v[2]*m[10]+m[14];return out};mat4.transformVec4=function(out,v,m){out[0]=v[0]*m[0]+v[1]*m[4]+v[2]*m[8]+v[3]*m[12];out[1]=v[0]*m[1]+v[1]*m[5]+v[2]*m[9]+v[3]*m[13];out[2]=v[0]*m[2]+v[1]*m[6]+v[2]*m[10]+v[3]*m[14];out[3]=v[0]*m[3]+v[1]*m[7]+v[2]*m[11]+v[3]*m[15];return out};mat4.extractEulerAngles=function(out,m){out[0]=Math.atan2(m[6],m[10]);var c2=Math.sqrt(m[0]*m[0]+m[1]*m[1]);out[1]=Math.atan2(-m[2],c2);var s1=Math.sin(out[0]),c1=Math.cos(out[0]);out[2]=Math.atan2(s1*m[8]-c1*m[4],c1*m[5]-s1*m[9]);return out};mat4.invert2=function(out,m){var det=m[0]*(m[5]*m[10]-m[6]*m[9])+m[4]*(m[2]*m[9]-m[1]*m[10])+m[8]*(m[1]*m[6]-m[2]*m[5]);if(det==0)return null;var invDet=1/det;out[0]=(m[5]*m[10]-m[6]*m[9])*invDet;out[1]=(m[9]*m[2]-m[10]*m[1])*invDet;out[2]=(m[1]*m[6]-m[2]*m[5])*invDet;out[4]=(m[6]*m[8]-m[4]*m[10])*invDet;out[5]=(m[10]*m[0]-m[8]*m[2])*invDet;out[6]=(m[2]*m[4]-m[0]*m[6])*invDet;out[8]=(m[4]*m[9]-m[5]*m[8])*invDet;out[9]=(m[8]*m[1]-m[9]*m[0])*invDet;out[10]=(m[0]*m[5]-m[1]*m[4])*invDet;out[3]=out[0]*-m[3]+out[1]*-m[7]+out[2]*-m[11];out[7]=out[4]*-m[3]+out[5]*-m[7]+out[6]*-m[11];out[11]=out[8]*-m[3]+out[9]*-m[7]+out[10]*-m[11];out[12]=out[13]=out[14]=0;out[15]=1;return out};mat4.invert=function(out,m){out[0]=m[5]*m[10]*m[15]-m[5]*m[14]*m[11]-m[6]*m[9]*m[15]+m[6]*m[13]*m[11]+m[7]*m[9]*m[14]-m[7]*m[13]*m[10];out[1]=-m[1]*m[10]*m[15]+m[1]*m[14]*m[11]+m[2]*m[9]*m[15]-m[2]*m[13]*m[11]-m[3]*m[9]*m[14]+m[3]*m[13]*m[10];out[2]=m[1]*m[6]*m[15]-m[1]*m[14]*m[7]-m[2]*m[5]*m[15]+m[2]*m[13]*m[7]+m[3]*m[5]*m[14]-m[3]*m[13]*m[6];out[3]=-m[1]*m[6]*m[11]+m[1]*m[10]*m[7]+m[2]*m[5]*m[11]-m[2]*m[9]*m[7]-m[3]*m[5]*m[10]+m[3]*m[9]*m[6];out[4]=-m[4]*m[10]*m[15]+m[4]*m[14]*m[11]+m[6]*m[8]*m[15]-m[6]*m[12]*m[11]-m[7]*m[8]*m[14]+m[7]*m[12]*m[10];out[5]=m[0]*m[10]*m[15]-m[0]*m[14]*m[11]-m[2]*m[8]*m[15]+m[2]*m[12]*m[11]+m[3]*m[8]*m[14]-m[3]*m[12]*m[10];out[6]=-m[0]*m[6]*m[15]+m[0]*m[14]*m[7]+m[2]*m[4]*m[15]-m[2]*m[12]*m[7]-m[3]*m[4]*m[14]+m[3]*m[12]*m[6];out[7]=m[0]*m[6]*m[11]-m[0]*m[10]*m[7]-m[2]*m[4]*m[11]+m[2]*m[8]*m[7]+m[3]*m[4]*m[10]-m[3]*m[8]*m[6];out[8]=m[4]*m[9]*m[15]-m[4]*m[13]*m[11]-m[5]*m[8]*m[15]+m[5]*m[12]*m[11]+m[7]*m[8]*m[13]-m[7]*m[12]*m[9];out[9]=-m[0]*m[9]*m[15]+m[0]*m[13]*m[11]+m[1]*m[8]*m[15]-m[1]*m[12]*m[11]-m[3]*m[8]*m[13]+m[3]*m[12]*m[9];out[10]=m[0]*m[5]*m[15]-m[0]*m[13]*m[7]-m[1]*m[4]*m[15]+m[1]*m[12]*m[7]+m[3]*m[4]*m[13]-m[3]*m[12]*m[5];out[11]=-m[0]*m[5]*m[11]+m[0]*m[9]*m[7]+m[1]*m[4]*m[11]-m[1]*m[8]*m[7]-m[3]*m[4]*m[9]+m[3]*m[8]*m[5];out[12]=-m[4]*m[9]*m[14]+m[4]*m[13]*m[10]+m[5]*m[8]*m[14]-m[5]*m[12]*m[10]-m[6]*m[8]*m[13]+m[6]*m[12]*m[9];out[13]=m[0]*m[9]*m[14]-m[0]*m[13]*m[10]-m[1]*m[8]*m[14]+m[1]*m[12]*m[10]+m[2]*m[8]*m[13]-m[2]*m[12]*m[9];out[14]=-m[0]*m[5]*m[14]+m[0]*m[13]*m[6]+m[1]*m[4]*m[14]-m[1]*m[12]*m[6]-m[2]*m[4]*m[13]+m[2]*m[12]*m[5];out[15]=m[0]*m[5]*m[10]-m[0]*m[9]*m[6]-m[1]*m[4]*m[10]+m[1]*m[8]*m[6]+m[2]*m[4]*m[9]-m[2]*m[8]*m[5];var det=m[0]*out[0]+m[1]*out[4]+m[2]*out[8]+m[3]*out[12];for(var i=0;i<16;i++)out[i]/=det;return out};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1e3/60)}}();jQuery.support.cors=true;if($.ajaxTransport){$.ajaxSetup({flatOptions:{renderer:true}});$.ajaxTransport("+binary",function(options,originalOptions,jqXHR){if(window.FormData&&(options.dataType&&options.dataType=="binary"||options.data&&(window.ArrayBuffer&&options.data instanceof ArrayBuffer||window.Blob&&options.data instanceof Blob))){return{send:function(_,callback){var xhr=new XMLHttpRequest,url=options.url,type=options.type,dataType=options.responseType||"blob",data=options.data||null;if(options.renderer){xhr.addEventListener("progress",function(event){if(event.lengthComputable){if(!options.renderer.downloads[this.responseURL]){options.renderer.downloads[this.responseURL]={loaded:event.loaded,total:event.total}}else{options.renderer.downloads[this.responseURL].loaded=event.loaded}options.renderer.updateProgress()}})}xhr.addEventListener("load",function(){if(options.renderer){delete options.renderer.downloads[this.responseURL];options.renderer.updateProgress()}var data={};data[options.dataType]=xhr.response;callback(xhr.status,xhr.statusText,data,xhr.getAllResponseHeaders())});xhr.open(type,url,true);xhr.responseType=dataType;xhr.send(data)},abort:function(){jqXHR.abort()}}}})}else{(function(){var httpData=$.httpData;$.httpData=function(xhr,type,s){if(type=="binary"){return xhr.response}else{return httpData(xhr,type,s)}}})();$.ajaxSetup({beforeSend:function(xhr,options){if(options.dataType=="binary"){xhr.responseType=options.responseType||"arraybuffer";xhr.addEventListener("progress",function(event){if(!options.renderer)return;if(event.lengthComputable){if(!options.renderer.downloads[this.responseURL]){options.renderer.downloads[this.responseURL]={loaded:event.loaded,total:event.total}}else{options.renderer.downloads[this.responseURL].loaded=event.loaded}options.renderer.updateProgress()}},false);xhr.addEventListener("load",function(){if(!options.renderer)return;delete options.renderer.downloads[this.responseURL];options.renderer.updateProgress()},false)}}})}Math.randomInt=function(){return Math.randomInt||function(min,max){return Math.floor(Math.random()*(max-min))+min}}();if(typeof Object.create!="function"){Object.create=function(){var obj=function(){};return function(prototype){if(arguments.length>1){throw Error("Second argument not supported")}if(typeof prototype!="object"){throw TypeError("Argument must be an object")}obj.prototype=prototype;var result=new obj;obj.prototype=null;return result}}()}window.console=window.console||{log:function(){},error:function(){},warn:function(){}};function ZamModelViewer(opts){var self=this;if(!opts.type||!self.validTypes[opts.type])throw"Viewer error: Bad viewer type given";if(!opts.container)throw"Viewer error: Bad container given";if(!opts.aspect)throw"Viewer error: Bad aspect ratio given";if(!opts.contentPath)throw"Viewer error: No content path given";self.type=opts.type;self.container=opts.container;self.aspect=parseFloat(opts.aspect);self.renderer=null;self.options=opts;var width=parseInt(self.container.width());var height=Math.round(width/self.aspect);self.init(width,height)}ZamModelViewer.WEBGL=1;ZamModelViewer.FLASH=2;ZamModelViewer.TOR=1;ZamModelViewer.WOW=2;ZamModelViewer.LOL=3;ZamModelViewer.GW2=4;ZamModelViewer.WILDSTAR=5;ZamModelViewer.HEROES=6;ZamModelViewer.DESTINY=7;ZamModelViewer.Models={};ZamModelViewer.prototype={validTypes:{2:"Wowhead",3:"LolKing",6:"HeroKing",7:"DestinyDB"},destroy:function(){var self=this;if(self.renderer)self.renderer.destroy();self.options=null;self.container=null},init:function(width,height){var self=this,glSupport=false;if(typeof window["Uint8Array"]!==undefined&&typeof window["DataView"]!==undefined){try{var canvas=document.createElement("canvas");var ctx=canvas.getContext("webgl",{alpha:false})||canvas.getContext("experimental-webgl",{alpha:false});if(ctx)glSupport=true}catch(e){}}if(!self.options.flash&&glSupport){self.mode=ZamModelViewer.WEBGL;self.renderer=new ZamModelViewer.WebGL(self)}else{self.mode=ZamModelViewer.FLASH;self.renderer=new ZamModelViewer.Flash(self)}self.renderer.resize(width,height);self.renderer.init()},method:function(name,params){var self=this;if(params===undefined)params=[];if(self.renderer)return self.renderer.method(name,[].concat(params));return null},option:function(key,val){var self=this;if(val!==undefined){self.options[key]=val}return self.options[key]}};ZamModelViewer.isFullscreen=function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)return true;return false};ZamModelViewer.requestFullscreen=function(e){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)return;if(e.requestFullscreen){e.requestFullscreen()}else if(e.webkitRequestFullscreen){e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}else if(e.mozRequestFullScreen){e.mozRequestFullScreen()}else if(e.msRequestFullscreen){e.msRequestFullscreen()}};ZamModelViewer.exitFullscreen=function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)return;if(document.exitFullscreen){document.exitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}};ZamModelViewer.DataView=function(buffer){this.buffer=new DataView(buffer);this.position=0};ZamModelViewer.DataView.prototype={getBool:function(){var v=this.buffer.getUint8(this.position)!=0;this.position+=1;return v},getUint8:function(){var v=this.buffer.getUint8(this.position);this.position+=1;return v},getInt8:function(){var v=this.buffer.getInt8(this.position);this.position+=1;return v},getUint16:function(){var v=this.buffer.getUint16(this.position,true);this.position+=2;return v},getInt16:function(){var v=this.buffer.getInt16(this.position,true);this.position+=2;return v},getUint32:function(){var v=this.buffer.getUint32(this.position,true);this.position+=4;return v},getInt32:function(){var v=this.buffer.getInt32(this.position,true);this.position+=4;return v},getFloat:function(){var v=this.buffer.getFloat32(this.position,true);this.position+=4;return v},getString:function(len){if(len===undefined)len=this.getUint16();var str="";for(var i=0;i<len;++i){str+=String.fromCharCode(this.getUint8())}return str},setBool:function(v){this.buffer.setUint8(this.position,v?1:0);this.position+=1},setUint8:function(v){this.buffer.setUint8(this.position,v);this.position+=1},setInt8:function(v){this.buffer.setInt8(this.position,v);this.position+=1},setUint16:function(v){this.buffer.setUint16(this.position,v,true);this.position+=2},setInt16:function(v){this.buffer.setInt16(this.position,v,true);this.position+=2},setUint32:function(v){this.buffer.setUint32(this.position,v,true);this.position+=4},setInt32:function(v){this.buffer.setInt32(this.position,v,true);this.position+=4},setFloat:function(v){this.buffer.setFloat32(this.position,v,true);this.position+=4}};ZamModelViewer.WebGL=function(viewer){var self=this;self.viewer=viewer;self.options=viewer.options;self.downloads={};self.context=null;self.width=0;self.height=0;self.time=0;self.delta=0;self.models=[];self.screenshotDataURL=null;self.makeDataURL=false;self.screenshotCallback=null;self.azimuth=Math.PI*1.5;self.zenith=Math.PI/2;self.distance=15;self.fov=30;self.zoom={rateStep:.1,rateAccelerationDecay:.4,interpolationRate:.3,range:[.3,4],rateCurrent:0,target:1,current:1};self.zoom.range=self.zoom.range.map(function(x){return Math.log(x)/Math.log(1+self.zoom.rateStep)});self.translation=[0,0,0];self.target=[0,0,0];self.eye=[0,0,0];self.up=[0,0,1];self.lookDir=vec3.create();self.fullscreen=false;self.projMatrix=mat4.create();self.viewMatrix=mat4.create();self.panningMatrix=mat4.create();self.viewOffset=vec3.create();if(!ZamModelViewer.WebGL.addedCss){ZamModelViewer.WebGL.addedCss=true;$("head").append('<link rel="stylesheet" href="//wow.zamimg.com/modelviewer/viewer/viewer.css" type="text/css" />')}};ZamModelViewer.WebGL.prototype={updateProgress:function(){var self=this,totalSize=0,totalLoaded=0;for(var url in self.downloads){totalSize+=self.downloads[url].total;totalLoaded+=self.downloads[url].loaded}if(totalSize<=0){if(self.progressShown){self.progressBg.hide();self.progressBar.hide();self.progressShown=false}}else{if(!self.progressShown){self.progressBg.show();self.progressBar.show();self.progressShown=true}var pct=totalLoaded/totalSize;self.progressBar.width(Math.round(self.width*pct)+"px")}},destroy:function(){var self=this;self.stop=true;if(self.canvas){self.canvas.detach();self.progressBg.detach();self.progressBar.detach();self.canvas.off("mousedown touchstart",self.onMouseDown).off("DOMMouseScroll",self.onMouseScroll).off("mousewheel",self.onMouseWheel).off("dblclick",self.onDoubleClick).off("contextmenu",self.onContextMenu);$(window).off("resize",self.onFullscreen);$(document).off("mouseup touchend",self.onMouseUp).off("mousemove touchmove",self.onMouseMove);self.canvas=self.progressBg=self.progressBar=null}if(self.context){var gl=self.context;if(self.bgTexture)gl.deleteTexture(self.bgTexture);self.bgTexture=null;if(self.program)gl.deleteProgram(self.program);self.program=null;if(self.vb)gl.deleteBuffer(self.vb);if(self.vs)gl.deleteShader(self.vs);if(self.fs)gl.deleteShader(self.fs);self.vb=self.vs=self.fs=null}if(self.bgImg)self.bgImg=null;for(var i=0;i<self.models.length;++i){self.models[i].destroy();self.models[i]=null}self.models=[]},method:function(name,params){var self=this;if(self.models.length>0&&self.models[0].external&&self.models[0].external[name]){return self.models[0].external[name].apply(self.models[0],params)}else{return null}},getTime:function(){if(window.performance&&window.performance.now)return window.performance.now();else return Date.now()},draw:function(){var self=this,gl=self.context,i;var time=self.getTime();self.delta=(time-self.time)*.001;self.time=time;self.updateCamera();gl.viewport(0,0,self.width,self.height);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);if(self.bgTexture&&self.program){gl.useProgram(self.program);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,self.bgTexture);gl.uniform1i(self.uTexture,0);gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);gl.enableVertexAttribArray(self.aPosition);gl.vertexAttribPointer(self.aPosition,2,gl.FLOAT,false,16,0);gl.enableVertexAttribArray(self.aTexCoord);gl.vertexAttribPointer(self.aTexCoord,2,gl.FLOAT,false,16,8);gl.depthMask(false);gl.disable(gl.CULL_FACE);gl.blendFunc(gl.ONE,gl.ZERO);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.CULL_FACE);gl.depthMask(true);gl.disableVertexAttribArray(self.aPosition);gl.disableVertexAttribArray(self.aTexCoord)}for(i=0;i<self.models.length;++i)self.models[i].draw()},updateCamera:function(){var self=this;self.zoom.target+=self.zoom.rateCurrent;self.zoom.rateCurrent*=1-self.zoom.rateAccelerationDecay;self.zoom.target=-Math.max(Math.min(-self.zoom.target,self.zoom.range[1]),self.zoom.range[0]);self.zoom.current+=(self.zoom.target-self.zoom.current)*self.zoom.interpolationRate;var d=self.distance*Math.pow(self.zoom.rateStep+1,-self.zoom.current),a=self.azimuth,z=self.zenith;if(self.up[2]==1){self.eye[0]=-d*Math.sin(z)*Math.cos(a)+self.target[0];self.eye[1]=-d*Math.sin(z)*Math.sin(a)+self.target[1];self.eye[2]=-d*Math.cos(z)+self.target[2]}else{self.eye[0]=-d*Math.sin(z)*Math.cos(a)+self.target[0];self.eye[1]=-d*Math.cos(z)+self.target[1];self.eye[2]=-d*Math.sin(z)*Math.sin(a)+self.target[2]}vec3.subtract(self.lookDir,self.target,self.eye);vec3.normalize(self.lookDir,self.lookDir);mat4.lookAt(self.viewMatrix,self.eye,self.target,self.up);mat4.identity(self.panningMatrix);if(self.up[2]==1){vec3.set(self.viewOffset,self.translation[0],-self.translation[1],0)}else{vec3.set(self.viewOffset,self.translation[0],0,self.translation[1])}mat4.translate(self.panningMatrix,self.panningMatrix,self.viewOffset);mat4.multiply(self.viewMatrix,self.panningMatrix,self.viewMatrix)},init:function(){var self=this,gl=self.context,i;mat4.perspective(self.projMatrix,self.fov*.0174532925,self.viewer.aspect,.1,5e3);self.updateCamera();if(self.options.transparent)gl.clearColor(1,1,1,0);else gl.clearColor(0,0,0,1);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.BLEND);if((self.options.models||self.options.items)&&ZamModelViewer.Models[self.viewer.type]){var Model=ZamModelViewer.Models[self.viewer.type];var models=[].concat(self.options.models);if(models.length>0){for(i=0;i<models.length;++i){self.models.push(new Model(self,self.viewer,models[i],i))}}else if(self.viewer.type==ZamModelViewer.DESTINY&&self.options.items){self.models.push(new Model(self,self.viewer))}}function tick(){if(self.stop)return;requestAnimFrame(tick);self.draw();if(self.makeDataURL!==false){if(self.canvas[0].toDataURL){if(!Array.isArray(self.makeDataURL)){self.makeDataURL=[]}self.screenshotDataURL=self.canvas[0].toDataURL.apply(self.canvas[0],self.makeDataURL);if(self.screenshotCallback){self.screenshotCallback();self.screenshotCallback=null}}self.makeDataURL=false}}tick()},resize:function(width,height){var self=this;if(self.width===width)return;if(!self.fullscreen){self.viewer.container.css({height:height+"px",position:"relative"})}self.width=width;self.height=height;if(!self.canvas){self.canvas=$("<canvas/>");self.canvas.attr({width:width,height:height});self.viewer.container.append(self.canvas);if(self.options.transparent)self.context=self.canvas[0].getContext("webgl",{alpha:true,premultipliedAlpha:false})||self.canvas[0].getContext("experimental-webgl",{alpha:true,premultipliedAlpha:false});else self.context=self.canvas[0].getContext("webgl",{alpha:false,premultipliedAlpha:false})||self.canvas[0].getContext("experimental-webgl",{alpha:false,premultipliedAlpha:false});self.progressBg=$("<div/>",{css:{display:"none",position:"absolute",bottom:0,left:0,right:0,height:"10px",backgroundColor:"#000"}});self.progressBar=$("<div/>",{css:{display:"none",position:"absolute",bottom:0,left:0,width:0,height:"10px",backgroundColor:"#ccc"}});self.viewer.container.append(self.progressBg);self.viewer.container.append(self.progressBar);if(!self.context){alert("No WebGL support, sorry! You should totally use Chrome.");self.canvas.detach();self.canvas=null;return}self.toggleSize=function(event){if(!self.resized){self.restoreWidth=self.width;self.restoreHeight=self.height;self.resized=true;self.resize(640,480);mat4.perspective(self.projMatrix,self.fov*.0174532925,640/480,.1,5e3)}else{self.resized=false;self.resize(self.restoreWidth,self.restoreHeight);mat4.perspective(self.projMatrix,self.fov*.0174532925,self.viewer.aspect,.1,5e3)}};self.onDoubleClick=function(event){if(ZamModelViewer.isFullscreen()){ZamModelViewer.exitFullscreen()}else{ZamModelViewer.requestFullscreen(self.canvas[0])}};self.onFullscreen=function(event){if(!self.fullscreen&&ZamModelViewer.isFullscreen()){self.restoreWidth=self.width;self.restoreHeight=self.height;self.fullscreen=true;var $window=$(window);self.resize($window.width(),$window.height());mat4.perspective(self.projMatrix,self.fov*.0174532925,$window.width()/$window.height(),.1,5e3)}else if(self.fullscreen&&!ZamModelViewer.isFullscreen()){self.fullscreen=false;self.resize(self.restoreWidth,self.restoreHeight);mat4.perspective(self.projMatrix,self.fov*.0174532925,self.viewer.aspect,.1,5e3)}};self.onMouseDown=function(event){if(event.which==3||event.ctrlKey){self.rightMouseDown=true}else{self.mouseDown=true}if(event.type=="touchstart"){self.mouseX=event.originalEvent.touches[0].clientX;self.mouseY=event.originalEvent.touches[0].clientY}else{self.mouseX=event.clientX;self.mouseY=event.clientY}$("body").addClass("unselectable")};self.onMouseScroll=function(event){self.zoom.rateCurrent+=event.originalEvent.detail>0?1:-1;event.preventDefault();return false};self.onMouseWheel=function(event){self.zoom.rateCurrent+=event.originalEvent.wheelDelta>0?1:-1;event.preventDefault();return false};self.onMouseUp=function(event){if(self.mouseDown||self.rightMouseDown){$("body").removeClass("unselectable");self.mouseDown=false;self.rightMouseDown=false}};self.onMouseMove=function(event){if(!self.mouseDown&&!self.rightMouseDown||self.mouseX===undefined)return;var x,y;if(event.type=="touchmove"){event.preventDefault();x=event.originalEvent.touches[0].clientX;y=event.originalEvent.touches[0].clientY}else{x=event.clientX;y=event.clientY}var dx=(x-self.mouseX)/self.width*Math.PI*2;var dy=(y-self.mouseY)/self.width*Math.PI*2;if(self.mouseDown){if(self.up[2]==1){self.azimuth-=dx}else{self.azimuth+=dx}self.zenith+=dy;var pi2=Math.PI*2;while(self.azimuth<0)self.azimuth+=pi2;while(self.azimuth>pi2)self.azimuth-=pi2;if(self.zenith<1e-4)self.zenith=1e-4;if(self.zenith>=Math.PI)self.zenith=Math.PI-1e-4}else{self.translation[0]+=dx;self.translation[1]+=dy}self.mouseX=x;self.mouseY=y};self.onContextMenu=function(event){return false};self.canvas.on("mousedown touchstart",self.onMouseDown).on("DOMMouseScroll",self.onMouseScroll).on("mousewheel",self.onMouseWheel).on("dblclick",self.onDoubleClick).on("contextmenu",self.onContextMenu);$(window).on("resize",self.onFullscreen);$(document).on("mouseup touchend",self.onMouseUp).on("mousemove touchmove",self.onMouseMove)}else{self.canvas.attr({width:width,height:height});self.canvas.css({width:width+"px",height:height+"px"});self.context.viewport(0,0,self.drawingBufferWidth,self.drawingBufferHeight)}if(self.options.background){self.loadBackground()}},loadBackground:function(){var self=this,gl=self.context;if(self.options.transparent)return;var initVb=function(){self.vb=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(16),gl.DYNAMIC_DRAW);var vs=self.compileShader(gl.VERTEX_SHADER,self.vertShader);var fs=self.compileShader(gl.FRAGMENT_SHADER,self.fragShader);var program=gl.createProgram();gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Error linking shaders");return}self.vs=vs;self.fs=fs;self.program=program;self.uTexture=gl.getUniformLocation(program,"uTexture");self.aPosition=gl.getAttribLocation(program,"aPosition");self.aTexCoord=gl.getAttribLocation(program,"aTexCoord")};var updateVb=function(){var u=self.width/self.bgImg.width,v=self.height/self.bgImg.height;var vbData=[-1,-1,0,v,1,-1,u,v,-1,1,0,0,1,1,u,0];gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferSubData(gl.ARRAY_BUFFER,0,new Float32Array(vbData))};if(!self.bgImg){self.bgImg=new Image;self.bgImg.crossOrigin="";self.bgImg.onload=function(){self.bgImg.loaded=true;self.bgTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.bgTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.bgImg);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);if(!self.vb)initVb();updateVb()};self.bgImg.onerror=function(){self.bgImg=null};self.bgImg.src=self.options.contentPath+self.options.background}else if(self.bgImg.loaded){if(!self.vb)initVb();updateVb()}},vertShader:"    attribute vec2 aPosition;    attribute vec2 aTexCoord;        varying vec2 vTexCoord;        void main(void) {        vTexCoord = aTexCoord;        gl_Position = vec4(aPosition, 0, 1);    }    ",fragShader:"    precision mediump float;    varying vec2 vTexCoord;        uniform sampler2D uTexture;        void main(void) {        gl_FragColor = texture2D(uTexture, vTexCoord);    }    ",compileShader:function(type,source){var self=this,gl=self.context;var shader=gl.createShader(type);gl.shaderSource(shader,source);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){throw"Shader compile error: "+gl.getShaderInfoLog(shader)}return shader}};ZamModelViewer.Flash=function(viewer){var self=this;self.viewer=viewer;self.options=viewer.options;self.width=0;self.height=0;self.div=null;self.object=null;self.divId="sjfdlkjsfesl32"};ZamModelViewer.Flash.prototype={destroy:function(){var self=this;if(self.div){self.div.detach();self.div=null}if(self.object){self.object.detach();self.object=null}},method:function(name,params){var self=this,object=$("#"+self.divId);if(object.length>0){return object[0][name].apply(object[0],params)}else{return null}},resize:function(width,height){var self=this;if(self.width===width)return;self.viewer.container.css({height:height+"px"});self.width=width;self.height=height;if(!self.div){self.div=$("<div/>",{id:self.divId});self.viewer.container.append(self.div)}},init:function(){var self=this,opts=self.options;var model=opts.models;var flashVars={modelType:model.type,model:model.id,container:self.divId,contentPath:opts.contentPath};var params={quality:"high",allowscriptaccess:"always",allowfullscreen:true,menu:false,bgcolor:"#181818",wmode:"direct"};if(opts.background)flashVars.background=opts.background;if(opts.cls!==undefined)flashVars.cls=opts.cls;if(opts.hd!==undefined)flashVars.hd=opts.hd;if(opts.sk!==undefined)flashVars.sk=opts.sk;if(opts.ha!==undefined)flashVars.ha=opts.ha;if(opts.hc!==undefined)flashVars.hc=opts.hc;if(opts.fa!==undefined)flashVars.fa=opts.fa;if(opts.fc!==undefined)flashVars.fc=opts.fc;if(opts.fh!==undefined)flashVars.fh=opts.fh;if(opts.items){var items=opts.items;var equipList=[];if($.isArray(items)){for(var i=0;i<items.length;++i){equipList.push(items[i][0]);equipList.push(items[i][1])}}else{for(var slot in items){equipList.push(slot);equipList.push(items[slot])}}flashVars.equipList=equipList.join(",")}self.object=$("#"+self.divId);self.object.html("<b>WebGL not supported by your browser, please go to https://get.webgl.org/ for support.</b>")}};ZamModelViewer.Wow=function(){};ZamModelViewer.Wow.VertexSize32=10;ZamModelViewer.Wow.VertexProgramAttributes={position:"aPosition",normal:"aNormal",texcoord0:"aTexCoord0",texcoord1:"aTexCoord1"};ZamModelViewer.Wow.Model=function(renderer,viewer,model,index,skipLoad){var self=this;self.Texture=ZamModelViewer.Wow.Texture;self.renderer=renderer;self.viewer=viewer;self.model=model;self.modelIndex=index;self.modelPath=null;self.loaded=false;self.particlesEnabled=false;self.ribbonsEnabled=false;self.deferredParentingMatrix=mat4.create();self.opts=self.viewer.options;self.mount=null;self.isMount=self.opts.mount&&self.opts.mount.type==ZamModelViewer.Wow.Types.NPC&&self.opts.mount.id==self.model.id;if(self.model.type==ZamModelViewer.Wow.Types.CHARACTER){if(self.opts.mount&&self.opts.mount.type==ZamModelViewer.Wow.Types.NPC&&self.opts.mount.id){self.opts.mount.parent=self;self.mount=new ZamModelViewer.Wow.Model(renderer,viewer,self.opts.mount,0)}}self.race=-1;self.gender=-1;self.class=self.opts.cls?parseInt(self.opts.cls):-1;self.meta=null;self.skinIndex=0;self.hairIndex=0;self.hairColorIndex=0;self.faceIndex=0;self.featuresIndex=0;self.featuresColorIndex=0;self.HornsIndex=0;self.EyePatchIndex=0;self.TattoosIndex=0;self.parent=self.model.parent||null;self.items={};self.collectionModels={};self.needsCompositing=false;self.textureOverrides={};self.compositeImage=null;self.compositeTexture=null;self.npcTexture=null;self.specialTextures={};self.bakedTextures=[{},{},{},{},{},{},{},{},{},{},{},{},{},{}];self.isHD=false;self.sheathMain=-1;self.sheathOff=-1;self.numGeosets=29;self.geosets=new Array(self.numGeosets);self.geosetDefaults=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,0,1];self.CreatureGeosetData=0;for(var i=0;i<self.numGeosets;i++)self.geosets[i]=i*100+self.geosetDefaults[i];self.time=0;self.frame=0;self.startAnimation=null;self.currentAnimation=null;self.animStartTime=0;self.animPaused=false;self.matrix=mat4.create();self.vbData=null;self.vb=null;self.ib=null;self.shaderReady=false;self.vs=null;self.fs=null;self.program=null;self.uniforms=null;self.attribs=null;self.ambientColor=[.35,.35,.35,1];self.primaryColor=[1,1,1,1];self.secondaryColor=[.35,.35,.35,1];self.lightDir1=vec3.create();self.lightDir2=vec3.create();self.lightDir3=vec3.create();vec3.normalize(self.lightDir1,[5,-3,3]);vec3.normalize(self.lightDir2,[5,5,5]);vec3.normalize(self.lightDir3,[-5,-5,-5]);self.boundsSet=false;self.animBounds=false;self.boundsMin=[0,0,0];self.boundsMax=[0,0,0];self.boundsCenter=[0,0,0];self.boundsSize=[0,0,0];self.vertices=null;self.indices=null;self.animations=null;self.animLookup=null;self.bones=null;self.boneLookup=null;self.keyBoneLookup=null;self.meshes=null;self.texUnits=null;self.texUnitLookup=null;self.renderFlags=null;self.materials=null;self.materialLookup=null;self.textureAnims=null;self.textureAnimLookup=null;self.textureReplacements=null;self.attachments=null;self.attachmentLookup=null;self.colors=null;self.alphas=null;self.alphaLookup=null;self.particleEmitters=null;self.ribbonEmitters=null;self.tmpMat=mat4.create();self.tmpVec=vec3.create();self.tmpVec3=vec3.create();self.tmpVec4=vec4.create();self.mountMat=mat4.create();if(!skipLoad){self.load()}};ZamModelViewer.Models[ZamModelViewer.WOW]=ZamModelViewer.Wow.Model;ZamModelViewer.Wow.Model.prototype={external:{getNumAnimations:function(){var model=this.mount?this.mount:this;return model.animations?model.animations.length:0},getAnimation:function(idx){var model=this.mount?this.mount:this;if(model.animations&&idx>-1&&idx<model.animations.length){return model.animations[idx].name}else{return""}},setAnimation:function(name){var model=this.mount?this.mount:this;model.setAnimation(name)},resetAnimation:function(){var model=this.mount?this.mount:this;model.setAnimation("Stand")},setAnimPaused:function(paused){this.animPaused=paused},attachList:function(list){var equip=list.split(",");var items=[];for(var i=0;i<equip.length;i+=2){items.push([equip[i],equip[i+1]])}for(var i in items){var item=[parseInt(items[i][0]),parseInt(items[i][1])];this.opts.items.push(item)}this.loadItems(items);this.needsCompositing=true},clearSlots:function(list){var slots=list.split(",");for(var i=0;i<slots.length;++i){this.removeSlot(slots[i]);var items=[];for(var i in this.opts.items){if(this.opts.items[i].indexOf(parseInt(slots[i]))!=0)items.push(this.opts.items[i])}this.opts.items=items}this.needsCompositing=true},setAppearance:function(hairStyle,hairColor,faceType,skinColor,features,featuresColor,horns,eyepatch,tattoos,sheathMain,sheathOff){this.skinIndex=skinColor;this.hairIndex=hairStyle;this.hairColorIndex=hairColor;this.faceIndex=faceType;this.featuresIndex=features;this.featuresColorIndex=featuresColor;this.HornsIndex=horns;this.EyePatchIndex=eyepatch;this.TattoosIndex=tattoos;var Region=ZamModelViewer.Wow.Regions;var destroyTexture=function(array,key){array[key].destroy();delete array[key]};if(this.specialTextures[1])destroyTexture(this.specialTextures,1);if(this.specialTextures[6])destroyTexture(this.specialTextures,6);if(this.specialTextures[8])destroyTexture(this.specialTextures,8);if(this.bakedTextures[Region.LegUpper][1])destroyTexture(this.bakedTextures[Region.LegUpper],1);if(this.bakedTextures[Region.TorsoUpper][1])destroyTexture(this.bakedTextures[Region.TorsoUpper],1);if(this.bakedTextures[Region.FaceLower][1])destroyTexture(this.bakedTextures[Region.FaceLower],1);if(this.bakedTextures[Region.FaceUpper][1])destroyTexture(this.bakedTextures[Region.FaceUpper],1);if(this.bakedTextures[Region.FaceLower][2])destroyTexture(this.bakedTextures[Region.FaceLower],2);if(this.bakedTextures[Region.FaceUpper][2])destroyTexture(this.bakedTextures[Region.FaceUpper],2);if(this.bakedTextures[Region.FaceLower][3])destroyTexture(this.bakedTextures[Region.FaceLower],3);if(this.bakedTextures[Region.FaceUpper][3])destroyTexture(this.bakedTextures[Region.FaceUpper],3);if(this.bakedTextures[Region.Base][1])destroyTexture(this.bakedTextures[Region.Base],1);if(this.bakedTextures[Region.Unknown735][1])destroyTexture(this.bakedTextures[Region.Unknown735],1);this.sheathMain=sheathMain;this.sheathOff=sheathOff;this.needsCompositing=true;this.setup()},isLoaded:function(){if(this.mount){return this.mount.loaded&&this.loaded}else{return this.loaded}},setParticlesEnabled:function(enabled){this.particlesEnabled=enabled},setRibbonsEnabled:function(enabled){this.ribbonsEnabled=enabled}},
setMatrix:function(parent,bone,attach,extra){var self=this;mat4.copy(self.matrix,parent);mat4.multiply(self.matrix,self.matrix,bone);if(attach)mat4.translate(self.matrix,self.matrix,attach);if(extra)mat4.multiply(self.matrix,self.matrix,extra)},setAnimation:function(name){var self=this,anim;for(var i=0;i<self.animations.length;++i){anim=self.animations[i];if(!anim.name)continue;if(anim.name==name&&anim.subId==0){self.animStartTime=0;self.startAnimation=self.currentAnimation=anim;WH.debug("Set animation to",anim.id,anim.name);break}}if(name!="Stand"&&!self.currentAnimation){self.setAnimation("Stand")}},updateBuffers:function(fillVb){var self=this,i,j,vertLength=ZamModelViewer.Wow.VertexSize32,gl=self.renderer.context;if(!self.vertices||!self.indices)return;var vbLength=self.vertices.length*vertLength;if(!self.vbData)self.vbData=new Float32Array(vbLength);if(fillVb){var vbData=self.vbData,verts=self.vertices;for(i=0,j=0;i<vbLength;++j){vbData[i+0]=verts[j].transPosition[0];vbData[i+1]=verts[j].transPosition[1];vbData[i+2]=verts[j].transPosition[2];vbData[i+3]=verts[j].transNormal[0];vbData[i+4]=verts[j].transNormal[1];vbData[i+5]=verts[j].transNormal[2];vbData[i+6]=verts[j].u;vbData[i+7]=verts[j].v;vbData[i+8]=verts[j].u2;vbData[i+9]=verts[j].v2;i+=ZamModelViewer.Wow.VertexSize32}}if(!self.vb){self.vb=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferData(gl.ARRAY_BUFFER,self.vbData,gl.DYNAMIC_DRAW);self.ib=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(self.indices),gl.STATIC_DRAW)}else{gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferSubData(gl.ARRAY_BUFFER,0,self.vbData)}},updateBounds:function(){var self=this,t,m,color=[1,1,1,1],Wow=ZamModelViewer.Wow;var min=self.boundsMin,max=self.boundsMax,pos,tmp=self.tmpVec;vec3.set(min,9999,9999,999);vec3.set(max,-9999,-9999,-9999);if(!self.texUnits){mat4.identity(self.matrix);self.renderer.distance=1;return false}for(var i=0;i<self.texUnits.length;++i){t=self.texUnits[i];if(!t.show)continue;color[0]=color[1]=color[2]=color[3]=1;if(self.currentAnimation){if(t.color)t.color.getValue(self.currentAnimation.index,self.time,color);if(t.alpha)color[3]*=t.alpha.getValue(self.currentAnimation.index,self.time)}if(color[3]<.01)continue;m=t.mesh;for(var j=0;j<m.indexCount;++j){pos=self.vertices[self.indices[m.indexStart+j]].transPosition;vec3.min(min,min,pos);vec3.max(max,max,pos)}}if(self.mount&&self.mount.loaded){if(self.mount.updateBounds()){vec3.copy(min,vec3.scale(min,self.mount.boundsMin,1.1));vec3.copy(max,vec3.scale(max,self.mount.boundsMax,1.1));max[2]*=1.75}}if(self.model.type==Wow.Types.NPC){vec3.scale(min,min,self.meta.Scale);vec3.scale(max,max,self.meta.Scale)}vec3.subtract(self.boundsSize,max,min);vec3.scaleAndAdd(self.boundsCenter,min,self.boundsSize,.5);var hSize=self.boundsSize[2],wSize,dSize,scale=self.meta?self.meta.Scale:1;if(self.model.type!=Wow.Types.ITEM){wSize=self.boundsSize[1];dSize=self.boundsSize[0]}else{wSize=self.boundsSize[0];dSize=self.boundsSize[1]}if(!self.parent){var ratio=self.renderer.width/self.renderer.height;var hTan=2*Math.tan(self.renderer.fov/2*.0174532925);var wTan=hTan*ratio;var hDist=hSize*1.2/hTan;var wDist=wSize*1.2/wTan;self.renderer.distance=Math.max(Math.max(hDist,wDist),dSize*2)}mat4.identity(self.matrix);if(self.model.type!=Wow.Types.ITEM){mat4.rotateZ(self.matrix,self.matrix,Math.PI/2)}mat4.translate(self.matrix,self.matrix,vec3.negate(tmp,self.boundsCenter));vec3.set(self.tmpVec,scale,scale,scale);mat4.scale(self.matrix,self.matrix,self.tmpVec);return true},getTattooRegion:function(){var tattooData=ZamModelViewer.Wow.TattooDataForRace[this.race];if(tattooData){var tattooRegion=tattooData[2];if(tattooData[3]!=0&&this.class!=tattooData[3]){return}return tattooRegion}},getResolutionVariationType:function(variationType){return ZamModelViewer.Wow.CharVariationMap[variationType][this.isHD?1:0]},setup:function(){var self=this,i,Wow=ZamModelViewer.Wow,Races=Wow.Races,Classes=Wow.Classes,CharVariationType=Wow.CharVariationType;if(self.model.type!=Wow.Types.CHARACTER&&self.model.type!=Wow.Types.NPC&&self.model.type!=Wow.Types.HUMANOIDNPC||self.race<1){self.applyMonsterGeosets();return}var skinFeature,faceFeature,facialHairFeature,hairFeature,underwearFeature,tattooFeature;if(self.customFeatures){skinFeature=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.Skin),0,self.skinIndex);faceFeature=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.Face),self.faceIndex,self.skinIndex);facialHairFeature=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.FacialHair),self.featuresIndex,self.featuresColorIndex);hairFeature=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.Hair),self.hairIndex,self.hairColorIndex);underwearFeature=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.Underwear),0,self.skinIndex);var tattooData=Wow.TattooDataForRace[self.race];if(tattooData){var tattooVariationType=tattooData[self.gender];if(tattooData[3]!=0&&self.class!=tattooData[3]){tattooVariationType=null}if(tattooVariationType){tattooFeature=self.customFeatures.getFeature(self.getResolutionVariationType(tattooVariationType),self.TattoosIndex,self.skinIndex)}}}if(self.hairGeosets){self.currentHairGeoset=self.hairGeosets.getHairGeosetByVariationId(CharVariationType.Hair,self.hairIndex)}self.updateMeshes();var Region=ZamModelViewer.Wow.Regions;if(!self.npcTexture){self.needsCompositing=true;if(skinFeature&&skinFeature.textures[0]!=0&&!self.specialTextures[1]){self.specialTextures[1]=new self.Texture(self,1,skinFeature.textures[0])}if(underwearFeature){if(underwearFeature.textures[0]!=0&&!self.bakedTextures[Region.LegUpper][1])self.bakedTextures[Region.LegUpper][1]=new self.Texture(self,Region.LegUpper,underwearFeature.textures[0]);if(underwearFeature.textures[1]!=0&&!self.bakedTextures[Region.TorsoUpper][1])self.bakedTextures[Region.TorsoUpper][1]=new self.Texture(self,Region.TorsoUpper,underwearFeature.textures[1])}if(tattooFeature){var tattooRegion=self.getTattooRegion();if(tattooRegion&&tattooFeature.textures[0]!=0&&!self.bakedTextures[tattooRegion][1]){self.bakedTextures[tattooRegion][1]=new self.Texture(self,tattooRegion,tattooFeature.textures[0])}}if(faceFeature){if(faceFeature.textures[0]!=0&&!self.bakedTextures[Region.FaceLower][1])self.bakedTextures[Region.FaceLower][1]=new self.Texture(self,Region.FaceLower,faceFeature.textures[0]);if(faceFeature.textures[1]!=0&&!self.bakedTextures[Region.FaceUpper][1])self.bakedTextures[Region.FaceUpper][1]=new self.Texture(self,Region.FaceUpper,faceFeature.textures[1])}if(facialHairFeature){if(facialHairFeature.textures[0]!=0&&!self.bakedTextures[Region.FaceLower][2])self.bakedTextures[Region.FaceLower][2]=new self.Texture(self,Region.FaceLower,facialHairFeature.textures[0]);if(facialHairFeature.textures[1]!=0&&!self.bakedTextures[Region.FaceUpper][2])self.bakedTextures[Region.FaceUpper][2]=new self.Texture(self,Region.FaceUpper,facialHairFeature.textures[1])}if(self.currentHairGeoset){if(self.currentHairGeoset.showscalp==1){hairFeature=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.Hair),1,self.hairColorIndex)}else if(hairFeature&&self.currentHairGeoset.showscalp==0){if(hairFeature.textures[1]!=0&&!self.bakedTextures[Region.FaceLower][3])self.bakedTextures[Region.FaceLower][3]=new self.Texture(self,Region.FaceLower,hairFeature.textures[1]);if(hairFeature.textures[2]!=0&&!self.bakedTextures[Region.FaceUpper][3])self.bakedTextures[Region.FaceUpper][3]=new self.Texture(self,Region.FaceUpper,hairFeature.textures[2])}}}if(skinFeature&&skinFeature.textures[1]!=0&&!self.specialTextures[8]){self.specialTextures[8]=new self.Texture(self,8,skinFeature.textures[1])}if(hairFeature&&hairFeature.textures[0]!=0&&!self.specialTextures[6]){self.specialTextures[6]=new self.Texture(self,6,hairFeature.textures[0])}},setGeometryVisibleCustom:function(data){if(data){this.geosets[data.geosetType]=data.geosetType*100+data.geosetID}},setGeometryVisible:function(minId,maxId,visible){var self=this;if(!self.texUnits||self.texUnits.length==0)return false;var texUnit;for(var i=0;i<self.texUnits.length;++i){texUnit=self.texUnits[i];if(texUnit.meshId>=minId&&texUnit.meshId<=maxId){texUnit.show=visible}}return true},applyMonsterGeosets:function(){var self=this;self.setGeometryVisible(0,0,true);if(self.CreatureGeosetData!=0){self.setGeometryVisible(1,899,false);for(var i=0;i<8;++i){var geoset=self.CreatureGeosetData>>i*4&15;if(geoset!=0){var meshId=100*(i+1);self.setGeometryVisible(meshId,meshId+99,false);self.setGeometryVisible(meshId+geoset,meshId+geoset,true)}}}},updateCollection:function(collection){var boneMap=[],self=this;for(var i=0;i<self.bones.length;i++){boneMap[self.bones[i].id]=i}var ibones=collection.bones;if(ibones){for(var i=0;i<ibones.length;i++){var bone=ibones[i];var pi=boneMap[bone.id];if(typeof pi!="number")continue;var dst=ibones[i].matrix;var src=self.bones[pi].matrix;ibones[i].skipUpdate=true;mat4.copy(dst,src)}mat4.identity(self.tmpMat);collection.setMatrix(self.matrix,self.tmpMat);collection.update();collection.draw(false)}},updateMeshes:function(){var self=this,i,j,u,Wow=ZamModelViewer.Wow,Races=Wow.Races,Genders=Wow.Genders,Slots=Wow.Slots,CharVariationType=Wow.CharVariationType;if(!self.texUnits||self.texUnits.length==0)return;self.geosets[7]=702;if(self.hairGeosets){if(self.race==Races.ZANDALARITROLL){var earring=self.hairGeosets.getHairGeosetByVariationId(CharVariationType.Custom3,self.EyePatchIndex);self.setGeometryVisibleCustom(earring);var tusk=self.hairGeosets.getHairGeosetByVariationId(CharVariationType.Custom2,self.HornsIndex);self.setGeometryVisibleCustom(tusk)}else if(self.race==Races.VULPERA){var nose=self.hairGeosets.getHairGeosetByVariationId(CharVariationType.Custom2,self.HornsIndex);self.setGeometryVisibleCustom(nose)}else if(self.race==Races.DARKIRONDWARF){var earring=self.hairGeosets.getHairGeosetByVariationId(CharVariationType.Custom1,self.HornsIndex);self.setGeometryVisibleCustom(earring)}else if(self.race==Races.LIGHTFORGEDDRAENEI){var rune=self.hairGeosets.getHairGeosetByVariationId(CharVariationType.Custom3,self.EyePatchIndex);self.setGeometryVisibleCustom(rune)}var skin=self.hairGeosets.getHairGeosetByColorIndex(CharVariationType.Skin,self.skinIndex);self.setGeometryVisibleCustom(skin);var face=self.hairGeosets.getHairGeosetByVariationId(CharVariationType.Face,self.faceIndex);self.setGeometryVisibleCustom(face)}self.setGeometryVisibleCustom(self.currentHairGeoset);if(self.geosets[0]==0)self.geosets[0]=1;if(self.facialHairStyles){var facialStyle=self.facialHairStyles.getStyle(self.featuresIndex);if(facialStyle){if(facialStyle.geoset[0]!=-1)self.geosets[1]=100+facialStyle.geoset[0];if(facialStyle.geoset[1]!=-1)self.geosets[3]=300+facialStyle.geoset[1];if(facialStyle.geoset[2]!=-1)self.geosets[2]=200+facialStyle.geoset[2];if(facialStyle.geoset[3]!=-1)self.geosets[16]=1600+facialStyle.geoset[3];if(facialStyle.geoset[4]!=-1)self.geosets[17]=1700+facialStyle.geoset[4]}}var eyeGlowFlag=false;if(self.class==Wow.Classes.DEATHKNIGHT){eyeGlowFlag=true}else if(self.customFeatures){var faceSection=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.Face),self.faceIndex,self.skinIndex);if(faceSection)eyeGlowFlag=(faceSection.flags&4)!=0;else eyeGlowFlag=false}self.setGeometryVisible(0,3e3,false);self.setGeometryVisible(0,0,true);for(i=0;i<self.geosets.length;i++){if(eyeGlowFlag&&i==17)self.setGeometryVisible(1703,1703,true);else self.setGeometryVisible(self.geosets[i],self.geosets[i],true)}var tailFlag=false;var skinSection=self.customFeatures.getFeature(self.getResolutionVariationType(CharVariationType.Skin),0,self.skinIndex);if(skinSection)tailFlag=(skinSection.flags&256)!=0;var tailGeoset=1;if(!tailFlag){tailGeoset=self.hairGeosets.getHairGeosetConditional(CharVariationType.Skin,self.skinIndex,19)}if(tailGeoset<=0)tailGeoset=1;self.setGeometryVisible(1900+tailGeoset,1900+tailGeoset,true);var helm=self.items[Slots.HEAD];var shirt=self.items[Slots.SHIRT];var chest=self.items[Slots.CHEST];var belt=self.items[Slots.BELT];var pants=self.items[Slots.PANTS];var boots=self.items[Slots.BOOTS];var wrist=self.items[Slots.BRACERS];var gloves=self.items[Slots.HANDS];var tabard=self.items[Slots.TABARD];var cloak=self.items[Slots.CAPE];for(var colModelFile in self.collectionModels){if(self.collectionModels[colModelFile].isDirty){if(self.collectionModels[colModelFile].setGeometryVisible(0,3e3,false)){self.collectionModels[colModelFile].isDirty=false}}}function setGeo(model,meshId,def){if(!model.texUnits)return;var texUnit,found=false;for(var i=0;i<model.texUnits.length;++i){texUnit=model.texUnits[i];if(texUnit.meshId==meshId){found=true;break}}meshId=found?meshId:def;model.setGeometryVisible(meshId,meshId,true)}var slot,item,meshId;for(slot in self.items){item=self.items[slot];if(item.collectionModel){var collectionModel=item.collectionModel;if(item.slot==Slots.HEAD){meshId=item.geosetGroup[0]>0?2700+item.geosetGroup[0]:2701;setGeo(collectionModel,meshId,2701);meshId=item.geosetGroup[1]>0?2100+item.geosetGroup[1]:2101;setGeo(collectionModel,meshId,2101)}else if(item.slot==Slots.SHOULDER){meshId=item.geosetGroup[0]>0?2600+item.geosetGroup[0]:2601;setGeo(collectionModel,meshId,2601)}else if(item.slot==Slots.SHIRT){meshId=item.geosetGroup[0]>0?800+item.geosetGroup[0]:801;setGeo(collectionModel,meshId,801);meshId=item.geosetGroup[1]>0?1e3+item.geosetGroup[1]:1001;setGeo(collectionModel,meshId,1001)}else if(item.slot==Slots.CHEST||item.slot==Slots.ROBE){meshId=item.geosetGroup[0]>0?800+item.geosetGroup[0]:801;setGeo(collectionModel,meshId,801);meshId=item.geosetGroup[1]>0?1e3+item.geosetGroup[1]:1001;setGeo(collectionModel,meshId,1001);meshId=item.geosetGroup[2]>0?1300+item.geosetGroup[2]:1301;setGeo(collectionModel,meshId,1301);meshId=item.geosetGroup[3]>0?2200+item.geosetGroup[3]:2201;setGeo(collectionModel,meshId,2201);meshId=item.geosetGroup[4]>0?2800+item.geosetGroup[4]:2801;setGeo(collectionModel,meshId,2801)}else if(item.slot==Slots.BELT){meshId=item.geosetGroup[0]>0?1800+item.geosetGroup[0]:1801;setGeo(collectionModel,meshId,1801)}else if(item.slot==Slots.PANTS){meshId=item.geosetGroup[0]>0?1100+item.geosetGroup[0]:1101;setGeo(collectionModel,meshId,1101);meshId=item.geosetGroup[1]>0?900+item.geosetGroup[1]:901;setGeo(collectionModel,meshId,901);meshId=item.geosetGroup[2]>0?1300+item.geosetGroup[2]:1301;setGeo(collectionModel,meshId,1301)}else if(item.slot==Slots.BOOTS){meshId=item.geosetGroup[0]>0?500+item.geosetGroup[0]:501;setGeo(collectionModel,meshId,501);meshId=item.geosetGroup[1]>0?2e3+item.geosetGroup[1]:2001;setGeo(collectionModel,meshId,2001)}else if(item.slot==Slots.HANDS){meshId=item.geosetGroup[0]>0?400+item.geosetGroup[0]:401;setGeo(collectionModel,meshId,401);meshId=item.geosetGroup[1]>0?2300+item.geosetGroup[1]:2301;setGeo(collectionModel,meshId,2301)}else if(item.slot==Slots.CAPE){meshId=item.geosetGroup[0]>0?1500+item.geosetGroup[0]:1501;setGeo(collectionModel,meshId,1501)}else if(item.slot==Slots.TABARD){meshId=item.geosetGroup[0]>0?1200+item.geosetGroup[0]:1201;setGeo(collectionModel,meshId,1201)}}}if(helm){var race=self.race,gender=self.gender;var hideGeoset=gender==Genders.MALE?helm.HideGeosetMale:helm.HideGeosetFemale;if(hideGeoset){var groups=[0,1,2,3,7,16,17,24,25];for(i=0;i<hideGeoset.length;i++){if((1<<race&hideGeoset[i])!=0){var meshBase=groups[i]*100;var meshID=meshBase+self.geosetDefaults[groups[i]];self.setGeometryVisible(meshBase+self.geosetDefaults[i],meshBase+99,false);self.setGeometryVisible(meshID,meshID,true)}}}}var flags=0;if(tabard){flags|=16}if(gloves&&gloves.geosetGroup&&gloves.geosetGroup[0]){var glovesGeoset=401+gloves.geosetGroup[0];self.setGeometryVisible(401,499,false);self.setGeometryVisible(glovesGeoset,glovesGeoset,true);gloves.sortValue+=2}else{if(chest&&chest.geosetGroup&&chest.geosetGroup[0]){var chesetGeoset=801+chest.geosetGroup[0];self.setGeometryVisible(chesetGeoset,chesetGeoset,true)}}var canShowShirt=!(chest||belt||wrist);if(canShowShirt&&shirt&&shirt.geosetGroup&&shirt.geosetGroup[0]){var shirtGeoset=801+shirt.geosetGroup[0];self.setGeometryVisible(shirtGeoset,shirtGeoset,true)}if(tabard){if((tabard.flags&1048576)==0){self.setGeometryVisible(2200,2299,false);self.setGeometryVisible(2202,2202,true)}}else{if(chest&&chest.geosetGroup&&chest.geosetGroup[3]){var chestGeoset=2201+chest.geosetGroup[3];self.setGeometryVisible(2200,2299,false);self.setGeometryVisible(chestGeoset,chestGeoset,true)}}var largeBelt=false;if(belt&&belt.geosetGroup&&belt.geosetGroup[0]){largeBelt=(belt.flags&512)!=0}var robePants=false;var robeChest=false;if(chest&&chest.geosetGroup&&chest.geosetGroup[2]){robeChest=true;self.setGeometryVisible(501,599,false);self.setGeometryVisible(902,999,false);self.setGeometryVisible(1100,1199,false);self.setGeometryVisible(1300,1399,false);var chestGeoset=1301+chest.geosetGroup[2];self.setGeometryVisible(chestGeoset,chestGeoset,true)}else if(pants&&pants.geosetGroup&&pants.geosetGroup[2]){robePants=true;self.setGeometryVisible(501,599,false);self.setGeometryVisible(902,999,false);self.setGeometryVisible(1100,1199,false);self.setGeometryVisible(1300,1399,false);var pantsGeoset=1301+pants.geosetGroup[2];self.setGeometryVisible(pantsGeoset,pantsGeoset,true)}else{if(boots&&boots.geosetGroup&&boots.geosetGroup[0]){self.setGeometryVisible(501,599,false);self.setGeometryVisible(901,901,true);var bootsGeoset=501+boots.geosetGroup[0];self.setGeometryVisible(bootsGeoset,bootsGeoset,true)}else{var pantsGeoset;if(pants&&pants.geosetGroup&&pants.geosetGroup[1]){pantsGeoset=901+pants.geosetGroup[1]}else{pantsGeoset=901}self.setGeometryVisible(pantsGeoset,pantsGeoset,true)}}var bootsGeoset;if(boots&&boots.geosetGroup&&boots.geosetGroup[1]){bootsGeoset=2e3+boots.geosetGroup[1]}else if(boots&&(boots.flags&1048576)==0){bootsGeoset=2002}else{bootsGeoset=2001}self.setGeometryVisible(bootsGeoset,bootsGeoset,true);var showTabard=false;var hasDress=robeChest|robePants;if(!hasDress&&tabard&&tabard.geosetGroup&&tabard.geosetGroup[0]){showTabard=false;var tabardGeoset;if(largeBelt){showTabard=true;tabardGeoset=1203}else{showTabard=true;tabardGeoset=1201+tabard.geosetGroup[0]}self.setGeometryVisible(tabardGeoset,tabardGeoset,true)}else if(!(flags&16)){}else{self.setGeometryVisible(1201,1201,true);if(!hasDress){self.setGeometryVisible(1202,1202,true);showTabard=true}}if(!(showTabard||robeChest)){if(chest&&chest.geosetGroup&&chest.geosetGroup[1]){var chestGeoset=1001+chest.geosetGroup[1];self.setGeometryVisible(chestGeoset,chestGeoset,true)}else if(shirt&&shirt.geosetGroup&&shirt.geosetGroup[1]){var shirtGeoset=1001+shirt.geosetGroup[1];self.setGeometryVisible(shirtGeoset,shirtGeoset,true)}}if(!robeChest){if(pants&&pants.geosetGroup&&pants.geosetGroup[0]){var geosetGroup=pants.geosetGroup[0];var pantsGeoset=1101+geosetGroup;if(geosetGroup>2){self.setGeometryVisible(1300,1399,false);self.setGeometryVisible(pantsGeoset,pantsGeoset,true)}else if(!showTabard){self.setGeometryVisible(pantsGeoset,pantsGeoset,true)}}}if(cloak&&cloak.geosetGroup&&cloak.geosetGroup[0]){self.setGeometryVisible(1500,1599,false);var cloakGeoset=1501+cloak.geosetGroup[0];self.setGeometryVisible(cloakGeoset,cloakGeoset,true)}if(belt&&belt.geosetGroup&&belt.geosetGroup[0]){self.setGeometryVisible(1800,1899,false);var beltGeoset=1801+belt.geosetGroup[0];self.setGeometryVisible(beltGeoset,beltGeoset,true)}if(!pants&&!robeChest&&!robePants&&!showTabard&&!tailFlag&&!largeBelt){self.setGeometryVisible(1401,1401,true)}else{self.setGeometryVisible(1400,1499,false)}if(self.hornsModel){self.hornsModel.setGeometryVisible(0,3e3,false);if(!pants)self.hornsModel.setGeometryVisible(1401,1401,true);self.hornsModel.setGeometryVisible(2400+self.HornsIndex,2400+self.HornsIndex,true);self.hornsModel.setGeometryVisible(2500+self.EyePatchIndex,2500+self.EyePatchIndex,true)}var attach;for(slot in self.items){item=self.items[slot];if(!item.models)continue;var slotAttachments=self.getSlotAttachments(slot,item);for(i=0;i<item.models.length;++i){if(item.models[i]&&slotAttachments.length>i){attach=self.attachments[slotAttachments[i]];item.models[i].bone=attach.bone;item.models[i].attachment=attach;if(item.visual&&item.visual.models){var itemModel=item.models[i].model;for(var j=0;j<item.visual.models.length;j++){if(!itemModel.attachments||!itemModel.attachments[j]||!item.visual.models[j])continue;attach=itemModel.attachments[j];item.visual.models[j].bone=attach.bone;item.visual.models[j].attachment=attach;item.visual.models[j].model.bone=attach.bone;item.visual.models[j].model.attachment=attach}}}}}},compositeTextures:function(){var self=this,i,j,Region=ZamModelViewer.Wow.Regions,Classes=ZamModelViewer.Wow.Classes,Slots=ZamModelViewer.Wow.Slots,Races=ZamModelViewer.Wow.Races,item,t;for(i=0;i<self.bakedTextures.length;++i){for(j in self.bakedTextures[i]){if(!self.bakedTextures[i][j].ready())return}}for(i in self.items){item=self.items[i];if(!item.loaded&&!item.failed){return}else if(item.textures){for(j=0;j<item.textures.length;++j){if(item.textures[j].texture&&!item.textures[j].texture.ready())return}}}for(var i in self.specialTextures){if(self.specialTextures[i]&&!self.specialTextures[i].ready())return}if(!self.specialTextures[1])return;if(!self.compositeImage){self.compositeImage=document.createElement("canvas");self.compositeImage.width=self.specialTextures[1].mergedImg.width;self.compositeImage.height=self.specialTextures[1].mergedImg.height}var ctx=self.compositeImage.getContext("2d");ctx.drawImage(self.specialTextures[1].mergedImg,0,0,self.compositeImage.width,self.compositeImage.height);var w=self.compositeImage.width,h=self.compositeImage.height,regions=Region.old,r;if(w!=h)regions=Region.new;for(i=1;i<=3;++i){if(self.bakedTextures[Region.FaceLower][i]){if(!self.bakedTextures[Region.FaceLower][i].ready())return;r=regions[Region.FaceLower];ctx.drawImage(self.bakedTextures[Region.FaceLower][i].mergedImg,w*r.x,h*r.y,w*r.w,h*r.h)}if(self.bakedTextures[Region.FaceUpper][i]){if(!self.bakedTextures[Region.FaceUpper][i].ready())return;r=regions[Region.FaceUpper];ctx.drawImage(self.bakedTextures[Region.FaceUpper][i].mergedImg,w*r.x,h*r.y,w*r.w,h*r.h)}}var drawBra=true,drawPanties=true,uniqueSlot;for(i in self.items){uniqueSlot=self.items[i].uniqueSlot;if(uniqueSlot==Slots.SHIRT||uniqueSlot==Slots.CHEST||uniqueSlot==Slots.TABARD)drawBra=false;if(uniqueSlot==Slots.PANTS)drawPanties=false}if(drawBra&&self.bakedTextures[Region.TorsoUpper][1]){if(!self.bakedTextures[Region.TorsoUpper][1].ready())return;r=regions[Region.TorsoUpper];ctx.drawImage(self.bakedTextures[Region.TorsoUpper][1].mergedImg,w*r.x,h*r.y,w*r.w,h*r.h)}if(drawPanties&&self.bakedTextures[Region.LegUpper][1]){if(!self.bakedTextures[Region.LegUpper][1].ready())return;r=regions[Region.LegUpper];ctx.drawImage(self.bakedTextures[Region.LegUpper][1].mergedImg,w*r.x,h*r.y,w*r.w,h*r.h)}if(self.TattoosIndex>0){var tattooRegion=self.getTattooRegion();if(tattooRegion&&self.bakedTextures[tattooRegion][1]){if(!self.bakedTextures[tattooRegion][1].ready())return;r=regions[tattooRegion];ctx.drawImage(self.bakedTextures[tattooRegion][1].mergedImg,w*r.x,h*r.y,w*r.w,h*r.h)}}var items=[];for(i in self.items){items.push(self.items[i])}items.sort(function(a,b){return a.sortValue-b.sortValue});for(i=0;i<items.length;++i){item=items[i];if(!item.textures)continue;for(j=0;j<item.textures.length;++j){t=item.textures[j];if(t.gender!=self.gender||!t.texture||!t.texture.ready())continue;if(t.region!=Region.Base){if((self.meta.RaceFlags&2)!=0&&t.region==Region.Foot)continue;r=regions[t.region];ctx.drawImage(t.texture.mergedImg,w*r.x,h*r.y,w*r.w,h*r.h)}}}var gl=self.renderer.context;if(self.compositeTexture)gl.deleteTexture(self.compositeTexture);self.compositeTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.compositeTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.compositeImage);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);self.needsCompositing=false},loadItems:function(items){var self=this;if($.isArray(items)){for(var i=0;i<items.length;++i){self.addItem(items[i][0],items[i][1],items[i][2])}}else{for(var slot in items){self.addItem(parseInt(slot),items[slot])}}},addItem:function(slot,id,visualid){var self=this,Wow=ZamModelViewer.Wow;var item=new Wow.Item(self,slot,id,self.race,self.gender);if(visualid){item.setVisual(visualid)}var uniqueSlot=item.uniqueSlot;var altSlot=Wow.SlotAlternate[slot];if(!self.items[uniqueSlot]||altSlot==0){self.items[uniqueSlot]=item}else{item.uniqueSlot=altSlot;self.items[altSlot]=item}},removeSlot:function(slot){var self=this;var item=self.items[slot];if(item){delete self.items[slot];item.destroy();delete item}},getSlotAttachments:function(slot,item){var self=this,Slots=ZamModelViewer.Wow.Slots;var slotAttachments=[];if(self.attachments&&self.attachmentLookup){var slotMap={1:function(itm){return[11]},3:function(itm){return[6,5]},22:function(itm){if(itm&&itm.slot==Slots.SHIELD)return[0];return[2]},21:function(itm){return[1]},17:function(itm){return[1]},15:function(itm){return[2]},25:function(itm){return[1]},13:function(itm){return[1]},14:function(itm){return[0]},23:function(itm){return[2]},6:function(itm){return[53]},26:function(itm){return[1]},27:function(itm){return[55]}};var sheathStandardOverrides={21:26,22:27,15:28,17:26,25:32,13:32,23:33,14:28,26:26};var SheathWeaponOverrides={0:{21:26,22:27},1:{21:26,22:27},2:{21:30,22:31},3:{21:33,22:32},4:{21:26,22:27,15:28},5:{21:26},6:{21:26,22:27},7:{21:26,22:27},8:{21:26,22:27},9:{21:33,22:28}};if(slotMap[slot]){var data=slotMap[slot](item);for(var i=0;i<data.length;++i){var att=data[i];if((self.sheathMain>=0||self.sheathOff>=0||self.mount)&&sheathStandardOverrides[slot])att=sheathStandardOverrides[slot];if(self.sheathMain>=0&&slot==21&&SheathWeaponOverrides[self.sheathMain][slot])att=SheathWeaponOverrides[self.sheathMain][slot];if(self.sheathOff>=0&&slot==22&&SheathWeaponOverrides[self.sheathOff][slot])att=SheathWeaponOverrides[self.sheathOff][slot];if(att>=self.attachmentLookup.length||self.attachmentLookup[att]==-1)continue;slotAttachments.push(self.attachmentLookup[att])}}}return slotAttachments},onLoaded:function(){var self=this,i,Slots=ZamModelViewer.Wow.Slots;if(self.texUnits){for(i=0;i<self.texUnits.length;++i)self.texUnits[i].setup(self);self.sortedTexUnits=self.texUnits.concat();self.sortedTexUnits.sort(function(a,b){if(a.meshId==b.meshId)return a.priorityPlane-b.priorityPlane;else return a.meshId-b.meshId})}if(self.mount){if(ZamModelViewer.Wow.StandingMounts[self.mount.model.id]){self.setAnimation("StealthStand")}else{self.setAnimation("Mount")}}else{self.setAnimation("Stand")}self.updateBuffers(true);self.updateBounds();self.setup();self.loaded=true;if(self.isMount&&self.parent.loaded){self.parent.updateBounds()}if(self.parent&&self.parent.loaded){self.parent.updateMeshes()}}};ZamModelViewer.Wow.ReversedModels={147259:true};ZamModelViewer.Wow.ReversedItems={139260:true,45146:true};ZamModelViewer.Wow.StandingMounts={28060:true,28063:true,28082:true,41903:true,42147:true,44808:true,45271:true};ZamModelViewer.Wow.Types={ITEM:1,HELM:2,SHOULDER:4,NPC:8,CHARACTER:16,HUMANOIDNPC:32,OBJECT:64,ARMOR:128,PATH:256,ITEMVISUAL:512};ZamModelViewer.Wow.Classes={WARRIOR:1,PALADIN:2,HUNTER:3,ROGUE:4,PRIEST:5,DEATHKNIGHT:6,SHAMAN:7,MAGE:8,WARLOCK:9,MONK:10,DRUID:11,DEMONHUNTER:12};ZamModelViewer.Wow.Genders={MALE:0,FEMALE:1,0:"male",1:"female"};ZamModelViewer.Wow.Races={HUMAN:1,ORC:2,DWARF:3,NIGHTELF:4,SCOURGE:5,TAUREN:6,GNOME:7,TROLL:8,GOBLIN:9,BLOODELF:10,DRAENEI:11,FELORC:12,NAGA:13,BROKEN:14,SKELETON:15,VRYKUL:16,TUSKARR:17,FORESTTROLL:18,TAUNKA:19,NORTHRENDSKELETON:20,ICETROLL:21,WORGEN:22,WORGENHUMAN:23,PANDAREN:24,PANDAREN_A:25,PANDAREN_H:26,NIGHTBORNE:27,HIGHMOUNTAINTAUREN:28,VOIDELF:29,LIGHTFORGEDDRAENEI:30,ZANDALARITROLL:31,KULTIRAN:32,THINHUMAN:33,DARKIRONDWARF:34,VULPERA:35,MAGHARORC:36,UPRIGHTORC:37,1:"human",2:"orc",3:"dwarf",4:"nightelf",5:"scourge",6:"tauren",7:"gnome",8:"troll",9:"goblin",10:"bloodelf",11:"draenei",12:"felorc",13:"naga_",14:"broken",15:"skeleton",16:"vrykul",17:"tuskarr",18:"foresttroll",19:"taunka",20:"northrendskeleton",21:"icetroll",22:"worgen",23:"gilnean",24:"pandaren",25:"pandarena",26:"pandarenh",27:"nightborne",28:"highmountaintauren",29:"voidelf",30:"lightforgeddraenei",31:"zandalaritroll",32:"kultiran",33:"thinhuman",34:"darkirondwarf",35:"vulpera",36:"magharorc"};ZamModelViewer.Wow.UniqueSlots=[0,1,0,3,4,5,6,7,8,9,10,0,0,21,22,22,16,21,0,19,5,21,22,22,0,21,21,27];ZamModelViewer.Wow.SlotOrder=[0,16,0,15,1,7,11,5,6,9,8,0,0,17,18,19,14,20,0,12,8,21,22,23,0,24,25,0];ZamModelViewer.Wow.SlotAlternate=[0,0,0,0,0,0,0,0,0,0,0,0,0,22,0,0,0,22,0,0,0,0,0,0,0,0,0,0];ZamModelViewer.Wow.SlotType=[0,2,0,4,128,128,128,128,128,128,128,0,0,1,1,1,128,1,0,128,128,1,1,1,0,1,1,2];ZamModelViewer.Wow.Slots={HEAD:1,SHOULDER:3,SHIRT:4,CHEST:5,BELT:6,PANTS:7,BOOTS:8,BRACERS:9,HANDS:10,ONEHAND:13,SHIELD:14,BOW:15,CAPE:16,TWOHAND:17,TABARD:19,ROBE:20,RIGHTHAND:21,LEFTHAND:22,OFFHAND:23,THROWN:25,RANGED:26};ZamModelViewer.Wow.UiCustomizationType={Skin:0,Face:1,Hair:2,HairColor:3,FacialHair:4,CustomOptionTattoo:5,CustomOptionHorn:6,CustomOptionFacewear:7,CustomOptionTattooColor:8};ZamModelViewer.Wow.CharVariationType={Skin:0,Face:1,FacialHair:2,Hair:3,Underwear:4,Custom1:5,Custom2:6,Custom3:7};ZamModelViewer.Wow.CharVariationMap=[[0,5],[1,6],[2,7],[3,8],[4,9],[10,11],[12,13],[14,15]];ZamModelViewer.Wow.TattooDataForRace={1:[5,5,13,0],2:[5,5,13,0],4:[5,5,12,12],10:[5,5,12,12],27:[5,5,13,0],28:[5,5,13,0],30:[5,5,12,0],31:[5,5,13,0],34:[6,5,13,0],35:[5,5,13,0]};ZamModelViewer.Wow.Regions={ArmUpper:0,ArmLower:1,Hand:2,TorsoUpper:3,TorsoLower:4,LegUpper:5,LegLower:6,Foot:7,Accessory:8,FaceUpper:9,FaceLower:10,Unused:11,Base:12,Unknown735:13,old:[{x:0,y:0,w:.5,h:.25},{x:0,y:.25,w:.5,h:.25},{x:0,y:.5,w:.5,h:.125},{x:.5,y:0,w:.5,h:.25},{x:.5,y:.25,w:.5,h:.125},{x:.5,y:.375,w:.5,h:.25},{x:.5,y:.625,w:.5,h:.25},{x:.5,y:.875,w:.5,h:.125},{},{x:0,y:.625,w:.5,h:.125},{x:0,y:.75,w:.5,h:.25},{},{x:0,y:0,w:1,h:1},{x:0,y:0,w:1,h:1}],new:[{x:0,y:0,w:.25,h:.25},{x:0,y:.25,w:.25,h:.25},{x:0,y:.5,w:.25,h:.125},{x:.25,y:0,w:.25,h:.25},{x:.25,y:.25,w:.25,h:.125},{x:.25,y:.375,w:.25,h:.25},{x:.25,y:.625,w:.25,h:.25},{x:.25,y:.875,w:.25,h:.125},{x:.75,y:.75,w:.25,h:.25},{x:.5,y:0,w:.5,h:1},{x:.5,y:0,w:.5,h:1},{},{x:0,y:0,w:.5,h:1},{x:0,y:0,w:1,h:1}]};ZamModelViewer.Wow.Model.prototype.load=function(){var self=this,Type=ZamModelViewer.Wow.Types;if(!self.model||!self.model.type||!self.model.id)return;self._load(self.model.type,self.model.id)};ZamModelViewer.Wow.Model.prototype._load=function(type,id){var self=this,Type=ZamModelViewer.Wow.Types,url=null;if(type==Type.ITEM)url="meta/item/";else if(type==Type.HELM)url="meta/armor/1/";else if(type==Type.SHOULDER)url="meta/armor/3/";else if(type==Type.NPC||type==Type.HUMANOIDNPC)url="meta/npc/";else if(type==Type.OBJECT)url="meta/object/";else if(type==Type.CHARACTER)url="meta/character/";else if(type==Type.ITEMVISUAL)url="meta/itemvisual/";if(url){url=self.opts.contentPath+url+id+".json";(function(type){$.getJSON(url).done(function(json){self.loadMeta(json,type)}).fail(function(jqxhr,textStatus,error){var err=textStatus+", "+error;console.log("Model:_load Error loading metadata: "+err)})})(type)}else if(type==Type.PATH){self.modelPath=id;if(!self.meta)self.meta={Model:id,Scale:1};url=self.opts.contentPath+"mo3/"+id+".mo3";$.ajax({url:url,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:false,renderer:self.renderer,success:function(buffer){self.loadMo3(buffer)},error:function(xhr,status,error){console.log(error)}})}};ZamModelViewer.Wow.RaceFallbacks={36:[2,0,2,1,2,0,2,1],35:[9,0,9,1,9,0,9,1],34:[3,0,3,1,3,0,3,1],33:[5,1,0,-1,5,0,0,-1],31:[0,-1,8,1,0,-1,8,1],30:[11,0,11,1,11,0,11,1],29:[10,0,10,1,10,0,10,1],
28:[6,0,6,1,6,0,6,1],27:[4,0,4,1,4,0,4,1],26:[24,0,24,1,24,0,24,1],25:[24,0,24,1,24,0,24,1],23:[1,0,1,1,1,0,1,1],15:[5,0,5,1,5,0,5,1]};ZamModelViewer.Wow.Model.prototype.getFallbackRaceGender=function(gender,race,isTexture){var fallbackData=ZamModelViewer.Wow.RaceFallbacks[race];if(fallbackData){var offset=isTexture?4:0;return fallbackData.slice(gender*2+offset,gender*2+offset+2)}};ZamModelViewer.Wow.Model.prototype.selectBestModel=function(modelid,gender,cls,race){var models=this.meta.ModelFiles[modelid];if(models.length==1){return models[0].FileDataId}var fallbackData=this.getFallbackRaceGender(gender,race,false);if(fallbackData&&fallbackData[0]!=0){race=fallbackData[0];gender=fallbackData[1]}for(i=0;i<models.length;i++){var model=models[i];if(model.Race!=0&&model.Race==race&&(model.Class!=0&&model.Class==cls)&&(model.Gender==gender||model.Gender==2)){return model.FileDataId}}for(i=0;i<models.length;i++){var model=models[i];if(model.Race!=0&&model.Race==race&&(model.Gender==gender||model.Gender==2)){return model.FileDataId}}for(i=0;i<models.length;i++){var model=models[i];if(model.Class!=0&&model.Class==cls&&(model.Gender==gender||model.Gender==2)){return model.FileDataId}}for(i=0;i<models.length;i++){var model=models[i];if(model.Gender==gender||model.Gender==2){return model.FileDataId}}console.log("selectBestModel for "+modelid+", gender "+gender+", class "+cls+", race "+race+" failed!")};ZamModelViewer.Wow.Model.prototype.loadMeta=function(meta,type){var self=this,Type=ZamModelViewer.Wow.Types,model,i;if(!type)type=self.model.type;if(!self.meta)self.meta=meta;if(type==Type.CHARACTER){model=meta.Model;if(self.opts.hd&&meta.HDModel){model=meta.HDModel;self.isHD=true}if(self.opts.cls)self.class=parseInt(self.opts.cls);var customDataUrl=self.opts.contentPath+"meta/charactercustomization/"+meta.Race+"_"+meta.Gender+".json";$.getJSON(customDataUrl,function(data){WH.debug("Got customization data!",data);self.customFeatures=new ZamModelViewer.Wow.CustomFeatures(data.customFeatures);self.hairGeosets=new ZamModelViewer.Wow.HairGeosets(data.hairGeosets);self.facialHairStyles=new ZamModelViewer.Wow.FacialHairStyles(data.facialHairStyles);if(data.HDCustomGeoFileDataID!=0&&self.class==12){var modelInfo={type:Type.PATH,id:data.HDCustomGeoFileDataID,parent:self};self.hornsModel=new ZamModelViewer.Wow.Model(self.renderer,self.viewer,modelInfo,0)}if(self.needsCompositing){self.setup()}});if(self.opts.sheathMain)self.sheathMain=self.opts.sheathMain;if(self.opts.sheathOff)self.sheathOff=self.opts.sheathOff;if(self.isHD&&self.meta.Creature&&self.meta.Creature.HDTexture){self.npcTexture=new self.Texture(self,-1,self.meta.Creature.HDTexture)}else if(self.meta.Creature&&self.meta.Creature.Texture){self.npcTexture=new self.Texture(self,-1,self.meta.Creature.Texture)}self.race=meta.Race;self.gender=meta.Gender;self._load(Type.PATH,model);if(self.meta.Equipment){self.loadItems(self.meta.Equipment)}if(self.opts.items){self.loadItems(self.opts.items)}if(self.model.type!=Type.CHARACTER&&self.meta.Race>0){self.skinIndex=parseInt(self.meta.Creature.SkinColor);self.hairIndex=parseInt(self.meta.Creature.HairStyle);self.hairColorIndex=parseInt(self.meta.Creature.HairColor);self.faceIndex=parseInt(self.meta.Creature.FaceType);self.featuresIndex=parseInt(self.meta.Creature.FacialHair);self.faceColorIndex=self.hairColorIndex;self.HornsIndex=0;self.EyePatchIndex=0;self.TattoosIndex=0}else{if(self.opts.sk)self.skinIndex=parseInt(self.opts.sk);if(self.opts.ha)self.hairIndex=parseInt(self.opts.ha);if(self.opts.hc)self.hairColorIndex=parseInt(self.opts.hc);if(self.opts.fa)self.faceIndex=parseInt(self.opts.fa);if(self.opts.fh)self.featuresIndex=parseInt(self.opts.fh);if(self.opts.fc)self.faceColorIndex=parseInt(self.opts.fc);if(self.opts.ho)self.HornsIndex=parseInt(self.opts.ho);if(self.opts.ep)self.EyePatchIndex=parseInt(self.opts.ep);if(self.opts.ta)self.TattoosIndex=parseInt(self.opts.ta)}}else if(type==Type.HELM){var race=1;var gender=0;var cls=1;if(self.parent){race=self.parent.race;gender=self.parent.gender;cls=self.parent.class}if(meta.ComponentModels){var model=meta.ComponentModels["0"];if(model&&meta.ModelFiles[model]){self._load(Type.PATH,self.selectBestModel(model,gender,cls,race))}}if(meta.Textures){for(i in meta.Textures){self.textureOverrides[i]=new self.Texture(self,parseInt(i),meta.Textures[i])}}}else if(type==Type.SHOULDER){var model1=meta.ComponentModels["0"];var model2=meta.ComponentModels["1"];if(self.model.shoulder==1||self.model.shoulder===undefined&&model1){if(model1){self._load(Type.PATH,meta.ModelFiles[model1][0].FileDataId)}if(meta.Textures){for(i in meta.Textures){self.textureOverrides[i]=new self.Texture(self,parseInt(i),meta.Textures[i])}}}else if(self.model.shoulder==2||self.model.shoulder===undefined&&model2){if(model2){self._load(Type.PATH,meta.ModelFiles[model2].length>1?meta.ModelFiles[model2][1].FileDataId:meta.ModelFiles[model2][0].FileDataId)}if(meta.Textures2){for(i in meta.Textures2){self.textureOverrides[i]=new self.Texture(self,parseInt(i),meta.Textures2[i])}}}}else if(type==Type.ITEMVISUAL){self._load(Type.PATH,meta.Equipment[self.modelIndex])}else{if(meta.Creature&&meta.Creature.CreatureGeosetData!=0){self.CreatureGeosetData=meta.Creature.CreatureGeosetData}if(meta.Textures){for(i in meta.Textures){if(meta.Textures[i]!=0){self.textureOverrides[i]=new self.Texture(self,parseInt(i),meta.Textures[i])}}}else if(meta.ComponentTextures&&self.parent){var g=self.parent.gender;for(i in meta.ComponentTextures){var textures=meta.TextureFiles[meta.ComponentTextures[i]];for(var j=0;j<textures.length;j++){var texture=textures[j];if(texture.Gender==g||texture.Gender==3){self.textureOverrides[i]=new self.Texture(self,parseInt(i),texture.FileDataId)}}}}if(self.opts.hd&&meta.HDModel){self._load(Type.PATH,meta.HDModel)}else if(meta.Model){self._load(Type.PATH,meta.Model)}else if(meta.Race>0){model=ZamModelViewer.Wow.Races[meta.Race]+ZamModelViewer.Wow.Genders[meta.Gender];self.race=meta.Race;self.gender=meta.Gender;self._load(Type.CHARACTER,model)}}};ZamModelViewer.Wow.Model.prototype.loadMo3=function(buffer){if(!buffer){console.error("Bad buffer for DataView");return}var self=this,r=new ZamModelViewer.DataView(buffer),i,Wow=ZamModelViewer.Wow;var magic=r.getUint32();if(magic!=604210112){console.log("Bad magic value");return}var version=r.getUint32();if(version<2e3){console.log("Bad version");return}var ofsVertices=r.getUint32();var ofsIndices=r.getUint32();var ofsSequences=r.getUint32();var ofsAnimations=r.getUint32();var ofsAnimLookup=r.getUint32();var ofsBones=r.getUint32();var ofsBoneLookup=r.getUint32();var ofsKeyBoneLookup=r.getUint32();var ofsMeshes=r.getUint32();var ofsTexUnits=r.getUint32();var ofsTexUnitLookup=r.getUint32();var ofsRenderFlags=r.getUint32();var ofsMaterials=r.getUint32();var ofsMaterialLookup=r.getUint32();var ofsTextureAnims=r.getUint32();var ofsTexAnimLookup=r.getUint32();var ofsTexReplacements=r.getUint32();var ofsAttachments=r.getUint32();var ofsAttachmentLookup=r.getUint32();var ofsColors=r.getUint32();var ofsAlphas=r.getUint32();var ofsAlphaLookup=r.getUint32();var ofsParticleEmitters=r.getUint32();var ofsRibbonEmitters=r.getUint32();var uncompressedSize=r.getUint32();self.program={name:"Wow.Generic",config:{}};self.attributeState=new ZamModelViewer.Tools.AttributeState;var compressedData=new Uint8Array(buffer,r.position);var data=null;try{data=pako.inflate(compressedData)}catch(err){console.log("Decompression error: "+err);return}if(data.length<uncompressedSize){console.log("Unexpected data size",data.length,uncompressedSize);return}r=new ZamModelViewer.DataView(data.buffer);r.position=ofsVertices;var numVertices=r.getInt32();if(numVertices>0){self.vertices=new Array(numVertices);for(i=0;i<numVertices;++i){self.vertices[i]=new Wow.Vertex(r)}}r.position=ofsIndices;var numIndices=r.getInt32();if(numIndices>0){self.indices=new Array(numIndices);for(i=0;i<numIndices;++i){self.indices[i]=r.getUint16()}}r.position=ofsAnimations;var numAnims=r.getInt32();if(numAnims>0){self.animations=new Array(numAnims);for(i=0;i<numAnims;++i){self.animations[i]=new Wow.Animation(r)}}r.position=ofsAnimLookup;var numAnimLookup=r.getInt32();if(numAnimLookup>0){self.animLookup=new Array(numAnimLookup);for(i=0;i<numAnimLookup;++i){self.animLookup[i]=r.getInt16()}}r.position=ofsBones;var numBones=r.getInt32();if(numBones>0){self.bones=new Array(numBones);for(i=0;i<numBones;++i){self.bones[i]=new Wow.Bone(self,i,r)}}r.position=ofsBoneLookup;var numBoneLookup=r.getInt32();if(numBoneLookup>0){self.boneLookup=new Array(numBoneLookup);for(i=0;i<numBoneLookup;++i){self.boneLookup[i]=r.getInt16()}}r.position=ofsKeyBoneLookup;var numKeyBoneLookup=r.getInt32();if(numKeyBoneLookup>0){self.keyBoneLookup=new Array(numKeyBoneLookup);for(i=0;i<numKeyBoneLookup;++i){self.keyBoneLookup[i]=r.getInt16()}}r.position=ofsMeshes;var numMeshes=r.getInt32();if(numMeshes>0){self.meshes=new Array(numMeshes);for(i=0;i<numMeshes;++i){self.meshes[i]=new Wow.Mesh(r)}}r.position=ofsTexUnits;var numTexUnits=r.getInt32();if(numTexUnits>0){self.texUnits=new Array(numTexUnits);for(i=0;i<numTexUnits;++i){self.texUnits[i]=new Wow.TexUnit(r)}}r.position=ofsTexUnitLookup;var numTexUnitLookup=r.getInt32();if(numTexUnitLookup>0){self.texUnitLookup=new Array(numTexUnitLookup);for(i=0;i<numTexUnitLookup;++i){self.texUnitLookup[i]=r.getInt16()}}r.position=ofsRenderFlags;var numRenderFlags=r.getInt32();if(numRenderFlags>0){self.renderFlags=new Array(numRenderFlags);for(i=0;i<numRenderFlags;++i){self.renderFlags[i]=new Wow.RenderFlag(r)}}r.position=ofsMaterials;var numMaterials=r.getInt32();if(numMaterials>0){self.materials=new Array(numMaterials);for(i=0;i<numMaterials;++i){self.materials[i]=new Wow.Material(self,i,r)}}r.position=ofsMaterialLookup;var numMaterialLookup=r.getInt32();if(numMaterialLookup>0){self.materialLookup=new Array(numMaterialLookup);for(i=0;i<numMaterialLookup;++i){self.materialLookup[i]=r.getInt16()}}r.position=ofsTextureAnims;var numTextureAnims=r.getInt32();if(numTextureAnims>0){self.textureAnims=new Array(numTextureAnims);for(i=0;i<numTextureAnims;++i){self.textureAnims[i]=new Wow.TextureAnimation(r)}}r.position=ofsTexAnimLookup;var numTexAnimLookup=r.getInt32();if(numTexAnimLookup>0){self.textureAnimLookup=new Array(numTexAnimLookup);for(i=0;i<numTexAnimLookup;++i){self.textureAnimLookup[i]=r.getInt16()}}r.position=ofsTexReplacements;var numTexReplacements=r.getInt32();if(numTexReplacements>0){self.textureReplacements=new Array(numTexReplacements);for(i=0;i<numTexReplacements;++i){self.textureReplacements[i]=r.getInt16()}}r.position=ofsAttachments;var numAttachments=r.getInt32();if(numAttachments>0){self.attachments=new Array(numAttachments);for(i=0;i<numAttachments;++i){self.attachments[i]=new Wow.Attachment(r)}}r.position=ofsAttachmentLookup;var numAttachmentLookup=r.getInt32();if(numAttachmentLookup>0){self.attachmentLookup=new Array(numAttachmentLookup);for(i=0;i<numAttachmentLookup;++i){self.attachmentLookup[i]=r.getInt16()}}r.position=ofsColors;var numColors=r.getInt32();if(numColors>0){self.colors=new Array(numColors);for(i=0;i<numColors;++i){self.colors[i]=new Wow.Color(r)}}r.position=ofsAlphas;var numAlphas=r.getInt32();if(numAlphas>0){self.alphas=new Array(numAlphas);for(i=0;i<numAlphas;++i){self.alphas[i]=new Wow.Alpha(r)}}r.position=ofsAlphaLookup;var numAlphaLookup=r.getInt32();if(numAlphaLookup>0){self.alphaLookup=new Array(numAlphaLookup);for(i=0;i<numAlphaLookup;++i){self.alphaLookup[i]=r.getInt16()}}r.position=ofsParticleEmitters;var numParticleEmitters=r.getInt32();if(numParticleEmitters>0){self.particleEmitters=new Array(numParticleEmitters);for(i=0;i<numParticleEmitters;++i){self.particleEmitters[i]=new Wow.ParticleEmitter(self,r)}}r.position=ofsRibbonEmitters;var numRibbonEmitters=r.getInt32();if(numRibbonEmitters>0){self.ribbonEmitters=new Array(numRibbonEmitters);for(i=0;i<numRibbonEmitters;++i){self.ribbonEmitters[i]=new Wow.RibbonEmitter(self,r)}}self.onLoaded()};ZamModelViewer.Wow.Model.prototype.update=function(){var self=this,i,j;if(!self.loaded||!self.texUnits)return;self.frame++;self.time=self.renderer.time;if(self.currentAnimation){if(self.animStartTime==0)self.animStartTime=self.time;if(self.time-self.animStartTime>=self.currentAnimation.length){var nextAnim=self.currentAnimation.next;if(self.currentAnimation.id!=0&&nextAnim!=-1){self.currentAnimation=self.animations[nextAnim];self.animStartTime=self.time}else{self.currentAnimation=self.startAnimation;self.animStartTime=self.time}}}if(self.race==9&&self.gender==0&&self.currentAnimation&&self.currentAnimation.name.startsWith("Emote")){self.sortedTexUnits[0].show=false;self.sortedTexUnits[6].show=false}var numUnits=self.texUnits.length,count,start,u;for(i=0;i<numUnits;++i){u=self.texUnits[i];if(!u.show)continue;count=u.mesh.indexCount;start=u.mesh.indexStart;for(j=0;j<count;++j)self.vertices[self.indices[start+j]].frame=self.frame}var numBones=self.bones.length,animTime=self.time-self.animStartTime,vb=self.vbData;if(self.bones&&self.animations){for(i=0;i<numBones;++i)self.bones[i].updated=false;for(i=0;i<numBones;++i)self.bones[i].update(animTime);if(self.vertices){var numVerts=self.vertices.length,v,b,w,idx,tmpVec3=self.tmpVec3,tmpVec4=self.tmpVec4;for(i=0;i<numVerts;++i){v=self.vertices[i];if(v.frame!=self.frame)continue;var vertexSizeFloat=ZamModelViewer.Wow.VertexSize32;idx=i*vertexSizeFloat;vb[idx]=vb[idx+1]=vb[idx+2]=vb[idx+3]=vb[idx+4]=vb[idx+5]=0;for(j=0;j<4;++j){w=v.weights[j]/255;if(w>0){b=self.bones[v.bones[j]];vec3.transformMat4(tmpVec3,v.position,b.matrix);vec4.transformMat4(tmpVec4,v.normal,b.matrix);vb[idx+0]+=tmpVec3[0]*w;vb[idx+1]+=tmpVec3[1]*w;vb[idx+2]+=tmpVec3[2]*w;vb[idx+3]+=tmpVec4[0]*w;vb[idx+4]+=tmpVec4[1]*w;vb[idx+5]+=tmpVec4[2]*w}}v.transPosition[0]=vb[idx+0];v.transPosition[1]=vb[idx+1];v.transPosition[2]=vb[idx+2];v.transNormal[0]=vb[idx+3];v.transNormal[1]=vb[idx+4];v.transNormal[2]=vb[idx+5]}self.updateBuffers(false);if(!self.animBounds){self.animBounds=true;self.updateBounds()}}}};ZamModelViewer.Wow.Model.prototype.draw=function(flipWinding){var self=this,gl=self.renderer.context,Wow=ZamModelViewer.Wow,Races=Wow.Races,Genders=Wow.Genders;if(self.mount){self.mount.draw();if(self.mount.loaded){var attach=self.mount.attachments[self.mount.attachmentLookup[0]];var scale=1/self.mount.meta.Scale;vec3.set(self.tmpVec,scale,scale,scale);mat4.identity(self.tmpMat);mat4.scale(self.tmpMat,self.tmpMat,self.tmpVec);self.setMatrix(self.mount.matrix,self.mount.bones[attach.bone].matrix,attach.position,self.tmpMat)}}var upsideDown=Wow.ReversedModels[self.model.id];if(upsideDown&&!self.parent){mat4.identity(self.matrix);vec3.set(self.tmpVec,1,1,-1);mat4.scale(self.matrix,self.matrix,self.tmpVec);flipWinding=true}var itemMeta=self.meta?self.meta.Item:null;if(itemMeta&&itemMeta.ItemClass==2&&(itemMeta.ItemSubClass==13||itemMeta.ItemSubClass==9)&&!self.parent){mat4.identity(self.matrix);vec3.set(self.tmpVec,1,-1,1);mat4.scale(self.matrix,self.matrix,self.tmpVec);flipWinding=true}if(itemMeta&&itemMeta.ItemClass==2&&(itemMeta.ItemSubClass==8||itemMeta.ItemSubClass==1||itemMeta.ItemSubClass==7||itemMeta.ItemSubClass==3||itemMeta.ItemSubClass==10||itemMeta.ItemSubClass==15)&&!self.parent){mat4.identity(self.matrix);vec3.set(self.tmpVec,1,-1,1);mat4.scale(self.matrix,self.matrix,self.tmpVec);flipWinding=true}if(!self.loaded)return;self.update();if(self.needsCompositing)self.compositeTextures();if(flipWinding)gl.frontFace(gl.CW);if(self.vb)gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);if(self.ib)gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);self.sceneState={uModelMatrix:self.matrix,uViewMatrix:self.renderer.viewMatrix,uProjMatrix:self.renderer.projMatrix,uCameraPos:self.renderer.eye,uAmbientColor:self.ambientColor,uPrimaryColor:self.primaryColor,uSecondaryColor:self.secondaryColor,uLightDir1:self.lightDir1,uLightDir2:self.lightDir2,uLightDir3:self.lightDir3};if(self.vb){if(self.sortedTexUnits){for(var i=0;i<self.sortedTexUnits.length;++i){if(!self.sortedTexUnits[i].show)continue;self.sortedTexUnits[i].draw()}}self.attributeState.disableAll()}if(flipWinding)gl.frontFace(gl.CCW);if(self.hornsModel){self.updateCollection(self.hornsModel)}for(var i in self.items){var item=self.items[i];if(!item||!item.models)continue;for(var j=0;j<item.models.length;++j){if(item.models[j]&&item.models[j].model&&item.models[j].bone>-1&&item.models[j].bone<self.bones.length){var winding=false,reversed=item.models[j].model.model.type==Wow.Types.ITEM&&Wow.ReversedItems[item.models[j].model.model.id];var upsideDown=Wow.ReversedModels[item.models[j].model.model.id];mat4.identity(self.tmpMat);if(upsideDown){vec3.set(self.tmpVec,1,1,-1);mat4.scale(self.tmpMat,self.tmpMat,self.tmpVec);winding=true}else if(reversed&&item.slot!=Wow.Slots.LEFTHAND||!reversed&&item.slot==Wow.Slots.LEFTHAND){vec3.set(self.tmpVec,1,-1,1);mat4.scale(self.tmpMat,self.tmpMat,self.tmpVec);winding=true}else if(i==Wow.Slots.LEFTHAND&&item.slot==Wow.Slots.ONEHAND&&item.itemClass==2&&item.itemSubClass==13){vec3.set(self.tmpVec,1,-1,1);mat4.scale(self.tmpMat,self.tmpMat,self.tmpVec);winding=true}if(item.slot==27){var scale=item.models[j].model.meta.Scale;vec3.set(self.tmpVec,scale,scale,scale);mat4.scale(self.tmpMat,self.tmpMat,self.tmpVec)}item.models[j].model.setMatrix(self.matrix,self.bones[item.models[j].bone].matrix,item.models[j].attachment.position,self.tmpMat);item.models[j].model.update();item.models[j].model.draw(winding);if(item.visual&&item.visual.models&&item.models[j].model.loaded){for(var k=0;k<item.visual.models.length;k++){var visual=item.visual.models[k];if(visual){mat4.identity(self.tmpMat);mat4.rotateY(self.tmpMat,self.tmpMat,Math.PI/2);var transPos=visual.model.particleEmitters[0].position;vec3.set(self.tmpVec,-transPos[0],-transPos[1],-transPos[2]);mat4.translate(self.tmpMat,self.tmpMat,self.tmpVec);visual.model.setMatrix(self.matrix,self.bones[item.models[j].bone].matrix,visual.attachment.position,self.tmpMat);item.visual.models[k].model.update();item.visual.models[k].model.draw(winding)}}}}else if(item.models[j]&&item.models[j].model&&item.models[j].bone==-1){self.updateCollection(item.models[j].model)}}}for(var i in self.collectionModels){var collection=self.collectionModels[i];if(!collection)continue;self.updateCollection(collection)}if(self.particleEmitters&&self.particlesEnabled){for(var i=0;i<self.particleEmitters.length;++i){self.particleEmitters[i].update(self.currentAnimation.index,self.time,self.renderer.delta);self.particleEmitters[i].draw()}}if(self.ribbonEmitters&&self.ribbonsEnabled){for(var i=0;i<self.ribbonEmitters.length;++i){self.ribbonEmitters[i].update(self.currentAnimation.index,self.time);self.ribbonEmitters[i].draw()}}};ZamModelViewer.Wow.Model.prototype.destroy=function(){var self=this;if(!self.renderer)return;var gl=self.renderer.context,i,j;ZamModelViewer.Tools.ReleaseProgram(self.programInfo);self.program=null;self.vs=null;self.fs=null;self.vb=null;self.ib=null;self.vbData=null;self.uniforms=null;self.attribs=null;if(self.compositeTexture)gl.deleteTexture(self.compositeTexture);if(self.npcTexture)self.npcTexture.destroy();if(self.bakedTextures){for(i=0;i<self.bakedTextures.length;++i){for(j in self.bakedTextures[i]){self.bakedTextures[i][j].destroy()}}}if(self.specialTextures){for(i in self.specialTextures){self.specialTextures[i].destroy()}}if(self.textureOverrides){for(i in self.textureOverrides){self.textureOverrides[i].destroy()}}if(self.indices)self.indices=null;if(self.animLookup)self.animLookup=null;if(self.boneLookup)self.boneLookup=null;if(self.keyBoneLookup)self.keyBoneLookup=null;if(self.texUnitLookup)self.texUnitLookup=null;if(self.materialLookup)self.materialLookup=null;if(self.textureAnimLookup)self.textureAnimLookup=null;if(self.textureReplacements)self.textureReplacements=null;if(self.attachmentLookup)self.attachmentLookup=null;if(self.alphaLookup)self.alphaLookup=null;if(self.renderFlags)for(i=0;i<self.renderFlags.length;++i)self.renderFlags[i]=null;self.renderFlags=null;var destroyArray=function(key){if(self[key]){var arr=self[key];for(var i=0;i<arr.length;++i){if(arr[i]&&arr[i].destroy)arr[i].destroy();arr[i]=null}self[key]=null}};destroyArray("vertices");destroyArray("animations");destroyArray("bones");destroyArray("meshes");destroyArray("texUnits");destroyArray("materials");destroyArray("textureAnims");destroyArray("attachments");destroyArray("colors");destroyArray("alphas");destroyArray("particleEmitters");destroyArray("ribbonEmitters");destroyArray("skins");destroyArray("faces");destroyArray("hairs");if(self.items){for(i in self.items){self.items[i].destroy();self.items[i]=null}}if(self.collectionModels){for(i in self.collectionModels){self.collectionModels[i].destroy();self.collectionModels[i]=null}}if(self.mount)self.mount.destroy();self.mount=null;if(self.hornsModel)self.hornsModel.destroy();self.hornsModel=null;self.renderer=null;self.viewer=null;self.model=null;self.items=null;self.collectionModels=null;self.textureOverrides=null;self.specialTextures=null;self.bakedTextures=null;self.geosets=null;self.slotAttachments=null;self.matrix=null;self.ambientColor=null;self.primaryColor=null;self.secondaryColor=null;self.lightDir1=null;self.lightDir2=null;self.lightDir3=null;self.boundsMin=null;self.boundsMax=null;self.boundsCenter=null;self.boundsSize=null;self.tmpMat=null;self.tmpVec=null;self.tmpVec2=null;self.tmpVec3=null;self.tmpVec4=null;self.mountMat=null};(function(){ZamModelViewer.Wow.Animated=function(){};ZamModelViewer.Wow.Animated.prototype={destroy:function(){var self=this;if(self.data)for(var i=0;i<self.data.length;++i)self.data[i]=null;self.times=null;self.data=null;return null},createValue:function(){return this.defaultValue},defaultValue:0,setDefault:function(v){this.defaultValue=v},interpolate:function(v1,v2,r,result){result=v1+(v2-v1)*r;return result},set:function(result,value){result=value;return result},getDefault:function(r){r=this.defaultValue;return r},readValue:function(r){return r.getInt32()},getValue:function(time,result){var self=this;if(result===undefined)result=self.createValue();else result=self.getDefault(result);if(self.type!=0||self.data.length>1){if(self.times.length>1){var maxTime=self.times[self.times.length-1];if(maxTime>0&&time>maxTime)time%=maxTime;var idx=0,numTimes=self.times.length;for(var i=0;i<numTimes;++i){if(time>=self.times[i]&&time<self.times[i+1]){idx=i;break}}var t1=self.times[idx],t2=self.times[idx+1],r=0;if(t1!=t2)r=(time-t1)/(t2-t1);if(self.type==1)return self.interpolate(self.data[idx],self.data[idx+1],r,result);else{result=self.set(result,self.data[idx]);return result}}else if(self.data.length>0){result=self.set(result,self.data[0]);return result}else{return result}}else{if(self.data.length==0)return result;else{result=self.set(result,self.data[0]);return result}}},read:function(r){var self=this,i;self.type=r.getInt16();self.seq=r.getInt16();self.used=r.getBool();var numTimes=r.getInt32();self.times=new Array(numTimes);for(i=0;i<numTimes;++i){self.times[i]=r.getInt32()}var numData=r.getInt32();self.data=new Array(numData);for(i=0;i<numData;++i){self.data[i]=self.readValue(r)}}};ZamModelViewer.Wow.Animated.destroySet=function(dataset){if(!dataset||dataset.length==0)return;for(var i=0;i<dataset.length;++i){dataset[i].destroy();dataset[i]=null}return null};ZamModelViewer.Wow.Animated.getValue=function(type,dataset,anim,time,result){if(!result)result=type.createValue();else result=type.getDefault(result);if(!dataset||dataset.length==0)return result;if(anim>=dataset.length)anim=0;return dataset[anim].getValue(time,result)};ZamModelViewer.Wow.Animated.isUsed=function(dataset,anim){if(!dataset||dataset.length==0)return false;if(anim>=dataset.length)anim=0;return dataset[anim].used};ZamModelViewer.Wow.AnimatedVec3=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.AnimatedVec3.prototype=new ZamModelViewer.Wow.Animated;ZamModelViewer.Wow.AnimatedVec3.prototype.constructor=ZamModelViewer.Wow.AnimatedVec3;ZamModelViewer.Wow.AnimatedVec3.prototype.createValue=function(){return vec3.clone(this.defaultValue)};ZamModelViewer.Wow.AnimatedVec3.prototype.defaultValue=vec3.create();ZamModelViewer.Wow.AnimatedVec3.prototype.getDefault=function(result){vec3.copy(result,this.defaultValue);return result};ZamModelViewer.Wow.AnimatedVec3.prototype.interpolate=function(v1,v2,r,result){return vec3.lerp(result,v1,v2,r)};ZamModelViewer.Wow.AnimatedVec3.prototype.set=function(result,value){result[0]=value[0];result[1]=value[1];result[2]=value[2]};ZamModelViewer.Wow.AnimatedVec3.prototype.readValue=function(r){return vec3.set(vec3.create(),r.getFloat(),r.getFloat(),r.getFloat())};ZamModelViewer.Wow.AnimatedVec3.getValue=function(dataset,anim,time,result){return ZamModelViewer.Wow.Animated.getValue(ZamModelViewer.Wow.AnimatedVec3.prototype,dataset,anim,time,result)};ZamModelViewer.Wow.AnimatedVec3.readSet=function(r){var count=r.getInt32();var data=new Array(count);for(var i=0;i<count;++i)data[i]=new ZamModelViewer.Wow.AnimatedVec3(r);return data};ZamModelViewer.Wow.AnimatedQuat=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.AnimatedQuat.prototype=new ZamModelViewer.Wow.Animated;ZamModelViewer.Wow.AnimatedQuat.prototype.constructor=ZamModelViewer.Wow.AnimatedQuat;ZamModelViewer.Wow.AnimatedQuat.prototype.createValue=function(){return quat.clone(this.defaultValue)};ZamModelViewer.Wow.AnimatedQuat.prototype.defaultValue=quat.create();ZamModelViewer.Wow.AnimatedQuat.prototype.getDefault=function(result){quat.copy(result,this.defaultValue);return result};ZamModelViewer.Wow.AnimatedQuat.prototype.interpolate=function(v1,v2,r,result){return quat.slerp(result,v1,v2,r)};ZamModelViewer.Wow.AnimatedQuat.prototype.set=function(result,value){result[0]=value[0];result[1]=value[1];result[2]=value[2];result[3]=value[3]};ZamModelViewer.Wow.AnimatedQuat.prototype.readValue=function(r){return quat.set(quat.create(),r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat())};ZamModelViewer.Wow.AnimatedQuat.getValue=function(dataset,anim,time,result){return ZamModelViewer.Wow.Animated.getValue(ZamModelViewer.Wow.AnimatedQuat.prototype,dataset,anim,time,result)};ZamModelViewer.Wow.AnimatedQuat.readSet=function(r){var count=r.getInt32();var data=new Array(count);for(var i=0;i<count;++i)data[i]=new ZamModelViewer.Wow.AnimatedQuat(r);return data};ZamModelViewer.Wow.AnimatedUint16=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.AnimatedUint16.prototype=new ZamModelViewer.Wow.Animated;ZamModelViewer.Wow.AnimatedUint16.prototype.constructor=ZamModelViewer.Wow.AnimatedUint16;ZamModelViewer.Wow.AnimatedUint16.prototype.readValue=function(r){return r.getUint16()};ZamModelViewer.Wow.AnimatedUint16.getValue=function(dataset,anim,time,result){return ZamModelViewer.Wow.Animated.getValue(ZamModelViewer.Wow.AnimatedUint16.prototype,dataset,anim,time,result)};ZamModelViewer.Wow.AnimatedUint16.readSet=function(r){var count=r.getInt32();var data=new Array(count);for(var i=0;i<count;++i)data[i]=new ZamModelViewer.Wow.AnimatedUint16(r);return data};ZamModelViewer.Wow.AnimatedFloat=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.AnimatedFloat.prototype=new ZamModelViewer.Wow.Animated;ZamModelViewer.Wow.AnimatedFloat.prototype.constructor=ZamModelViewer.Wow.AnimatedFloat;ZamModelViewer.Wow.AnimatedFloat.prototype.readValue=function(r){return r.getFloat()};ZamModelViewer.Wow.AnimatedFloat.getValue=function(dataset,anim,time,result){return ZamModelViewer.Wow.Animated.getValue(ZamModelViewer.Wow.AnimatedFloat.prototype,dataset,anim,time,result)};ZamModelViewer.Wow.AnimatedFloat.readSet=function(r){var count=r.getInt32();var data=new Array(count);for(var i=0;i<count;++i)data[i]=new ZamModelViewer.Wow.AnimatedFloat(r);return data};ZamModelViewer.Wow.AnimatedUint8=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.AnimatedUint8.prototype=new ZamModelViewer.Wow.Animated;ZamModelViewer.Wow.AnimatedUint8.prototype.constructor=ZamModelViewer.Wow.AnimatedUint8;ZamModelViewer.Wow.AnimatedUint8.prototype.readValue=function(r){return r.getUint8()};ZamModelViewer.Wow.AnimatedUint8.getValue=function(dataset,anim,time,result){return ZamModelViewer.Wow.Animated.getValue(ZamModelViewer.Wow.AnimatedUint8.prototype,dataset,anim,time,result)};ZamModelViewer.Wow.AnimatedUint8.readSet=function(r){var count=r.getInt32();var data=new Array(count);for(var i=0;i<count;++i)data[i]=new ZamModelViewer.Wow.AnimatedUint8(r);return data};ZamModelViewer.Wow.SAnimated=function(){};ZamModelViewer.Wow.SAnimated.prototype={destroy:function(){var self=this;for(var i=0;i<self.data.length;++i)self.data[i]=null;self.times=null;self.data=null;return null},createValue:function(){return this.defaultValue},defaultValue:0,setDefault:function(v){this.defaultValue=v},interpolate:function(v1,v2,r,result){result=v1+(v2-v1)*r;return result},set:function(result,value){result=value;return result},getDefault:function(r){r=this.defaultValue;return r},readValue:function(r){return r.getInt32()},getValue:function(time,result){var self=this;if(result===undefined)result=self.createValue();else result=self.getDefault(result);if(self.data.length>1&&self.times.length>1){var maxTime=self.times[self.times.length-1];if(maxTime>0&&time>maxTime)time%=maxTime;var idx=0,numTimes=self.times.length;for(var i=0;i<numTimes;++i){if(time>=self.times[i]&&time<self.times[i+1]){idx=i;break}}var t1=self.times[idx],t2=self.times[idx+1],r=0;if(t1!=t2)r=(time-t1)/(t2-t1);return self.interpolate(self.data[idx],self.data[idx+1],r,result)}else if(self.data.length>0){result=self.set(result,self.data[0]);return result}else{return result}},read:function(r){var self=this,i;var numTimes=r.getInt32();self.times=new Array(numTimes);for(i=0;i<numTimes;++i){self.times[i]=r.getUint32()}var numData=r.getInt32();self.data=new Array(numData);for(i=0;i<numData;++i){self.data[i]=self.readValue(r)}}};ZamModelViewer.Wow.SAnimatedVec2=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.SAnimatedVec2.prototype=new ZamModelViewer.Wow.SAnimated;ZamModelViewer.Wow.SAnimatedVec2.prototype.constructor=ZamModelViewer.Wow.SAnimatedVec2;ZamModelViewer.Wow.SAnimatedVec2.prototype.createValue=function(){return vec2.clone(this.defaultValue)};ZamModelViewer.Wow.SAnimatedVec2.prototype.defaultValue=vec2.create();ZamModelViewer.Wow.SAnimatedVec2.prototype.getDefault=function(result){vec2.copy(result,this.defaultValue);return result};ZamModelViewer.Wow.SAnimatedVec2.prototype.interpolate=function(v1,v2,r,result){return vec2.lerp(result,v1,v2,r)};ZamModelViewer.Wow.SAnimatedVec2.prototype.set=function(result,value){result[0]=value[0];result[1]=value[1];result[2]=value[2]};ZamModelViewer.Wow.SAnimatedVec2.prototype.readValue=function(r){return vec2.set(vec2.create(),r.getFloat(),r.getFloat())};ZamModelViewer.Wow.SAnimatedVec2.getValue=function(dataset,anim,time,result){return ZamModelViewer.Wow.Animated.getValue(ZamModelViewer.Wow.SAnimatedVec2.prototype,dataset,anim,time,result)};ZamModelViewer.Wow.SAnimatedVec3=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.SAnimatedVec3.prototype=new ZamModelViewer.Wow.SAnimated;ZamModelViewer.Wow.SAnimatedVec3.prototype.constructor=ZamModelViewer.Wow.SAnimatedVec3;ZamModelViewer.Wow.SAnimatedVec3.prototype.createValue=function(){return vec3.clone(this.defaultValue)};ZamModelViewer.Wow.SAnimatedVec3.prototype.defaultValue=vec3.create();ZamModelViewer.Wow.SAnimatedVec3.prototype.getDefault=function(result){vec3.copy(result,this.defaultValue);return result};ZamModelViewer.Wow.SAnimatedVec3.prototype.interpolate=function(v1,v2,r,result){return vec3.lerp(result,v1,v2,r)};ZamModelViewer.Wow.SAnimatedVec3.prototype.set=function(result,value){result[0]=value[0];result[1]=value[1];result[2]=value[2]};ZamModelViewer.Wow.SAnimatedVec3.prototype.readValue=function(r){return vec3.set(vec3.create(),r.getFloat(),r.getFloat(),r.getFloat())};ZamModelViewer.Wow.SAnimatedVec3.getValue=function(dataset,anim,time,result){
return ZamModelViewer.Wow.Animated.getValue(ZamModelViewer.Wow.SAnimatedVec3.prototype,dataset,anim,time,result)};ZamModelViewer.Wow.SAnimatedUint16=function(r){var self=this;self.read(r)};ZamModelViewer.Wow.SAnimatedUint16.prototype=new ZamModelViewer.Wow.SAnimated;ZamModelViewer.Wow.SAnimatedUint16.prototype.constructor=ZamModelViewer.Wow.SAnimatedUint16;ZamModelViewer.Wow.SAnimatedUint16.prototype.readValue=function(r){return r.getUint16()};ZamModelViewer.Wow.SAnimatedUint16.getValue=function(dataset,anim,time,result){return ZamModelViewer.Wow.SAnimated.getValue(ZamModelViewer.Wow.SAnimatedUint16.prototype,dataset,anim,time,result)}})();ZamModelViewer.Wow.ShaderTool=function(){var tool={};function getShaderEffect(shaderId){const id=shaderId&32767;if(id<shaderMap.length)return shaderMap[id];return["PS_Combiners_Opaque","VS_Diffuse_T1"]}tool.GetWowPSShaderName=function(shaderId,opCount){var shader="";if(shaderId&32768){return getShaderEffect(shaderId)[0]}else{if(opCount==1){shader=shaderId&112?"PS_Combiners_Mod":"PS_Combiners_Opaque"}else{var shadernames1=["Opaque","Mod","Mod","Add","Mod2x","Mod","Mod2xNA","AddNA"];var shadernames2=["Opaque","Mod","Mod","AddAlpha","Mod2x","Mod","Mod2xNA","AddAlpha"];var shadernames=shaderId&112?shadernames1:shadernames2;shader=(shaderId&112?"PS_Combiners_Mod":"PS_Combiners_Opaque")+"_"+shadernames[shaderId&7]}}return shader};tool.GetWowVSShaderName=function(shaderId,opCount){var shader="";if(shaderId&32768){return getShaderEffect(shaderId)[1]}else{if(opCount==1){shader=shaderId&128?"Env":shaderId&16384?"T2":"T1"}else{if(shaderId&128){shader=shaderId&8?"Env_Env":"Env_T1"}else{shader=shaderId&8?"T1_Env":shaderId&16384?"T1_T2":"T1_T1"}}}return"VS_Diffuse_"+shader};tool.GetWowProgram=function(shaderId,opCount,renderFlag){var ps=tool.GetWowPSShaderName(shaderId,opCount);var vs=tool.GetWowVSShaderName(shaderId,opCount);var name="Wow."+vs+"_"+ps;if(ZamModelViewer.Tools._GetProgram(name))return{name:name};var program={shaders:[tool.GenerateVS(vs,renderFlag),tool.GeneratePS(ps,renderFlag)],attributes:{position:"aPosition",normal:"aNormal",texcoord0:"aTexCoord0",texcoord1:"aTexCoord1"}};ZamModelViewer.Tools.RegisterProgram(name,program);return{name:name}};tool.Get=function(opts){var config={};var optConfFunc={texcoord1:function(c,v){c["INPUT_TEXCOORD1"]="aTexCoord"+v}};for(var cfn in opts.options){var v=opts.options[cfn];optConfFunc[cfn](config,v)}return{name:"Wow."+opts.name,config:config}};var shaderMap,psCombiners;tool.GenerateVS=function(vsname){var shader=null;var base="";base+="vTexCoord1 = (uTextureMatrix1 * vec4(aTexCoord0, 0, 1)).st;\n";base+="vTexCoord2 = (uTextureMatrix2 * vec4(aTexCoord1, 0, 1)).st;\n";if(vsname.substr(0,2)==="VS"){vsname=vsname.substr(3);var types=vsname.split("_");var kind=types[0];if(kind==="Diffuse"||kind==="Color"){base="";types.splice(0,1);var srcs={T1:["uTextureMatrix1","aTexCoord0"],T2:["uTextureMatrix2","aTexCoord1"],T3:["","aTexCoord2"],Env:["","texEnv"]};var tIndex=1;for(var i in types){if(srcs[types[i]]){if(srcs[types[i]][0]&&srcs[types[i]][1]!="texEnv"){base+="vTexCoord"+tIndex+" = ("+srcs[types[i]][0]+" * vec4("+srcs[types[i]][1]+", 0, 1)).st;\n"}else if(srcs[types[i]][1]=="texEnv"){base+="vTexCoord"+tIndex+" = texEnv;\n"}else{base+="vTexCoord"+tIndex+" = (uTextureMatrix"+tIndex+" * vec4("+srcs[types[i]][1]+", 0, 1)).st;\n"}tIndex++}else{WH.debug("Missing vertex shader def?",vsname)}}}}shader="            attribute vec3 aPosition;\n            attribute vec3 aNormal;\n            attribute vec2 aTexCoord0;\n            attribute vec2 aTexCoord1;\n            attribute vec3 aColor;\n            \n            varying vec3 vNormal;\n            varying vec2 vTexCoord1;\n            varying vec2 vTexCoord2;\n            varying vec2 vTexCoord3;\n            varying vec2 vTexCoord4;\n            \n            uniform mat4 uModelMatrix;\n            uniform mat4 uPanningMatrix;\n            uniform mat4 uViewMatrix;\n            uniform mat4 uProjMatrix;\n            uniform mat4 uTextureMatrix1;\n            uniform mat4 uTextureMatrix2;\n            uniform mat4 uTextureMatrix3;\n            uniform mat4 uTextureMatrix4;\n            uniform vec3 uCameraPos;\n            uniform bool uHasTexture1;\n            uniform bool uHasTexture2;\n            uniform bool uHasTexture3;\n            uniform bool uHasTexture4;\n            \n            vec2 sphereMap(vec3 vertex, vec3 normal)\n            {\n               vec3 normPos = -(normalize(vertex.xyz));\n               vec3 temp = (normPos - (normal * (2.0 * dot(normPos, normal))));\n               temp = vec3(temp.x, temp.y, temp.z + 1.0);\n               vec2 texCoord = ((normalize(temp).xy * 0.5) + vec2(0.5));\n               return texCoord;\n            }\n            void main(void) {\n              vec4 pos = uViewMatrix * uModelMatrix * vec4(aPosition, 1);\n              vNormal = normalize(mat3(uViewMatrix * uModelMatrix) * aNormal);\n              vec2 texEnv = sphereMap(pos.xyz,vNormal.xyz);\n              gl_Position = uProjMatrix * uViewMatrix * uModelMatrix * vec4(aPosition, 1);\n            \n            "+base+"\n              vNormal = mat3(uViewMatrix * uModelMatrix) * aNormal;            }";return shader};tool.GeneratePS=function(psname,renderFlag){var def=psCombiners[psname];if(!def){WH.debug("Missing pixel shader def",psname);psname="PS_Combiners_Opaque_Mod";def=psCombiners[psname]}var base="\t\t"+def[1]+"\n\t\t"+def[2];for(var i=0;i<def[0];i++){var ii=i+1;base="vec4 tex"+i+" = texture2D(uTexture"+ii+", vTexCoord"+ii+".st);\n"+base}var uniforms="            precision mediump float;            \n            varying vec3 vNormal;\n            varying vec2 vTexCoord1;\n            varying vec2 vTexCoord2;\n            varying vec2 vTexCoord3;\n            varying vec2 vTexCoord4;\n            \n            uniform bool uHasTexture1;\n            uniform bool uHasTexture2;\n            uniform bool uHasTexture3;\n            uniform bool uHasTexture4;\n            uniform bool uHasAlpha;\n            uniform int uBlendMode;\n            uniform bool uUnlit;\n            uniform vec4 uColor;\n            uniform vec4 uAmbientColor;\n            uniform vec4 uPrimaryColor;\n            uniform vec4 uSecondaryColor;\n            uniform vec3 uLightDir1;\n            uniform vec3 uLightDir2;\n            uniform vec3 uLightDir3;\n            uniform sampler2D uTexture1;\n            uniform sampler2D uTexture2;\n            uniform sampler2D uTexture3;\n            uniform sampler2D uTexture4;\n            uniform sampler2D uAlpha;\n            ";var extra="";if(renderFlag.blend==1){}var shader=uniforms+"\n            void main(void) {\n            vec4 _output = vec4(1.0);\n            vec4 _input = vec4(1.0);\n            "+base+"\n            "+extra+"\n            if (uBlendMode == 1) {\n                if (_output.a < 0.7) {\n                    discard;\n                }\n            }\n            if (!uUnlit) {                vec4 litColor = uAmbientColor;                vec3 normal = normalize(vNormal);                                float dp = max(0.0, dot(normal, uLightDir1));                litColor += uPrimaryColor * dp;                                dp = max(0.0, dot(normal, uLightDir2));                litColor += uSecondaryColor * dp;                                dp = max(0.0, dot(normal, uLightDir3));                litColor += uSecondaryColor * dp;                                litColor = clamp(litColor, vec4(0,0,0,0), vec4(1,1,1,1));                _output *= litColor;            }            gl_FragColor = _output.xyzw;\n            }";return shader};shaderMap=[["PS_Combiners_Opaque_Mod2xNA_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_Add","VS_Diffuse_T1_Env_T1","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_AddAlpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Alpha_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_3s","VS_Diffuse_T1_Env_T1","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Opaque_AddAlpha_Wgt","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_Add_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_ModNA_Alpha","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha_Wgt","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_AddAlpha_Wgt","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_AddAlpha_Wgt","VS_Diffuse_T1_T2","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod_Add_Wgt","VS_Diffuse_T1_Env","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha","VS_Diffuse_T1_Env_T1","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Dual_Crossfade","VS_Diffuse_T1","HS_T1","DS_T1"],["PS_Combiners_Mod_Depth","VS_Diffuse_EdgeFade_T1","HS_T1","DS_T1"],["PS_Combiners_Opaque_Mod2xNA_Alpha_Alpha","VS_Diffuse_T1_Env_T2","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Mod","VS_Diffuse_EdgeFade_T1_T2","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_Masked_Dual_Crossfade","VS_Diffuse_T1_T2","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Alpha","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha","VS_Diffuse_T1_Env_T2","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Depth","VS_Diffuse_EdgeFade_Env","HS_T1","DS_T1"],["PS_Guild","VS_Diffuse_T1_T2_T1","HS_T1_T2_T3","DS_T1_T2"],["PS_Guild_NoBorder","VS_Diffuse_T1_T2","HS_T1_T2","DS_T1_T2_T3"],["PS_Guild_Opaque","VS_Diffuse_T1_T2_T1","HS_T1_T2_T3","DS_T1_T2"],["PS_Illum","VS_Diffuse_T1_T1","HS_T1_T2","DS_T1_T2"],["PS_Combiners_Mod_Mod_Mod_Const","VS_Diffuse_T1_T2_T3","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Mod_Mod_Mod_Const","VS_Color_T1_T2_T3","HS_T1_T2_T3","DS_T1_T2_T3"],["PS_Combiners_Opaque","VS_Diffuse_T1","HS_T1","DS_T1"],["PS_Combiners_Mod_Mod2x","VS_Diffuse_EdgeFade_T1_T2","HS_T1_T2","DS_T1_T2"]];psCombiners={PS_Combiners_Add:[1,"_output.rgb = _input.rgb + tex0.rgb;","_output.a = _input.a + tex0.a;"],PS_Combiners_Decal:[1,"_output.rgb = mix(_input.rgb, tex0.rgb, _input.a);","_output.a = _input.a;"],PS_Combiners_Fade:[1,"_output.rgb = mix(tex0.rgb, _input.rgb, _input.a);","_output.a = _input.a;"],PS_Combiners_Mod:[1,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = _input.a * tex0.a;"],PS_Combiners_Mod2x:[1,"_output.rgb = _input.rgb * tex0.rgb * 2.0;","_output.a = _input.a * tex0.a * 2.0;"],PS_Combiners_Opaque:[1,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = _input.a;"],PS_Combiners_Add_Add:[2,"_output.rgb = (_input.rgb + tex0.rgb) + tex1.rgb;","_output.a = (_input.a + tex0.a) + tex1.a;"],PS_Combiners_Add_Mod:[2,"_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb;","_output.a = (_input.a + tex0.a) * tex1.a;"],PS_Combiners_Add_Mod2x:[2,"_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb * 2.0;","_output.a = (_input.a + tex0.a) * tex1.a * 2.0;"],PS_Combiners_Add_Opaque:[2,"_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb;","_output.a = _input.a + tex0.a;"],PS_Combiners_Mod_Add:[2,"_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;","_output.a = (_input.a * tex0.a) + tex1.a;"],PS_Combiners_Mod_AddNA:[2,"_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;","_output.a = _input.a * tex0.a;"],PS_Combiners_Mod_Mod:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = (_input.a * tex0.a) * tex1.a;"],PS_Combiners_Mod_Mod2x:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = (_input.a * tex0.a) * tex1.a * 2.0;"],PS_Combiners_Mod_Mod2xNA:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = _input.a * tex0.a;"],PS_Combiners_Mod_Opaque:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = _input.a * tex0.a;"],PS_Combiners_Mod2x_Add:[2,"_output.rgb = (_input.rgb * tex0.rgb) * 2 + tex1.rgb;","_output.a = (_input.a * tex0.a) * 2 + tex1.a;"],PS_Combiners_Mod2x_Mod2x:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 4.0;","_output.a = (_input.a * tex0.a) * tex1.a * 4.0;"],PS_Combiners_Mod2x_Opaque:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = _input.a * tex0.a * 2.0;"],PS_Combiners_Opaque_Add:[2,"_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;","_output.a = _input.a + tex1.a;"],PS_Combiners_Opaque_AddAlpha:[2,"_output.rgb = (_input.rgb * tex0.rgb) + (tex1.rgb * tex1.a);","_output.a = _input.a;"],PS_Combiners_Opaque_AddAlpha_Wgt:[2,"_output.rgb = (_input.rgb * tex0.rgb) + (tex1.rgb * tex1.a);","_output.a = _input.a;"],PS_Combiners_Opaque_AddAlpha_Alpha:[2,"_output.rgb = (_input.rgb * tex0.rgb) + (tex1.rgb * tex1.a * (1.0 - tex0.a));","_output.a = _input.a;"],PS_Combiners_Opaque_AddNA:[2,"_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;","_output.a = _input.a;"],PS_Combiners_Opaque_Mod:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = _input.a * tex1.a;"],PS_Combiners_Opaque_Mod2x:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = _input.a * tex1.a * 2.0;"],PS_Combiners_Opaque_Mod2xNA:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;","_output.a = _input.a;"],PS_Combiners_Opaque_Mod2xNA_Alpha:[2,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex0.rgb, vec3(tex0.a));","_output.a = _input.a;"],PS_Combiners_Opaque_Opaque:[2,"_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;","_output.a = _input.a;"],PS_Combiners_Opaque_Mod2xNA_Alpha_Add:[2,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex0.rgb, vec3(tex0.a));","_output.a = _input.a + tex1.a;"],PS_Combiners_Mod_Mod_Mod_Const:[3,"_output.rgb = _input.rgb * (tex0 * tex1 * tex2).rgb;","_output.a = _input.a * (tex0 * tex1 * tex2).a;"],PS_Combiners_Mod_AddAlpha:[2,"_output.rgb = (_input.rgb * tex0.rgb) + (tex1.rgb * tex1.a);","_output.a = _input.a * tex0.a;"],PS_Combiners_Mod_AddAlpha_Wgt:[2,"_output.rgb = (_input.rgb * tex0.rgb) + (tex1.rgb * tex1.a);","_output.a = _input.a * tex0.a;"],PS_Combiners_Mod_AddAlpha_Alpha:[2,"_output.rgb = _input.rgb * tex0.rgb + tex1.rgb * tex1.a * (1.0 - tex0.a);","_output.a = _input.a * (tex0.a + tex1.a * (0.3 * tex1.r + 0.59 * tex1.g + 0.11 * tex1.b));"],PS_Combiners_Opaque_Mod_Add_Wgt:[2,"_output.rgb = _input.rgb * mix(tex0.rgb, tex1.rgb, vec3(tex1.a)) + (tex0.rgb * tex0.a);","_output.a = _input.a;"],PS_Guild:[3,"_output.rgb = _input.rgb * mix(tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a)), tex2.rgb * vec3(1.0, 1.0, 1.0), vec3(tex2.a));","_output.a = _input.a * tex0.a;"],PS_Guild_Opaque:[3,"_output.rgb = _input.rgb * mix(tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a)), tex2.rgb * vec3(1.0, 1.0, 1.0), vec3(tex2.a));","_output.a = _input.a;"],PS_Guild_NoBorder:[2,"_output.rgb = _input.rgb * tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a));","_output.a = _input.a * tex0.a;"],PS_Combiners_Opaque_Alpha_Alpha:[2,"_output.rgb = _input.rgb * mix(mix(tex0.rgb, tex1.rgb, vec3(tex1.a)), tex0.rgb, vec3(tex0.a));","_output.a = _input.a;"],PS_Combiners_Opaque_Mod2xNA_Alpha_3s:[3,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.000000, tex2.rgb, vec3(tex2.a));","_output.a = _input.a;"],PS_Combiners_Mod_Add_Alpha:[2,"_output.rgb = _input.rgb * tex0.rgb + tex1.rgb * (1.000000 - tex0.a);","_output.a = _input.a * (tex0.a + tex1.a);"],PS_Combiners_Opaque_ModNA_Alpha:[2,"_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb, tex0.rgb, vec3(tex0.a));","_output.a = _input.a;"],PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha:[3,"float glowOpacity = clamp((tex2.a * vec4(1.0, 1.0, 1.0, 1.0).z), 0.0, 1.0); _output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.000000, tex0.rgb, vec3(tex0.a)) * (1.000000 - glowOpacity) + tex2.rgb * glowOpacity;","_output.a = _input.a;"],PS_Combiners_Opaque_Mod2xNA_Alpha_Alpha:[3,"_output.rgb = _input.rgb * mix(mix(tex0.rgb * tex1.rgb * 2.000000, tex2.rgb, vec3(tex2.a)), tex0.rgb, vec3(tex0.a));","_output.a = _input.a;"],PS_Combiners_Mod_Depth:[1,"_output.rgb = _input.rgb * tex0.rgb;","_output.a = _input.a * tex0.a;"],PS_Combiners_Opaque_Alpha:[2,"_output.rgb = _input.rgb * mix(tex0.rgb, tex1.rgb, vec3(tex1.a));","_output.a = _input.a;"]};return tool}();ZamModelViewer.Wow.Texture=function(model,index,file){var self=this,gl=model.renderer.context;self.model=model;self.index=index;self.url=model.opts.contentPath+"textures/"+file+".png";self.texture=null;self.alphaTexture=null;self.img=self.alphaImg=self.mergedImg=null;self.loaded=false;(function(self,gl){self.mergedImg=new Image;self.mergedImg.crossOrigin="";self.mergedImg.onload=function(){self.splitImages()};self.mergedImg.onerror=function(){self.mergedImg=null};self.mergedImg.src=self.url})(self,gl)};ZamModelViewer.Wow.Texture.prototype={ready:function(){return this.loaded},destroy:function(){var self=this;if(!self.model)return;var gl=self.model.renderer.context;if(self.texture)gl.deleteTexture(self.texture);if(self.alphaTexture)gl.deleteTexture(self.alphaTexture);self.texture=null;self.alphaTexture=null;self.img=self.alphaImg=self.mergedImg=null;self.model=null},splitImages:function(){var self=this;if(!self.model){return}var gl=self.model.renderer.context;var width=self.mergedImg.width,height=self.mergedImg.height;var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var ctx=canvas.getContext("2d");ctx.drawImage(self.mergedImg,0,0,width,height);var rgba=ctx.getImageData(0,0,width,height),p=rgba.data;var hasAlpha=false,alphaVal,i;for(i=0;i<p.length;i+=4){alphaVal=p[i+3];if(!hasAlpha&&alphaVal!=255){hasAlpha=true;break}}self.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.mergedImg);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);if(hasAlpha){self.alphaTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.alphaTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.mergedImg);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR)}self.loaded=true}};ZamModelViewer.Wow.Item=function(model,slot,id,race,gender){var self=this;self.model=model;self.slot=slot;self.uniqueSlot=ZamModelViewer.Wow.UniqueSlots[slot];self.sortValue=ZamModelViewer.Wow.SlotOrder[slot];self.models=null;self.textures=null;self.geosetGroup=null;self.flags=0;self.loaded=false;self.failed=false;self.visual=null;self.visualid=0;if(id){self.load(id,race,gender)}};ZamModelViewer.Wow.Item.prototype={destroy:function(){var self=this,i;if(self.models){for(i=0;i<self.models.length;++i){if(self.models[i].model)self.models[i].model.destroy();self.models[i].model=null;self.models[i].attachment=null;self.models[i]=null}self.models=null}if(self.textures){for(i=0;i<self.textures;++i){if(self.textures[i].texture)self.textures[i].texture.destroy();self.textures[i].texture=null;self.textures[i]=null}self.textures=null}self.geosetGroup=null;if(self.visual){self.visual.destroy();self.visual=null}self.loaded=false;if(self.collectionModel){self.collectionModel.isDirty=true;self.collectionModel=null}if(self.model){self.model.setup();self.model=null}},load:function(id,race,gender){var self=this,Wow=ZamModelViewer.Wow;self.id=id;self.race=race;self.gender=gender;var path="meta/item/";if(self.slot==Wow.Slots.HEAD||self.slot==Wow.Slots.SHOULDER||self.slot==Wow.Slots.SHIRT||self.slot==Wow.Slots.CHEST||self.slot==Wow.Slots.BELT||self.slot==Wow.Slots.PANTS||self.slot==Wow.Slots.BOOTS||self.slot==Wow.Slots.BRACERS||self.slot==Wow.Slots.HANDS||self.slot==Wow.Slots.CAPE||self.slot==Wow.Slots.TABARD||self.slot==Wow.Slots.ROBE){path="meta/armor/"+self.slot+"/"}var url=self.model.opts.contentPath+path+self.id+".json";$.getJSON(url).done(function(json){self.loadMeta(json)}).fail(function(jqxhr,textStatus,error){var err=textStatus+", "+error;console.log("Item:load Error loading metadata: "+err);self.failed=true})},loadMeta:function(meta){var self=this,Wow=ZamModelViewer.Wow;self.flags=parseInt(meta.Item.Flags);self.slot=parseInt(meta.Item.InventoryType);self.itemClass=parseInt(meta.Item.ItemClass);self.itemSubClass=parseInt(meta.Item.ItemSubClass);function selectBestTexture(textureid,gender,cls,race){var textures=meta.TextureFiles[textureid];for(i=0;i<textures.length;i++){var texture=textures[i];if(texture.Race!=0&&texture.Race==race&&(texture.Class!=0&&texture.Class==cls)&&(texture.Gender==gender||texture.Gender==3)){return texture.FileDataId}}for(i=0;i<textures.length;i++){var texture=textures[i];if(texture.Race!=0&&texture.Race==race&&(texture.Gender==gender||texture.Gender==3)){return texture.FileDataId}}for(i=0;i<textures.length;i++){var texture=textures[i];if(texture.Class!=0&&texture.Class==cls&&(texture.Gender==gender||texture.Gender==3)){return texture.FileDataId}}for(i=0;i<textures.length;i++){var texture=textures[i];if(texture.Gender==gender||texture.Gender==3){return texture.FileDataId}}console.log("selectBestTexture for "+textureid+", gender "+gender+", class "+cls+", race "+race+" failed!")}if(meta.ComponentTextures){self.textures=[];for(var r in meta.ComponentTextures){var region=parseInt(r);var texFile=selectBestTexture(meta.ComponentTextures[r],self.model.gender,self.model.class,self.model.race);if(texFile){var texture={region:region,gender:self.model.gender,file:texFile,texture:null};if(region!=Wow.Regions.Base){texture.texture=new Wow.Texture(self.model,r,texFile)}else if(self.slot==Wow.Slots.CAPE){self.model.textureOverrides[2]=new Wow.Texture(self.model,2,texFile)}}self.textures.push(texture)}}self.geosetGroup=meta.Item.GeosetGroup;if(self.slot==Wow.Slots.HEAD){var gender=self.model.gender;var hideGeoset=gender==0?meta.Item.HideGeosetMale:meta.Item.HideGeosetFemale;if(gender==0){self.HideGeosetMale=meta.Item.HideGeosetMale}else{self.HideGeosetFemale=meta.Item.HideGeosetFemale}}if(self.slot==Wow.Slots.SHOULDER){self.models=new Array(2)}else if(Wow.SlotType[self.slot]!=Wow.Types.ARMOR){self.models=new Array(1)}if(self.models){for(var i=0;i<self.models.length;++i){var model={race:self.race,gender:self.gender,bone:-1,attachment:null,model:null};var modelInfo={type:Wow.SlotType[self.slot],id:self.id,parent:self.model};if(self.slot==Wow.Slots.SHOULDER){modelInfo.shoulder=i+1}model.model=new Wow.Model(self.model.renderer,self.model.viewer,modelInfo,i,true);model.model.loadMeta(meta,modelInfo.type);self.models[i]=model}}if(self.slot==Wow.Slots.BELT&&meta.Model&&meta.Model!=0){var model={race:0,gender:0,bone:-1,attachment:null,model:null};var modelInfo={type:Wow.SlotType[self.slot],id:self.id,parent:self.model};model.model=new Wow.Model(self.model.renderer,self.model.viewer,modelInfo,0,true);model.model.loadMeta(meta,Wow.Types.ARMOR);self.models=[model]}if(self.slot==Wow.Slots.SHIRT||self.slot==Wow.Slots.CHEST||self.slot==Wow.Slots.ROBE||self.slot==Wow.Slots.BELT||self.slot==Wow.Slots.PANTS||self.slot==Wow.Slots.HANDS||self.slot==Wow.Slots.BOOTS||self.slot==Wow.Slots.HEAD){var componentIndex=0;if(self.slot==Wow.Slots.HEAD){componentIndex=1}if(meta.ComponentModels&&meta.ComponentModels[componentIndex]){var modelId=meta.ComponentModels[componentIndex];if(modelId&&meta.ModelFiles[modelId]){var modelInfo={type:Wow.SlotType[self.slot],id:self.id,parent:self.model};var model=new Wow.Model(self.model.renderer,self.model.viewer,modelInfo,0,true);model.meta=meta;model.isDirty=true;var race=1,gender=0,cls=1;if(self.model){race=self.model.race;gender=self.model.gender;cls=self.model.class}var modelFile=model.selectBestModel(modelId,gender,cls,race);if(modelFile){if(self.model){if(!self.model.collectionModels[modelFile]){self.model.collectionModels[modelFile]=model;self.collectionModel=model;model._load(ZamModelViewer.Wow.Types.PATH,modelFile)}else{self.collectionModel=self.model.collectionModels[modelFile]}}else{model._load(ZamModelViewer.Wow.Types.PATH,modelFile)}if(meta.Textures){for(i in meta.Textures){model.textureOverrides[i]=new model.Texture(model,parseInt(i),meta.Textures[i])}}}}}}if(self.slot==Wow.Slots.PANTS&&self.geosetGroup[2]>0){self.sortValue+=2}if(self.visualid!=0){self.visual=new Wow.ItemVisual(self.models[0].model,self.visualid)}self.loaded=true;self.model.updateMeshes()},setVisual:function(id){var self=this;if(self.visual){self.visual.destroy()}self.visualid=id}};ZamModelViewer.Wow.Vertex=function(r){var self=this;self.position=[r.getFloat(),r.getFloat(),r.getFloat()];self.normal=[r.getFloat(),r.getFloat(),r.getFloat(),0];self.u=r.getFloat();self.v=r.getFloat();self.u2=r.getFloat();self.v2=r.getFloat();self.weights=[r.getUint8(),r.getUint8(),r.getUint8(),r.getUint8()];self.bones=[r.getUint8(),r.getUint8(),r.getUint8(),r.getUint8()];self.transPosition=vec3.clone(self.position);self.transNormal=vec4.clone(self.normal)};ZamModelViewer.Wow.Vertex.prototype={destroy:function(){var self=this;self.position=null;self.normal=null;self.weights=null;self.bones=null;self.transPosition=null;self.transNormal=null}};ZamModelViewer.Wow.Animation=function(r){var self=this,Wow=ZamModelViewer.Wow;self.id=r.getUint16();self.subId=r.getUint16();self.flags=r.getUint32();self.length=r.getUint32();self.next=r.getInt16();self.index=r.getUint16();var available=r.getBool();if(available){self.name=r.getString()}};ZamModelViewer.Wow.Animation.prototype={destroy:function(){var self=this}};ZamModelViewer.Wow.Bone=function(model,index,r){var self=this,Wow=ZamModelViewer.Wow;self.model=model;self.index=index;self.keyId=r.getInt32();self.flags=r.getUint32();self.parent=r.getInt16();self.mesh=r.getUint16();self.id=r.getUint32();self.pivot=[r.getFloat(),r.getFloat(),r.getFloat()];self.translation=Wow.AnimatedVec3.readSet(r);self.rotation=Wow.AnimatedQuat.readSet(r);self.scale=Wow.AnimatedVec3.readSet(r);self.transformedPivot=vec3.create();self.matrix=mat4.create();self.tmpVec=vec3.create();self.tmpQuat=quat.create();self.tmpMat=mat4.create();self.hidden=false;self.updated=false};ZamModelViewer.Wow.Bone.prototype={destroy:function(){var self=this;self.model=null;self.pivot=null;self.transformedPivot=null;self.matrix=null;self.tmpVec=null;self.tmpQuat=null;self.tmpMat=null;for(var i=0;i<self.translation.length;++i){self.translation[i].destroy();self.translation[i]=null}for(var i=0;i<self.rotation.length;++i){self.rotation[i].destroy();self.rotation[i]=null}for(var i=0;i<self.scale.length;++i){self.scale[i].destroy();self.scale[i]=null}self.translation=null;self.rotation=null;self.scale=null},hide:function(){var self=this;self.hidden=true;for(var i=0;i<16;++i)self.matrix[i]=0},update:function(time){var self=this,Wow=ZamModelViewer.Wow;if(self.hidden){self.hide();return}if(self.updated||self.skipUpdate)return;self.updated=true;if(!self.model||!self.model.animations||self.model.animPaused)return;mat4.identity(self.matrix);var anim=self.model.currentAnimation;if(!anim)return;var billboard=(self.flags&8)!=0;var transUsed=Wow.Animated.isUsed(self.translation,anim.index);var rotUsed=Wow.Animated.isUsed(self.rotation,anim.index);var scaleUsed=Wow.Animated.isUsed(self.scale,anim.index);if(transUsed||rotUsed||scaleUsed||billboard){mat4.translate(self.matrix,self.matrix,self.pivot);if(transUsed){Wow.AnimatedVec3.getValue(self.translation,anim.index,time,self.tmpVec);mat4.translate(self.matrix,self.matrix,self.tmpVec)}if(rotUsed){Wow.AnimatedQuat.getValue(self.rotation,anim.index,time,self.tmpQuat);mat4.fromQuat(self.tmpMat,self.tmpQuat);mat4.transpose(self.tmpMat,self.tmpMat);mat4.multiply(self.matrix,self.matrix,self.tmpMat)}if(scaleUsed){Wow.AnimatedVec3.getValue(self.scale,anim.index,time,self.tmpVec);mat4.scale(self.matrix,self.matrix,self.tmpVec)}if(billboard){var yRot=-self.model.renderer.zenith+Math.PI/2;var zRot;if(self.model.model.type==Wow.Types.ITEM){zRot=self.model.renderer.azimuth-Math.PI}else{zRot=self.model.renderer.azimuth-Math.PI*1.5}mat4.identity(self.matrix);mat4.translate(self.matrix,self.matrix,self.pivot);mat4.rotateZ(self.matrix,self.matrix,zRot);mat4.rotateY(self.matrix,self.matrix,yRot)}mat4.translate(self.matrix,self.matrix,vec3.negate(self.tmpVec,self.pivot))}if(self.parent>-1){self.model.bones[self.parent].update(time);mat4.multiply(self.matrix,self.model.bones[self.parent].matrix,self.matrix)}vec3.transformMat4(self.transformedPivot,self.pivot,self.matrix)}};ZamModelViewer.Wow.Mesh=function(r){var self=this;self.id=r.getUint16();self.indexWrap=r.getUint16();self.vertexStart=r.getUint16();self.vertexCount=r.getUint16();self.indexStart=r.getUint16()+self.indexWrap*65536;self.indexCount=r.getUint16();self.centerOfMass=[r.getFloat(),r.getFloat(),r.getFloat()];self.centerBounds=[r.getFloat(),r.getFloat(),r.getFloat()];self.radius=r.getFloat()};ZamModelViewer.Wow.Mesh.prototype={destroy:function(){var self=this;self.centerOfMass=null;self.centerBounds=null}};ZamModelViewer.Wow.TexUnit=function(r){var self=this;self.flags=r.getUint8();self.priorityPlane=r.getUint8();self.shaderId=r.getUint16();self.meshIndex=r.getUint16();self.geosetIndex=r.getUint16();self.colorIndex=r.getInt16();self.renderFlagIndex=r.getUint16();self.materialLayer=r.getUint16();self.opcount=r.getUint16();self.materialIndex=r.getInt16();self.texUnitIndex=r.getUint16();self.alphaIndex=r.getInt16();self.textureAnimIndex=r.getInt16();self.show=true;self.model=null;self.mesh=null;self.meshId=0;self.renderFlag=null;self.material=[];self.textureAnim=[];self.textureMatrix=mat4.create();self.color=null;self.alpha=null;self.unlit=false;self.cull=false;self.noZWrite=false;self.tmpColor=vec4.create();self.tmpVec=vec3.create();self.tmpQuat=quat.create()};var getTextures=function(self){var count=0;var texture1=null;var texture2=null;var texture3=null;var texture4=null;for(var i in self.material){var texture=null;if(self.material[i]){if(self.material[i].type==1){if(self.model.npcTexture){texture=self.model.npcTexture}else if(self.model.compositeTexture){texture={texture:self.model.compositeTexture}}}else if(self.material[i].texture){texture=self.material[i].texture}else if(((self.model.model.type<8||self.model.model.type>32)&&self.material[i].type==2||self.material[i].type>=11)&&self.model.textureOverrides[self.material[i].index]){texture=self.model.textureOverrides[self.material[i].index]}else if(self.material[i].type!=-1&&self.model.textureOverrides[self.material[i].type]){texture=self.model.textureOverrides[self.material[i].type]}else if(self.material[i].type!=-1&&self.model.specialTextures[self.material[i].type]){texture=self.model.specialTextures[self.material[i].type]}else if(!self.material[i].filename){var mat=self.model.materials[self.materialIndex+count];if(mat&&mat.texture){texture=mat.texture}}}if(i==0)texture1=texture;if(i==1)texture2=texture;if(i==2)texture3=texture;if(i==3)texture4=texture;count++}var textures={Texture1:{texture:texture1,location:0},Texture2:{texture:texture2,location:1},Texture3:{texture:texture3,location:2},Texture4:{texture:texture4,location:3}};for(var i in textures){var td=textures[i];td.uniform="u"+i;td.unit="TEXTURE"+td.location}return textures};ZamModelViewer.Wow.TexUnit.prototype={setup:function(model){var self=this;self.model=model;self.mesh=model.meshes[self.meshIndex];self.meshId=self.mesh.id;ZamModelViewer.Wow.RenderFlag.ComputeFlags(self);window.MeshLoadFilter&&window.MeshLoadFilter(self);var program=ZamModelViewer.Wow.ShaderTool.GetWowProgram(self.shaderId,self.opcount,self.renderFlag);self.program=program;for(var i=0;i<self.opcount;i++){if(self.materialIndex>-1&&self.materialIndex<model.materialLookup.length){var matIdx=model.materialLookup[self.materialIndex+i];if(matIdx>-1&&matIdx<model.materials.length){self.material.splice(i,0,model.materials[matIdx])}}if(self.textureAnimIndex>-1&&self.textureAnimIndex<model.textureAnimLookup.length){var animIdx=model.textureAnimLookup[self.textureAnimIndex+i]
;if(animIdx>-1&&model.textureAnims&&animIdx<model.textureAnims.length){self.textureAnim.splice(i,0,model.textureAnims[animIdx])}else{self.textureAnim.splice(i,0,null)}}}if(self.flip){self.material=self.material.reverse();self.textureAnim=self.textureAnim.reverse()}if(model.colors&&self.colorIndex>-1&&self.colorIndex<model.colors.length){self.color=model.colors[self.colorIndex]}if(self.alphaIndex>-1&&self.alphaIndex<model.alphaLookup.length){var alphaIdx=model.alphaLookup[self.alphaIndex];if(alphaIdx>-1&&alphaIdx<model.alphas.length){self.alpha=model.alphas[alphaIdx]}}},prepareProgram:function(){var self=this,gl=self.model.renderer.context;var programInfo=ZamModelViewer.Tools.GetProgram(gl,self.program.name,self.program.config);self.programInfo=programInfo;self.program=programInfo.program;self.uniforms=programInfo.uniforms},setBlendMode:function(gl){var blend=this.renderFlag.blend;if(blend==0){gl.disable(gl.BLEND)}else{gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD)}switch(blend){case 0:break;case 1:gl.blendFunc(gl.ONE,gl.ZERO);break;case 2:gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case 3:gl.blendFuncSeparate(gl.SRC_COLOR,gl.DST_COLOR,gl.SRC_ALPHA,gl.DST_ALPHA);break;case 4:gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE,gl.ZERO,gl.ONE);break;case 5:gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case 6:gl.blendFuncSeparate(gl.DST_COLOR,gl.SRC_COLOR,gl.DST_ALPHA,gl.SRC_ALPHA);break;case 7:gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);break;default:throw 3735927486}},draw:function(){var self=this,model=self.model,gl=self.model.renderer.context,anim=self.model.currentAnimation.index,time=self.model.time;self.programInfo||self.prepareProgram();if(!self.programInfo.program)return;gl.useProgram(self.programInfo.program);model.attributeState.enable(gl,self.programInfo.attributes);twgl.setUniforms(self.programInfo,model.sceneState);self.tmpColor[0]=self.tmpColor[1]=self.tmpColor[2]=self.tmpColor[3]=1;if(self.color){self.color.getValue(anim,time,self.tmpColor)}if(self.alpha){self.tmpColor[3]*=self.alpha.getValue(anim,time)}if(self.tmpColor[3]<=.001)return;var blend=self.renderFlag.blend;var uniforms=self.programInfo.uniforms;gl.uniform4fv(uniforms.uColor,self.tmpColor);gl.uniform1i(uniforms.uBlendMode,blend);gl.uniform1i(uniforms.uUnlit,self.unlit);var textures=getTextures(self);var loadedTextures=true;for(var tn in textures){var td=textures[tn];var c=td.location;var tx=td.texture&&td.texture.texture;loadedTextures=loadedTextures&&(!td.texture||tx);if(tx){gl.activeTexture(gl[td.unit]);gl.bindTexture(gl.TEXTURE_2D,tx);gl.uniform1i(uniforms[td.uniform],c)}gl.uniform1i(uniforms["uHas"+tn],td.texture?1:0)}if(loadedTextures&&!self.loadedTextures){self.loadedTextures=true}for(var i in self.textureAnim){mat4.identity(self.textureMatrix);if(self.textureAnim[i]){var rotTrans=false;if(self.textureAnim[i].translation&&ZamModelViewer.Wow.Animated.isUsed(self.textureAnim[i].translation,anim)){ZamModelViewer.Wow.AnimatedVec3.getValue(self.textureAnim[i].translation,anim,time,self.tmpVec);rotTrans=true}else{vec3.set(self.tmpVec,0,0,0)}if(self.textureAnim[i].rotation&&ZamModelViewer.Wow.Animated.isUsed(self.textureAnim[i].rotation,anim)){ZamModelViewer.Wow.AnimatedQuat.getValue(self.textureAnim[i].rotation,anim,time,self.tmpQuat);rotTrans=true}else{quat.set(self.tmpQuat,0,0,0,1)}if(rotTrans)mat4.fromRotationTranslation(self.textureMatrix,self.tmpQuat,self.tmpVec);if(self.textureAnim[i].scale&&ZamModelViewer.Wow.Animated.isUsed(self.textureAnim[i].scale,anim)){ZamModelViewer.Wow.AnimatedVec3.getValue(self.textureAnim[i].scale,anim,time,self.tmpVec);mat4.scale(self.textureMatrix,self.textureMatrix,self.tmpVec)}}gl.uniformMatrix4fv(uniforms["uTextureMatrix"+(i*1+1)],false,self.textureMatrix)}self.setBlendMode(gl);if(self.cull){gl.enable(gl.CULL_FACE)}else{gl.disable(gl.CULL_FACE)}gl.depthMask(!self.noZWrite);gl.depthFunc(gl.LEQUAL);gl.drawElements(gl.TRIANGLES,self.mesh.indexCount,gl.UNSIGNED_SHORT,self.mesh.indexStart*2);model.attributeState.disableAll()},destroy:function(){var self=this;self.model=null;self.mesh=null;self.renderFlag=null;self.material=null;self.textureAnim=null;self.color=null;self.alpha=null;self.tmpColor=null;self.textureMatrix=null;self.tmpVec=null;self.tmpQuat=null}};ZamModelViewer.Wow.RenderFlag=function(r){var self=this;self.flags=r.getUint16();self.blend=r.getUint16()};ZamModelViewer.Wow.RenderFlag.ComputeFlags=function(self){Object.assign(self,{flip:false,noZWrite:false,cull:true,unlit:false});if(self.model.renderFlags&&self.renderFlagIndex<self.model.renderFlags.length){self.renderFlag=self.model.renderFlags[self.renderFlagIndex]}else{self.renderFlag={flags:0,blend:0}}self.unlit=(self.renderFlag.flags&1)!=0;self.cull=(self.renderFlag.flags&4)==0;self.noZWrite=(self.renderFlag.flags&16)!=0};ZamModelViewer.Wow.Material=function(model,index,r){var self=this;self.model=model;self.index=index;self.type=r.getInt32();self.flags=r.getUint32();self.filename=r.getUint32();self.texture=null;self.load()};ZamModelViewer.Wow.Material.prototype={destroy:function(){var self=this;self.model=null;if(self.texture)self.texture.destroy();self.texture=null},load:function(){var self=this;if(self.filename==0)return;self.texture=new ZamModelViewer.Wow.Texture(self.model,0,self.filename)}};ZamModelViewer.Wow.TextureAnimation=function(r){var Wow=ZamModelViewer.Wow;var self=this,i;var numTrans=r.getInt32();if(numTrans>0){self.translation=new Array(numTrans);for(i=0;i<numTrans;++i)self.translation[i]=new Wow.AnimatedVec3(r)}else self.translation=null;var numRot=r.getInt32();if(numRot>0){self.rotation=new Array(numRot);for(i=0;i<numRot;++i)self.rotation[i]=new Wow.AnimatedQuat(r)}else self.rotation=null;var numScale=r.getInt32();if(numScale>0){self.scale=new Array(numScale);for(i=0;i<numScale;++i)self.scale[i]=new Wow.AnimatedVec3(r)}else self.scale=null};ZamModelViewer.Wow.TextureAnimation.prototype={destroy:function(){var self=this,i;if(self.translation){for(i=0;i<self.translation.length;++i)self.translation[i]=self.translation[i].destroy();self.translation=null}if(self.rotation){for(i=0;i<self.rotation.length;++i)self.rotation[i]=self.rotation[i].destroy();self.rotation=null}if(self.scale){for(i=0;i<self.scale.length;++i)self.scale[i]=self.scale[i].destroy();self.scale=null}}};ZamModelViewer.Wow.Attachment=function(r){var self=this;self.id=r.getInt32();self.bone=r.getInt32();self.position=[r.getFloat(),r.getFloat(),r.getFloat()];self.slot=-1};ZamModelViewer.Wow.Attachment.prototype={destroy:function(){var self=this;self.position=null}};ZamModelViewer.Wow.Color=function(r){var Wow=ZamModelViewer.Wow;var self=this,i;var numRgb=r.getInt32();if(numRgb>0){self.rgb=new Array(numRgb);for(i=0;i<numRgb;++i){self.rgb[i]=new Wow.AnimatedVec3(r)}}var numAlpha=r.getInt32();if(numAlpha>0){self.alpha=new Array(numAlpha);for(i=0;i<numAlpha;++i){self.alpha[i]=new Wow.AnimatedUint16(r)}}};ZamModelViewer.Wow.Color.prototype={destroy:function(){var self=this,i;if(self.rgb){for(i=0;i<self.rgb.length;++i)self.rgb[i]=self.rgb[i].destroy();self.rgb=null}if(self.alpha){for(i=0;i<self.alpha.length;++i)self.alpha[i]=self.alpha[i].destroy();self.alpha=null}},rgbUsed:function(anim){var self=this;if(!self.rgb)return false;if(anim<self.rgb.length)return self.rgb[anim].used;else return self.rgb[0].used},alphaUsed:function(anim){var self=this;if(!self.alpha)return false;if(anim<self.alpha.length)return self.alpha[anim].used;else return self.alpha[0].used},used:function(anim){var self=this;return self.rgbUsed(anim)||self.alphaUsed(anim)},getValue:function(anim,time,result){var self=this;if(!result)result=[1,1,1,1];else result[0]=result[1]=result[2]=result[3]=1;if(self.rgbUsed(anim))ZamModelViewer.Wow.AnimatedVec3.getValue(self.rgb,anim,time,result);if(self.alphaUsed(anim))result[3]=ZamModelViewer.Wow.AnimatedUint16.getValue(self.alpha,anim,time,result[3])/32767;return result}};ZamModelViewer.Wow.Alpha=function(r){var self=this;var count=r.getInt32();self.data=new Array(count);for(var i=0;i<count;++i){self.data[i]=new ZamModelViewer.Wow.AnimatedUint16(r)}};ZamModelViewer.Wow.Alpha.prototype={destroy:function(){var self=this;for(var i=0;i<self.data.length;++i)self.data[i]=self.data[i].destroy();self.data=null},used:function(anim){var self=this;if(self.data.length==0)return false;if(anim<self.data.length)return self.data[anim].used;else return self.data[0].used},getValue:function(anim,time){var self=this,a=1;if(self.used(anim)){var val=ZamModelViewer.Wow.AnimatedUint16.getValue(self.data,anim,time,a);a=val/32767}if(a>1)a=1;else if(a<0)a=0;return a}};ZamModelViewer.Wow.Particle=function(emitter){var self=this,Wow=ZamModelViewer.Wow;self.emitter=emitter;self.uuid=(new Date).getTime()};ZamModelViewer.Wow.Particle.prototype={destroy:function(){var self=this,gl=self.emitter.model.renderer.context;if(self.program)gl.deleteProgram(self.program);if(self.vs)gl.deleteShader(self.vs);if(self.fs)gl.deleteShader(self.fs);if(self.vb)gl.deleteBuffer(self.vb);if(self.ib)gl.deleteBuffer(self.ib);self.program=null;self.vs=null;self.fs=null;self.vb=null;self.ib=null;self.vbData=null;self.texture=null;self.attribs=null;self.uniforms=null},updateBuffers:function(){var self=this,gl=self.emitter.model.renderer.context,i,j;if(!self.vbData){self.vbData=new Float32Array(self.emitter.maxParticles*11);var ibData=new Uint16Array(self.emitter.maxParticles*6);var vert=0;for(i=0;i<self.emitter.maxParticles;++i){ibData[i*6+0]=vert;ibData[i*6+1]=vert+1;ibData[i*6+2]=vert+2;ibData[i*6+3]=vert+2;ibData[i*6+4]=vert+1;ibData[i*6+5]=vert+3;vert+=4}self.ib=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,ibData,gl.STATIC_DRAW)}self.emitter.numParticles=0;var p,idx=0,tc,vbData=self.vbData;if((self.emitter.flags&262144)==0){for(i=0;i<self.emitter.maxParticles;++i){p=self.emitter.particles[i];if(!p||p.maxLife==0)continue;tc=self.emitter.textureCoords[p.tile];for(j=0;j<4;++j){vbData[idx+0]=p.position[0];vbData[idx+1]=p.position[1];vbData[idx+2]=p.position[2];vbData[idx+3]=p.color[0];vbData[idx+4]=p.color[1];vbData[idx+5]=p.color[2];vbData[idx+6]=p.color[3];vbData[idx+7]=tc[j].x;vbData[idx+8]=tc[j].y;vbData[idx+9]=tc[j].z*p.size[0];vbData[idx+10]=tc[j].w*p.size[1];idx+=11}self.emitter.numParticles++}}else{for(i=0;i<self.emitter.maxParticles;++i){p=self.emitter.particles[i];if(!p||p.maxLife==0)continue;tc=self.emitter.textureCoords[p.tile];vbData[idx+0]=p.position[0];vbData[idx+1]=p.position[1];vbData[idx+2]=p.position[2];vbData[idx+11]=p.position[0];vbData[idx+12]=p.position[1];vbData[idx+13]=p.position[2];vbData[idx+22]=p.origin[0];vbData[idx+23]=p.origin[1];vbData[idx+24]=p.origin[2];vbData[idx+33]=p.origin[0];vbData[idx+34]=p.origin[1];vbData[idx+35]=p.origin[2];for(j=0;j<4;++j){vbData[idx+3]=p.color[0];vbData[idx+4]=p.color[1];vbData[idx+5]=p.color[2];vbData[idx+6]=p.color[3];vbData[idx+7]=tc[j].x;vbData[idx+8]=tc[j].y;vbData[idx+9]=tc[j].z*p.size[0];vbData[idx+10]=tc[j].w*p.size[1];idx+=11}self.emitter.numParticles++}}if(!self.vb){self.vb=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferData(gl.ARRAY_BUFFER,self.vbData,gl.DYNAMIC_DRAW)}else{gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferSubData(gl.ARRAY_BUFFER,0,self.vbData)}},draw:function(){var self=this,gl=self.emitter.model.renderer.context,i;if(self.emitter.numParticles==0)return;if(!self.shaderReady)self.initShader();if(!self.program)return;if(!self.emitter.texture){if((self.emitter.flags&268435456)!=0){WH.debug("multitexture particle",self.emitter.textureIds[0],self.emitter.textureIds[1],self.emitter.textureIds[2]);for(i=0;i<self.emitter.textureIds.length;i++){var textureId=self.emitter.textureIds[i];if(textureId>-1&&textureId<self.emitter.model.materials.length){var mat=self.emitter.model.materials[textureId];if(mat&&mat.texture&&mat.texture.texture&&(!mat.texture.alphaImg||mat.texture.alphaTexture)){if(i==0)self.emitter.texture=mat.texture;else if(i==1)self.emitter.texture2=mat.texture;else self.emitter.texture3=mat.texture}}}}else if(self.emitter.textureId>-1&&self.emitter.textureId<self.emitter.model.materials.length){var mat=self.emitter.model.materials[self.emitter.textureId];if(mat.texture&&mat.texture.texture&&(!mat.texture.alphaImg||mat.texture.alphaTexture)){self.emitter.texture=mat.texture}}}if(!self.emitter.texture)return;gl.useProgram(self.program);gl.uniformMatrix4fv(self.uniforms.vModelMatrix,false,self.matrix);gl.uniformMatrix4fv(self.uniforms.vViewMatrix,false,self.emitter.model.renderer.viewMatrix);gl.uniformMatrix4fv(self.uniforms.vProjMatrix,false,self.emitter.model.renderer.projMatrix);gl.uniform1i(self.uniforms.fBlendMode,self.emitter.blendMode);if(self.emitter.texture){gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,self.emitter.texture.texture);gl.uniform1i(self.uniforms.fTexture,0)}if(self.emitter.texture&&self.emitter.texture.alphaTexture){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,self.emitter.texture.alphaTexture);gl.uniform1i(self.uniforms.fAlpha,1)}if(self.emitter.texture2){gl.activeTexture(gl.TEXTURE2);gl.bindTexture(gl.TEXTURE_2D,self.emitter.texture2.texture);gl.uniform1i(self.uniforms.fTexture2,2)}if(self.emitter.texture3){gl.activeTexture(gl.TEXTURE3);gl.bindTexture(gl.TEXTURE_2D,self.emitter.texture3.texture);gl.uniform1i(self.uniforms.fTexture3,3)}gl.uniform1i(self.uniforms.fHasTexture,self.emitter.texture?1:0);gl.uniform1i(self.uniforms.fHasTexture2,self.emitter.texture2?1:0);gl.uniform1i(self.uniforms.fHasTexture3,self.emitter.texture3?1:0);gl.uniform1i(self.uniforms.fHasAlpha,self.emitter.texture&&self.emitter.texture.alphaTexture?1:0);var blend=self.emitter.blendMode;if(blend==0||blend==1){gl.blendFunc(gl.ONE,gl.ZERO)}else if(blend==2){gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}else if(blend==3){gl.blendFunc(gl.SRC_COLOR,gl.ONE)}else if(blend==4){gl.blendFunc(gl.SRC_ALPHA,gl.ONE)}else if(blend==5||blend==6){gl.blendFunc(gl.DST_COLOR,gl.SRC_COLOR)}else{gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}if(self.emitter.model.modelPath==166109){gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}gl.disable(gl.CULL_FACE);gl.depthMask(false);gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);for(i in self.attribs){var a=self.attribs[i];gl.enableVertexAttribArray(a.loc);gl.vertexAttribPointer(a.loc,a.size,a.type,false,a.stride,a.offset)}gl.drawElements(gl.TRIANGLES,self.emitter.numParticles*6,gl.UNSIGNED_SHORT,0);for(i in self.attribs){gl.disableVertexAttribArray(self.attribs[i].loc)}},initShader:function(){var self=this,gl=self.emitter.model.renderer.context;self.shaderReady=true;var vs=self.emitter.model.renderer.compileShader(gl.VERTEX_SHADER,self.vertShader);var fs=self.emitter.model.renderer.compileShader(gl.FRAGMENT_SHADER,self.fragShader);var program=gl.createProgram();gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Error linking shaders");return}self.vs=vs;self.fs=fs;self.program=program;self.uniforms={vModelMatrix:gl.getUniformLocation(program,"uModelMatrix"),vViewMatrix:gl.getUniformLocation(program,"uViewMatrix"),vProjMatrix:gl.getUniformLocation(program,"uProjMatrix"),fHasTexture:gl.getUniformLocation(program,"uHasTexture"),fHasTexture2:gl.getUniformLocation(program,"uHasTexture2"),fHasTexture3:gl.getUniformLocation(program,"uHasTexture3"),fHasAlpha:gl.getUniformLocation(program,"uHasAlpha"),fBlendMode:gl.getUniformLocation(program,"uBlendMode"),fTexture:gl.getUniformLocation(program,"uTexture"),fTexture2:gl.getUniformLocation(program,"uTexture2"),fTexture3:gl.getUniformLocation(program,"uTexture3"),fAlpha:gl.getUniformLocation(program,"uAlpha")};self.attribs={position:{loc:gl.getAttribLocation(program,"aPosition"),type:gl.FLOAT,size:3,offset:0,stride:44},normal:{loc:gl.getAttribLocation(program,"aColor"),type:gl.FLOAT,size:4,offset:12,stride:44},texcoord:{loc:gl.getAttribLocation(program,"aTexCoord"),type:gl.FLOAT,size:4,offset:28,stride:44}}},vertShader:"        attribute vec3 aPosition;        attribute vec4 aColor;        attribute vec4 aTexCoord;                varying vec4 vColor;        varying vec2 vTexCoord;                uniform mat4 uModelMatrix;        uniform mat4 uViewMatrix;        uniform mat4 uProjMatrix;                void main(void) {            vec4 pos = uViewMatrix * uModelMatrix * vec4(aPosition, 1);            pos.xy += aTexCoord.zw;            gl_Position = uProjMatrix * pos;                        vTexCoord = aTexCoord.xy;            vColor = aColor;        }    ",fragShader:"        precision mediump float;                varying vec4 vColor;        varying vec2 vTexCoord;                uniform bool uHasTexture;        uniform bool uHasTexture2;        uniform bool uHasTexture3;        uniform bool uHasAlpha;        uniform int uBlendMode;        uniform sampler2D uTexture;        uniform sampler2D uTexture2;        uniform sampler2D uTexture3;        uniform sampler2D uAlpha;                void main(void) {            float lo_thresh = 0.01;            vec4 color = vec4(1, 1, 1, 1);            if (uHasTexture) {                color = texture2D(uTexture, vTexCoord.st);            }            if (uHasTexture2) {                color *= texture2D(uTexture2, vTexCoord.st);            }            if (uHasTexture3) {                color *= texture2D(uTexture3, vTexCoord.st);            }            if (uBlendMode == 7) {                vec4 color2 = vec4(4, 4, 4, 4);                color *= color2;            }                        if (uHasAlpha) {                color.a = texture2D(uAlpha, vTexCoord.st).a;            } else {                color.a = 1.0;                if (color.r < lo_thresh && color.g < lo_thresh && color.b < lo_thresh) {                    color.a = 0.0;                }            }            color *= vColor;            if (color.a < lo_thresh) { discard; }                        gl_FragColor = color;        }    ",update:function(anim,time,delta){var self=this,Wow=ZamModelViewer.Wow;var grav=Wow.AnimatedVec3.getValue(self.emitter.gravity,anim,time);var deaccel=Wow.AnimatedFloat.getValue(self.emitter.gravity2,anim,time);var speed,i,j;if(self.emitter.emitterType==1||self.emitter.emitterType==2){var rate=Wow.AnimatedFloat.getValue(self.emitter.emissionRate,anim,time);var life=Wow.AnimatedFloat.getValue(self.emitter.lifespan,anim,time);var toSpawn=0;if(life!=0)toSpawn=delta*rate/life+self.emitter.spawnRemainder;else toSpawn=self.emitter.spawnRemainder;if(toSpawn<1){self.emitter.spawnRemainder=toSpawn;if(self.emitter.spawnRemainder<0)self.emitter.spawnRemainder=0}else{var count=Math.min(Math.floor(toSpawn),self.emitter.nextParticle+1);self.emitter.spawnRemainder=toSpawn-count;var en=true;if(Wow.Animated.isUsed(self.emitter.enabled,anim))en=Wow.AnimatedUint8.getValue(self.emitter.enabled,anim,time)!=0;if(en&&count>0){var w=Wow.AnimatedFloat.getValue(self.emitter.areaWidth,anim,time)*.5;var l=Wow.AnimatedFloat.getValue(self.emitter.areaLength,anim,time)*.5;speed=Wow.AnimatedFloat.getValue(self.emitter.emissionSpeed,anim,time);var vary=Wow.AnimatedFloat.getValue(self.emitter.speedVariation,anim,time);if(self.emitter.emitterType==1){for(i=0;i<count;++i){self.emitter.spawnPlaneParticle(w,l,speed,vary,life)}}else{var vSpread=Wow.AnimatedFloat.getValue(self.emitter.verticalRange,anim,time);var hSpread=Wow.AnimatedFloat.getValue(self.emitter.horizontalRange,anim,time);for(i=0;i<count;++i){self.emitter.spawnSphereParticle(w,l,speed,vary,vSpread,hSpread)}}}}if(isNaN(self.emitter.spawnRemainder))self.emitter.spawnRemainder=0}speed=1;var deaccelDelta=deaccel*delta;var speedDelta=speed*delta;var p,lifePos,limit,v,s1,s2,s3;s1=self.emitter.size.data[0];if(self.emitter.size.data.length>2){s2=self.emitter.size.data[1];s3=self.emitter.size.data[2]}else if(self.emitter.size.data.length>1){s2=self.emitter.size.data[1];s3=s2}else{s3=s2=s1}for(i=0;i<self.emitter.maxParticles;++i){p=self.emitter.particles[i];if(!p||p.maxLife==0)continue;p.origLife=p.life;p.life+=delta;lifePos=p.life/p.maxLife;if(lifePos>=1){p.maxLife=0;self.emitter.nextParticle++;self.emitter.unusedParticles[self.emitter.nextParticle]=p.index;continue}if(lifePos<=.5){vec2.lerp(p.size,s1,s2,lifePos/.5)}else{vec2.lerp(p.size,s2,s3,(lifePos-.5)/.5)}if(self.emitter.particleColors){for(j=0;j<3;++j){v=self.emitter.particleColors[j];if(j<self.emitter.alpha.data.length)vec4.set(self.emitter.tmpColors[j],v[0],v[1],v[2],v[3]*(self.emitter.alpha.data[j]/32767));else vec4.set(self.emitter.tmpColors[j],v[0],v[1],v[2],v[3])}}else{limit=Math.min(3,self.emitter.color.data.length);for(j=0;j<limit;++j){v=self.emitter.color.data[j];vec4.set(self.emitter.tmpColors[j],v[0]/255,v[1]/255,v[2]/255,self.emitter.alpha.data[j]/32767)}if(limit<3){v=self.emitter.color.data[limit-1];for(j=limit;j<3;++j)vec4.set(self.emitter.tmpColors[j],v[0]/255,v[1]/255,v[2]/255,self.emitter.alpha.data[j]/32767)}}if(lifePos<=.5){vec4.lerp(p.color,self.emitter.tmpColors[0],self.emitter.tmpColors[1],lifePos/.5)}else{vec4.lerp(p.color,self.emitter.tmpColors[1],self.emitter.tmpColors[2],(lifePos-.5)/.5)}if(lifePos>.5){p.color[3]*=1-(lifePos-.5)/.5}if(grav){self.matrix=mat4.create();if(p.origLife<1e-4){vec3.add(p.position,p.position,self.emitter.lastP);vec3.add(p.speed,p.speed,self.emitter._v)}var SPEEDLIMIT=.5;if(vec3.length(p.speed)>SPEEDLIMIT){p.speed=vec3.scale(vec3.create(),p.speed,SPEEDLIMIT/vec3.length(p.speed))}vec3.scaleAndAdd(p.speed,p.speed,p.direction,-deaccelDelta);if(self.emitter.slowdown>0){speed=Math.exp(-1*self.emitter.slowdown*p.life);speedDelta=speed*delta}vec3.scaleAndAdd(p.position,p.position,p.speed,speedDelta);vec3.scaleAndAdd(p.position,p.position,grav,.5*delta*delta)}else{self.matrix=self.emitter.model.matrix;vec3.scaleAndAdd(p.speed,p.speed,p.direction,-deaccelDelta);if(self.emitter.slowdown>0){speed=Math.exp(-1*self.emitter.slowdown*p.life);speedDelta=speed*delta}vec3.scaleAndAdd(p.position,p.position,p.speed,speedDelta)}}self.updateBuffers()}};ZamModelViewer.Wow.RibbonEmitter=function(model,r){var self=this,Wow=ZamModelViewer.Wow,i;self.model=model;self.id=r.getInt32();self.boneId=r.getInt32();self.position=[r.getFloat(),r.getFloat(),r.getFloat()];self.resolution=r.getFloat();self.length=r.getFloat();self.emissionAngle=r.getFloat();self.s1=r.getInt16();self.s2=r.getInt16();var count=r.getInt32();if(count>0){self.textureIds=new Array(count);for(i=0;i<count;++i){self.textureIds[i]=r.getInt32()}}self.color=Wow.AnimatedVec3.readSet(r);self.alpha=Wow.AnimatedUint16.readSet(r);self.above=Wow.AnimatedFloat.readSet(r);self.below=Wow.AnimatedFloat.readSet(r);self.bone=self.model.bones[self.boneId];self.maxSegments=50;self.segments=new Array(self.maxSegments);for(i=0;i<self.maxSegments;++i){self.segments[i]={position:vec3.create(),start:vec3.create(),up:vec4.create(),length:0}}self.currentSegment=0;self.numSegments=0;self.totalLength=self.resolution/self.length;self.currentPosition=vec3.clone(self.position);self.currentColor=vec4.create();self.currentAbove=0;self.currentBelow=0;self.currentLength=0;self.tmpPosition=vec3.create();self.tmpUp=vec4.create();self.tmpVec=vec4.create()};ZamModelViewer.Wow.RibbonEmitter.prototype={destroy:function(){var self=this,gl=self.model.renderer.context,Animated=ZamModelViewer.Wow.Animated;if(self.program)gl.deleteProgram(self.program);if(self.vs)gl.deleteShader(self.vs);if(self.fs)gl.deleteShader(self.fs);if(self.vb)gl.deleteBuffer(self.vb);if(self.ib)gl.deleteBuffer(self.ib);self.program=null;self.vs=null;self.fs=null;self.vb=null;self.ib=null;self.vbData=null;self.uniforms=null;self.attribs=null;self.texture=null;self.model=null;self.bone=null;self.position=null;self.textureIds=null;for(var i=0;i<self.maxSegments;++i){self.segments[i].position=null;self.segments[i].start=null;self.segments[i].up=null;self.segments[i]=null}self.segments=null;self.currentPosition=null;self.currentColor=null;self.tmpPosition=null;self.tmpUp=null;self.tmpVec=null;self.color=Animated.destroySet(self.color);self.alpha=Animated.destroySet(self.alpha);self.above=Animated.destroySet(self.above);self.below=Animated.destroySet(self.below)},updateBuffers:function(){var self=this,gl=self.model.renderer.context,i,j;if(!self.vbData){self.vbData=new Float32Array((self.maxSegments*2+2)*5);var ibData=new Uint16Array(self.maxSegments*6);var vert=0;for(i=0;i<self.maxSegments;++i){ibData[i*6+0]=vert;ibData[i*6+1]=vert+1;ibData[i*6+2]=vert+2;ibData[i*6+3]=vert+2;ibData[i*6+4]=vert+1;ibData[i*6+5]=vert+3;vert+=2}self.ib=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,ibData,gl.STATIC_DRAW)}if(self.numSegments==0)return;var s=self.segments[self.currentSegment],n=0,u,u2,l=0,vbData=self.vbData;var above=self.currentAbove,below=self.currentBelow;vbData[n]=s.start[0]+s.up[0]*above;vbData[n+1]=s.start[1]+s.up[1]*above;vbData[n+2]=s.start[2]+s.up[2]*above;vbData[n+3]=1;vbData[n+4]=0;n+=5;vbData[n]=s.start[0]-s.up[0]*below;vbData[n+1]=s.start[1]-s.up[1]*below;vbData[n+2]=s.start[2]-s.up[2]*below;vbData[n+3]=1;vbData[n+4]=1;n+=5;for(i=0;i<self.numSegments;++i){s=self.segments[(self.currentSegment+i)%self.maxSegments];u=1-(self.currentLength!=0?l/self.currentLength:0);u2=1-(self.currentLength!=0?(l+s.length)/self.currentLength:1);vbData[n]=s.position[0]+s.up[0]*above;vbData[n+1]=s.position[1]+s.up[1]*above;vbData[n+2]=s.position[2]+s.up[2]*above;vbData[n+3]=u2;vbData[n+4]=0;n+=5;vbData[n]=s.position[0]-s.up[0]*below;vbData[n+1]=s.position[1]-s.up[1]*below;vbData[n+2]=s.position[2]-s.up[2]*below;vbData[n+3]=u2;vbData[n+4]=1;n+=5;l+=s.length}if(!self.vb){self.vb=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferData(gl.ARRAY_BUFFER,self.vbData,gl.DYNAMIC_DRAW)}else{gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferSubData(gl.ARRAY_BUFFER,0,self.vbData)}},draw:function(){var self=this,gl=self.model.renderer.context,i;if(self.numSegments==0)return;if(!self.shaderReady)self.initShader();if(!self.program)return;if(!self.texture&&self.textureIds[0]>-1&&self.textureIds[0]<self.model.materials.length){var mat=self.model.materials[self.textureIds[0]];if(mat.texture&&mat.texture.texture&&(!mat.texture.alphaImg||mat.texture.alphaTexture)){self.texture=mat.texture}}if(!self.texture)return;gl.useProgram(self.program);gl.uniformMatrix4fv(self.uniforms.vModelMatrix,false,self.model.matrix);gl.uniformMatrix4fv(self.uniforms.vViewMatrix,false,self.model.renderer.viewMatrix);gl.uniformMatrix4fv(self.uniforms.vProjMatrix,false,self.model.renderer.projMatrix);gl.uniform4fv(self.uniforms.fColor,self.currentColor);if(self.texture){gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,self.texture.texture);gl.uniform1i(self.uniforms.fTexture,0)}if(self.texture&&self.texture.alphaTexture){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,self.texture.alphaTexture);gl.uniform1i(self.uniforms.fAlpha,1)}gl.uniform1i(self.uniforms.fHasTexture,self.texture?1:0);gl.uniform1i(self.uniforms.fHasAlpha,self.texture&&self.texture.alphaTexture?1:0);gl.blendFunc(gl.SRC_ALPHA,gl.ONE);gl.disable(gl.CULL_FACE);gl.depthMask(false);gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);for(i in self.attribs){var a=self.attribs[i];gl.enableVertexAttribArray(a.loc);gl.vertexAttribPointer(a.loc,a.size,a.type,false,a.stride,a.offset)}gl.drawElements(gl.TRIANGLES,self.numSegments*6,gl.UNSIGNED_SHORT,0);for(i in self.attribs){gl.disableVertexAttribArray(self.attribs[i].loc)}},initShader:function(){var self=this,gl=self.model.renderer.context;self.shaderReady=true;var vs=self.model.renderer.compileShader(gl.VERTEX_SHADER,self.vertShader);var fs=self.model.renderer.compileShader(gl.FRAGMENT_SHADER,self.fragShader);var program=gl.createProgram();gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Error linking shaders");return}self.vs=vs;self.fs=fs;self.program=program;self.uniforms={vModelMatrix:gl.getUniformLocation(program,"uModelMatrix"),vViewMatrix:gl.getUniformLocation(program,"uViewMatrix"),vProjMatrix:gl.getUniformLocation(program,"uProjMatrix"),fHasTexture:gl.getUniformLocation(program,"uHasTexture"),fHasAlpha:gl.getUniformLocation(program,"uHasAlpha"),fTexture:gl.getUniformLocation(program,"uTexture"),fAlpha:gl.getUniformLocation(program,"uAlpha"),fColor:gl.getUniformLocation(program,"uColor")};self.attribs={position:{loc:gl.getAttribLocation(program,"aPosition"),type:gl.FLOAT,size:3,offset:0,stride:20},texcoord:{loc:gl.getAttribLocation(program,"aTexCoord"),type:gl.FLOAT,size:2,offset:12,stride:20}}},vertShader:"        attribute vec3 aPosition;        attribute vec2 aTexCoord;                varying vec2 vTexCoord;                uniform mat4 uModelMatrix;        uniform mat4 uViewMatrix;        uniform mat4 uProjMatrix;                void main(void) {            gl_Position = uProjMatrix * uViewMatrix * uModelMatrix * vec4(aPosition, 1);                        vTexCoord = aTexCoord;        }    ",fragShader:"        precision mediump float;                varying vec2 vTexCoord;                uniform bool uHasTexture;        uniform bool uHasAlpha;        uniform sampler2D uTexture;        uniform sampler2D uAlpha;        uniform vec4 uColor;                void main(void) {            vec4 color = vec4(1, 1, 1, 1);            if (uHasTexture) {                color = texture2D(uTexture, vTexCoord.st);            }            if (uHasAlpha) {                color.a = texture2D(uAlpha, vTexCoord.st).a;            }                        gl_FragColor = color * uColor;        }    ",update:function(anim,time){var self=this,Wow=ZamModelViewer.Wow,i,s;vec3.transformMat4(self.tmpPosition,self.position,self.bone.matrix);vec4.set(self.tmpUp,0,0,1,0);vec4.transformMat4(self.tmpUp,self.tmpUp,self.bone.matrix);vec3.normalize(self.tmpUp,self.tmpUp);if(self.numSegments==0){s=self.pushSegment();vec3.copy(s.start,self.tmpPosition);vec3.copy(s.position,self.tmpPosition);vec4.copy(s.up,self.tmpUp);s.length=0}else{var currIdx=(self.currentSegment+self.numSegments-1)%self.maxSegments;s=self.segments[currIdx];vec3.copy(s.position,self.tmpPosition);vec4.copy(s.up,self.tmpUp);vec3.subtract(self.tmpVec,s.position,self.currentPosition);s.length+=vec3.length(self.tmpVec);if(s.length>=self.length){s=self.pushSegment();vec3.copy(s.start,self.tmpPosition);vec3.copy(s.position,self.tmpPosition);vec4.copy(s.up,self.tmpUp);s.length=0}}self.currentLength=0;var idx;for(i=0;i<self.numSegments;++i){idx=(self.currentSegment+i)%self.maxSegments;self.currentLength+=self.segments[idx].length}if(self.currentLength>self.totalLength+.1){self.currentLength-=self.segments[self.currentSegment].length;self.shiftSegment()}vec3.copy(self.currentPosition,self.tmpPosition);Wow.AnimatedVec3.getValue(self.color,anim,time,self.currentColor);self.currentColor[3]=Wow.AnimatedUint16.getValue(self.alpha,anim,time)/32767;self.currentAbove=Wow.AnimatedFloat.getValue(self.above,anim,time);self.currentBelow=Wow.AnimatedFloat.getValue(self.below,anim,time);self.updateBuffers()},pushSegment:function(){var self=this;if(self.numSegments<self.maxSegments){self.numSegments++}else{self.currentSegment=(self.currentSegment+1)%self.maxSegments}return self.segments[self.currentSegment]},popSegment:function(){var self=this;self.numSegments--},shiftSegment:function(){var self=this;self.currentSegment=(self.currentSegment+1)%self.maxSegments;self.numSegments--}};ZamModelViewer.Wow.ParticleEmitter=function(model,r){var self=this,Wow=ZamModelViewer.Wow;self.uuid=(new Date).getTime();self.model=model;self.id=r.getInt32();self.flags=r.getUint32();self.position=[r.getFloat(),r.getFloat(),r.getFloat()];self.boneId=r.getInt16();self.textureId=r.getInt16();if((self.flags&268435456)!=0){self.textureIds=[0,0,0];self.textureIds[0]=self.textureId&31;self.textureIds[1]=self.textureId>>5&31;self.textureIds[2]=self.textureId>>10&31}self.blendMode=r.getUint8();self.emitterType=r.getUint8()
;self.particleColorIndex=r.getUint16();if(self.particleColorIndex>=11&&self.particleColorIndex<=13){var colors;if(model.meta.Item&&model.meta.Item.ParticleColor){colors=model.meta.Item.ParticleColor}else if(model.meta.Creature&&model.meta.Creature.ParticleColor){colors=model.meta.Creature.ParticleColor}if(colors){self.particleColors=[vec4.create(),vec4.create(),vec4.create()];function toRGBA(argb){return[(argb>>16&255)/255,(argb>>8&255)/255,(argb>>0&255)/255,(argb>>24&255)/255]}vec4.copy(self.particleColors[0],toRGBA(colors.Start[self.particleColorIndex-11]));vec4.copy(self.particleColors[1],toRGBA(colors.Mid[self.particleColorIndex-11]));vec4.copy(self.particleColors[2],toRGBA(colors.End[self.particleColorIndex-11]))}}self.tileRotation=r.getUint16();self.tileRows=r.getUint16();self.tileColumns=r.getUint16();self.emissionSpeed=Wow.AnimatedFloat.readSet(r);self.speedVariation=Wow.AnimatedFloat.readSet(r);self.verticalRange=Wow.AnimatedFloat.readSet(r);self.horizontalRange=Wow.AnimatedFloat.readSet(r);self.gravity=Wow.AnimatedVec3.readSet(r);self.lifespan=Wow.AnimatedFloat.readSet(r);self.lifespanVary=r.getFloat();self.emissionRate=Wow.AnimatedFloat.readSet(r);self.emissionRateVary=r.getFloat();self.areaLength=Wow.AnimatedFloat.readSet(r);self.areaWidth=Wow.AnimatedFloat.readSet(r);self.gravity2=Wow.AnimatedFloat.readSet(r);self.color=new Wow.SAnimatedVec3(r);self.alpha=new Wow.SAnimatedUint16(r);self.size=new Wow.SAnimatedVec2(r);self.scaleVary=[r.getFloat(),r.getFloat()];self.intensity=new Wow.SAnimatedUint16(r);self.tailCellTrack=new Wow.SAnimatedUint16(r);self.tailLength=r.getFloat();self.twinkleSpeed=r.getFloat();self.twinklePercent=r.getFloat();self.twinkleScale=[r.getFloat(),r.getFloat()];self.burstMultiplier=r.getFloat();self.slowdown=r.getFloat();self.scale=[self.twinkleScale[0],self.twinkleScale[1],self.burstMultiplier];self.baseSpin=r.getFloat();self.baseSpinVary=r.getFloat();self.spin=r.getFloat();self.spinVary=r.getFloat();self.modelRot1=[r.getFloat(),r.getFloat(),r.getFloat()];self.modelRot2=[r.getFloat(),r.getFloat(),r.getFloat()];self.modelTranslation=[r.getFloat(),r.getFloat(),r.getFloat()];self.windTime=r.getFloat();self.followSpeed1=r.getFloat();self.followScale1=r.getFloat();self.followSpeed2=r.getFloat();self.followScale2=r.getFloat();var numSplinePoints=r.getInt32();self.splinePoints=new Array(numSplinePoints);for(var i=0;i<numSplinePoints;i++){self.splinePoints[i]=[r.getFloat(),r.getFloat(),r.getFloat()]}self.enabled=Wow.AnimatedUint8.readSet(r);self.multiTexScale=[r.getFloat(),r.getFloat()];self.multiTexBaseCoords=[[r.getFloat(),r.getFloat()],[r.getFloat(),r.getFloat()]];self.multiTexVaryCoords=[[r.getFloat(),r.getFloat()],[r.getFloat(),r.getFloat()]];self.bone=self.model.bones[self.boneId];self.maxParticles=1500;self.particles=new Array(self.maxParticles);self.unusedParticles=new Array(self.maxParticles);for(var i=self.maxParticles-1,j=0;i>=0;--i,++j)self.unusedParticles[i]=j;self.nextParticle=self.maxParticles-1;self.numParticles=0;self.spawnRemainder=0;self.tmpColors=[vec4.create(),vec4.create(),vec4.create()];self.spreadMat=mat4.create();self.tmpMat=mat4.create();self.lastP=vec3.create();self.particleModel=new ZamModelViewer.Wow.Particle(self);self.init()};ZamModelViewer.Wow.ParticleEmitter.prototype={destroy:function(){var self=this,gl=self.model.renderer.context,Animated=ZamModelViewer.Wow.Animated;self.particleModel.destroy();self.particleModel=null;self.model=null;self.bone=null;self.position=null;self.scale=null;self.rotation=null;self.modelRot1=null;self.modelRot2=null;self.modelTranslation=null;self.emissionSpeed=Animated.destroySet(self.emissionSpeed);self.speedVariation=Animated.destroySet(self.speedVariation);self.verticalRange=Animated.destroySet(self.verticalRange);self.horizontalRange=Animated.destroySet(self.horizontalRange);self.gravity=Animated.destroySet(self.gravity);self.lifespan=Animated.destroySet(self.lifespan);self.emissionRate=Animated.destroySet(self.emissionRate);self.areaLength=Animated.destroySet(self.areaLength);self.areaWidth=Animated.destroySet(self.areaWidth);self.gravity2=Animated.destroySet(self.gravity2);self.enabled=Animated.destroySet(self.enabled);self.color=self.color.destroy();self.alpha=self.alpha.destroy();self.size=self.size.destroy();self.intensity=self.intensity.destroy();self.particles=null;self.unusedParticles=null;self.tmpColors[0]=self.tmpColors[1]=self.tmpColors[2]=null;self.tmpColors=null;self.spreadMat=null;self.tmpMat=null},draw:function(){var self=this;self.particleModel.draw()},update:function(anim,time,delta){var self=this;var _p=vec3.create();mat4.transformVec3(_p,vec3.create(),self.model.matrix);self._v=vec3.scale(vec3.create(),vec3.subtract(vec3.create(),_p,self.lastP),1/delta);self.lastP=_p;self.particleModel.update(anim,time,delta)},getNextParticle:function(){var self=this;if(self.nextParticle<0)return null;var index=self.unusedParticles[self.nextParticle];if(!self.particles[index]){self.particles[index]={index:index,position:vec3.create(),origin:vec3.create(),speed:vec4.create(),direction:vec4.create(),down:vec3.create(),color:vec4.create(),size:vec2.create(),life:0,maxLife:0,tile:0}}self.nextParticle--;return self.particles[index]},spawnPlaneParticle:function(width,height,speed,vary,life){var self=this,p=self.getNextParticle();if(!p)return null;vec3.copy(p.position,self.position);p.position[0]+=2*width*(2*(Math.random()-.5));p.position[1]+=2*height*(2*(Math.random()-.5));vec3.transformMat4(p.position,p.position,self.bone.matrix);vec4.set(p.direction,0,0,1,0);vec4.set(p.direction,2*(Math.random()-.5),2*(Math.random()-.5),2*(Math.random()-.5),0);vec4.transformMat4(p.direction,p.direction,self.bone.matrix);vec3.normalize(p.direction,p.direction);vec4.copy(p.speed,p.direction);var v1=speed-speed*vary,v2=speed+speed*vary;vec4.scale(p.speed,p.speed,v1+(v2-v1)*Math.random());vec3.set(p.down,0,0,-1);p.life=0;p.maxLife=life;if(!p.maxLife)p.maxLife=1;vec3.copy(p.origin,p.position);p.tile=Math.floor(Math.random()*self.tileRows*self.tileColumns);vec4.set(p.color,1,1,1,1);return p},spawnSphereParticle:function(width,height,speed,vary,spread,spread2,life){var self=this,p=self.getNextParticle();if(!p)return null;var radius=Math.random(),t=0;if(spread==0){t=Math.random()*Math.PI*2-Math.PI}else{t=Math.random()*spread*2-spread}self.calcSpread(spread*2,spread*2,width,height);if((self.flags&57)==57||(self.flags&313)==313){vec3.copy(p.position,self.position);vec4.set(p.direction,width*Math.cos(t)*1.6,height*Math.sin(t)*1.6,0,0);vec3.add(p.position,p.position,p.direction);vec3.transformMat4(p.position,p.position,self.bone.matrix);if(vec3.squaredLength(p.direction)==0){vec4.set(p.speed,0,0,0,0)}else{vec4.transformMat4(p.direction,p.direction,self.bone.matrix);vec3.normalize(p.direction,p.direction);vec3.copy(p.speed,p.direction);vec3.scale(p.speed,p.speed,speed*(1+Math.random()*vary*2-vary))}}else{vec4.set(p.direction,0,0,1,0);vec4.transformMat4(p.direction,p.direction,self.spreadMat);vec3.scale(p.direction,p.direction,radius);vec3.copy(p.position,self.position);vec3.add(p.position,p.position,p.direction);vec3.transformMat4(p.position,p.position,self.bone.matrix);if(vec3.squaredLength(p.direction)==0&&(self.flags&256)==0){vec4.set(p.speed,0,0,0,0);vec4.set(p.direction,0,0,1,0);vec4.transformMat4(p.direction,p.direction,self.bone.matrix);vec3.normalize(p.direction,p.direction)}else{if((self.flags&256)>0){vec4.set(p.direction,0,0,1,0);vec4.transformMat4(p.direction,p.direction,self.bone.matrix)}vec3.normalize(p.direction,p.direction);vec4.copy(p.speed,p.direction);vec3.scale(p.speed,p.speed,speed*(1+Math.random()*vary*2-vary))}}var vScale=vec3.create();vec3.set(vScale,1,1,1);vec3.set(p.down,0,0,-1);p.life=0;p.maxLife=life;if(!p.maxLife)p.maxLife=1;vec3.copy(p.origin,p.position);p.tile=Math.floor(Math.random()*self.tileRows*self.tileColumns);vec4.set(p.color,1,1,1,1);return p},calcSpread:function(spread1,spread2,width,height){var self=this,mat=this.spreadMat,tmpMat=this.tmpMat;var a0=(Math.random()*(spread1*2)-spread1)/2,a1=(Math.random()*(spread2*2)-spread2)/2;var c0=Math.cos(a0),c1=Math.cos(a1),s0=Math.sin(a0),s1=Math.sin(a1);mat4.identity(mat);mat4.identity(tmpMat);tmpMat[5]=tmpMat[10]=c0;tmpMat[9]=s0;tmpMat[6]=-s0;mat4.multiply(mat,mat,tmpMat);mat4.identity(tmpMat);tmpMat[0]=tmpMat[10]=c1;tmpMat[2]=s1;tmpMat[8]=-s1;mat4.multiply(mat,mat,tmpMat);var size=Math.abs(c0)*height*Math.abs(s0)*width;mat[0]*=size;mat[1]*=size;mat[2]*=size;mat[4]*=size;mat[5]*=size;mat[6]*=size;mat[8]*=size;mat[9]*=size;mat[10]*=size;mat4.multiply(mat,self.bone.matrix,mat);return mat},init:function(){var self=this;if(self.scale.z==519)self.scale.z=1.5;var numTiles=self.tileRows*self.tileColumns;self.textureCoords=new Array(numTiles);var a={x:0,y:0},b={x:0,y:0};var i,x,y;for(i=0;i<numTiles;++i){x=i%self.tileColumns;y=Math.floor(i/self.tileColumns);a.x=x*(1/self.tileColumns);b.x=(x+1)*(1/self.tileColumns);a.y=y*(1/self.tileRows);b.y=(y+1)*(1/self.tileRows);self.textureCoords[i]=[{x:a.x,y:a.y,z:-1,w:1},{x:b.x,y:a.y,z:1,w:1},{x:a.x,y:b.y,z:-1,w:-1},{x:b.x,y:b.y,z:1,w:-1}]}}};ZamModelViewer.Wow.ItemVisual=function(model,id){var self=this;self.model=model;self.models=null;self.loaded=false;if(id){self.load(id)}};ZamModelViewer.Wow.ItemVisual.prototype={destroy:function(){var self=this;self.model=null;if(self.models){for(var i=0;i<self.models.length;++i){var model=self.models[i];if(!model)continue;if(model.model)model.model.destroy();model.model=null;model.attachment=null;self.models[i]=null}self.models=null}},load:function(id){var self=this;self.id=id;var url=self.model.opts.contentPath+"meta/itemvisual/"+self.id+".json";$.getJSON(url,function(data){self.loadMeta(data)})},loadMeta:function(meta){var self=this,Wow=ZamModelViewer.Wow;self.models=new Array(5);for(var i=0;i<self.models.length;++i){if(meta.Equipment[i]){self.models[i]={race:0,gender:0,bone:-1,attachment:null,model:null};var modelInfo={type:Wow.Types.ITEMVISUAL,id:self.id,parent:self.model};self.models[i].model=new Wow.Model(self.model.renderer,self.model.viewer,modelInfo,i)}}self.loaded=true;self.model.updateMeshes()}};ZamModelViewer.Wow.CustomFeatures=function(data){this.features=data.features};ZamModelViewer.Wow.CustomFeatures.prototype={destroy:function(){this.features=null},getFeatures:function(baseSection){return this.features[baseSection]},getFeature:function(baseSection,variationIndex,colorIndex){var numVariations=this.getVariationsCount(baseSection,variationIndex);var features=this.getFeatures(baseSection);if(features){for(var i=0;i<features.length;++i){var feature=features[i];if(feature.variationIndex==variationIndex&&(numVariations>1?feature.colorIndex==colorIndex:true))return feature}}},getVariationsCount:function(baseSection,variationIndex){var count=0;var features=this.getFeatures(baseSection);if(features){for(var i=0;i<features.length;++i){var feature=features[i];if(feature.variationIndex==variationIndex)count++}}return count}};ZamModelViewer.Wow.HairGeosets=function(data){this.hairGeosets=data.hairGeosets};ZamModelViewer.Wow.HairGeosets.prototype={destroy:function(){this.hairGeosets=null},getHairGeosetByVariationId:function(variationType,variationID){var hairGeosets=this.hairGeosets[variationType];if(!hairGeosets)return;for(var i=0;i<hairGeosets.length;i++)if(hairGeosets[i].variationID==variationID)return hairGeosets[i]},getHairGeosetByColorIndex:function(variationType,colorIndex){var hairGeosets=this.hairGeosets[variationType];if(!hairGeosets)return;for(var i=0;i<hairGeosets.length;i++)if(hairGeosets[i].colorIndex==colorIndex)return hairGeosets[i]},getHairGeosetConditional:function(variationType,colorIndex,geosetType){var hairGeosets=this.hairGeosets[variationType];if(!hairGeosets)return;for(var i=0;i<hairGeosets.length;i++)if(hairGeosets[i].colorIndex==colorIndex&&hairGeosets[i].geosetType==geosetType)return hairGeosets[i].geosetID;return-1}};ZamModelViewer.Wow.FacialHairStyles=function(data){this.styles=data.styles};ZamModelViewer.Wow.FacialHairStyles.prototype={destroy:function(){this.styles=null},getStyle:function(variationID){for(var i=0;i<this.styles.length;i++){if(this.styles[i].variationID==variationID)return this.styles[i]}}};ZamModelViewer.Destiny=function(){};ZamModelViewer.Destiny.Model=function(renderer,viewer,model,index,parent){var self=this;self.renderer=renderer;self.viewer=viewer;self.model=model;self.modelPath=null;self.loaded=false;self.opts=self.viewer.options;self.gender=self.opts.gender?parseInt(self.opts.gender):0;self.meta=null;self.index=index;self.parent=parent||null;self.models=null;self.textureLookup={};self.textures=null;self.geometry=null;self.genderGeometry=[null,null];self.genderTextures=[null,null];self.dyeGeometry=null;self.dyeTextures=null;self.gear=null;self.matrix=mat4.create();self.ib=null;self.shaderReady=false;self.vs=null;self.fs=null;self.program=null;self.uniforms=null;self.attribs=null;self.ambientColor=[.35,.35,.35,1];self.primaryColor=[1,1,1,1];self.secondaryColor=[.35,.35,.35,1];self.lightDir1=vec3.create();self.lightDir2=vec3.create();self.lightDir3=vec3.create();vec3.normalize(self.lightDir1,[-3,-3,-4]);vec3.normalize(self.lightDir2,[3,1,-3]);vec3.normalize(self.lightDir3,[-3,-1,-5]);self.lightIntensity=vec4.set(vec4.create(),.7,.15,.15,.25);self.animBounds=false;self.boundsCenter=[0,0,0];self.boundsSize=[0,0,0];self.boundsMin=[0,0,0];self.boundsMax=[0,0,0];self.tmpMat=mat4.create();self.tmpVec=vec3.create();self.load()};ZamModelViewer.Models[ZamModelViewer.DESTINY]=ZamModelViewer.Destiny.Model;ZamModelViewer.Destiny.Model.prototype={destroy:function(){var self=this,gl=self.renderer.context,i,j;if(self.program)gl.deleteProgram(self.program);if(self.vs)gl.deleteShader(self.vs);if(self.fs)gl.deleteShader(self.fs);if(self.textures){for(i=0;i<self.textures.length;++i){self.textures[i].destroy()}}if(self.models){for(i=0;i<self.models.length;++i){self.models[i].destroy()}}if(self.geometry){for(i=0;i<self.geometry.length;++i){self.geometry[i].destroy()}}},update:function(){var self=this,i;var delta=self.renderer.delta;if(self.skeleton)self.skeleton.update(delta);if(self.models){for(i=0;i<self.models.length;++i){self.models[i].update()}}else if(self.geometry&&self.parent&&self.parent.skeleton){for(i=0;i<self.geometry.length;++i){self.geometry[i].update()}}},draw:function(){var self=this,gl=self.renderer.context,i;if(!self.loaded)return;if(!self.shaderReady)self.initShader();if(!self.program)return;self.update();gl.useProgram(self.program);gl.frontFace(gl.CW);gl.disable(gl.CULL_FACE);if(self.parent){gl.uniformMatrix4fv(self.uniforms.vModelMatrix,false,self.parent.matrix)}else{gl.uniformMatrix4fv(self.uniforms.vModelMatrix,false,self.matrix)}gl.uniformMatrix4fv(self.uniforms.vViewMatrix,false,self.renderer.viewMatrix);gl.uniformMatrix4fv(self.uniforms.vProjMatrix,false,self.renderer.projMatrix);gl.uniform4fv(self.uniforms.fLightIntensity,self.lightIntensity);gl.uniform3fv(self.uniforms.fLightDir1,self.lightDir1);gl.uniform3fv(self.uniforms.fLightDir2,self.lightDir2);gl.uniform3fv(self.uniforms.fLightDir3,self.lightDir3);gl.uniform3fv(self.uniforms.fCameraPos,self.renderer.eye);gl.uniform1i(self.uniforms.fHasParent,!!self.parent);if(self.models){for(i=0;i<self.models.length;++i){self.models[i].draw()}}else if(self.geometry){var delta=self.renderer.delta;for(i=0;i<self.geometry.length;++i){self.geometry[i].draw(delta)}}},updateBounds:function(){var self=this,i,j,m,g;var min=vec3.set(self.boundsMin,9999,9999,9999),max=vec3.set(self.boundsMax,-9999,-9999,-9999);if(!self.models){for(i=0;i<self.geometry.length;++i){g=self.geometry[i];for(j=0;j<g.meshes.length;++j){m=g.meshes[j];min=vec3.min(min,min,m.boundsMin);max=vec3.max(max,max,m.boundsMax)}}}else{for(i=0;i<self.models.length;++i){m=self.models[i];if(!m.loaded)continue;min=vec3.min(min,min,m.boundsMin);max=vec3.max(max,max,m.boundsMax)}}vec3.subtract(self.boundsSize,max,min);vec3.scaleAndAdd(self.boundsCenter,min,self.boundsSize,.5);var hSize=self.boundsSize[2],wSize=self.boundsSize[0],dSize=self.boundsSize[1];if(!self.parent){if(self.opts.dist){self.renderer.distance=self.opts.dist}else{var ratio=self.renderer.width/self.renderer.height;var hTan=2*Math.tan(self.renderer.fov/2*.0174532925);var wTan=hTan*ratio;var hDist=hSize*1.2/hTan;var wDist=wSize*1.2/wTan;self.renderer.distance=Math.max(Math.max(hDist,wDist),dSize*1.25)}mat4.identity(self.matrix);mat4.rotateZ(self.matrix,self.matrix,Math.PI/2);mat4.translate(self.matrix,self.matrix,vec3.negate(self.tmpVec,self.boundsCenter))}else{self.parent.updateBounds()}}};ZamModelViewer.Destiny.Model.prototype.load=function(){var self=this;if(self.model){self._load(self.model)}else if(self.opts.items){var items;if($.isArray(self.opts.items)){items=self.opts.items}else{items=self.opts.items.split(";")}var excludeIdx=items.indexOf("4248210736");if(excludeIdx>-1)items.splice(excludeIdx,1);$.getJSON(self.opts.contentPath+"skeleton.json",function(data){self.skeleton=new ZamModelViewer.Destiny.Skeleton(self,data)});self.models=new Array(items.length);for(var i=0;i<items.length;++i){self.models[i]=new ZamModelViewer.Destiny.Model(self.renderer,self.viewer,items[i],i,self)}self.loaded=true}};ZamModelViewer.Destiny.Model.prototype._load=function(id){var self=this;var url=self.opts.contentPath+"geom/mobile/"+id+".geom";if(self.opts.cacheBuster){url+="?"+self.opts.cacheBuster}else{url+="?1"}$.ajax({url:url,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:false,renderer:self.renderer,success:function(buffer){self.loadGeom(buffer)},error:function(xhr,status,error){console.log(error)}})};ZamModelViewer.Destiny.Model.prototype.loadGeom=function(buffer){if(!buffer){console.error("Bad buffer for DataView");return}var self=this,r=new ZamModelViewer.DataView(buffer),D=ZamModelViewer.Destiny,i;var magic=r.getUint32();if(magic!=572728357){console.log("Bad magic value");return}var compressedData=new Uint8Array(buffer,r.position);var data=null;try{data=pako.inflate(compressedData)}catch(err){console.log("Decompression error: "+err);return}r=new ZamModelViewer.DataView(data.buffer);var numTextures=r.getInt32();self.textures=new Array(numTextures);for(i=0;i<numTextures;++i){var tex=r.getString();self.textures[i]=new D.Texture(self,"textures/mobile/"+tex);self.textureLookup[tex]=i}var numGeometry=r.getInt32();self.geometry=new Array(numGeometry);for(i=0;i<numGeometry;++i){self.geometry[i]=new D.Geometry(self,r)}var numMaleGeom=r.getInt32();self.genderGeometry[0]=new Array(numMaleGeom);for(i=0;i<numMaleGeom;++i){self.genderGeometry[0][i]=r.getInt32()}var numMaleTextures=r.getInt32();self.genderTextures[0]=new Array(numMaleTextures);for(i=0;i<numMaleTextures;++i){self.genderTextures[0][i]=r.getInt32()}var numFemaleGeom=r.getInt32();self.genderGeometry[1]=new Array(numFemaleGeom);for(i=0;i<numFemaleGeom;++i){self.genderGeometry[1][i]=r.getInt32()}var numFemaleTextures=r.getInt32();self.genderTextures[1]=new Array(numFemaleTextures);for(i=0;i<numFemaleTextures;++i){self.genderTextures[1][i]=r.getInt32()}var numDyeGeom=r.getInt32();self.dyeGeometry=new Array(numDyeGeom);for(i=0;i<numDyeGeom;++i){self.dyeGeometry[i]=r.getInt32()}var numDyeTextures=r.getInt32();self.dyeTextures=new Array(numDyeTextures);for(i=0;i<numDyeTextures;++i){self.dyeTextures[i]=r.getInt32()}var gearLen=r.getInt32();var gearStr=r.getString(gearLen);self.gear=JSON.parse(gearStr);if(self.gear){if(self.gear.locked_dyes&&self.gear.locked_dyes.length>0){self.dyeLocked=true;self.dyeInfo=self.gear.locked_dyes}else if(self.gear.custom_dyes&&self.gear.custom_dyes.length>0){self.dyeInfo=self.gear.custom_dyes;if(self.parent)self.parent.dyeInfo=self.dyeInfo}else if(self.gear.default_dyes&&self.gear.default_dyes.length>0){self.dyeInfo=self.gear.default_dyes}}if(numGeometry>0&&numMaleGeom==0&&numFemaleGeom==0){for(i=0;i<numGeometry;++i){self.geometry[i].show=true}}else{var geom=self.genderGeometry[self.gender];for(i=0;i<geom.length;++i){self.geometry[geom[i]].show=true}}self.loaded=true;self.updateBounds()};ZamModelViewer.Destiny.Model.prototype.initShader=function(){var self=this,gl=self.renderer.context;self.shaderReady=true;var vs=self.renderer.compileShader(gl.VERTEX_SHADER,self.vertShader);var fs=self.renderer.compileShader(gl.FRAGMENT_SHADER,self.fragShader);var program=gl.createProgram();gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Error linking shaders");return}self.vs=vs;self.fs=fs;self.program=program;self.uniforms={vModelMatrix:gl.getUniformLocation(program,"uModelMatrix"),vViewMatrix:gl.getUniformLocation(program,"uViewMatrix"),vProjMatrix:gl.getUniformLocation(program,"uProjMatrix"),vHasColor:gl.getUniformLocation(program,"uvHasColor"),fHasColor:gl.getUniformLocation(program,"ufHasColor"),fHasParent:gl.getUniformLocation(program,"uHasParent"),fHasDiffuse:gl.getUniformLocation(program,"uHasDiffuse"),fHasNormal:gl.getUniformLocation(program,"uHasNormal"),fHasStack:gl.getUniformLocation(program,"uHasStack"),fLit:gl.getUniformLocation(program,"uLit"),fDiffuse:gl.getUniformLocation(program,"uDiffuse"),fNormal:gl.getUniformLocation(program,"uNormal"),fStack:gl.getUniformLocation(program,"uStack"),fColor:gl.getUniformLocation(program,"uColor"),fLightIntensity:gl.getUniformLocation(program,"uLightIntensity"),fLightDir1:gl.getUniformLocation(program,"uLightDir1"),fLightDir2:gl.getUniformLocation(program,"uLightDir2"),fLightDir3:gl.getUniformLocation(program,"uLightDir3"),fCameraPos:gl.getUniformLocation(program,"uCameraPos")};self.attribs={position:gl.getAttribLocation(program,"aPosition"),normal:gl.getAttribLocation(program,"aNormal"),tangent:gl.getAttribLocation(program,"aTangent"),color:gl.getAttribLocation(program,"aColor"),texcoord:gl.getAttribLocation(program,"aTexCoords")}};ZamModelViewer.Destiny.Model.prototype.vertShader="    attribute vec3 aPosition;    attribute vec4 aNormal;    attribute vec4 aTangent;    attribute vec2 aTexCoords;    attribute vec4 aColor;        varying vec3 vPosition;    varying vec3 vNormal;    varying vec3 vTangent;    varying vec3 vBinormal;    varying vec2 vTexCoords;    varying vec4 vColor;        uniform mat4 uModelMatrix;    uniform mat4 uViewMatrix;    uniform mat4 uProjMatrix;    uniform bool uvHasColor;        void main(void) {        gl_Position = uProjMatrix * uViewMatrix * uModelMatrix * vec4(aPosition, 1);        vPosition = (uViewMatrix * uModelMatrix * vec4(aPosition, 1)).xyz;                vTexCoords = aTexCoords;        vec4 normal = normalize(aNormal);        vec4 tangent = normalize(aTangent);        vec4 binormal = vec4(cross(normal.xyz, tangent.xyz) * tangent.w, 1);                vNormal = mat3(uViewMatrix * uModelMatrix) * normal.xyz;        vTangent = mat3(uViewMatrix * uModelMatrix) * tangent.xyz;        vBinormal = mat3(uViewMatrix * uModelMatrix) * binormal.xyz;                if (uvHasColor) {            vColor = aColor;        }    }";ZamModelViewer.Destiny.Model.prototype.fragShader="    precision mediump float;        varying vec3 vPosition;    varying vec3 vNormal;    varying vec3 vTangent;    varying vec3 vBinormal;    varying vec2 vTexCoords;    varying vec4 vColor;        uniform bool ufHasColor;    uniform bool uHasParent;    uniform bool uHasDiffuse;    uniform bool uHasNormal;    uniform bool uHasStack;    uniform bool uLit;    uniform sampler2D uDiffuse;    uniform sampler2D uNormal;    uniform sampler2D uStack;    uniform vec4 uColor;    uniform vec3 uLightDir1;    uniform vec3 uLightDir2;    uniform vec3 uLightDir3;    uniform vec4 uLightIntensity;    uniform vec3 uCameraPos;        vec3 saturate(vec3 value) {        return clamp(value, 0.0, 1.0);    }        float saturate(float value) {        return clamp(value, 0.0, 1.0);    }        void main(void) {        vec4 color = vec4(1, 0, 1, 1);        if (uHasDiffuse) { color.rgb = texture2D(uDiffuse, vTexCoords).rgb; }        vec3 tintColor = vec3(1.0, 1.0, 1.0);        vec3 stackColor = vec3(1.0, 1.0, 1.0);        float specExponent = 255.0;        vec3 specColor = vec3(0.2, 0.2, 0.2);                if (uHasStack) {            color.rgb = pow(color.rgb, vec3(2.2, 2.2, 2.2));            stackColor = texture2D(uStack, vTexCoords).rgb;                        if (uHasParent && stackColor.b < 0.05) { discard; }                        tintColor = uColor.rgb * saturate(color.rgb * 4.0) + saturate(color.rgb - 0.25);            color.rgb = tintColor * stackColor.r + color.rgb * (1.0 - stackColor.r);            float invGamma = 1.0 / 2.2;            color.rgb = pow(color.rgb, vec3(invGamma, invGamma, invGamma));                        specExponent = stackColor.g * 255.0;        }                if (uHasNormal && uLit) {            vec3 normalMap = texture2D(uNormal, vTexCoords).rgb;            vec3 tNormal = normalize(vNormal);            vec3 tTangent = normalize(vTangent);            vec3 tBinormal = normalize(vBinormal);                        vec3 normal = mat3(tTangent, tBinormal, tNormal) * normalize(normalMap * 2.0 - vec3(1.0, 1.0, 1.0));            vec3 cameraDir = normalize(uCameraPos - vPosition);                        vec3 litColor = color.rgb * uLightIntensity.a;                        float facing = -1.0 + 2.0 * float(gl_FrontFacing);            float NdotL = saturate(dot(normal, uLightDir1) * facing);            float RdotV = max(0.0, dot(normal * NdotL * 2.0 - uLightDir1, cameraDir));                        vec3 specular = saturate(specColor * pow(RdotV, specExponent)) * stackColor.g * uLightIntensity.x * NdotL * 0.5;            litColor += color.rgb * NdotL * uLightIntensity.x + specular;                        NdotL = saturate(dot(normal, uLightDir2) * facing);            RdotV = max(0.0, dot(normal * NdotL * 2.0 - uLightDir2, cameraDir));                        specular = saturate(specColor * pow(RdotV, specExponent)) * stackColor.g * uLightIntensity.y * NdotL * 0.5;            litColor += color.rgb * NdotL * uLightIntensity.y + specular;                        NdotL = saturate(dot(normal, uLightDir3) * facing);            RdotV = max(0.0, dot(normal * NdotL * 2.0 - uLightDir3, cameraDir));                        specular = saturate(specColor * pow(RdotV, specExponent)) * stackColor.g * uLightIntensity.z * NdotL * 0.5;            litColor += color.rgb * NdotL * uLightIntensity.z + specular;                        color.rgb = saturate(litColor);        }                gl_FragColor = color;    }";ZamModelViewer.Destiny.Geometry=function(model,r){var self=this,D=ZamModelViewer.Destiny,i;self.model=model;self.name=r.getString();var numMeshes=r.getInt32();self.meshes=new Array(numMeshes);for(i=0;i<numMeshes;++i){self.meshes[i]=new D.Mesh(self,r)}var numPlates=r.getInt32();self.plates=new Array(numPlates);for(i=0;i<numPlates;++i){self.plates[i]=new D.TexturePlate(self,r)}self.show=false};ZamModelViewer.Destiny.Geometry.prototype={destroy:function(){var self=this,i;for(i=0;i<self.meshes.length;++i){self.meshes[i].destroy()}for(i=0;i<self.plates.length;++i){self.plates[i].destroy()}},update:function(){var self=this,i;if(!self.show)return;for(i=0;i<self.meshes.length;++i){self.meshes[i].update()}},draw:function(delta){var self=this,i;if(!self.show)return;for(i=0;i<self.meshes.length;++i){self.meshes[i].draw(delta,true)}for(i=0;i<self.meshes.length;++i){self.meshes[i].draw(delta)}},load:function(){var self=this,i;for(i=0;i<self.plates.length;++i){self.plates[i].load()}}};ZamModelViewer.Destiny.Mesh=function(geometry,r){var self=this,D=ZamModelViewer.Destiny,i,j;self.geometry=geometry;self.model=self.geometry.model;self.renderer=self.model.renderer;var gl=self.renderer.context;var numVbs=r.getInt32();self.vbs=new Array(numVbs);for(i=0;i<numVbs;++i){self.vbs[i]=new D.VertexBuffer(self.model,r);if(!self.posInfo){self.posInfo=self.vbs[i].getTypeData(D.VertexBuffer.Types.Position);if(self.posInfo&&self.vbs[i].positions)self.positions=self.vbs[i].positions}if(!self.normInfo){self.normInfo=self.vbs[i].getTypeData(D.VertexBuffer.Types.Normal);if(self.normInfo&&self.vbs[i].normals)self.normals=self.vbs[i].normals}if(!self.tanInfo){self.tanInfo=self.vbs[i].getTypeData(D.VertexBuffer.Types.Tangent);if(self.tanInfo&&self.vbs[i].tangents)self.tangents=self.vbs[i].tangents}if(self.vbs[i].hasBlendWeights)self.weights=self.vbs[i].weights;if(self.vbs[i].hasBlendIndices)self.indices=self.vbs[i].indices}var numIndices=r.getInt32();var indices=new Uint16Array(numIndices);for(i=0;i<numIndices;++i){indices[i]=r.getUint16()}self.boundsMin=[r.getFloat(),r.getFloat(),r.getFloat()];self.boundsMax=[r.getFloat(),r.getFloat(),r.getFloat()];self.offset=[r.getFloat(),r.getFloat(),r.getFloat()];self.scale=[r.getFloat(),r.getFloat(),r.getFloat()];self.ibData=[];var indexStart,indexCount,numTris;var numParts=r.getInt32();self.parts=new Array(numParts);for(i=0;i<numParts;++i){self.parts[i]=new D.MeshPart(r);numTris=0;indexStart=self.parts[i].indexStart;indexCount=self.parts[i].indexCount;self.parts[i].firstIndex=self.ibData.length;if(self.parts[i].primitive==5){for(j=0;j<indexCount;++j){self.ibData.push(indices[indexStart+j])}numTris=indexCount}else if(self.parts[i].primitive==3){for(j=0;j<indexCount;++j){self.ibData.push(indices[indexStart+j])}numTris=indexCount/3}else{console.error("unhandled primitive type")}self.parts[i].triangleCount=numTris;self.tmpVec=vec4.create()}self.ib=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(self.ibData),gl.STATIC_DRAW)};ZamModelViewer.Destiny.Mesh.prototype={destroy:function(){var self=this,gl=self.renderer.context,i;if(self.ib){gl.deleteBuffer(self.ib);self.ib=null}for(i=0;i<self.vbs.length;++i){self.vbs[i].destroy()}},hasAllTextures:function(){var self=this;if(!self.texture&&(!self.geometry.plates||self.geometry.plates.length>0))return false;if(!self.normalTexture&&(!self.geometry.plates||self.geometry.plates.length>1))return false;if(!self.stackTexture&&(!self.geometry.plates||self.geometry.plates.length>2))return false;for(var i=0;i<self.parts.length;++i){if(self.parts[i].diffuse&&!self.parts[i].diffuse.texture)return false;if(self.parts[i].normal&&!self.parts[i].normal.texture)return false;if(self.parts[i].stack&&!self.parts[i].stack.texture)return false}return true},getSlot:function(type){var self=this,o,base=0;for(var i=0;i<self.vbs.length;++i){o=self.vbs[i].getSlot(type);if(o){for(var idx in o){o[idx]+=base}return 0}else{base+=self.vbs[i].vbSlots}}return null},update:function(){var self=this;if(!self.posInfo||!self.model.parent||!self.model.parent.skeleton)return;var i,j,w,b,sk=self.model.parent.skeleton,tmpVec=self.tmpVec;var posStride=self.posInfo.stride,posCount=self.posInfo.count,posBuffer=self.posInfo.buffer,posOfs=self.posInfo.offset;var nrmStride=self.normInfo.stride,nrmCount=self.normInfo.count,nrmBuffer=self.normInfo.buffer,nrmOfs=self.normInfo.offset;var tanStride=self.tanInfo.stride,tanCount=self.tanInfo.count,tanBuffer=self.tanInfo.buffer,tanOfs=self.tanInfo.offset;for(i=0;i<posCount;++i,posOfs+=posStride,nrmOfs+=nrmStride,tanOfs+=tanStride){posBuffer[posOfs+0]=posBuffer[posOfs+1]=posBuffer[posOfs+2]=0;nrmBuffer[nrmOfs+0]=nrmBuffer[nrmOfs+1]=nrmBuffer[nrmOfs+2]=0;tanBuffer[tanOfs+0]=tanBuffer[tanOfs+1]=tanBuffer[tanOfs+2]=0;if(self.weights){for(j=0;j<4;++j){b=self.indices[i][j];w=self.weights[i][j]/255;if(w==0)continue;vec3.transformMat4(tmpVec,self.positions[i],sk.finalMats[b]);posBuffer[posOfs]+=tmpVec[0]*w;posBuffer[posOfs+1]+=tmpVec[1]*w;posBuffer[posOfs+2]+=tmpVec[2]*w;vec4.transformMat4(tmpVec,self.normals[i],sk.finalMats[b]);nrmBuffer[nrmOfs]+=tmpVec[0]*w;nrmBuffer[nrmOfs+1]+=tmpVec[1]*w;nrmBuffer[nrmOfs+2]+=tmpVec[2]*w;vec4.transformMat4(tmpVec,self.tangents[i],sk.finalMats[b]);tanBuffer[tanOfs]+=tmpVec[0]*w;tanBuffer[tanOfs+1]+=tmpVec[1]*w;tanBuffer[tanOfs+2]+=tmpVec[2]*w}}else if(self.indices){for(j=0;j<2;++j){b=self.indices[i][j];w=self.indices[i][j+2]/255;if(w==0)continue;vec3.transformMat4(tmpVec,self.positions[i],sk.finalMats[b]);posBuffer[posOfs]+=tmpVec[0]*w
;posBuffer[posOfs+1]+=tmpVec[1]*w;posBuffer[posOfs+2]+=tmpVec[2]*w;vec4.transformMat4(tmpVec,self.normals[i],sk.finalMats[b]);nrmBuffer[nrmOfs]+=tmpVec[0]*w;nrmBuffer[nrmOfs+1]+=tmpVec[1]*w;nrmBuffer[nrmOfs+2]+=tmpVec[2]*w;vec4.transformMat4(tmpVec,self.tangents[i],sk.finalMats[b]);tanBuffer[tanOfs]+=tmpVec[0]*w;tanBuffer[tanOfs+1]+=tmpVec[1]*w;tanBuffer[tanOfs+2]+=tmpVec[2]*w}}else{b=self.positions[i][3]|0;vec3.transformMat4(tmpVec,self.positions[i],sk.finalMats[b]);posBuffer[posOfs]=tmpVec[0];posBuffer[posOfs+1]=tmpVec[1];posBuffer[posOfs+2]=tmpVec[2];vec4.transformMat4(tmpVec,self.normals[i],sk.finalMats[b]);nrmBuffer[nrmOfs]=tmpVec[0];nrmBuffer[nrmOfs+1]=tmpVec[1];nrmBuffer[nrmOfs+2]=tmpVec[2];vec4.transformMat4(tmpVec,self.tangents[i],sk.finalMats[b]);tanBuffer[tanOfs]=tmpVec[0];tanBuffer[tanOfs+1]=tmpVec[1];tanBuffer[tanOfs+2]=tmpVec[2]}}self.posInfo.vb.updateBuffers()}};ZamModelViewer.Destiny.Mesh.prototype.draw=function(delta,depthOnly){var self=this,gl=self.renderer.context,i,p,t;if(!self.hasTextures){for(i=0;i<self.parts.length;++i){p=self.parts[i];if(p.diffuseTexture&&!p.diffuse&&self.model.textureLookup[p.diffuseTexture]!==undefined){t=self.model.textures[self.model.textureLookup[p.diffuseTexture]];if(!t.img&&!t.error)t.load();p.diffuse=t}else if(p.normalTexture&&!p.normal&&self.model.textureLookup[p.normalTexture]!==undefined){t=self.model.textures[self.model.textureLookup[p.normalTexture]];if(!t.img&&!t.error)t.load();p.normal=t}else if(p.stackTexture&&!p.stack&&self.model.textureLookup[p.stackTexture]!==undefined){t=self.model.textures[self.model.textureLookup[p.stackTexture]];if(!t.img&&!t.error)t.load();p.stack=t}}self.geometry.load();if(self.geometry.plates.length>0){p=self.geometry.plates[0];if(!self.texture&&p.texture!=null&&p.texture.texture)self.texture=p.texture;p=self.geometry.plates[1];if(!self.normalTexture&&p.texture!=null&&p.texture.texture)self.normalTexture=p.texture;p=self.geometry.plates[2];if(!self.stackTexture&&p.texture!=null&&p.texture.texture)self.stackTexture=p.texture}if(self.hasAllTextures())self.hasTextures=true}for(i=0;i<self.vbs.length;++i){self.vbs[i].enable()}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);var hasColor=self.getSlot(ZamModelViewer.Destiny.VertexBuffer.Types.Color)!=null;gl.uniform1i(self.model.uniforms.vHasColor,hasColor);gl.uniform1i(self.model.uniforms.fHasColor,hasColor);self.drawParts(depthOnly);for(i=0;i<self.vbs.length;++i){self.vbs[i].disable()}};ZamModelViewer.Destiny.Mesh.prototype.drawParts=function(depthOnly){var self=this,gl=self.renderer.context,dyes=self.model.dyeInfo,resetBlending=false,resetMask=false;if(!self.model.dyeLocked&&self.model.parent&&self.model.parent.dyeInfo)dyes=self.model.parent.dyeInfo;var i,j,k,p,alphaHadTexture=false;for(i=0;i<self.parts.length;++i){p=self.parts[i];if(self.geometry.name=="482021716-1"&&p.indexCount==330&&p.flags==0)continue;if(p.lodName.indexOf("0")==-1)continue;if(!depthOnly){if((p.flags&32)>0||(p.flags&64)>0)continue}else{if((p.flags&32)==0)continue}if((p.flags&32)>0){if(!resetBlending){resetBlending=true;gl.blendFunc(gl.SRC_COLOR,gl.ONE);gl.depthMask(false)}if(p.diffuseTexture)alphaHadTexture=true;else if(alphaHadTexture)continue}else{if(resetBlending){resetBlending=false;gl.blendFunc(gl.ONE,gl.ZERO);gl.depthMask(true)}if(resetMask){resetMask=false;gl.colorMask(true,true,true,true)}}var hasDiffuse=true,hasNormal=true,hasStack=true;gl.activeTexture(gl.TEXTURE0);if(p.diffuse){if(p.diffuse.texture){gl.bindTexture(gl.TEXTURE_2D,p.diffuse.texture)}else hasDiffuse=false}else if(self.texture&&self.texture.texture){gl.bindTexture(gl.TEXTURE_2D,self.texture.texture)}else hasDiffuse=false;gl.activeTexture(gl.TEXTURE1);if(p.normal){if(p.normal.texture){gl.bindTexture(gl.TEXTURE_2D,p.normal.texture)}else hasNormal=false}else if(self.normalTexture&&self.normalTexture.texture){gl.bindTexture(gl.TEXTURE_2D,self.normalTexture.texture)}else hasNormal=false;gl.activeTexture(gl.TEXTURE2);if(p.stack){if(p.stack.texture){gl.bindTexture(gl.TEXTURE_2D,p.stack.texture)}else hasStack=false}else if(self.stackTexture&&self.stackTexture.texture){gl.bindTexture(gl.TEXTURE_2D,self.stackTexture.texture)}else hasStack=false;if(dyes){for(j=0;j<dyes.length;++j){if(dyes[j].slot_type_index==p.dyeIndex){var dye=dyes[j].material_properties;if(p.usePrimaryColor)for(k=0;k<4;++k)self.tmpVec[k]=dye.primary_color[k];else for(k=0;k<4;++k)self.tmpVec[k]=dye.secondary_color[k];break}}}if(!hasDiffuse){continue}gl.uniform1i(self.model.uniforms.fHasDiffuse,hasDiffuse);gl.uniform1i(self.model.uniforms.fHasNormal,hasNormal);gl.uniform1i(self.model.uniforms.fHasStack,hasStack);gl.uniform1i(self.model.uniforms.fLit,(p.flags&32)==0);if(hasDiffuse)gl.uniform1i(self.model.uniforms.fDiffuse,0);if(hasNormal)gl.uniform1i(self.model.uniforms.fNormal,1);if(hasStack)gl.uniform1i(self.model.uniforms.fStack,2);gl.uniform4fv(self.model.uniforms.fColor,self.tmpVec);if(p.primitive==5){gl.drawElements(gl.TRIANGLE_STRIP,p.triangleCount,gl.UNSIGNED_SHORT,p.firstIndex*2)}else{gl.drawElements(gl.TRIANGLES,p.triangleCount*3,gl.UNSIGNED_SHORT,p.firstIndex*2)}}if(resetBlending){gl.blendFunc(gl.ONE,gl.ZERO);gl.depthMask(true)}if(resetMask){gl.colorMask(true,true,true,true)}};ZamModelViewer.Destiny.MeshPart=function(r){var self=this,i;self.indexStart=r.getUint16();self.indexCount=r.getUint16();self.indexMin=r.getUint16();self.indexMax=r.getUint16();self.flags=r.getUint32();self.primitive=r.getInt32();var dyeIndex=r.getInt32();self.externalId=r.getUint32();self.lod=r.getInt32();self.lodName=r.getString();self.usePrimaryColor=true;switch(dyeIndex){case 0:self.dyeIndex=0;break;case 1:self.dyeIndex=0;self.usePrimaryColor=false;break;case 2:self.dyeIndex=1;break;case 3:self.dyeIndex=1;self.usePrimaryColor=false;break;case 4:self.dyeIndex=2;break;case 5:self.dyeIndex=2;self.usePrimaryColor=false;break;case 6:case 7:self.dyeIndex=3;break}var numTextures=r.getInt32();self.textures=new Array(numTextures);for(i=0;i<numTextures;++i){self.textures[i]=r.getString();if(self.textures[i].indexOf(".")==-1)self.textures[i]+=".png"}if(numTextures>=5){self.diffuseTexture=self.textures[0];self.normalTexture=self.textures[2];self.stackTexture=self.textures[4]}else if(numTextures>0&&self.textures[0].indexOf("detail")==-1){self.diffuseTexture=self.textures[0]}};ZamModelViewer.Destiny.Texture=function(model,url){var self=this;self.model=model;self.url=model.opts.contentPath+url;if(model.opts.cacheBuster){self.url+="?"+model.opts.cacheBuster}else{self.url+="?1"}self.texture=null};ZamModelViewer.Destiny.Texture.prototype={destroy:function(){var self=this,gl=self.model.renderer.context;if(self.texture)gl.deleteTexture(self.texture);self.img=null},load:function(){var self=this,gl=self.model.renderer.context;(function(self,gl){self.img=new Image;self.img.crossOrigin="";self.img.onload=function(){self.img.loaded=true;self.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.img);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR)};self.img.onerror=function(){self.img=null;self.error=true};self.img.src=self.url})(self,gl)}};ZamModelViewer.Destiny.TexturePlate=function(geom,r){var self=this,D=ZamModelViewer.Destiny;self.geometry=geom;self.model=geom.model;self.name=r.getString();self.id=r.getString();self.index=r.getInt32();self.width=r.getInt16();self.height=r.getInt16();var numTextures=r.getInt32();self.textures=new Array(numTextures);for(var i=0;i<numTextures;++i){self.textures[i]=new D.TexturePlate.Part(r)}};ZamModelViewer.Destiny.TexturePlate.prototype={destroy:function(){var self=this;if(self.texture)self.texture.destroy()},load:function(){var self=this,D=ZamModelViewer.Destiny;if(self.name!="diffuse"&&self.name!="gearstack"&&self.name!="normal")return;if(!self.texture){self.texture=new D.Texture(self.model,"textures/mobile/"+self.id+".png");self.texture.load()}}};ZamModelViewer.Destiny.TexturePlate.Part=function(r){var self=this;self.name=r.getString();self.index=r.getInt32();self.width=r.getInt16();self.height=r.getInt16();self.x=r.getInt16();self.y=r.getInt16()};ZamModelViewer.Destiny.VertexBuffer=function(model,r){var self=this,Types=ZamModelViewer.Destiny.VertexBuffer.Types;self.model=model;self.renderer=model.renderer;self.count=r.getInt32();self.stride=r.getInt32();var numElements=r.getInt32();self.elements=new Array(numElements);var slot=0,offset=0,i,j;for(i=0;i<numElements;++i){var type=r.getUint8();var obj={type:type,slot:slot,offset:offset};if(type>=Types.Position&&type<=Types.MaxPosition){self.positions=new Array(numElements);self.hasPosition=true;obj.name="position";obj.baseType=Types.Position;obj.size=3;obj.read=self.readPosition;offset+=3}else if(type>=Types.TexCoord&&type<=Types.MaxTexCoord){obj.name="texcoord";obj.baseType=Types.TexCoord;obj.size=2;obj.read=self.readTexCoord;offset+=2}else if(type>=Types.Normal&&type<=Types.MaxNormal){self.normals=new Array(numElements);self.hasNormal=true;obj.name="normal";obj.baseType=Types.Normal;obj.size=4;obj.read=self.readNormal;offset+=4}else if(type>=Types.Tangent&&type<=Types.MaxTangent){self.tangents=new Array(numElements);self.hasTangent=true;obj.name="tangent";obj.baseType=Types.Tangent;obj.size=4;obj.read=self.readTangent;offset+=4}else if(type>=Types.Color&&type<=Types.MaxColor){obj.name="color";obj.baseType=Types.Color;obj.size=4;obj.read=self.readColor;offset+=4}else if(type>=Types.BlendWeight&&type<=Types.MaxWeight){self.weights=new Array(numElements);self.hasBlendWeights=true;obj.baseType=Types.BlendWeight;obj.read=self.readBlendWeight;obj.discard=true}else if(type>=Types.BlendIndex&&type<=Types.MaxIndex){self.indices=new Array(numElements);self.hasBlendIndices=true;obj.baseType=Types.BlendIndex;obj.read=self.readBlendIndex;obj.discard=true}else{throw"bad type"}self.elements[i]=obj;if(obj.discard)continue;slot++}self.vbStride=offset;self.vbSlots=slot;self.vbData=new Float32Array(self.count*self.vbStride);var idx=0;for(i=0;i<self.count;++i){for(j=0;j<numElements;++j){idx=self.elements[j].read.call(this,r,self.vbData,idx,i)}}self.updateBuffers()};ZamModelViewer.Destiny.VertexBuffer.prototype={destroy:function(){var self=this,gl=self.renderer.context;if(self.buffer){gl.deleteBuffer(self.buffer);self.buffer=null}},enable:function(){var self=this,gl=self.renderer.context,i,e;gl.bindBuffer(gl.ARRAY_BUFFER,self.buffer);for(i=0;i<self.elements.length;++i){e=self.elements[i];if(e.name&&e.type==e.baseType){gl.enableVertexAttribArray(self.model.attribs[e.name]);gl.vertexAttribPointer(self.model.attribs[e.name],e.size,gl.FLOAT,false,self.vbStride*4,e.offset*4)}}},disable:function(){var self=this,gl=self.renderer.context,i,e;gl.bindBuffer(gl.ARRAY_BUFFER,self.buffer);for(i=0;i<self.elements.length;++i){e=self.elements[i];if(e.name&&e.type==e.baseType){gl.disableVertexAttribArray(self.model.attribs[e.name])}}},updateBuffers:function(){var self=this,gl=self.renderer.context;if(self.vbStride>0){if(!self.buffer){self.buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,self.buffer);gl.bufferData(gl.ARRAY_BUFFER,self.vbData,gl.DYNAMIC_DRAW)}else{gl.bindBuffer(gl.ARRAY_BUFFER,self.buffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,self.vbData)}}},getTypeData:function(type){var self=this,e,i;for(i=0;i<self.elements.length;++i){e=self.elements[i];if(e.type==type){return{buffer:self.vbData,offset:e.offset,stride:self.vbStride,count:self.count,vb:self}}}return null},getSlot:function(type){var self=this,obj={},e,i;for(i=0;i<self.elements.length;++i){e=self.elements[i];if(e.discard)continue;if(type==e.baseType){var index=e.type-e.baseType;obj[index]=e.slot}}var empty=true;for(var idx in obj){empty=false;break}if(empty)return null;return obj},readPosition:function(r,vbData,idx,i){var self=this;var pos=self.positions[i]=[r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat()];vbData[idx++]=pos[0];vbData[idx++]=pos[1];vbData[idx++]=pos[2];return idx},readTexCoord:function(r,vbData,idx,i){vbData[idx++]=r.getFloat();vbData[idx++]=r.getFloat();return idx},readNormal:function(r,vbData,idx,i){var self=this;var normal=self.normals[i]=[r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat()];vbData[idx++]=normal[0];vbData[idx++]=normal[1];vbData[idx++]=normal[2];vbData[idx++]=normal[3];return idx},readTangent:function(r,vbData,idx,i){var self=this;var tangent=self.tangents[i]=[r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat()];vbData[idx++]=tangent[0];vbData[idx++]=tangent[1];vbData[idx++]=tangent[2];vbData[idx++]=tangent[3];return idx},readColor:function(r,vbData,idx,i){vbData[idx++]=r.getUint8()/255;vbData[idx++]=r.getUint8()/255;vbData[idx++]=r.getUint8()/255;vbData[idx++]=r.getUint8()/255;return idx},readBlendWeight:function(r,vbData,idx,i){var self=this;self.weights[i]=[r.getUint8(),r.getUint8(),r.getUint8(),r.getUint8()];return idx},readBlendIndex:function(r,vbData,idx,i){var self=this;self.indices[i]=[r.getUint8(),r.getUint8(),r.getUint8(),r.getUint8()];return idx}};ZamModelViewer.Destiny.VertexBuffer.Types={Position:1,MaxPosition:3,TexCoord:4,MaxTexCoord:11,Normal:12,MaxNormal:18,Tangent:19,MaxTangent:25,Color:26,MaxColor:32,BlendWeight:33,MaxWeight:39,BlendIndex:40,MaxIndex:47};ZamModelViewer.Destiny.Skeleton=function(model,data){var self=this,i,j;if(!data||!data.anim||!data.bones){throw"Invalid skeleton data"}self.model=model;var anim=self.anim=data.anim;var bones=self.bones=data.bones;self.fps=30;self.frameDuration=1/self.fps;self.frameTime=0;self.frame=0;self.animFrames=new Array(anim.frame_count);var tmpMat=mat4.create();var staticBoneData=anim.static_bone_data,staticScaleMap=staticBoneData.scale_control_map,staticRotationMap=staticBoneData.rotation_control_map,staticTranslationMap=staticBoneData.translation_control_map,staticFrame=staticBoneData.transform_stream_header.streams.frames[0],staticScales=staticFrame.scales,staticRotations=staticFrame.rotations,staticTranslations=staticFrame.translations,animBoneData=anim.animated_bone_data,animScaleMap=animBoneData.scale_control_map,animRotationMap=animBoneData.rotation_control_map,animTranslationMap=animBoneData.translation_control_map,animTransformFrames=animBoneData.transform_stream_header.streams.frames;for(i=0;i<anim.frame_count;++i){var frameMats=new Array(anim.node_count);var frame=animTransformFrames[i];for(j=0;j<anim.node_count;++j){var staticScaleIdx=staticScaleMap.indexOf(j),staticRotIdx=staticRotationMap.indexOf(j),staticTransIdx=staticTranslationMap.indexOf(j);var animScaleIdx=animScaleMap.indexOf(j),animRotIdx=animRotationMap.indexOf(j),animTransIdx=animTranslationMap.indexOf(j);var scale=staticScaleIdx>=0?staticScales[staticScaleIdx]:frame.scales[animScaleIdx];var rot=staticRotIdx>=0?staticRotations[staticRotIdx]:frame.rotations[animRotIdx];var trans=staticTransIdx>=0?staticTranslations[staticTransIdx]:frame.translations[animTransIdx];mat4.fromQuat(tmpMat,rot);mat4.scale(tmpMat,tmpMat,[scale,scale,scale]);tmpMat[12]=trans[0];tmpMat[13]=trans[1];tmpMat[14]=trans[2];frameMats[j]=mat4.clone(tmpMat)}self.animFrames[i]=frameMats}self.frameMats=new Array(anim.node_count);self.finalMats=new Array(anim.node_count);for(i=0;i<anim.node_count;++i){self.frameMats[i]=mat4.create();self.finalMats[i]=mat4.create()}self.parentNodes=new Array(bones.definition.nodes.length);self.invMatrices=new Array(bones.definition.default_inverse_object_space_transforms.length);for(i=0;i<bones.definition.nodes.length;++i){self.parentNodes[i]=bones.definition.nodes[i].parent_node_index}for(i=0;i<bones.definition.default_inverse_object_space_transforms.length;++i){var info=bones.definition.default_inverse_object_space_transforms[i];mat4.fromQuat(tmpMat,info.r);mat4.scale(tmpMat,tmpMat,[info.ts[3],info.ts[3],info.ts[3]]);tmpMat[12]=info.ts[0];tmpMat[13]=info.ts[1];tmpMat[14]=info.ts[2];self.invMatrices[i]=mat4.clone(tmpMat)}};ZamModelViewer.Destiny.Skeleton.prototype={update:function(delta){var self=this;self.frameTime+=delta;while(self.frameTime>=self.frameDuration){self.frameTime-=self.frameDuration;self.frame++}while(self.frame>=self.anim.frame_count)self.frame-=self.anim.frame_count;var mat,frameMat,parentId;var mats=self.animFrames[self.frame];for(var i=0;i<self.anim.node_count;++i){mat=mats[i];frameMat=self.frameMats[i];parentId=self.parentNodes[i];if(parentId>=0){mat4.multiply(frameMat,self.frameMats[parentId],mat)}else{mat4.copy(frameMat,mat)}mat4.multiply(self.finalMats[i],frameMat,self.invMatrices[i])}}};ZamModelViewer.Lol=function(){};ZamModelViewer.Lol.Model=function(renderer,viewer,model,index,parent){var self=this;vec3.set(renderer.up,0,1,0);self.renderer=renderer;self.viewer=viewer;self.model=model;self.modelIndex=index;self.loaded=false;self.animsLoaded=false;self.opts=self.viewer.options;self.meta=null;self.parent=parent||null;self.texture=null;self.meshTextures={};self.animIndex=-1;self.animName=null;self.baseAnim=null;self.meshes=null;self.vertices=null;self.indices=null;self.transforms=null;self.bones=null;self.boneLookup={};self.matrix=mat4.create();self.ib=null;self.shaderReady=false;self.vs=null;self.fs=null;self.program=null;self.uniforms=null;self.attribs=null;self.ambientColor=[.35,.35,.35,1];self.primaryColor=[1,1,1,1];self.secondaryColor=[.35,.35,.35,1];self.lightDir1=vec3.create();self.lightDir2=vec3.create();self.lightDir3=vec3.create();vec3.normalize(self.lightDir1,[5,5,-5]);vec3.normalize(self.lightDir2,[5,5,5]);vec3.normalize(self.lightDir3,[-5,-5,-5]);self.animBounds=false;self.boundsCenter=[0,0,0];self.boundsSize=[0,0,0];self.boundsMin=[0,0,0];self.boundsMax=[0,0,0];self.modelOffset=0;self.defaultDistance=0;self.newAnimation=false;self.tmpMat=mat4.create();self.tmpVec=vec4.create();self.ANIMATED=true;self.hiddenBones=null;var hiddenBones=ZamModelViewer.Lol.Model.HiddenBones;if(hiddenBones[self.model.champion]!==undefined){if(hiddenBones[self.model.champion][self.model.skin]!==undefined){self.hiddenBones=hiddenBones[self.model.champion][self.model.skin]}}self.load()};ZamModelViewer.Models[ZamModelViewer.LOL]=ZamModelViewer.Lol.Model;ZamModelViewer.Lol.Model.prototype={external:{getNumAnimations:function(){return this.animations?this.animations.length:0},getAnimation:function(index){if(this.animations&&this.animations.length>index&&index>-1){return this.animations[index].name}else{return""}},setAnimation:function(name){for(i=0;i<this.renderer.models.length;++i){this.renderer.models[i].setAnimation(name)}},isLoaded:function(){return this.loaded&&this.animsLoaded}},destroy:function(){var self=this,gl=self.renderer.context,i,j;if(self.program)gl.deleteProgram(self.program);if(self.vs)gl.deleteShader(self.vs);if(self.fs)gl.deleteShader(self.fs);if(self.textures){for(i=0;i<self.textures.length;++i){self.textures[i].destroy()}}if(self.models){for(i=0;i<self.models.length;++i){self.models[i].destroy()}}if(self.geometry){for(i=0;i<self.geometry.length;++i){self.geometry[i].destroy()}}},getAnimation:function(name){var self=this,i,animIndex=-1;if(!self.animations)return animIndex;name=name.toLowerCase();if(name=="idle"||name=="attack"){var anims=[],re=new RegExp(name+"[0-9]*");for(i=0;i<self.animations.length;++i){if(self.animations[i].name.search(re)==0)anims.push(i)}if(anims.length>0){animIndex=anims[Math.randomInt(0,anims.length)]}}else{for(i=0;i<self.animations.length;++i){if(self.animations[i].name==name){animIndex=i;break}}}return animIndex},setAnimation:function(name){var self=this;self.animIndex=self.getAnimation(name);if(self.animIndex==-1){if(name=="idle"){self.animIndex=0;self.animName=self.animations[0].name}else{self.setAnimation("idle");return}}else{self.animName=name}var baseAnims=ZamModelViewer.Lol.Model.BaseAnimations;if(baseAnims[self.model.champion]!==undefined){if(baseAnims[self.model.champion][self.model.skin]!==undefined){var baseAnim=baseAnims[self.model.champion][self.model.skin],baseIndex=-1;if(baseAnim[self.animations[self.animIndex].name])baseIndex=self.getAnimation(baseAnim[self.animations[self.animIndex].name]);else if(baseAnim["all"])baseIndex=self.getAnimation(baseAnim["all"]);if(baseIndex>-1)self.baseAnim=self.animations[baseIndex];else self.baseAnim=null}}self.animTime=self.renderer.time;self.newAnimation=true},update:function(){var self=this,i,j,gl=self.renderer.context;if(!self.loaded||!self.vertices||!self.animations||self.animations.length==0)return;if(self.animIndex==-1)self.setAnimation("idle");var time=self.renderer.time-self.animTime;var anim=self.animations[self.animIndex];if(time>=anim.duration){self.setAnimation(self.animName);anim=self.animations[self.animIndex];time=0}if(self.ANIMATED){var timePerFrame=1e3/anim.fps;var frame=Math.floor(time/timePerFrame);var r=time%timePerFrame/timePerFrame;var hiddenBones={};if(self.hiddenBones){if(self.hiddenBones[anim.name])hiddenBones=self.hiddenBones[anim.name];else if(self.hiddenBones["all"])hiddenBones=self.hiddenBones["all"]}var b;if(self.version>=1){for(i=0;i<self.bones.length;++i){b=self.bones[i];if(hiddenBones[b.name]){mat4.identity(self.tmpMat);mat4.scale(self.tmpMat,self.tmpMat,vec3.set(self.tmpVec,0,0,0));mat4.copy(self.transforms[i],self.tmpMat)}else if(anim.lookup[b.name]!==undefined){anim.bones[anim.lookup[b.name]].update(i,frame,r)}else if(self.baseAnim&&self.baseAnim.lookup[b.name]!==undefined){self.baseAnim.bones[self.baseAnim.lookup[b.name]].update(i,frame,r)}else{if(b.parent!=-1){mat4.mulSlimDX(self.transforms[i],b.incrMatrix,self.transforms[b.parent])}else{mat4.copy(self.transforms[i],b.incrMatrix)}}}}else{for(i=0;i<anim.bones.length;++i){b=anim.bones[i];if(self.boneLookup[b.bone]!==undefined){b.update(self.boneLookup[b.bone],frame,r)}else{var parentBone=anim.bones[i-1];if(!parentBone)continue;if(parentBone.index+1<self.transforms.length){mat4.copy(self.transforms[parentBone.index+1],self.transforms[parentBone.index])}b.index=parentBone.index+1}}}var numBones=Math.min(self.transforms.length,self.bones.length);for(i=0;i<numBones;++i){mat4.mulSlimDX(self.transforms[i],self.bones[i].baseMatrix,self.transforms[i])}mat4.identity(self.tmpMat);var numVerts=self.vertices.length,vbData=self.vbData,vec=self.tmpVec,v,w,m,idx;for(i=0;i<numVerts;++i){v=self.vertices[i];idx=i*8;vbData[idx]=vbData[idx+1]=vbData[idx+2]=vbData[idx+3]=vbData[idx+4]=vbData[idx+5]=0;for(j=0;j<4;++j){if(v.weights[j]>0){w=v.weights[j];m=anim.fps==1?self.tmpMat:self.transforms[v.bones[j]];vec3.transformMat4(vec,v.position,m);vbData[idx]+=vec[0]*w;vbData[idx+1]+=vec[1]*w;vbData[idx+2]+=vec[2]*w;vec4.transformMat4(vec,v.normal,m);vbData[idx+3]+=vec[0]*w;vbData[idx+4]+=vec[1]*w;vbData[idx+5]+=vec[2]*w}}}if(!self.animBounds){self.updateBounds(true);self.animBounds=true}gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferSubData(gl.ARRAY_BUFFER,0,self.vbData)}if(self.newAnimation){self.updateBounds(true);self.newAnimation=false}},updatePosition:function(){var self=this,index=self.modelIndex,offset=self.renderer.models[0].boundsSize[0]*1.5;if(index>2){offset+=Math.abs(self.renderer.models[index-2].modelOffset)}if(self.modelIndex%2>0)offset=-offset;self.modelOffset=offset;mat4.identity(self.matrix);mat4.translate(self.matrix,self.matrix,vec3.negate(self.tmpVec,self.boundsCenter));mat4.scale(self.matrix,self.matrix,vec3.set(self.tmpVec,-1,1,1));vec3.normalize(self.tmpVec,vec3.set(self.tmpVec,4,0,-1));vec3.scale(self.tmpVec,self.tmpVec,offset);if(offset<0)self.tmpVec[2]=-self.tmpVec[2];self.matrix[12]+=self.tmpVec[0];self.matrix[13]+=self.tmpVec[1];self.matrix[14]+=self.tmpVec[2]},updateBounds:function(useVb){var self=this,i,j,m,idx,verts=self.vertices,vbData=self.vbData;var min=vec3.set(self.boundsMin,9999,9999,9999),max=vec3.set(self.boundsMax,-9999,-9999,-9999),pos;if(!verts)return;if(self.meshes&&self.indices){var firstIndex,numIndices,visible;for(i=0;i<self.meshes.length;++i){m=self.meshes[i];visible=!(self.meta&&self.meta.meshVis[m.name]===false);if(!visible)continue;firstIndex=m.iStart;numIndices=m.iCount;for(j=0;j<numIndices;++j){if(useVb){idx=self.indices[firstIndex+j]*8;pos=vec3.set(self.tmpVec,vbData[idx],vbData[idx+1],vbData[idx+2])}else{pos=vec3.copy(self.tmpVec,verts[self.indices[firstIndex+j]].position)}if(pos[1]<-250)pos[1]=min[1];min=vec3.min(min,min,pos);max=vec3.max(max,max,pos)}}}else{for(i=0;i<verts.length;++i){if(useVb){idx=i*8;pos=vec3.set(self.tmpVec,vbData[idx],vbData[idx+1],vbData[idx+2])}else{pos=vec3.copy(self.tmpVec,verts[i].position)}if(pos[1]<-250)pos[1]=min[1];min=vec3.min(min,min,pos);max=vec3.max(max,max,pos)}}vec3.subtract(self.boundsSize,max,min);vec3.scaleAndAdd(self.boundsCenter,min,self.boundsSize,.5);vec3.copy(self.tmpVec,self.boundsCenter);self.tmpVec[1]=-self.tmpVec[1];mat4.identity(self.matrix);mat4.translate(self.matrix,self.matrix,self.tmpVec);mat4.scale(self.matrix,self.matrix,vec3.set(self.tmpVec,-1,1,1));var models=self.renderer.models;if(models.length>1){for(i=1;i<models.length;++i){models[i].updatePosition()}if(self.modelIndex!=0)models[0].updateDistance()}if(self.modelIndex==0){self.updateDistance()}},updateDistance:function(){var self=this,models=self.renderer.models;var wSize=self.boundsSize[0],hSize=self.boundsSize[1],dSize=self.boundsSize[2];if(models.length>1){var width=Math.abs(models[models.length-1].modelOffset)+models[models.length-1].boundsSize[0];if(models.length>2){width+=Math.abs(models[models.length-2].modelOffset)+models[models.length-2].boundsSize[0]}else{width*=2}wSize=Math.max(wSize,width)}var dist;if(self.opts.dist){dist=self.opts.dist}else{var ratio=self.renderer.width/self.renderer.height;var hTan=2*Math.tan(self.renderer.fov/2*.0174532925);var wTan=hTan*ratio;var hDist=hSize*1.2/hTan;var wDist=wSize*1.2/wTan;dist=Math.max(Math.max(hDist,wDist),dSize*2)}if(self.defaultDistance==0||self.defaultDistance==self.renderer.distance){self.defaultDistance=self.renderer.distance=dist}}};ZamModelViewer.Lol.Model.prototype.load=function(){var self=this;if(self.model&&self.model.champion!==undefined&&self.model.skin!==undefined){self._load(self.model.champion,self.model.skin)}};ZamModelViewer.Lol.Model.prototype._load=function(champion,skin){var self=this;self.champion=champion;self.skin=skin;$.getJSON(self.opts.contentPath+"meta/"+champion+"_"+skin+".json",function(data){self.loadMeta(data)});var url=self.opts.contentPath+"models/"+champion+"_"+skin+".lmesh";$.ajax({url:url,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:false,renderer:self.renderer,success:function(buffer){self.loadMesh(buffer)},error:function(xhr,status,error){console.log(error)}})};ZamModelViewer.Lol.Model.prototype.loadMeta=function(meta){var self=this;self.meta=meta;if(self.animations)self.updateBounds(self.animBounds);for(var t in meta.meshTextures){self.meshTextures[t]=new ZamModelViewer.Lol.Texture(self,self.champion+"/"+meta.meshTextures[t]+".png")}};ZamModelViewer.Lol.Model.prototype.loadMesh=function(buffer){if(!buffer){console.error("Bad buffer for DataView");return}var self=this,r=new ZamModelViewer.DataView(buffer),i,v,idx,Lol=ZamModelViewer.Lol;var gl=self.renderer.context;var magic=r.getUint32();if(magic!=604210091){console.log("Bad magic value");return}self.version=r.getUint32();var animFile=r.getString();var textureFile=r.getString();if(animFile&&animFile.length>0){var url=self.opts.contentPath+"models/"+animFile+".lanim";$.ajax({url:url,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:false,renderer:self.renderer,success:function(buffer){self.loadAnim(buffer)},error:function(xhr,status,error){console.log(error)}})}if(textureFile&&textureFile.length>0){self.texture=new Lol.Texture(self,self.champion+"/"+textureFile+".png")}var numMeshes=r.getUint32();if(numMeshes>0){self.meshes=new Array(numMeshes);for(i=0;i<numMeshes;++i){var name=r.getString().toLowerCase();var vStart=r.getUint32();var vCount=r.getUint32();var iStart=r.getUint32();var iCount=r.getUint32();self.meshes[i]={name:name,vStart:vStart,vCount:vCount,iStart:iStart,iCount:iCount}}}var numVerts=r.getUint32();if(numVerts>0){self.vertices=new Array(numVerts);self.vbData=new Float32Array(numVerts*8);for(i=0;i<numVerts;++i){idx=i*8;self.vertices[i]=v=new Lol.Vertex(r);self.vbData[idx]=v.position[0];self.vbData[idx+1]=v.position[1];self.vbData[idx+2]=v.position[2];self.vbData[idx+3]=v.normal[0];self.vbData[idx+4]=v.normal[1];self.vbData[idx+5]=v.normal[2];self.vbData[idx+6]=v.u;self.vbData[idx+7]=v.v}}var numIndices=r.getUint32();if(numIndices>0){self.indices=new Array(numIndices);for(i=0;i<numIndices;++i){self.indices[i]=r.getUint16()}}var numBones=r.getUint32();if(numBones>0){self.transforms=new Array(numBones);self.bones=new Array(numBones);for(i=0;i<numBones;++i){self.bones[i]=new Lol.Bone(self,i,r);if(self.boneLookup[self.bones[i].name]!==undefined){self.bones[i].name=self.bones[i].name+"2"}self.boneLookup[self.bones[i].name]=i;self.transforms[i]=new mat4.create}}if(self.vbData){self.vb=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferData(gl.ARRAY_BUFFER,self.vbData,gl.DYNAMIC_DRAW)}if(self.indices){self.ib=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(self.indices),gl.STATIC_DRAW)}self.loaded=true;self.updateBounds()};ZamModelViewer.Lol.Model.prototype.loadAnim=function(buffer){if(!buffer){console.error("Bad buffer for DataView");return}var self=this,r=new ZamModelViewer.DataView(buffer),i,Lol=ZamModelViewer.Lol;var magic=r.getUint32();if(magic!=604210092){console.log("Bad magic value");return}var version=r.getUint32();if(version>=2){var compressedData=new Uint8Array(buffer,r.position);var data=null;try{data=pako.inflate(compressedData)}catch(err){console.log("Decompression error: "+err);return}r=new ZamModelViewer.DataView(data.buffer)}var numAnims=r.getUint32();if(numAnims>0){self.animations=new Array(numAnims);for(i=0;i<numAnims;++i){self.animations[i]=new Lol.Animation(self,r,version)}}self.animsLoaded=true};ZamModelViewer.Lol.Model.prototype.draw=function(){var self=this,gl=self.renderer.context,i;if(!self.loaded)return;if(!self.shaderReady)self.initShader();if(!self.program)return;self.update();gl.useProgram(self.program);gl.uniformMatrix4fv(self.uniforms.vModelMatrix,false,self.matrix);gl.uniformMatrix4fv(self.uniforms.vViewMatrix,false,self.renderer.viewMatrix);gl.uniformMatrix4fv(self.uniforms.vProjMatrix,false,self.renderer.projMatrix);gl.uniform4fv(self.uniforms.fAmbientColor,self.ambientColor);gl.uniform4fv(self.uniforms.fPrimaryColor,self.primaryColor);gl.uniform4fv(self.uniforms.fSecondaryColor,self.secondaryColor);gl.uniform3fv(self.uniforms.fLightDir1,self.lightDir1);gl.uniform3fv(self.uniforms.fLightDir2,self.lightDir2);gl.uniform3fv(self.uniforms.fLightDir3,self.lightDir3);gl.uniform1i(self.uniforms.fTexture,0);gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);var cull=gl.getParameter(gl.CULL_FACE);if(!cull)gl.enable(gl.CULL_FACE);var face=gl.getParameter(gl.FRONT_FACE);if(face!=gl.CW)gl.frontFace(gl.CW);for(i in self.attribs){var a=self.attribs[i];gl.enableVertexAttribArray(a.loc);gl.vertexAttribPointer(a.loc,a.size,a.type,false,a.stride,a.offset)}if(self.meshes){var m,visible;for(i=0;i<self.meshes.length;++i){m=self.meshes[i];visible=!(self.meta&&self.meta.meshVis[m.name]===false);if(self.meta&&self.meta.animMeshVis[self.animName]!==undefined&&self.meta.animMeshVis[self.animName][m.name]!==undefined)visible=self.meta.animMeshVis[self.animName][m.name];if(!visible)continue;if(self.meshTextures[m.name]!==undefined){if(self.meshTextures[m.name].texture){gl.uniform1i(self.uniforms.fHasTexture,true);gl.bindTexture(gl.TEXTURE_2D,self.meshTextures[m.name].texture)}else{gl.uniform1i(self.uniforms.fHasTexture,false)}}else if(self.texture&&self.texture.texture){gl.uniform1i(self.uniforms.fHasTexture,true);gl.bindTexture(gl.TEXTURE_2D,self.texture.texture)}else{gl.uniform1i(self.uniforms.fHasTexture,false)}gl.drawElements(gl.TRIANGLES,m.iCount,gl.UNSIGNED_SHORT,m.iStart*2)}}else{if(self.texture&&self.texture.texture){gl.uniform1i(self.uniforms.fHasTexture,true);gl.bindTexture(gl.TEXTURE_2D,self.texture.texture)}else{gl.uniform1i(self.uniforms.fHasTexture,false)}
gl.drawElements(gl.TRIANGLES,self.indices.length,gl.UNSIGNED_SHORT,0)}for(i in self.attribs){gl.disableVertexAttribArray(self.attribs[i].loc)}if(!cull)gl.disable(gl.CULL_FACE);if(face==gl.CCW)gl.frontFace(gl.CCW)};ZamModelViewer.Lol.Model.prototype.initShader=function(){var self=this,gl=self.renderer.context;self.shaderReady=true;var vs=self.renderer.compileShader(gl.VERTEX_SHADER,self.vertShader);var fs=self.renderer.compileShader(gl.FRAGMENT_SHADER,self.fragShader);var program=gl.createProgram();gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Error linking shaders");return}self.vs=vs;self.fs=fs;self.program=program;self.uniforms={vModelMatrix:gl.getUniformLocation(program,"uModelMatrix"),vViewMatrix:gl.getUniformLocation(program,"uViewMatrix"),vProjMatrix:gl.getUniformLocation(program,"uProjMatrix"),fHasTexture:gl.getUniformLocation(program,"uHasTexture"),fAmbientColor:gl.getUniformLocation(program,"uAmbientColor"),fPrimaryColor:gl.getUniformLocation(program,"uPrimaryColor"),fSecondaryColor:gl.getUniformLocation(program,"uSecondaryColor"),fLightDir1:gl.getUniformLocation(program,"uLightDir1"),fLightDir2:gl.getUniformLocation(program,"uLightDir2"),fLightDir3:gl.getUniformLocation(program,"uLightDir3"),fTexture:gl.getUniformLocation(program,"uTexture")};self.attribs={position:{loc:gl.getAttribLocation(program,"aPosition"),type:gl.FLOAT,size:3,offset:0,stride:32},normal:{loc:gl.getAttribLocation(program,"aNormal"),type:gl.FLOAT,size:3,offset:12,stride:32},texcoord:{loc:gl.getAttribLocation(program,"aTexCoord"),type:gl.FLOAT,size:2,offset:24,stride:32}}};ZamModelViewer.Lol.Model.prototype.vertShader="    attribute vec3 aPosition;    attribute vec3 aNormal;    attribute vec2 aTexCoord;        varying vec3 vNormal;    varying vec2 vTexCoord;        uniform mat4 uModelMatrix;    uniform mat4 uViewMatrix;    uniform mat4 uProjMatrix;        void main(void) {        gl_Position = uProjMatrix * uViewMatrix * uModelMatrix * vec4(aPosition, 1);        vNormal = mat3(uViewMatrix * uModelMatrix) * normalize(aNormal);        vTexCoord = aTexCoord;    }";ZamModelViewer.Lol.Model.prototype.fragShader="    precision mediump float;        varying vec3 vNormal;    varying vec2 vTexCoord;        uniform bool uHasTexture;    uniform vec4 uAmbientColor;    uniform vec4 uPrimaryColor;    uniform vec4 uSecondaryColor;    uniform vec3 uLightDir1;    uniform vec3 uLightDir2;    uniform vec3 uLightDir3;    uniform sampler2D uTexture;        void main(void) {        vec4 color = vec4(1, 1, 1, 1);        if (uHasTexture) {            color = texture2D(uTexture, vTexCoord.st);        } else {            color = vec4(vTexCoord.st, 0, 1);        }                vec4 litColor = uAmbientColor;        vec3 normal = normalize(vNormal);                float dp = max(0.0, dot(normal, uLightDir1));        litColor += uPrimaryColor * dp;                dp = max(0.0, dot(normal, uLightDir2));        litColor += uSecondaryColor * dp;                dp = max(0.0, dot(normal, uLightDir3));        litColor += uSecondaryColor * dp;                litColor = clamp(litColor, vec4(0,0,0,0), vec4(1,1,1,1));        color *= litColor;                gl_FragColor = color;    }";ZamModelViewer.Lol.Texture=function(model,url){var self=this;self.model=model;self.url=model.opts.contentPath+"textures/"+url;self.texture=null;self.load()};ZamModelViewer.Lol.Texture.prototype={destroy:function(){var self=this,gl=self.model.renderer.context;if(self.texture)gl.deleteTexture(self.texture);self.img=null},load:function(){var self=this,gl=self.model.renderer.context;(function(self,gl){self.img=new Image;self.img.crossOrigin="";self.img.onload=function(){self.img.loaded=true;self.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.img);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR)};self.img.onerror=function(){self.img=null;self.error=true};self.img.src=self.url})(self,gl)}};ZamModelViewer.Lol.Vertex=function(r){var self=this,i;self.position=[r.getFloat(),r.getFloat(),r.getFloat()];self.normal=[r.getFloat(),r.getFloat(),r.getFloat(),0];self.u=r.getFloat();self.v=r.getFloat();self.bones=new Array(4);for(i=0;i<4;++i)self.bones[i]=r.getUint8();self.weights=new Array(4);for(i=0;i<4;++i)self.weights[i]=r.getFloat()};ZamModelViewer.Lol.Bone=function(model,index,r){var self=this,i;self.model=model;self.index=index;self.name=r.getString().toLowerCase();self.parent=r.getInt32();self.scale=r.getFloat();self.origMatrix=mat4.create();for(i=0;i<16;++i)self.origMatrix[i]=r.getFloat();self.baseMatrix=mat4.clone(self.origMatrix);mat4.transpose(self.baseMatrix,self.baseMatrix);mat4.invert(self.baseMatrix,self.baseMatrix);mat4.transpose(self.origMatrix,self.origMatrix);self.incrMatrix=mat4.create();if(model.version>=2){for(i=0;i<16;++i)self.incrMatrix[i]=r.getFloat();mat4.transpose(self.incrMatrix,self.incrMatrix)}else{mat4.identity(self.incrMatrix)}};ZamModelViewer.Lol.Animation=function(model,r,version){var self=this,i,Lol=ZamModelViewer.Lol;self.model=model;self.meshOverride={};self.name=r.getString().toLowerCase();self.fps=r.getInt32();var numBones=r.getUint32();self.bones=new Array(numBones);self.lookup={};for(i=0;i<numBones;++i){self.bones[i]=new Lol.AnimationBone(model,self,r,version);self.lookup[self.bones[i].bone]=i}if(numBones==0||self.fps<=1){self.duration=1e3}else{self.duration=Math.floor(1e3*(self.bones[0].frames.length/self.fps))}};ZamModelViewer.Lol.AnimationBone=function(model,anim,r,version){var self=this;self.model=model;self.anim=anim;var numFrames=r.getUint32();self.bone=r.getString().toLowerCase();self.flags=r.getUint32();self.frames=new Array(numFrames);var scale=[1,1,1];for(var i=0;i<numFrames;++i){var pos=[r.getFloat(),r.getFloat(),r.getFloat()];var rot=[r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat()];if(version>=3)scale=[r.getFloat(),r.getFloat(),r.getFloat()];self.frames[i]={pos:pos,rot:rot,scale:scale}}self.matrix=mat4.create();self.tmpMat=mat4.create();self.tmpMat2=mat4.create();self.tmpPos=vec3.create();self.tmpRot=quat.create();self.tmpScale=vec3.create()};ZamModelViewer.Lol.AnimationBone.prototype.update=function(boneId,frame,r){var self=this;self.index=boneId;var parent=self.model.bones[boneId].parent;var f0=frame%self.frames.length,f1=(frame+1)%self.frames.length;vec3.lerp(self.tmpPos,self.frames[f0].pos,self.frames[f1].pos,r);vec3.lerp(self.tmpScale,self.frames[f0].scale,self.frames[f1].scale,r);quat.slerp(self.tmpRot,self.frames[f0].rot,self.frames[f1].rot,r);mat4.translation(self.tmpMat2,self.tmpPos);mat4.rotationQuat(self.tmpMat,self.tmpRot);mat4.mulSlimDX(self.matrix,self.tmpMat,self.tmpMat2);if(parent!=-1){mat4.mulSlimDX(self.matrix,self.matrix,self.model.transforms[parent])}mat4.copy(self.model.transforms[boneId],self.matrix)};ZamModelViewer.Lol.Model.BaseAnimations={32:{4:{all:"idle1_bow",idle1_bow:"idle1"}},55:{7:{idle1_candycane_below:"idle1"}}};ZamModelViewer.Lol.Model.HiddenBones={55:{7:{recall:{},all:{xmas_pole:true}}},115:{4:{all:{sled:true},satcheljump:{bomb:true,bomb_b:true}}},201:{3:{all:{poro:true}}},254:{0:{all:{teacup:true},taunt2:{}},1:{all:{teacup:true},taunt2:{}},3:{all:{teacup:true},taunt2:{}},4:{all:{teacup:true},taunt2:{}}},412:{1:{all:{coin1:true,coin2:true,coin3:true,coin4:true,coin5:true,coin6:true,coin7:true,treasure_chest:true,treasure_chest_cover:true,tire:true},recall:{tire:true},undersea_recall_loop:{tire:true},undersea_recall_loop2:{coin1:true,coin2:true,coin3:true,coin4:true,coin5:true,coin6:true,coin7:true,treasure_chest:true,treasure_chest_cover:true},undersea_recall_windup:{tire:true},undersea_recall_windup2:{coin1:true,coin2:true,coin3:true,coin4:true,coin5:true,coin6:true,coin7:true,treasure_chest:true,treasure_chest_cover:true}}},420:{0:{all:{c_tentacle1:true}},1:{all:{c_tentacle1:true}}}};ZamModelViewer.Heroes=function(){};ZamModelViewer.Heroes.Model=function(renderer,viewer,model,parent){var self=this;self.renderer=renderer;self.viewer=viewer;self.model=model;self.modelPath=null;self.ready=false;self.parent=parent;self.opts=self.viewer.options;self.meta=null;self.vertices=null;self.indices=null;self.materialLookup=null;self.materials=null;self.meshes=null;self.bones=null;self.boneLookup=null;self.boneNameLookup={};self.baseMatrices=null;self.animations=null;self.animData=null;self.animDataLookup=null;self.anims=null;self.textures={};self.matrix=mat4.create();self.ib=null;self.shaderReady=false;self.vs=null;self.fs=null;self.program=null;self.uniforms=null;self.attribs=null;self.ambientColor=[.35,.35,.35,1];self.primaryColor=[1,1,1,1];self.secondaryColor=[.35,.35,.35,1];self.lightDir1=vec3.create();self.lightDir2=vec3.create();self.lightDir3=vec3.create();vec3.normalize(self.lightDir1,[-3,-3,-3]);vec3.normalize(self.lightDir2,[3,-1,-3]);vec3.normalize(self.lightDir3,[3,2,2]);self.lightIntensity=vec4.set(vec4.create(),.75,.25,.25,.35);self.animBounds=false;self.boundsCenter=[0,0,0];self.boundsSize=[0,0,0];self.boundsMin=[0,0,0];self.boundsMax=[0,0,0];self.animTime=0;self.lastTime=self.renderer.time;self.tmpMat=mat4.create();self.tmpVec=vec4.create();self.tmpVec2=vec4.create();self.tmpQuat=quat.create();self.load()};ZamModelViewer.Models[ZamModelViewer.HEROES]=ZamModelViewer.Heroes.Model;ZamModelViewer.Heroes.disabledAnims={herofalstad:true,falstaddarkiron:true,falstadnordic:true,falstadskinultimate:true,falstadultimatered:true,falstadultimatewhite:true,falstadstormlord:true,falstadstormlorddarkiron:true,falstadstormlordnordic:true,tyraelskinseraphimchampion:true,tyraelseraphimsand:true,tyraelseraphimdark:true};ZamModelViewer.Heroes.Model.prototype={external:{isLoaded:function(){return this.ready}},destroy:function(){var self=this,gl=self.renderer.context,i,j;if(self.program)gl.deleteProgram(self.program);if(self.vs)gl.deleteShader(self.vs);if(self.fs)gl.deleteShader(self.fs);if(self.vb)gl.deleteBuffer(self.vb);if(self.ib)gl.deleteBuffer(self.ib);self.program=self.vs=self.fs=self.vb=self.ib=null;self.vbData=null},update:function(){var self=this,i,j,k;self.animTime+=self.renderer.time-self.lastTime;self.lastTime=self.renderer.time;if(!self.ready||!self.vertices)return;var vertLength=10;if(self.currentAnim&&!ZamModelViewer.Heroes.disabledAnims[self.model]){var numBones=self.bones.length,bone,startBone,animBone,anim=self.currentAnim,animModel=self.currentAnimModel;var hasScale,hasRot,hasTrans;for(i=0;i<numBones;++i){startBone=bone=self.bones[i];mat4.identity(startBone.matrix);while(bone){if(animModel.boneNameLookup[bone.name]){animBone=animModel.bones[animModel.boneNameLookup[bone.name]]}else{animBone=null}hasScale=hasRot=hasTrans=false;if(animBone&&animModel.animDataLookup.length>0){var animDataIndex=animModel.animDataLookup[anim.index].indices[0];var animData=animModel.animData[animDataIndex];var numIds=animData.animIds.length;for(j=0;j<numIds;++j){if(animBone.translation.animId==animData.animIds[j]){var transData=animData.translations[animData.animIndices[j].animIndex];transData.getValue(self.animTime,self.tmpVec);hasTrans=true}if(animBone.rotation.animId==animData.animIds[j]){var rotData=animData.rotations[animData.animIndices[j].animIndex];rotData.getValue(self.animTime,self.tmpQuat);hasRot=true}if(animBone.scale.animId==animData.animIds[j]){var scaleData=animData.translations[animData.animIndices[j].animIndex];scaleData.getValue(self.animTime,self.tmpVec2);hasScale=true}}}if(!hasTrans)vec3.copy(self.tmpVec,bone.translation.value);if(!hasRot)quat.copy(self.tmpQuat,bone.rotation.value);if(!hasScale)vec3.copy(self.tmpVec2,bone.scale.value);mat4.fromQuat(self.tmpMat,self.tmpQuat);mat4.scale(self.tmpMat,self.tmpMat,self.tmpVec2);self.tmpMat[12]=self.tmpVec[0];self.tmpMat[13]=self.tmpVec[1];self.tmpMat[14]=self.tmpVec[2];bone.scaleLength=self.tmpVec2[0];mat4.multiply(startBone.matrix,self.tmpMat,startBone.matrix);if(bone.parentId>-1){bone=self.bones[bone.parentId]}else{bone=null}}if(!startBone.show)mat4.scale(startBone.matrix,startBone.matrix,vec3.set(self.tmpVec,0,0,0));if(animModel.boneNameLookup[startBone.name]!==undefined&&animModel.baseMatrices.length>animModel.boneNameLookup[startBone.name]){mat4.multiply(startBone.matrix,startBone.matrix,animModel.baseMatrices[animModel.boneNameLookup[startBone.name]])}else if(self.baseMatrices&&self.baseMatrices.length>i){mat4.multiply(startBone.matrix,startBone.matrix,self.baseMatrices[i])}}var m,v,w,b,boneIndex,vertStart,vertCount,idx,vbData=self.vbData,tmpVec=self.tmpVec,tmpVec2=self.tmpVec2;for(i=0;i<self.meshes.length;++i){m=self.meshes[i];if(!m.show)continue;boneIndex=m.boneIndex;vertStart=m.vStart;vertCount=m.vCount;for(j=0;j<vertCount;++j){v=self.vertices[vertStart+j];idx=(j+vertStart)*vertLength;vbData[idx]=vbData[idx+1]=vbData[idx+2]=vbData[idx+3]=vbData[idx+4]=vbData[idx+5]=0;for(k=0;k<4;++k){if(v.weights[k]==0)continue;w=v.weights[k]/255;b=self.bones[self.boneLookup[boneIndex+v.bones[k]]];vec3.transformMat4(tmpVec,v.position,b.matrix);vec4.transformMat4(tmpVec2,v.normal,b.matrix);vbData[idx]+=tmpVec[0]*w;vbData[idx+1]+=tmpVec[1]*w;vbData[idx+2]+=tmpVec[2]*w;vbData[idx+3]+=tmpVec2[0]*w;vbData[idx+4]+=tmpVec2[1]*w;vbData[idx+5]+=tmpVec2[2]*w}vec3.set(v.transPosition,vbData[idx],vbData[idx+1],vbData[idx+2]);vec4.set(v.transNormal,vbData[idx+3],vbData[idx+4],vbData[idx+5],0)}}self.updateBuffers();if(!self.animBounds){self.updateBounds();self.animBounds=true}}},updateBuffers:function(){var self=this,gl=self.renderer.context;if(!self.vbData){var vertLength=10;var vbLength=self.vertices.length*vertLength;self.vbData=new Float32Array(vbLength);var v,numVerts=self.vertices.length,vbData=self.vbData,base;for(var i=0,j=0;j<numVerts;i+=vertLength,++j){v=self.vertices[j];vbData[i]=v.transPosition[0];vbData[i+1]=v.transPosition[1];vbData[i+2]=v.transPosition[2];vbData[i+3]=v.transNormal[0];vbData[i+4]=v.transNormal[1];vbData[i+5]=v.transNormal[2];vbData[i+6]=v.uv1.u;vbData[i+7]=v.uv1.v;if(self.hasUv2){vbData[i+8]=v.uv2.u;vbData[i+9]=v.uv2.v}else{vbData[i+8]=vbData[i+9]=0}}self.vb=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferData(gl.ARRAY_BUFFER,self.vbData,gl.DYNAMIC_DRAW)}else{gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);gl.bufferSubData(gl.ARRAY_BUFFER,0,self.vbData)}},draw:function(){var self=this,gl=self.renderer.context,i;if(!self.ready)return;if(!self.shaderReady)self.initShader();if(!self.program)return;self.update();gl.useProgram(self.program);gl.frontFace(gl.CCW);gl.uniformMatrix4fv(self.uniforms.vModelMatrix,false,self.matrix);gl.uniformMatrix4fv(self.uniforms.vViewMatrix,false,self.renderer.viewMatrix);gl.uniformMatrix4fv(self.uniforms.vProjMatrix,false,self.renderer.projMatrix);gl.uniform4fv(self.uniforms.fLightIntensity,self.lightIntensity);gl.uniform3fv(self.uniforms.fLightDir1,self.lightDir1);gl.uniform3fv(self.uniforms.fLightDir2,self.lightDir2);gl.uniform3fv(self.uniforms.fLightDir3,self.lightDir3);gl.uniform3fv(self.uniforms.fCameraPos,self.renderer.eye);gl.uniform1i(self.uniforms.vHasUv2,self.hasUv2);gl.bindBuffer(gl.ARRAY_BUFFER,self.vb);for(i in self.attribs){var a=self.attribs[i];gl.enableVertexAttribArray(a.loc);gl.vertexAttribPointer(a.loc,a.size,a.type,false,a.stride,a.offset)}if(self.meshes){for(i=0;i<self.meshes.length;++i){if(!self.meshes[i].show)continue;self.meshes[i].draw()}}for(i in self.attribs){gl.disableVertexAttribArray(self.attribs[i].loc)}},getMaterial:function(idx){var self=this;if(idx>=self.materialLookup.length||self.materialLookup[idx].type!=1)return null;return self.materials[self.materialLookup[idx].index]},setAnimation:function(name){var self=this,i,j;self.animTime=0;if(self.animations){for(i=0;i<self.animations.length;++i){if(self.animations[i].name==name){self.currentAnim=self.animations[i];self.currentAnimModel=self;return}}}if(self.anims){for(i=0;i<self.anims.length;++i){if(!self.anims[i].animations)continue;for(j=0;j<self.anims[i].animations.length;++j){if(self.anims[i].animations[j].name==name){self.currentAnim=self.anims[i].animations[j];self.currentAnimModel=self.anims[i];return}}}}if(self.animations.length>0){self.currentAnim=self.animations[0];self.currentAnimModel=self}else{self.currentAnim=null;self.currentAnimModel=null}},onAnimLoaded:function(){var self=this;if(self.anims){for(var i=0;i<self.anims.length;++i){if(!self.anims[i].ready)break}}self.animsLoaded=true;self.setAnimation("Stand")},updateBounds:function(skipSizing){var self=this,i,j,m,p;var min=self.boundsMin,max=self.boundsMax;if(!skipSizing){vec3.set(min,9999,9999,9999);vec3.set(max,-9999,-9999,-9999);for(i=0;i<self.meshes.length;++i){m=self.meshes[i];if(!m.show)continue;for(j=0;j<m.vCount;++j){p=self.vertices[m.vStart+j].transPosition;if(Math.abs(p[0])>15||Math.abs(p[1])>15||Math.abs(p[2])>15)continue;min=vec3.min(min,min,p);max=vec3.max(max,max,p)}}}vec3.subtract(self.boundsSize,max,min);vec3.scaleAndAdd(self.boundsCenter,min,self.boundsSize,.5);var hSize=self.boundsSize[2],wSize=self.boundsSize[0],dSize=self.boundsSize[1];if(!self.parent){if(self.opts.dist){self.renderer.distance=self.opts.dist}else{var ratio=self.renderer.width/self.renderer.height;var hTan=2*Math.tan(self.renderer.fov/2*.0174532925);var wTan=hTan*ratio;var hDist=(dSize*.5+hSize*1.2)/hTan;var wDist=(dSize*.5+wSize*1.2)/wTan;self.renderer.distance=Math.max(Math.max(hDist,wDist),dSize*1.25)}mat4.identity(self.matrix);mat4.rotateZ(self.matrix,self.matrix,Math.PI);mat4.translate(self.matrix,self.matrix,vec3.negate(self.tmpVec,self.boundsCenter))}else{self.parent.updateBounds()}}};ZamModelViewer.Heroes.Model.prototype.load=function(){var self=this;if(!self.model)return;self._load(self.model)};ZamModelViewer.Heroes.Model.prototype._load=function(model){var self=this;$.getJSON(self.opts.contentPath+"meta/"+model+".json?"+(self.opts.cacheBuster||1),function(data){self.loadMeta(data)})};ZamModelViewer.Heroes.Model.prototype._loadModel=function(model){var self=this;var url;if(model.indexOf(".mdl")>-1){url=model}else{url="models/"+model+".mdl"}$.ajax({url:self.opts.contentPath+url+"?"+(self.opts.cacheBuster||1),type:"GET",dataType:"binary",responseType:"arraybuffer",processData:false,renderer:self.renderer,success:function(buffer){self.loadModel(buffer)},error:function(xhr,status,error){console.log(error)}})};ZamModelViewer.Heroes.Model.prototype.loadMeta=function(meta){var self=this;self.meta=meta;if(meta.Model){self._loadModel(meta.Model)}};ZamModelViewer.Heroes.Model.prototype.loadModel=function(buffer){if(!buffer){console.error("Bad buffer for DataView");return}var self=this,r=new ZamModelViewer.DataView(buffer),Heroes=ZamModelViewer.Heroes,i;var version=r.getUint32();if(version>2){console.log("Bad version");return}var numVertices=r.getInt32();self.vertices=new Array(numVertices);var uv2=self.hasUv2=r.getBool();var uv3=self.hasUv3=r.getBool();var uv4=self.hasUv4=r.getBool();var uv5=self.hasUv5=r.getBool();for(i=0;i<numVertices;++i){self.vertices[i]=new Heroes.Vertex(r,uv2,uv3,uv4,uv5)}var numIndices=r.getInt32();self.indices=new Array(numIndices);for(i=0;i<numIndices;++i)self.indices[i]=r.getUint16();var numMaterialLookup=r.getInt32();self.materialLookup=new Array(numMaterialLookup);for(i=0;i<numMaterialLookup;++i){self.materialLookup[i]={type:r.getUint32(),index:r.getUint32()}}var numMaterials=r.getInt32();self.materials=new Array(numMaterials);for(i=0;i<numMaterials;++i){self.materials[i]=new Heroes.Material(self,r)}var numMeshes=r.getInt32();self.meshes=new Array(numMeshes);for(i=0;i<numMeshes;++i){self.meshes[i]=new Heroes.Mesh(self,r)}var numBones=r.getInt32();self.bones=new Array(numBones);for(i=0;i<numBones;++i){self.bones[i]=new Heroes.Bone(self,i,r);self.boneNameLookup[self.bones[i].name]=i}var numBoneLookup=r.getInt32();self.boneLookup=new Array(numBoneLookup);for(i=0;i<numBoneLookup;++i)self.boneLookup[i]=r.getUint16();var numMatrices=r.getInt32();self.baseMatrices=new Array(numMatrices);for(i=0;i<numMatrices;++i){var mat=mat4.create();for(var j=0;j<16;++j){mat[j]=r.getFloat()}self.baseMatrices[i]=mat}var numAnimations=r.getInt32();self.animations=new Array(numAnimations);for(i=0;i<numAnimations;++i){self.animations[i]=new Heroes.Animation(i,r)}var numAnimData=r.getInt32();self.animData=new Array(numAnimData);for(i=0;i<numAnimData;++i){self.animData[i]=new Heroes.AnimData(r)}var numAnimDataLookup=r.getInt32();self.animDataLookup=new Array(numAnimDataLookup);for(i=0;i<numAnimDataLookup;++i){self.animDataLookup[i]=new Heroes.AnimData.Lookup(r)}var numAnimFiles=1,animFile;if(version>1){numAnimFiles=r.getInt32();self.anims=new Array(numAnimFiles);for(i=0;i<numAnimFiles;++i){animFile=r.getString();self.anims[i]=new Heroes.Model(self.renderer,self.viewer,null,self);self.anims[i]._loadModel(animFile)}}else{animFile=r.getString();if(animFile&&animFile.length>0){var anim=new Heroes.Model(self.renderer,self.viewer,null,self);anim._loadModel(animFile);self.anims=[anim]}}self.ready=true;if(!self.parent){self.meshes.sort(function(a,b){var m1=a.material,m2=b.material;var p1=m1?m1.priority:0,p2=m2?m2.priority:0;return p1-p2});var HM=ZamModelViewer.Heroes.Mesh.hiddenMeshes;if(HM[self.model]){for(i=0;i<self.meshes.length;++i){if(HM[self.model][i])self.meshes[i].show=false}}self.updateBuffers();self.updateBounds();if(!self.anims){self.setAnimation("Stand")}}else{self.parent.onAnimLoaded()}};ZamModelViewer.Heroes.Model.prototype.initShader=function(){var self=this,gl=self.renderer.context;self.shaderReady=true;var vs=self.renderer.compileShader(gl.VERTEX_SHADER,self.vertShader);var fs=self.renderer.compileShader(gl.FRAGMENT_SHADER,self.fragShader);var program=gl.createProgram();gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Error linking shaders");return}self.vs=vs;self.fs=fs;self.program=program;self.uniforms={vModelMatrix:gl.getUniformLocation(program,"uModelMatrix"),vViewMatrix:gl.getUniformLocation(program,"uViewMatrix"),vProjMatrix:gl.getUniformLocation(program,"uProjMatrix"),vHasUv2:gl.getUniformLocation(program,"uHasUv2"),fBlendMode:gl.getUniformLocation(program,"uBlendMode"),fHasDiffuse:gl.getUniformLocation(program,"uHasDiffuse"),fHasDiffuseAlpha:gl.getUniformLocation(program,"uHasDiffuseAlpha"),fDiffuse:gl.getUniformLocation(program,"uDiffuse"),fDiffuseAlpha:gl.getUniformLocation(program,"uDiffuseAlpha"),fLightIntensity:gl.getUniformLocation(program,"uLightIntensity"),fLightDir1:gl.getUniformLocation(program,"uLightDir1"),fLightDir2:gl.getUniformLocation(program,"uLightDir2"),fLightDir3:gl.getUniformLocation(program,"uLightDir3"),fCameraPos:gl.getUniformLocation(program,"uCameraPos")};self.attribs={position:{loc:gl.getAttribLocation(program,"aPosition"),type:gl.FLOAT,size:3,offset:0,stride:40},normal:{loc:gl.getAttribLocation(program,"aNormal"),type:gl.FLOAT,size:3,offset:12,stride:40},uv1:{loc:gl.getAttribLocation(program,"aUv1"),type:gl.FLOAT,size:2,offset:24,stride:40},uv2:{loc:gl.getAttribLocation(program,"aUv2"),type:gl.FLOAT,size:2,offset:32,stride:40}}};ZamModelViewer.Heroes.Model.prototype.vertShader="    attribute vec3 aPosition;    attribute vec3 aNormal;    attribute vec2 aUv1;    attribute vec2 aUv2;    attribute vec2 aUv3;    attribute vec2 aUv4;    attribute vec2 aUv5;        varying vec3 vPosition;    varying vec3 vNormal;    varying vec2 vTexCoord;        uniform mat4 uModelMatrix;    uniform mat4 uViewMatrix;    uniform mat4 uProjMatrix;    uniform bool uHasUv2;        void main(void) {        gl_Position = uProjMatrix * uViewMatrix * uModelMatrix * vec4(aPosition, 1);        vPosition = (uViewMatrix * uModelMatrix * vec4(aPosition, 1)).xyz;        vNormal = mat3(uViewMatrix * uModelMatrix) * aNormal;                if (uHasUv2) { vTexCoord = aUv2; }        else { vTexCoord = aUv1; }    }";ZamModelViewer.Heroes.Model.prototype.fragShader="    precision mediump float;        varying vec3 vPosition;    varying vec3 vNormal;    varying vec2 vTexCoord;        uniform int uBlendMode;    uniform bool uHasDiffuse;    uniform bool uHasDiffuseAlpha;    uniform sampler2D uDiffuse;    uniform sampler2D uDiffuseAlpha;    uniform vec3 uLightDir1;    uniform vec3 uLightDir2;    uniform vec3 uLightDir3;    uniform vec4 uLightIntensity;    uniform vec3 uCameraPos;        vec3 saturate(vec3 value) {        return clamp(value, 0.0, 1.0);    }        float saturate(float value) {        return clamp(value, 0.0, 1.0);    }        void main(void) {        vec4 color = vec4(1, 0, 1, 1);        if (uHasDiffuse) { color.rgb = texture2D(uDiffuse, vTexCoord).rgb; }        if ((uBlendMode == 1 || uBlendMode == 3 || uBlendMode == 6) && uHasDiffuseAlpha) { color.a = texture2D(uDiffuseAlpha, vTexCoord).r; }                vec3 normal = normalize(vNormal);        vec3 cameraDir = normalize(uCameraPos - vPosition);                vec3 litColor = color.rgb * uLightIntensity.a;                float facing = (-1.0 + 2.0 * float(gl_FrontFacing)) * -1.0;        float NdotL = saturate(dot(normal, uLightDir1) * facing);                litColor += color.rgb * NdotL * uLightIntensity.x;                NdotL = saturate(dot(normal, uLightDir2) * facing);                litColor += color.rgb * NdotL * uLightIntensity.y;                NdotL = saturate(dot(normal, uLightDir3) * facing);                litColor += color.rgb * NdotL * uLightIntensity.z;                color.rgb = saturate(litColor);                gl_FragColor = color;    }";ZamModelViewer.Heroes.Vertex=function(r,uv2,uv3,uv4,uv5){var self=this;self.position=[r.getFloat(),r.getFloat(),r.getFloat()];self.weights=[r.getUint8(),r.getUint8(),r.getUint8(),r.getUint8()];self.bones=[r.getUint8(),r.getUint8(),r.getUint8(),r.getUint8()];self.normal=[r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat()];self.tangent=[r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat()];self.uv1={u:r.getFloat(),v:r.getFloat()};if(uv2)self.uv2={u:r.getFloat(),v:r.getFloat()};if(uv3)self.uv3={u:r.getFloat(),v:r.getFloat()};if(uv4)self.uv4={u:r.getFloat(),v:r.getFloat()};if(uv5)self.uv5={u:r.getFloat(),v:r.getFloat()};self.transPosition=vec3.clone(self.position);self.transNormal=vec4.clone(self.normal)};ZamModelViewer.Heroes.Vertex.prototype={destroy:function(){var self=this;self.position=null;self.weights=null;self.bones=null;self.normal=null;self.tangent=null;self.uv1=self.uv2=self.uv3=self.uv4=self.uv5=null;self.transPosition=null;self.transNormal=null}};ZamModelViewer.Heroes.Material=function(model,r){var self=this,M=ZamModelViewer.Heroes.Material;self.model=model;self.name=r.getString();self.flags=r.getUint32();self.blendMode=r.getUint32();self.priority=r.getUint32();self.specularity=r.getFloat();self.cutoutThreshold=r.getUint32();self.specularMultiplier=r.getFloat();self.emissiveMultiplier=r.getFloat();self.layerBlend=r.getUint32();self.emissiveBlend=r.getUint32();self.specularType=r.getUint32();var numTextures=0;if(model.meta&&model.meta.Textures)numTextures=model.meta.Textures.length;var numLayers=r.getInt32();self.layers=new Array(numLayers);for(var i=0;i<numLayers;++i){var l=self.layers[i]=new M.Layer(r);if(l.path){if(M.overrides[model.model]&&M.overrides[model.model][self.name]&&M.overrides[model.model][self.name][i]){l.path=M.overrides[model.model][self.name][i];if(!model.parent){l.texture=self.getTexture(l.path)}}else if(i==M.Layer.Diffuse){for(var j=0;j<numTextures;++j){if(model.meta.Textures[j].indexOf("_diff")>-1){l.path=model.meta.Textures[j];break}}if(!model.parent){l.texture=self.getTexture(l.path)}}}}};ZamModelViewer.Heroes.Material.overrides={novaultimatewhiteteal:{Ultimate_Ponytail:{0:"storm_hero_novahairgrid_ultimate_blue_diff"}},novaskinultimate:{Ultimate_Ponytail:{0:"storm_hero_novahairgrid_ultimate_red_diff"}},novaultimatewhitepink:{Ultimate_Ponytail:{0:"storm_hero_novahairgrid_ultimate_pink_diff"}}};ZamModelViewer.Heroes.Material.blends={EyeLens:6};ZamModelViewer.Heroes.Material.prototype={destroy:function(){var self=this,i;if(self.layers){for(i=0;i<self.layers.length;++i){self.layers[i].destroy();self.layers[i]=null}self.layers=null}self.model=null},bind:function(blend){var self=this,gl=self.model.renderer.context,M=ZamModelViewer.Heroes.Material;if(M.blends[self.name])blend=M.blends[self.name];if(blend===null)blend=self.blendMode;switch(blend){case 0:gl.blendFunc(gl.ONE,gl.ZERO);break;case 1:gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);break;case 2:gl.blendFunc(gl.SRC_COLOR,gl.ONE);break;case 3:gl.blendFunc(gl.SRC_ALPHA,gl.ONE);break;case 4:case 5:gl.blendFunc(gl.DST_COLOR,gl.SRC_COLOR);break;case 6:gl.blendFunc(gl.ONE_MINUS_SRC_ALPHA,gl.SRC_ALPHA);break;default:gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);break}if((self.flags&8)>0){gl.disable(gl.CULL_FACE)}else{gl.enable(gl.CULL_FACE)}gl.uniform1i(self.model.uniforms.fBlendMode,blend);var t=self.layers[M.Layer.Diffuse].texture;if(t){if(t.texture){gl.bindTexture(gl.TEXTURE_2D,t.texture);gl.uniform1i(self.model.uniforms.fHasDiffuse,true);gl.uniform1i(self.model.uniforms.fDiffuse,0)}else{gl.uniform1i(self.model.uniforms.fHasDiffuse,false)}if(t.alphaTexture){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,t.alphaTexture);gl.uniform1i(self.model.uniforms.fHasDiffuseAlpha,true);gl.uniform1i(self.model.uniforms.fDiffuseAlpha,1);gl.activeTexture(gl.TEXTURE0)}else{gl.uniform1i(self.model.uniforms.fHasDiffuseAlpha,false)}}else{gl.uniform1i(self.model.uniforms.fHasDiffuse,false);gl.uniform1i(self.model.uniforms.fHasDiffuseAlpha,false)}},getTexture:function(path){var self=this;if(!self.model.textures[path]){self.model.textures[path]=new ZamModelViewer.Heroes.Texture(self.model,path+".png")}return self.model.textures[path]}};ZamModelViewer.Heroes.Material.Layer=function(r){var self=this;self.path=r.getString();self.color=r.getUint32();self.flags=r.getUint32();self.uvChannel=r.getUint32();self.alphaFlags=r.getUint32();self.uvAngle=[r.getFloat(),r.getFloat(),r.getFloat()];self.uvTiling=[r.getFloat(),r.getFloat()];self.brightness=r.getFloat();self.tintStrenght=r.getFloat();self.tintUnk1=r.getFloat();self.tintUnk2=r.getFloat();self.tintUnk3=r.getFloat()};ZamModelViewer.Heroes.Material.Layer.Diffuse=0;ZamModelViewer.Heroes.Material.Layer.Emissive=4;ZamModelViewer.Heroes.Material.Layer.Normal=10;ZamModelViewer.Heroes.Material.Layer.prototype={destroy:function(){var self=this;if(self.texture)self.texture.destroy();self.texture=null;self.uvAngle=null;self.uvTiling=null}};ZamModelViewer.Heroes.Mesh=function(model,r){var self=this,M=ZamModelViewer.Heroes.Mesh;self.model=model;self.materialId=r.getUint16();self.vStart=r.getUint32();self.vCount=r.getUint32();self.iStart=r.getUint32();self.iCount=r.getUint32();self.numBones=r.getUint16();self.boneIndex=r.getUint16();self.rootBone=r.getUint16();var indices=model.indices;self.indices=new Array(self.iCount);for(var i=0;i<self.iCount;++i){self.indices[i]=indices[self.iStart+i]+self.vStart}self.show=true;self.material=model.getMaterial(self.materialId);if(!self.material||(self.material.flags&32)>0)self.show=false;if(M.blendOverrides[model.model]!==undefined){self.blendOverride=M.blendOverrides[model.model]}else{self.blendOverride=null}};ZamModelViewer.Heroes.Mesh.blendOverrides={zagaraskininsectoid:0,zagarainsectoidblack:0,zagarainsectoidblue:0};ZamModelViewer.Heroes.Mesh.hiddenMeshes={heroarthas:{3:true,4:true},arthasblue:{3:true,4:true},arthaswhite:{3:true,4:true},arthasskindragonbone:{4:true,5:true},arthasfrostwyrmgreen:{4:true,5:true},arthasfrostwyrmred:{4:true,5:true},arthasskinlichprince:{1:true,2:true,5:true},arthaslichprincegreen:{1:true,2:true,5:true},arthaslichprincepurple:{1:true,2:true,5:true},arthasskinultimate:{1:true,3:true,5:true},arthasultimategreen:{1:true,3:true,5:true},arthasultimatepink:{1:true,3:true,5:true},herozeratul:{0:true,4:true},zeratulargent:{0:true,4:true},zeratulgreen:{0:true,4:true},zeratulskinhightemplar:{0:true,3:true},zeratulhightemplarorange:{0:true,3:true},zeratulhightemplarwhite:{0:true,3:true},zeratulskinninja:{3:true,2:true},zeratulroninteal:{3:true,2:true},zeratulroninyellow:{3:true,2:true},
zeratulskinultimate:{0:true,3:true},zeratulultimateblue:{0:true,3:true},zeratulultimatered:{0:true,3:true},heromurky:{1:true,2:true},murkyblue:{1:true,2:true},murkyorange:{1:true,2:true},murkyskingrunty:{1:true,4:true},murkygruntyblack:{1:true,4:true},murkygruntyred:{1:true,4:true},murkyskineaster:{1:true,3:true,4:true},murkyeasterwhite:{1:true,3:true,4:true},murkyeasterorange:{1:true,3:true,4:true},murkyskinultimate:{1:true,4:true},murkyultimateblue:{1:true,4:true},murkyultimateblack:{1:true,4:true},heromuradin:{0:true,1:true},muradiniron:{0:true,1:true},muradinred:{0:true,1:true},muradinskinkandyking:{0:true},muradinkandykingcaramel:{0:true},muradinkandykinggreen:{0:true},muradinskinmagni:{3:true},muradinmagniartic:{3:true},muradinmagnidarkiron:{3:true},muradinskinultimate:{1:true},muradinultimatedarkiron:{1:true},muradinultimatered:{1:true},herofalstad:{2:true},falstaddarkiron:{2:true},falstadnordic:{2:true},falstadskinultimate:{3:true},falstadultimatered:{3:true},falstadultimatewhite:{3:true},falstadstormlord:{2:true},falstadstormlorddarkiron:{2:true},falstadstormlordnordic:{2:true},zagaraskininsectoid:{0:true},zagarainsectoidblack:{0:true},zagarainsectoidblue:{0:true},tyrandeskinwarden:{2:true},tyrandewardenbloodelf:{2:true},tyrandewardenwhite:{2:true},herosylvanas:{2:true},sylvanasblue:{2:true},sylvanasred:{2:true},herojaina:{3:true},jainagreen:{3:true},jainablue:{3:true},herojainaskintempest:{4:true},jainatempestcrimson:{4:true},jainatempestjade:{4:true},herojainaskinultimate:{0:true},jainaultimatered:{0:true},jainaultimategray:{0:true},herobarbarian:{4:true},barbarianred:{4:true},barbarianblue:{4:true},barbarianwrathmodelfemale:{0:true},barbarianwrathfemalered:{0:true},barbarianwrathfemalepink:{0:true},herobarbarianultimatesonya:{5:true},sonyaultimatered:{5:true},sonyaultimatenordic:{5:true},tyrandeskinbloodelf:{0:true},tyrandebloodelfred:{0:true},tyrandebloodelfblue:{0:true}};ZamModelViewer.Heroes.Mesh.prototype={destroy:function(){var self=this,gl=self.model.renderer.context;if(self.ib)gl.deleteBuffer(self.ib);self.ib=null;self.indices=null;self.model=null;self.material=null}};ZamModelViewer.Heroes.Mesh.prototype.draw=function(){var self=this,gl=self.model.renderer.context;if(self.material)self.material.bind(self.blendOverride);if(!self.ib){self.ib=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(self.indices),gl.STATIC_DRAW)}else{gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.ib)}gl.drawElements(gl.TRIANGLES,self.iCount,gl.UNSIGNED_SHORT,0)};ZamModelViewer.Heroes.Bone=function(model,index,r){var self=this,H=ZamModelViewer.Heroes;self.model=model;self.index=index;self.name=r.getString();self.flags=r.getUint32();self.parentId=r.getInt16();self.translation=new H.AnimVec3(r);self.rotation=new H.AnimQuaternion(r);self.scale=new H.AnimVec3(r);self.matrix=mat4.create();self.tmpMat=mat4.create();self.tmpVec=vec4.create();self.tmpQuat=quat.create();self.scaleLength=0;self.updated=false;self.show=H.Bone.disabledBones[model.model]&&H.Bone.disabledBones[model.model][self.name]?false:true};ZamModelViewer.Heroes.Bone.disabledBones={};ZamModelViewer.Heroes.Bone.prototype={destroy:function(){var self=this;if(self.translation)self.translation.destroy();if(self.rotation)self.rotation.destroy();if(self.scale)self.scale.destroy();self.translation=null;self.rotation=null;self.scale=null;self.matrix=null;self.tmpMat=null;self.tmpVec=null;self.tmpQuat=null;self.model=null;self.parent=null}};ZamModelViewer.Heroes.Animation=function(index,r){var self=this;self.index=index;self.name=r.getString();self.seqStart=r.getInt32();self.seqEnd=r.getInt32();self.flags=r.getUint32();self.moveSpeed=r.getFloat();self.frequency=r.getInt32();self.replayStart=r.getInt32();self.replayEnd=r.getInt32()};ZamModelViewer.Heroes.AnimData=function(r){var self=this,H=ZamModelViewer.Heroes,i;self.name=r.getString();self.index=r.getUint16();self.index2=r.getUint16();var numAnimIds=r.getInt32();self.animIds=new Array(numAnimIds);for(i=0;i<numAnimIds;++i)self.animIds[i]=r.getUint32();var numAnimIndices=r.getInt32();self.animIndices=new Array(numAnimIndices);for(i=0;i<numAnimIndices;++i){self.animIndices[i]=new H.AnimData.Index(r)}var numTranslations=r.getInt32();self.translations=new Array(numTranslations);for(i=0;i<numTranslations;++i){self.translations[i]=new H.AnimData.Vec3(r)}var numRotations=r.getInt32();self.rotations=new Array(numRotations);for(i=0;i<numRotations;++i){self.rotations[i]=new H.AnimData.Quaternion(r)}var numColors=r.getInt32();self.colors=new Array(numColors);for(i=0;i<numColors;++i){self.colors[i]=new H.AnimData.Color(r)}};ZamModelViewer.Heroes.AnimData.prototype={destroy:function(){var self=this,i;self.animIds=null;if(self.animIndices)for(i=0;i<self.animIndices.length;++i)self.animIndices[i]=null;self.animIndices=null;if(self.translations){for(i=0;i<self.translations.length;++i){self.translations[i].destroy();self.translations[i]=null}self.translations=null}if(self.rotations){for(i=0;i<self.rotations.length;++i){self.rotations[i].destroy();self.rotations[i]=null}self.rotations=null}if(self.colors){for(i=0;i<self.colors.length;++i){self.colors[i].destroy();self.colors[i]=null}self.colors=null}}};ZamModelViewer.Heroes.AnimData.Index=function(r){var self=this;self.animIndex=r.getUint16();self.dataIndex=r.getUint16()};ZamModelViewer.Heroes.AnimData.Lookup=function(r){var self=this;self.name=r.getString();var numIndices=r.getInt32();self.indices=new Array(numIndices);for(var i=0;i<numIndices;++i){self.indices[i]=r.getUint32()}};ZamModelViewer.Heroes.AnimData.Lookup.prototype={destroy:function(){this.indices=null}};ZamModelViewer.Heroes.AnimData.Base=function(){};ZamModelViewer.Heroes.AnimData.Base.prototype={destroy:function(){var self=this,i;self.timeline=null;if(self.values){for(i=0;i<self.values.length;++i){self.values[i]=null}self.values=null}},read:function(r){var self=this,i;var numTimes=r.getInt32();self.timeline=new Array(numTimes);for(i=0;i<numTimes;++i){self.timeline[i]=r.getInt32()}self.flags=r.getUint32();self.length=r.getUint32();var numValues=r.getInt32();self.values=new Array(numValues);for(i=0;i<numValues;++i){self.values[i]=self.readValue(r)}},defaultValue:0,createValue:function(){return this.defaultValue},setDefault:function(v){this.defaultValue=v},interpolate:function(v1,v2,r,result){result=v1+(v2-v1)*r;return result},set:function(result,value){result=value;return result},getDefault:function(r){r=this.defaultValue;return r},readValue:function(r){return null},getValue:function(time,result){var self=this;if(time>self.length)time%=self.length;var lastIdx=0,numTimes=self.timeline.length-1;for(var i=0;i<numTimes;++i){if(self.timeline[i]<time)lastIdx=i;else break}if(lastIdx<numTimes){var r=(time-self.timeline[lastIdx])/(self.timeline[lastIdx+1]-self.timeline[lastIdx]);result=self.interpolate(self.values[lastIdx],self.values[lastIdx+1],r,result)}else{result=self.set(result,self.values[lastIdx])}return result}};ZamModelViewer.Heroes.AnimData.Vec3=function(r){var self=this;self.read(r)};ZamModelViewer.Heroes.AnimData.Vec3.prototype=new ZamModelViewer.Heroes.AnimData.Base;ZamModelViewer.Heroes.AnimData.Vec3.prototype.constructor=ZamModelViewer.Heroes.AnimData.Vec3;ZamModelViewer.Heroes.AnimData.Vec3.prototype.createValue=function(){return vec3.clone(this.defaultValue)};ZamModelViewer.Heroes.AnimData.Vec3.prototype.defaultValue=vec3.create();ZamModelViewer.Heroes.AnimData.Vec3.prototype.getDefault=function(result){vec3.copy(result,this.defaultValue);return result};ZamModelViewer.Heroes.AnimData.Vec3.prototype.interpolate=function(v1,v2,r,result){return vec3.lerp(result,v1,v2,r)};ZamModelViewer.Heroes.AnimData.Vec3.prototype.set=function(result,value){vec3.copy(result,value);return result};ZamModelViewer.Heroes.AnimData.Vec3.prototype.readValue=function(r){return vec3.set(vec3.create(),r.getFloat(),r.getFloat(),r.getFloat())};ZamModelViewer.Heroes.AnimData.Quaternion=function(r){var self=this;self.read(r)};ZamModelViewer.Heroes.AnimData.Quaternion.prototype=new ZamModelViewer.Heroes.AnimData.Base;ZamModelViewer.Heroes.AnimData.Quaternion.prototype.constructor=ZamModelViewer.Heroes.AnimData.Quaternion;ZamModelViewer.Heroes.AnimData.Quaternion.prototype.createValue=function(){return quat.clone(this.defaultValue)};ZamModelViewer.Heroes.AnimData.Quaternion.prototype.defaultValue=quat.create();ZamModelViewer.Heroes.AnimData.Quaternion.prototype.getDefault=function(result){quat.copy(result,this.defaultValue);return result};ZamModelViewer.Heroes.AnimData.Quaternion.prototype.interpolate=function(v1,v2,r,result){return quat.slerp(result,v1,v2,r)};ZamModelViewer.Heroes.AnimData.Quaternion.prototype.set=function(result,value){quat.copy(result,value);return result};ZamModelViewer.Heroes.AnimData.Quaternion.prototype.readValue=function(r){return quat.set(quat.create(),r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat())};ZamModelViewer.Heroes.AnimData.Color=function(r){var self=this;self.read(r)};ZamModelViewer.Heroes.AnimData.Color.prototype=new ZamModelViewer.Heroes.AnimData.Base;ZamModelViewer.Heroes.AnimData.Color.prototype.constructor=ZamModelViewer.Heroes.AnimData.Color;ZamModelViewer.Heroes.AnimData.Color.prototype.createValue=function(){return vec4.clone(this.defaultValue)};ZamModelViewer.Heroes.AnimData.Color.prototype.defaultValue=vec4.create();ZamModelViewer.Heroes.AnimData.Color.prototype.getDefault=function(result){vec4.copy(result,this.defaultValue);return result};ZamModelViewer.Heroes.AnimData.Color.prototype.interpolate=function(v1,v2,r,result){return vec4.lerp(result,v1,v2,r)};ZamModelViewer.Heroes.AnimData.Color.prototype.set=function(result,value){vec4.copy(result,value);return result};ZamModelViewer.Heroes.AnimData.Color.prototype.readValue=function(r){return vec4.set(vec4.create(),r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat())};ZamModelViewer.Heroes.AnimReference=function(){};ZamModelViewer.Heroes.AnimReference.prototype={read:function(r){var self=this;self.flags=r.getUint16();self.animFlags=r.getUint16();self.animId=r.getUint32()}};ZamModelViewer.Heroes.AnimVec3=function(r){var self=this;self.read(r);self.value=[r.getFloat(),r.getFloat(),r.getFloat()]};ZamModelViewer.Heroes.AnimVec3.prototype=new ZamModelViewer.Heroes.AnimReference;ZamModelViewer.Heroes.AnimVec3.prototype.constructor=ZamModelViewer.Heroes.AnimVec3;ZamModelViewer.Heroes.AnimQuaternion=function(r){var self=this;self.read(r);self.value=[r.getFloat(),r.getFloat(),r.getFloat(),r.getFloat()]};ZamModelViewer.Heroes.AnimQuaternion.prototype=new ZamModelViewer.Heroes.AnimReference;ZamModelViewer.Heroes.AnimQuaternion.prototype.constructor=ZamModelViewer.Heroes.AnimQuaternion;ZamModelViewer.Heroes.Texture=function(model,url){var self=this;self.model=model;self.url=model.opts.contentPath+"textures/"+url;if(model.opts.cacheBuster){self.url+="?"+model.opts.cacheBuster}else{self.url+="?1"}self.alphaUrl=self.url.replace(".png",".alpha.png");self.texture=null;self.alphaTexture=null;self.load()};ZamModelViewer.Heroes.Texture.prototype={destroy:function(){var self=this,gl=self.model.renderer.context;if(self.texture)gl.deleteTexture(self.texture);if(self.alphaTexture)gl.deleteTexture(self.alphaTexture);self.texture=null;self.alphatexture=null;self.img=null;self.alphaImg=null;self.model=null},load:function(){var self=this,gl=self.model.renderer.context;(function(self,gl){self.img=new Image;self.img.crossOrigin="";self.img.onload=function(){self.img.loaded=true;self.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.img);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR)};self.img.onerror=function(){self.img=null;self.error=true};self.img.src=self.url;self.alphaImg=new Image;self.alphaImg.crossOrigin="";self.alphaImg.onload=function(){self.alphaImg.loaded=true;self.alphaTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,self.alphaTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.alphaImg);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR)};self.alphaImg.onerror=function(){self.alphaImg=null};self.alphaImg.src=self.alphaUrl})(self,gl)}};
//# sourceMappingURL=viewer.min.js.map